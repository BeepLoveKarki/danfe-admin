function _createForOfIteratorHelper(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var c=0,a=function(){};return{s:a,n:function(){return c>=e.length?{done:!0}:{done:!1,value:e[c++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,r=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw r}}}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],c=!0,a=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(c=(i=o.next()).done)&&(n.push(i.value),!t||n.length!==t);c=!0);}catch(s){a=!0,r=s}finally{try{c||null==o.return||o.return()}finally{if(a)throw r}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var c=_superPropBase(e,t);if(c){var a=Object.getOwnPropertyDescriptor(c,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,c=new Array(t);n<t;n++)c[n]=e[n];return c}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,c=_getPrototypeOf(e);if(t){var a=_getPrototypeOf(this).constructor;n=Reflect.construct(c,arguments,a)}else n=c.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var c=t[n];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(e,c.key,c)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{FGij:function(e,t,n){"use strict";n.r(t);var c=n("D57K"),a=n("EM62"),r=n("sEIs"),i=n("ixhn"),o=n("OxKu"),s=n("YtkY"),l=n("mWib"),u=n("kuMc"),d=n("ruxD"),p=n("TLy2"),f=n("jIqt"),m=n("Ohay"),b=n("8j5Y"),g=n("wqq/"),v=n("J+dc"),h=n("cJ9h"),y=n("7SLS"),C=n("pBDD"),O=n("mW0F");function V(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){var n;"function"==typeof t[t.length-1]&&(n=t.pop());var c=t;return e.lift(new k(c,n))}}var k=function(){function e(t,n){_classCallCheck(this,e),this.observables=t,this.project=n}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new x(e,this.observables,this.project))}}]),e}(),x=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,c,a){var r;_classCallCheck(this,n),(r=t.call(this,e)).observables=c,r.project=a,r.toRespond=[];var i=c.length;r.values=new Array(i);for(var o=0;o<i;o++)r.toRespond.push(o);for(var s=0;s<i;s++){var l=c[s];r.add(Object(O.a)(_assertThisInitialized(r),l,l,s))}return r}return _createClass(n,[{key:"notifyNext",value:function(e,t,n,c,a){this.values[n]=t;var r=this.toRespond;if(r.length>0){var i=r.indexOf(n);-1!==i&&r.splice(i,1)}}},{key:"notifyComplete",value:function(){}},{key:"_next",value:function(e){if(0===this.toRespond.length){var t=[e].concat(_toConsumableArray(this.values));this.project?this._tryProject(t):this.destination.next(t)}}},{key:"_tryProject",value:function(e){var t;try{t=this.project.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)}}]),n}(C.a),P=n("Efrr"),F=n("5uGe"),I=n("ryP2");var j=function(){function e(t,n){_classCallCheck(this,e),this.delay=t,this.scheduler=n}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new _(e,this.delay,this.scheduler))}}]),e}(),_=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,c,a){var r;return _classCallCheck(this,n),(r=t.call(this,e)).delay=c,r.scheduler=a,r.queue=[],r.active=!1,r.errored=!1,r}return _createClass(n,[{key:"_schedule",value:function(e){this.active=!0,this.destination.add(e.schedule(n.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))}},{key:"scheduleNotification",value:function(e){if(!0!==this.errored){var t=this.scheduler,n=new S(t.now()+this.delay,e);this.queue.push(n),!1===this.active&&this._schedule(t)}}},{key:"_next",value:function(e){this.scheduleNotification(I.a.createNext(e))}},{key:"_error",value:function(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()}},{key:"_complete",value:function(){this.scheduleNotification(I.a.createComplete()),this.unsubscribe()}}],[{key:"dispatch",value:function(e){for(var t=e.source,n=t.queue,c=e.scheduler,a=e.destination;n.length>0&&n[0].time-c.now()<=0;)n.shift().notification.observe(a);if(n.length>0){var r=Math.max(0,n[0].time-c.now());this.schedule(e,r)}else this.unsubscribe(),t.active=!1}}]),n}(F.a),S=function e(t,n){_classCallCheck(this,e),this.time=t,this.notification=n},E=n("xVbo"),w=n("nIj0"),A=n("8hOy"),M=n("HM3f"),z=n("6Oco"),D=n("C05f"),T=n("ZTXN"),$=n("ROBh"),Z=n("P4Xx"),N=n("47ST"),L=n("GoAz"),G=n("g6G6"),U=n("hbhS"),K=n("hG4v"),B=n("2kYt"),R=n("Ui7s"),q=n("qzMg"),Y=n("jY47"),H=n("oqI+"),J=n("qvOF"),W=n("s2Ay"),Q=n("iNDR"),X=n("Kej3");function ee(e,t){if(1&e){var n=a.oc();a.nc(0,"button",4),a.vc("click",(function(){return a.Sc(n),a.xc().save()})),a.bd(1),a.yc(2,"translate"),a.mc()}if(2&e){var c=a.xc();a.Ec("disabled",c.detailForm.invalid||c.detailForm.pristine),a.Vb(1),a.dd(" ",a.zc(2,2,"common.update")," ")}}n.d(t,"ApplyFacetDialogComponent",(function(){return wc})),n.d(t,"AssetDetailComponent",(function(){return xc})),n.d(t,"AssetListComponent",(function(){return Pc})),n.d(t,"AssetResolver",(function(){return Lc})),n.d(t,"AssignProductsToChannelDialogComponent",(function(){return Ac})),n.d(t,"CatalogModule",(function(){return ya})),n.d(t,"CollectionContentsComponent",(function(){return Fc})),n.d(t,"CollectionDetailComponent",(function(){return Ic})),n.d(t,"CollectionListComponent",(function(){return jc})),n.d(t,"CollectionResolver",(function(){return Gc})),n.d(t,"CollectionTreeComponent",(function(){return sa})),n.d(t,"CollectionTreeNodeComponent",(function(){return la})),n.d(t,"FacetDetailComponent",(function(){return _c})),n.d(t,"FacetListComponent",(function(){return Sc})),n.d(t,"FacetResolver",(function(){return Uc})),n.d(t,"GenerateProductVariantsComponent",(function(){return ua})),n.d(t,"OPTION_VALUE_INPUT_VALUE_ACCESSOR",(function(){return da})),n.d(t,"OptionValueInputComponent",(function(){return pa})),n.d(t,"ProductAssetsComponent",(function(){return fa})),n.d(t,"ProductDetailComponent",(function(){return Mc})),n.d(t,"ProductDetailService",(function(){return Ec})),n.d(t,"ProductListComponent",(function(){return Zc})),n.d(t,"ProductResolver",(function(){return Kc})),n.d(t,"ProductSearchInputComponent",(function(){return $c})),n.d(t,"ProductSearchSelectionModel",(function(){return zc})),n.d(t,"ProductSearchSelectionModelFactory",(function(){return Dc})),n.d(t,"ProductVariantsEditorComponent",(function(){return Nc})),n.d(t,"ProductVariantsListComponent",(function(){return ga})),n.d(t,"ProductVariantsResolver",(function(){return Bc})),n.d(t,"ProductVariantsTableComponent",(function(){return va})),n.d(t,"UpdateProductOptionDialogComponent",(function(){return ba})),n.d(t,"VariantPriceDetailComponent",(function(){return ha})),n.d(t,"arrayToTree",(function(){return oa})),n.d(t,"assetBreadcrumb",(function(){return ia})),n.d(t,"catalogRoutes",(function(){return ta})),n.d(t,"collectionBreadcrumb",(function(){return ra})),n.d(t,"facetBreadcrumb",(function(){return aa})),n.d(t,"productBreadcrumb",(function(){return na})),n.d(t,"productVariantEditorBreadcrumb",(function(){return ca})),n.d(t,"\u02750",(function(){return Rc})),n.d(t,"\u02751",(function(){return qc})),n.d(t,"\u02752",(function(){return Yc})),n.d(t,"\u02753",(function(){return Hc})),n.d(t,"\u02754",(function(){return Jc})),n.d(t,"\u02755",(function(){return Wc})),n.d(t,"\u02756",(function(){return Qc})),n.d(t,"\u02757",(function(){return Xc})),n.d(t,"\u02758",(function(){return ea}));var te=function(){return{}};function ne(e,t){1&e&&a.jc(0)}var ce=function(){return{tab:"variants"}},ae=function(e,t){return["/catalog/products",e,t]};function re(e,t){if(1&e&&(a.nc(0,"td",5),a.bd(1),a.mc(),a.nc(2,"td",6),a.ic(3,"vdr-table-row-action",7),a.yc(4,"translate"),a.mc()),2&e){var n=t.item;a.Vb(1),a.cd(n.name),a.Vb(2),a.Ec("label",a.zc(4,3,"common.edit"))("linkTo",a.Kc(6,ae,n.productId,a.Ic(5,ce)))}}var ie=function(e){return{$implicit:e}},oe=["collectionContents"];function se(e,t){if(1&e){var n=a.oc();a.nc(0,"button",6),a.vc("click",(function(){return a.Sc(n),a.xc().create()})),a.bd(1),a.yc(2,"translate"),a.mc()}if(2&e){var c=a.xc();a.Ec("disabled",c.detailForm.invalid||c.detailForm.pristine),a.Vb(1),a.dd(" ",a.zc(2,2,"common.create")," ")}}function le(e,t){if(1&e){var n=a.oc();a.nc(0,"button",6),a.vc("click",(function(){return a.Sc(n),a.xc(2).save()})),a.bd(1),a.yc(2,"translate"),a.mc()}if(2&e){var c=a.xc(2);a.Ec("disabled",(c.detailForm.invalid||c.detailForm.pristine)&&!c.assetsChanged()),a.Vb(1),a.dd(" ",a.zc(2,2,"common.update")," ")}}function ue(e,t){1&e&&a.Zc(0,le,3,4,"button",7),2&e&&a.Ec("vdrIfPermissions","UpdateCatalog")}function de(e,t){1&e&&(a.lc(0),a.bd(1),a.yc(2,"translate"),a.kc()),2&e&&(a.Vb(1),a.cd(a.zc(2,1,"catalog.public")))}function pe(e,t){1&e&&(a.bd(0),a.yc(1,"translate")),2&e&&a.cd(a.zc(1,1,"catalog.private"))}var fe=function(){return["customFields"]};function me(e,t){if(1&e&&a.ic(0,"vdr-custom-field-control",31),2&e){var n=a.xc().$implicit,c=a.xc(3);a.Ec("customFieldsFormGroup",c.detailForm.get(a.Ic(2,fe)))("customField",n)}}function be(e,t){if(1&e&&(a.lc(0),a.Zc(1,me,1,3,"vdr-custom-field-control",30),a.kc()),2&e){var n=t.$implicit,c=a.xc(3);a.Vb(1),a.Ec("ngIf",c.customFieldIsSet(n.name))}}function ge(e,t){if(1&e&&(a.nc(0,"section",29),a.nc(1,"label"),a.bd(2),a.yc(3,"translate"),a.mc(),a.Zc(4,be,2,1,"ng-container",25),a.mc()),2&e){var n=a.xc(2);a.Vb(2),a.cd(a.zc(3,2,"common.custom-fields")),a.Vb(2),a.Ec("ngForOf",n.customFields)}}function ve(e,t){if(1&e){var n=a.oc();a.lc(0),a.nc(1,"vdr-configurable-input",32),a.vc("remove",(function(e){return a.Sc(n),a.xc(2).removeFilter(e)})),a.yc(2,"async"),a.yc(3,"hasPermission"),a.yc(4,"async"),a.mc(),a.kc()}if(2&e){var c=t.$implicit,r=t.index,i=a.xc(2);a.Vb(1),a.Ec("facets",a.zc(2,6,i.facets$))("operation",c)("operationDefinition",i.getFilterDefinition(c))("formControlName",r)("readonly",!a.zc(3,8,"UpdateCatalog"))("activeChannel",a.zc(4,10,i.activeChannel$))}}function he(e,t){if(1&e){var n=a.oc();a.nc(0,"button",37),a.vc("click",(function(){a.Sc(n);var e=t.$implicit;return a.xc(3).addFilter(e)})),a.bd(1),a.mc()}if(2&e){var c=t.$implicit;a.Vb(1),a.dd(" ",c.description," ")}}function ye(e,t){if(1&e&&(a.nc(0,"div"),a.nc(1,"vdr-dropdown"),a.nc(2,"button",33),a.ic(3,"clr-icon",34),a.bd(4),a.yc(5,"translate"),a.mc(),a.nc(6,"vdr-dropdown-menu",35),a.Zc(7,he,2,1,"button",36),a.mc(),a.mc(),a.mc()),2&e){var n=a.xc(2);a.Vb(4),a.dd(" ",a.zc(5,2,"marketing.add-condition")," "),a.Vb(3),a.Ec("ngForOf",n.allFilters)}}var Ce=function(e){return{count:e}};function Oe(e,t){if(1&e&&(a.nc(0,"div",38),a.bd(1),a.yc(2,"translate"),a.yc(3,"translate"),a.mc()),2&e){var n=t.$implicit;a.Vb(1),a.ed(" ",a.zc(2,2,"catalog.collection-contents")," (",a.Ac(3,4,"common.results-count",a.Jc(7,Ce,n)),") ")}}var Ve=function(e){return{pattern:e}};function ke(e,t){if(1&e){var n=a.oc();a.nc(0,"form",8),a.nc(1,"div",9),a.nc(2,"div",10),a.nc(3,"vdr-form-field",11),a.yc(4,"translate"),a.nc(5,"clr-toggle-wrapper"),a.ic(6,"input",12),a.yc(7,"hasPermission"),a.nc(8,"label",13),a.Zc(9,de,3,3,"ng-container",14),a.Zc(10,pe,2,3,"ng-template",null,15,a.ad),a.mc(),a.mc(),a.mc(),a.nc(12,"vdr-form-field",16),a.yc(13,"translate"),a.nc(14,"input",17),a.vc("input",(function(e){return a.Sc(n),a.xc().updateSlug(e.target.value)})),a.yc(15,"hasPermission"),a.mc(),a.mc(),a.nc(16,"vdr-form-field",18),a.yc(17,"translate"),a.yc(18,"translate"),a.ic(19,"input",19),a.yc(20,"hasPermission"),a.mc(),a.ic(21,"vdr-rich-text-editor",20),a.yc(22,"hasPermission"),a.yc(23,"translate"),a.Zc(24,ge,5,4,"section",21),a.mc(),a.nc(25,"div",22),a.nc(26,"vdr-product-assets",23),a.vc("change",(function(e){return a.Sc(n),a.xc().assetChanges=e})),a.mc(),a.mc(),a.mc(),a.nc(27,"div",24),a.nc(28,"div",10),a.nc(29,"label"),a.bd(30),a.yc(31,"translate"),a.mc(),a.Zc(32,ve,5,12,"ng-container",25),a.Zc(33,ye,8,4,"div",26),a.mc(),a.nc(34,"div",10),a.nc(35,"vdr-collection-contents",27,28),a.Zc(37,Oe,4,9,"ng-template"),a.mc(),a.mc(),a.mc(),a.mc()}if(2&e){var c=t.ngIf,r=a.Pc(11),i=a.xc();a.Ec("formGroup",i.detailForm),a.Vb(3),a.Ec("label",a.zc(4,19,"catalog.visibility")),a.Vb(3),a.Ec("vdrDisabled",!a.zc(7,21,"UpdateCatalog")),a.Vb(3),a.Ec("ngIf",i.detailForm.value.visible)("ngIfElse",r),a.Vb(3),a.Ec("label",a.zc(13,23,"common.name")),a.Vb(2),a.Ec("readonly",!a.zc(15,25,"UpdateCatalog")),a.Vb(2),a.Ec("label",a.zc(17,27,"catalog.slug"))("errors",a.Jc(39,Ve,a.zc(18,29,"catalog.slug-pattern-error"))),a.Vb(3),a.Ec("readonly",!a.zc(20,31,"UpdateCatalog")),a.Vb(2),a.Ec("readonly",!a.zc(22,33,"UpdateCatalog"))("label",a.zc(23,35,"common.description")),a.Vb(3),a.Ec("ngIf",i.customFields.length),a.Vb(2),a.Ec("assets",c.assets)("featuredAsset",c.featuredAsset),a.Vb(4),a.cd(a.zc(31,37,"catalog.filters")),a.Vb(2),a.Ec("ngForOf",i.filters),a.Vb(1),a.Ec("vdrIfPermissions","UpdateCatalog"),a.Vb(2),a.Ec("collectionId",i.id)}}var xe=function(){return["./create"]};function Pe(e,t){1&e&&(a.nc(0,"a",8),a.ic(1,"clr-icon",9),a.bd(2),a.yc(3,"translate"),a.mc()),2&e&&(a.Ec("routerLink",a.Ic(4,xe)),a.Vb(2),a.dd(" ",a.zc(3,2,"catalog.create-new-collection")," "))}function Fe(e,t){if(1&e){var n=a.oc();a.nc(0,"div",10),a.bd(1),a.yc(2,"async"),a.yc(3,"translate"),a.mc(),a.nc(4,"button",11),a.vc("click",(function(){return a.Sc(n),a.xc().closeContents()})),a.ic(5,"clr-icon",12),a.mc()}if(2&e){var c=t.$implicit,r=a.xc();a.Vb(1),a.ed(" ",a.zc(2,2,r.activeCollectionTitle$)," (",a.Ac(3,4,"common.results-count",a.Jc(7,Ce,c)),") ")}}function Ie(e,t){if(1&e){var n=a.oc();a.nc(0,"button",6),a.vc("click",(function(){return a.Sc(n),a.xc().create()})),a.bd(1),a.yc(2,"translate"),a.mc()}if(2&e){var c=a.xc();a.Ec("disabled",c.detailForm.invalid||c.detailForm.pristine),a.Vb(1),a.dd(" ",a.zc(2,2,"common.create")," ")}}function je(e,t){if(1&e){var n=a.oc();a.nc(0,"button",6),a.vc("click",(function(){return a.Sc(n),a.xc(2).save()})),a.bd(1),a.yc(2,"translate"),a.mc()}if(2&e){var c=a.xc(2);a.Ec("disabled",c.detailForm.invalid||c.detailForm.pristine),a.Vb(1),a.dd(" ",a.zc(2,2,"common.update")," ")}}function _e(e,t){1&e&&a.Zc(0,je,3,4,"button",7),2&e&&a.Ec("vdrIfPermissions","UpdateCatalog")}function Se(e,t){1&e&&(a.lc(0),a.bd(1),a.yc(2,"translate"),a.kc()),2&e&&(a.Vb(1),a.cd(a.zc(2,1,"catalog.public")))}function Ee(e,t){1&e&&(a.bd(0),a.yc(1,"translate")),2&e&&a.cd(a.zc(1,1,"catalog.private"))}var we=function(){return["facet","customFields"]};function Ae(e,t){if(1&e&&a.ic(0,"vdr-custom-field-control",24),2&e){var n=a.xc().$implicit,c=a.xc(3);a.Ec("customFieldsFormGroup",c.detailForm.get(a.Ic(2,we)))("customField",n)}}function Me(e,t){if(1&e&&(a.lc(0),a.Zc(1,Ae,1,3,"vdr-custom-field-control",23),a.kc()),2&e){var n=t.$implicit,c=a.xc(3);a.Vb(1),a.Ec("ngIf",c.customFieldIsSet(n.name))}}function ze(e,t){if(1&e&&(a.nc(0,"section",21),a.nc(1,"label"),a.bd(2),a.yc(3,"translate"),a.mc(),a.Zc(4,Me,2,1,"ng-container",22),a.mc()),2&e){var n=a.xc(2);a.Vb(2),a.cd(a.zc(3,2,"common.custom-fields")),a.Vb(2),a.Ec("ngForOf",n.customFields)}}function De(e,t){if(1&e&&(a.lc(0),a.nc(1,"th"),a.bd(2),a.mc(),a.kc()),2&e){var n=t.$implicit;a.Vb(2),a.cd(n.name)}}var Te=function(e){return["values",e,"customFields"]};function $e(e,t){if(1&e&&a.ic(0,"vdr-custom-field-control",40),2&e){var n=a.xc().$implicit,c=a.xc().index,r=a.xc(4);a.Ec("showLabel",!1)("customFieldsFormGroup",r.detailForm.get(a.Jc(3,Te,c)))("customField",n)}}function Ze(e,t){if(1&e&&(a.lc(0),a.nc(1,"td",31),a.Zc(2,$e,1,5,"vdr-custom-field-control",39),a.mc(),a.kc()),2&e){var n=t.$implicit,c=a.xc().index,r=a.xc(4);a.Vb(2),a.Ec("ngIf",r.customValueFieldIsSet(c,n.name))}}function Ne(e,t){if(1&e){var n=a.oc();a.nc(0,"tr",30),a.nc(1,"td",31),a.ic(2,"vdr-entity-info",0),a.mc(),a.nc(3,"td",31),a.nc(4,"input",32),a.vc("input",(function(e){a.Sc(n);var c=t.index,r=a.xc(3).ngIf;return a.xc().updateValueCode(null==r.values[c]?null:r.values[c].code,e.target.value,c)})),a.yc(5,"hasPermission"),a.mc(),a.mc(),a.nc(6,"td",31),a.ic(7,"input",33),a.mc(),a.Zc(8,Ze,3,1,"ng-container",22),a.nc(9,"td",31),a.nc(10,"vdr-dropdown"),a.nc(11,"button",34),a.bd(12),a.yc(13,"translate"),a.ic(14,"clr-icon",35),a.mc(),a.nc(15,"vdr-dropdown-menu",36),a.nc(16,"button",37),a.vc("click",(function(){a.Sc(n);var e=t.index,c=a.xc(3).ngIf;return a.xc().deleteFacetValue(null==c.values[e]?null:c.values[e].id,e)})),a.yc(17,"hasPermission"),a.ic(18,"clr-icon",38),a.bd(19),a.yc(20,"translate"),a.mc(),a.mc(),a.mc(),a.mc(),a.mc()}if(2&e){var c=t.$implicit,r=t.index,i=a.xc(4);a.Ec("formGroupName",r),a.Vb(2),a.Ec("entity",c),a.Vb(2),a.Ec("readonly",!a.zc(5,7,"UpdateCatalog")),a.Vb(4),a.Ec("ngForOf",i.customValueFields),a.Vb(4),a.dd(" ",a.zc(13,9,"common.actions")," "),a.Vb(4),a.Ec("disabled",!a.zc(17,11,"UpdateCatalog")),a.Vb(3),a.dd(" ",a.zc(20,13,"common.delete")," ")}}function Le(e,t){if(1&e&&(a.nc(0,"table",28),a.nc(1,"thead"),a.nc(2,"tr"),a.ic(3,"th"),a.nc(4,"th"),a.bd(5),a.yc(6,"translate"),a.mc(),a.nc(7,"th"),a.bd(8),a.yc(9,"translate"),a.mc(),a.Zc(10,De,3,1,"ng-container",22),a.ic(11,"th"),a.mc(),a.mc(),a.nc(12,"tbody"),a.Zc(13,Ne,21,15,"tr",29),a.mc(),a.mc()),2&e){var n=a.xc(3);a.Vb(5),a.cd(a.zc(6,4,"common.name")),a.Vb(3),a.cd(a.zc(9,6,"common.code")),a.Vb(2),a.Ec("ngForOf",n.customValueFields),a.Vb(3),a.Ec("ngForOf",n.values)}}function Ge(e,t){if(1&e){var n=a.oc();a.nc(0,"button",41),a.vc("click",(function(){return a.Sc(n),a.xc(3).addFacetValue()})),a.ic(1,"clr-icon",42),a.bd(2),a.yc(3,"translate"),a.mc()}2&e&&(a.Vb(2),a.dd(" ",a.zc(3,1,"catalog.add-facet-value")," "))}function Ue(e,t){if(1&e&&(a.nc(0,"section",25),a.nc(1,"label"),a.bd(2),a.yc(3,"translate"),a.mc(),a.Zc(4,Le,14,8,"table",26),a.nc(5,"div"),a.Zc(6,Ge,4,3,"button",27),a.mc(),a.mc()),2&e){var n=a.xc(2);a.Vb(2),a.cd(a.zc(3,3,"catalog.facet-values")),a.Vb(2),a.Ec("ngIf",0<n.getValuesFormArray().length),a.Vb(2),a.Ec("vdrIfPermissions","CreateCatalog")}}function Ke(e,t){if(1&e){var n=a.oc();a.nc(0,"form",8),a.nc(1,"section",9),a.nc(2,"vdr-form-field",10),a.yc(3,"translate"),a.nc(4,"clr-toggle-wrapper"),a.ic(5,"input",11),a.yc(6,"hasPermission"),a.nc(7,"label",12),a.Zc(8,Se,3,3,"ng-container",13),a.Zc(9,Ee,2,3,"ng-template",null,14,a.ad),a.mc(),a.mc(),a.mc(),a.nc(11,"vdr-form-field",15),a.yc(12,"translate"),a.nc(13,"input",16),a.vc("input",(function(e){a.Sc(n);var c=t.ngIf;return a.xc().updateCode(c.code,e.target.value)})),a.yc(14,"hasPermission"),a.mc(),a.mc(),a.nc(15,"vdr-form-field",17),a.yc(16,"translate"),a.yc(17,"hasPermission"),a.ic(18,"input",18),a.yc(19,"hasPermission"),a.mc(),a.Zc(20,ze,5,4,"section",19),a.mc(),a.Zc(21,Ue,7,5,"section",20),a.yc(22,"async"),a.mc()}if(2&e){var c=a.Pc(10),r=a.xc();a.Ec("formGroup",r.detailForm),a.Vb(2),a.Ec("label",a.zc(3,12,"catalog.visibility")),a.Vb(3),a.Ec("vdrDisabled",!a.zc(6,14,"UpdateCatalog")),a.Vb(3),a.Ec("ngIf",r.detailForm.value.facet.visible)("ngIfElse",c),a.Vb(3),a.Ec("label",a.zc(12,16,"common.name")),a.Vb(2),a.Ec("readonly",!a.zc(14,18,"UpdateCatalog")),a.Vb(2),a.Ec("label",a.zc(16,20,"common.code"))("readOnlyToggle",a.zc(17,22,"UpdateCatalog")),a.Vb(3),a.Ec("readonly",!a.zc(19,24,"UpdateCatalog")),a.Vb(2),a.Ec("ngIf",r.customFields.length),a.Vb(1),a.Ec("ngIf",!a.zc(22,26,r.isNew$))}}function Be(e,t){1&e&&(a.nc(0,"a",4),a.ic(1,"clr-icon",5),a.bd(2),a.yc(3,"translate"),a.mc()),2&e&&(a.Ec("routerLink",a.Ic(4,xe)),a.Vb(2),a.dd(" ",a.zc(3,2,"catalog.create-new-facet")," "))}function Re(e,t){if(1&e&&a.ic(0,"vdr-facet-value-chip",18),2&e){var n=t.$implicit;a.Ec("facetValue",n)("removable",!1)("displayFacetName",!1)}}function qe(e,t){if(1&e&&(a.lc(0),a.ic(1,"clr-icon",5),a.bd(2),a.kc()),2&e){var n=a.xc(2).item,c=a.xc();a.Vb(2),a.dd(" ",n.values.length-c.initialLimit," ")}}function Ye(e,t){1&e&&a.ic(0,"clr-icon",21)}function He(e,t){if(1&e){var n=a.oc();a.nc(0,"button",19),a.vc("click",(function(){a.Sc(n);var e=a.xc().item;return a.xc().toggleDisplayLimit(e)})),a.Zc(1,qe,3,1,"ng-container",9),a.Zc(2,Ye,1,0,"ng-template",null,20,a.ad),a.mc()}if(2&e){var c=a.Pc(3),r=a.xc().item,i=a.xc();a.Vb(1),a.Ec("ngIf",(i.displayLimit[r.id]||0)<r.values.length)("ngIfElse",c)}}function Je(e,t){1&e&&(a.lc(0),a.bd(1),a.yc(2,"translate"),a.kc()),2&e&&(a.Vb(1),a.cd(a.zc(2,1,"catalog.public")))}function We(e,t){1&e&&(a.bd(0),a.yc(1,"translate")),2&e&&a.cd(a.zc(1,1,"catalog.private"))}var Qe=function(e){return["./",e]};function Xe(e,t){if(1&e){var n=a.oc();a.nc(0,"td",6),a.bd(1),a.mc(),a.nc(2,"td",6),a.bd(3),a.mc(),a.nc(4,"td",6),a.Zc(5,Re,1,3,"vdr-facet-value-chip",7),a.yc(6,"slice"),a.Zc(7,He,4,2,"button",8),a.mc(),a.nc(8,"td",6),a.nc(9,"vdr-chip"),a.Zc(10,Je,3,3,"ng-container",9),a.Zc(11,We,2,3,"ng-template",null,10,a.ad),a.mc(),a.mc(),a.nc(13,"td",11),a.ic(14,"vdr-table-row-action",12),a.yc(15,"translate"),a.mc(),a.nc(16,"td",11),a.nc(17,"vdr-dropdown"),a.nc(18,"button",13),a.bd(19),a.yc(20,"translate"),a.ic(21,"clr-icon",14),a.mc(),a.nc(22,"vdr-dropdown-menu",15),a.nc(23,"button",16),a.vc("click",(function(){a.Sc(n);var e=t.item;return a.xc().deleteFacet(e.id)})),a.yc(24,"hasPermission"),a.ic(25,"clr-icon",17),a.bd(26),a.yc(27,"translate"),a.mc(),a.mc(),a.mc(),a.mc()}if(2&e){var c=t.item,r=a.Pc(12),i=a.xc();a.Yb("private",c.isPrivate),a.Vb(1),a.cd(c.code),a.Vb(1),a.Yb("private",c.isPrivate),a.Vb(1),a.cd(c.name),a.Vb(1),a.Yb("private",c.isPrivate),a.Vb(1),a.Ec("ngForOf",a.Bc(6,23,c.values,0,i.displayLimit[c.id]||3)),a.Vb(2),a.Ec("ngIf",c.values.length>i.initialLimit),a.Vb(1),a.Yb("private",c.isPrivate),a.Vb(2),a.Ec("ngIf",!c.isPrivate)("ngIfElse",r),a.Vb(3),a.Yb("private",c.isPrivate),a.Vb(1),a.Ec("label",a.zc(15,27,"common.edit"))("linkTo",a.Jc(35,Qe,c.id)),a.Vb(2),a.Yb("private",c.isPrivate),a.Vb(3),a.dd(" ",a.zc(20,29,"common.actions")," "),a.Vb(4),a.Ec("disabled",!a.zc(24,31,"DeleteCatalog")),a.Vb(3),a.dd(" ",a.zc(27,33,"common.delete")," ")}}function et(e,t){1&e&&(a.bd(0),a.yc(1,"translate")),2&e&&a.cd(a.zc(1,1,"catalog.add-facets"))}function tt(e,t){if(1&e){var n=a.oc();a.nc(0,"button",3),a.vc("click",(function(){return a.Sc(n),a.xc().cancel()})),a.bd(1),a.yc(2,"translate"),a.mc(),a.nc(3,"button",4),a.vc("click",(function(){return a.Sc(n),a.xc().selectValues()})),a.bd(4),a.yc(5,"translate"),a.mc()}if(2&e){var c=a.xc();a.Vb(1),a.cd(a.zc(2,3,"common.cancel")),a.Vb(2),a.Ec("disabled",0===c.selectedValues.length),a.Vb(1),a.dd(" ",a.zc(5,5,"catalog.add-facets")," ")}}function nt(e,t){1&e&&(a.bd(0),a.yc(1,"translate")),2&e&&a.cd(a.zc(1,1,"catalog.assign-products-to-channel"))}var ct=function(e){return{channel:e}};function at(e,t){if(1&e&&(a.bd(0),a.yc(1,"translate")),2&e){var n=a.xc();a.dd(" ",a.Ac(1,1,"catalog.price-in-channel",a.Jc(4,ct,null==n.selectedChannel?null:n.selectedChannel.code))," ")}}function rt(e,t){1&e&&(a.bd(0),a.yc(1,"translate")),2&e&&a.dd(" ",a.zc(1,1,"catalog.no-channel-selected")," ")}function it(e,t){if(1&e&&(a.bd(0),a.yc(1,"currency")),2&e){var n=a.xc().$implicit,c=a.xc();a.dd(" ",a.Ac(1,1,n.pricePreview/100,null==c.selectedChannel?null:c.selectedChannel.currencyCode)," ")}}function ot(e,t){1&e&&a.bd(0," - ")}function st(e,t){if(1&e&&(a.nc(0,"tr"),a.nc(1,"td"),a.bd(2),a.mc(),a.nc(3,"td"),a.bd(4),a.yc(5,"currency"),a.mc(),a.nc(6,"td"),a.Zc(7,it,2,4,"ng-template",8),a.Zc(8,ot,1,0,"ng-template",null,12,a.ad),a.mc(),a.mc()),2&e){var n=t.$implicit,c=a.Pc(9),r=a.xc();a.Vb(2),a.cd(n.name),a.Vb(2),a.cd(a.Ac(5,4,n.price/100,null==r.currentChannel?null:r.currentChannel.currencyCode)),a.Vb(3),a.Ec("ngIf",r.selectedChannel)("ngIfElse",c)}}var lt=function(e){return{channelCode:e}};function ut(e,t){if(1&e&&(a.bd(0),a.yc(1,"translate")),2&e){var n=a.xc(2);a.dd(" ",a.Ac(1,1,"catalog.assign-to-named-channel",a.Jc(4,lt,null==n.selectedChannel?null:n.selectedChannel.code))," ")}}function dt(e,t){1&e&&(a.bd(0),a.yc(1,"translate")),2&e&&a.dd(" ",a.zc(1,1,"catalog.no-channel-selected")," ")}function pt(e,t){if(1&e){var n=a.oc();a.nc(0,"button",13),a.vc("click",(function(){return a.Sc(n),a.xc().cancel()})),a.bd(1),a.yc(2,"translate"),a.mc(),a.nc(3,"button",14),a.vc("click",(function(){return a.Sc(n),a.xc().assign()})),a.Zc(4,ut,2,6,"ng-template",8),a.Zc(5,dt,2,3,"ng-template",null,9,a.ad),a.mc()}if(2&e){var c=a.Pc(6),r=a.xc();a.Vb(1),a.cd(a.zc(2,4,"common.cancel")),a.Vb(2),a.Ec("disabled",!r.selectedChannel),a.Vb(1),a.Ec("ngIf",r.selectedChannel)("ngIfElse",c)}}var ft=function(){return["product","enabled"]};function mt(e,t){if(1&e&&(a.nc(0,"clr-toggle-wrapper"),a.ic(1,"input",8),a.nc(2,"label"),a.bd(3),a.yc(4,"translate"),a.mc(),a.mc()),2&e){var n=a.xc();a.Vb(1),a.Ec("formControl",n.detailForm.get(a.Ic(4,ft))),a.Vb(2),a.cd(a.zc(4,2,"common.enabled"))}}function bt(e,t){if(1&e){var n=a.oc();a.nc(0,"button",9),a.vc("click",(function(){return a.Sc(n),a.xc().create()})),a.bd(1),a.yc(2,"translate"),a.mc()}if(2&e){var c=a.xc();a.Ec("disabled",c.detailForm.invalid||c.detailForm.pristine||!c.variantsToCreateAreValid()),a.Vb(1),a.dd(" ",a.zc(2,2,"common.create")," ")}}function gt(e,t){if(1&e){var n=a.oc();a.nc(0,"button",9),a.vc("click",(function(){return a.Sc(n),a.xc(2).save()})),a.bd(1),a.yc(2,"translate"),a.mc()}if(2&e){var c=a.xc(2);a.Ec("disabled",(c.detailForm.invalid||c.detailForm.pristine)&&!c.assetsChanged()&&!c.variantAssetsChanged()),a.Vb(1),a.dd(" ",a.zc(2,2,"common.update")," ")}}function vt(e,t){1&e&&a.Zc(0,gt,3,4,"button",10),2&e&&a.Ec("vdrIfPermissions","UpdateCatalog")}function ht(e,t){if(1&e){var n=a.oc();a.nc(0,"vdr-chip",38),a.vc("iconClick",(function(){a.Sc(n);var e=a.xc().$implicit;return a.xc(5).removeFromChannel(e.id)})),a.ic(1,"vdr-channel-badge",39),a.bd(2),a.yc(3,"channelCodeToLabel"),a.mc()}if(2&e){var c=a.xc().$implicit;a.Vb(1),a.Ec("channelCode",c.code),a.Vb(1),a.dd(" ",a.zc(3,2,c.code)," ")}}function yt(e,t){if(1&e&&(a.lc(0),a.Zc(1,ht,4,4,"vdr-chip",37),a.kc()),2&e){var n=t.$implicit,c=a.xc(5);a.Vb(1),a.Ec("ngIf",!c.isDefaultChannel(n.code))}}function Ct(e,t){if(1&e){var n=a.oc();a.nc(0,"vdr-form-item",31),a.yc(1,"translate"),a.nc(2,"div",32),a.nc(3,"div",33),a.Zc(4,yt,2,1,"ng-container",34),a.yc(5,"async"),a.mc(),a.nc(6,"button",35),a.vc("click",(function(){return a.Sc(n),a.xc(4).assignToChannel()})),a.ic(7,"clr-icon",36),a.bd(8),a.yc(9,"translate"),a.mc(),a.mc(),a.mc()}if(2&e){var c=a.xc(4);a.Ec("label",a.zc(1,3,"common.channels")),a.Vb(4),a.Ec("ngForOf",a.zc(5,5,c.productChannels$)),a.Vb(4),a.dd(" ",a.zc(9,7,"catalog.assign-to-channel")," ")}}function Ot(e,t){1&e&&(a.lc(0),a.Zc(1,Ct,10,9,"vdr-form-item",30),a.kc())}var Vt=function(){return["product","customFields"]};function kt(e,t){if(1&e&&(a.ic(0,"vdr-custom-field-control",42),a.yc(1,"hasPermission")),2&e){var n=a.xc().$implicit,c=a.xc(4);a.Ec("customFieldsFormGroup",c.detailForm.get(a.Ic(5,Vt)))("customField",n)("readonly",!a.zc(1,3,"UpdateCatalog"))}}function xt(e,t){if(1&e&&(a.lc(0),a.Zc(1,kt,2,6,"vdr-custom-field-control",41),a.kc()),2&e){var n=t.$implicit,c=a.xc(4);a.Vb(1),a.Ec("ngIf",c.customFieldIsSet(n.name))}}function Pt(e,t){if(1&e&&(a.nc(0,"section",40),a.nc(1,"label"),a.bd(2),a.yc(3,"translate"),a.mc(),a.Zc(4,xt,2,1,"ng-container",34),a.mc()),2&e){var n=a.xc(3);a.Vb(2),a.cd(a.zc(3,2,"common.custom-fields")),a.Vb(2),a.Ec("ngForOf",n.customFields)}}function Ft(e,t){if(1&e){var n=a.oc();a.nc(0,"vdr-facet-value-chip",43),a.vc("remove",(function(){a.Sc(n);var e=t.$implicit;return a.xc(3).removeProductFacetValue(e.id)})),a.yc(1,"hasPermission"),a.mc()}if(2&e){var c=t.$implicit;a.Ec("facetValue",c)("removable",a.zc(1,2,"UpdateCatalog"))}}function It(e,t){if(1&e){var n=a.oc();a.nc(0,"button",44),a.vc("click",(function(){return a.Sc(n),a.xc(3).selectProductFacetValue()})),a.ic(1,"clr-icon",45),a.bd(2),a.yc(3,"translate"),a.mc()}2&e&&(a.Vb(2),a.dd(" ",a.zc(3,1,"catalog.add-facets")," "))}function jt(e,t){if(1&e){var n=a.oc();a.nc(0,"div"),a.nc(1,"h4"),a.bd(2),a.yc(3,"translate"),a.mc(),a.nc(4,"vdr-generate-product-variants",46),a.vc("variantsChange",(function(e){return a.Sc(n),a.xc(3).createVariantsConfig=e})),a.mc(),a.mc()}2&e&&(a.Vb(2),a.cd(a.zc(3,1,"catalog.product-variants")))}function _t(e,t){if(1&e){var n=a.oc();a.nc(0,"clr-tab-content"),a.nc(1,"div",15),a.nc(2,"div",16),a.nc(3,"section",17),a.Zc(4,Ot,2,0,"ng-container",18),a.nc(5,"vdr-form-field",19),a.yc(6,"translate"),a.nc(7,"input",20),a.vc("input",(function(e){return a.Sc(n),a.xc(2).updateSlug(e.target.value)})),a.yc(8,"hasPermission"),a.mc(),a.mc(),a.nc(9,"vdr-form-field",21),a.yc(10,"translate"),a.yc(11,"translate"),a.ic(12,"input",22),a.yc(13,"hasPermission"),a.mc(),a.ic(14,"vdr-rich-text-editor",23),a.yc(15,"hasPermission"),a.yc(16,"translate"),a.Zc(17,Pt,5,4,"section",24),a.nc(18,"div",25),a.Zc(19,Ft,2,4,"vdr-facet-value-chip",26),a.yc(20,"async"),a.Zc(21,It,4,3,"button",27),a.mc(),a.mc(),a.mc(),a.nc(22,"div",28),a.nc(23,"vdr-product-assets",29),a.vc("change",(function(e){return a.Sc(n),a.xc(2).assetChanges=e})),a.mc(),a.mc(),a.mc(),a.Zc(24,jt,5,3,"div",14),a.yc(25,"async"),a.mc()}if(2&e){var c=a.xc().ngIf,r=a.xc();a.Vb(5),a.Ec("label",a.zc(6,13,"catalog.product-name")),a.Vb(2),a.Ec("readonly",!a.zc(8,15,"UpdateCatalog")),a.Vb(2),a.Ec("label",a.zc(10,17,"catalog.slug"))("errors",a.Jc(31,Ve,a.zc(11,19,"catalog.slug-pattern-error"))),a.Vb(3),a.Ec("readonly",!a.zc(13,21,"UpdateCatalog")),a.Vb(2),a.Ec("readonly",!a.zc(15,23,"UpdateCatalog"))("label",a.zc(16,25,"common.description")),a.Vb(3),a.Ec("ngIf",r.customFields.length),a.Vb(2),a.Ec("ngForOf",a.zc(20,27,r.facetValues$)),a.Vb(2),a.Ec("vdrIfPermissions","UpdateCatalog"),a.Vb(2),a.Ec("assets",c.assets)("featuredAsset",c.featuredAsset),a.Vb(1),a.Ec("ngIf",a.zc(25,29,r.isNew$))}}var St=function(){return["./","manage-variants"]};function Et(e,t){1&e&&(a.nc(0,"a",58),a.ic(1,"clr-icon",59),a.bd(2),a.yc(3,"translate"),a.mc()),2&e&&(a.Ec("routerLink",a.Ic(4,St)),a.Vb(2),a.dd(" ",a.zc(3,2,"catalog.manage-variants")," "))}function wt(e,t){if(1&e&&(a.ic(0,"vdr-product-variants-table",60),a.yc(1,"async")),2&e){var n=a.xc(3).ngIf,c=a.xc();a.Ec("variants",a.zc(1,3,c.variants$))("optionGroups",n.optionGroups)("productVariantsFormArray",c.detailForm.get("variants"))}}function At(e,t){if(1&e){var n=a.oc();a.nc(0,"vdr-product-variants-list",61),a.vc("assetChange",(function(e){return a.Sc(n),a.xc(4).variantAssetChange(e)}))("updateProductOption",(function(e){return a.Sc(n),a.xc(4).updateProductOption(e)}))("selectionChange",(function(e){return a.Sc(n),a.xc(4).selectedVariantIds=e}))("selectFacetValueClick",(function(e){return a.Sc(n),a.xc(4).selectVariantFacetValue(e)})),a.yc(1,"async"),a.yc(2,"async"),a.yc(3,"async"),a.yc(4,"async"),a.mc()}if(2&e){var c=a.xc(3).ngIf,r=a.xc();a.Ec("variants",a.zc(1,8,r.variants$))("facets",a.zc(2,10,r.facets$))("optionGroups",c.optionGroups)("productVariantsFormArray",r.detailForm.get("variants"))("taxCategories",a.zc(3,12,r.taxCategories$))("customFields",r.customVariantFields)("customOptionFields",r.customOptionFields)("activeLanguage",a.zc(4,14,r.languageCode$))}}function Mt(e,t){if(1&e){var n=a.oc();a.nc(0,"clr-tab-content"),a.nc(1,"section",47),a.nc(2,"div",48),a.nc(3,"div",49),a.nc(4,"button",50),a.vc("click",(function(){return a.Sc(n),a.xc(3).variantDisplayMode="card"})),a.ic(5,"clr-icon",51),a.bd(6),a.yc(7,"translate"),a.mc(),a.nc(8,"button",52),a.vc("click",(function(){return a.Sc(n),a.xc(3).variantDisplayMode="table"})),a.ic(9,"clr-icon",53),a.bd(10),a.yc(11,"translate"),a.mc(),a.mc(),a.ic(12,"div",54),a.Zc(13,Et,4,5,"a",55),a.mc(),a.Zc(14,wt,2,5,"vdr-product-variants-table",56),a.Zc(15,At,5,16,"vdr-product-variants-list",57),a.mc(),a.mc()}if(2&e){var c=a.xc(3);a.Vb(4),a.Yb("btn-primary","card"===c.variantDisplayMode),a.Vb(2),a.dd(" ",a.zc(7,9,"catalog.display-variant-cards")," "),a.Vb(2),a.Yb("btn-primary","table"===c.variantDisplayMode),a.Vb(2),a.dd(" ",a.zc(11,11,"catalog.display-variant-table")," "),a.Vb(3),a.Ec("vdrIfPermissions","UpdateCatalog"),a.Vb(1),a.Ec("ngIf","table"===c.variantDisplayMode),a.Vb(1),a.Ec("ngIf","card"===c.variantDisplayMode)}}function zt(e,t){if(1&e){var n=a.oc();a.nc(0,"clr-tab"),a.nc(1,"button",12),a.vc("click",(function(){return a.Sc(n),a.xc(2).navigateToTab("variants")})),a.bd(2),a.yc(3,"translate"),a.mc(),a.Zc(4,Mt,16,13,"clr-tab-content",13),a.yc(5,"async"),a.mc()}if(2&e){var c=a.xc(2);a.Vb(2),a.dd(" ",a.zc(3,2,"catalog.product-variants")," "),a.Vb(2),a.Ec("clrIfActive","variants"===a.zc(5,4,c.activeTab$))}}function Dt(e,t){if(1&e){var n=a.oc();a.nc(0,"form",11),a.vc("keydown.enter",(function(e){return a.Sc(n),e.preventDefault()})),a.nc(1,"clr-tabs"),a.nc(2,"clr-tab"),a.nc(3,"button",12),a.vc("click",(function(){return a.Sc(n),a.xc().navigateToTab("details")})),a.bd(4),a.yc(5,"translate"),a.mc(),a.Zc(6,_t,26,33,"clr-tab-content",13),a.yc(7,"async"),a.mc(),a.Zc(8,zt,6,6,"clr-tab",14),a.yc(9,"async"),a.mc(),a.mc()}if(2&e){var c=a.xc();a.Ec("formGroup",c.detailForm),a.Vb(4),a.dd(" ",a.zc(5,4,"catalog.product-details")," "),a.Vb(2),a.Ec("clrIfActive","details"===a.zc(7,6,c.activeTab$)),a.Vb(2),a.Ec("ngIf",!a.zc(9,8,c.isNew$))}}var Tt=["selectComponent"];function $t(e,t){if(1&e){var n=a.oc();a.nc(0,"div",6),a.vc("click",(function(){return a.Sc(n),a.xc(2),a.Pc(1).selectTag()})),a.bd(1),a.yc(2,"translate"),a.mc()}if(2&e){var c=a.xc(2),r=a.Pc(1);a.Yb("selected",c.isSearchHeaderSelected()),a.Vb(1),a.ed(" ",a.zc(2,4,"catalog.search-for-term"),": ",r.searchTerm," ")}}function Zt(e,t){if(1&e&&a.Zc(0,$t,3,6,"div",5),2&e){a.xc();var n=a.Pc(1);a.Ec("ngIf",n.searchTerm)}}function Nt(e,t){if(1&e){var n=a.oc();a.lc(0),a.nc(1,"vdr-facet-value-chip",8),a.vc("remove",(function(){a.Sc(n);var e=a.xc(),t=e.item;return(0,e.clear)(t)})),a.mc(),a.kc()}if(2&e){var c=a.xc().item;a.Vb(1),a.Ec("facetValue",c.facetValue)("removable",!0)}}function Lt(e,t){if(1&e){var n=a.oc();a.lc(0),a.nc(1,"vdr-chip",9),a.vc("iconClick",(function(){a.Sc(n);var e=a.xc(),t=e.item;return(0,e.clear)(t)})),a.bd(2),a.mc(),a.kc()}if(2&e){var c=a.xc().item;a.Vb(1),a.Ec("icon","times"),a.Vb(1),a.dd('"',c.label,'"')}}function Gt(e,t){if(1&e&&(a.Zc(0,Nt,2,2,"ng-container",7),a.Zc(1,Lt,3,2,"ng-container",7)),2&e){var n=t.item;a.Ec("ngIf",n.facetValue),a.Vb(1),a.Ec("ngIf",!n.facetValue)}}function Ut(e,t){if(1&e&&(a.lc(0),a.ic(1,"vdr-facet-value-chip",10),a.kc()),2&e){var n=a.xc().item;a.Vb(1),a.Ec("facetValue",n.facetValue)("removable",!1)}}function Kt(e,t){if(1&e&&a.Zc(0,Ut,2,2,"ng-container",7),2&e){var n=t.item;a.Ec("ngIf",n.facetValue)}}var Bt=["productSearchInputComponent"];function Rt(e,t){1&e&&(a.nc(0,"a",13),a.ic(1,"clr-icon",14),a.nc(2,"span",15),a.bd(3),a.yc(4,"translate"),a.mc(),a.mc()),2&e&&(a.Ec("routerLink",a.Ic(4,xe)),a.Vb(3),a.cd(a.zc(4,2,"catalog.create-new-product")))}function qt(e,t){if(1&e&&(a.ic(0,"img",28),a.yc(1,"assetPreview")),2&e){var n=t.ngIf;a.Ec("src",a.Ac(1,1,n,"tiny"),a.Uc)}}function Yt(e,t){1&e&&(a.nc(0,"div",29),a.ic(1,"clr-icon",30),a.mc())}function Ht(e,t){1&e&&(a.nc(0,"vdr-chip"),a.bd(1),a.yc(2,"translate"),a.mc()),2&e&&(a.Vb(1),a.cd(a.zc(2,1,"common.disabled")))}function Jt(e,t){if(1&e){var n=a.oc();a.nc(0,"td",16),a.nc(1,"div",17),a.Zc(2,qt,2,4,"img",18),a.Zc(3,Yt,2,0,"ng-template",null,19,a.ad),a.mc(),a.mc(),a.nc(5,"td",16),a.bd(6),a.mc(),a.nc(7,"td",20),a.Zc(8,Ht,3,3,"vdr-chip",21),a.mc(),a.nc(9,"td",22),a.ic(10,"vdr-table-row-action",23),a.yc(11,"translate"),a.mc(),a.nc(12,"td",22),a.nc(13,"vdr-dropdown"),a.nc(14,"button",24),a.bd(15),a.yc(16,"translate"),a.ic(17,"clr-icon",25),a.mc(),a.nc(18,"vdr-dropdown-menu",7),a.nc(19,"button",26),a.vc("click",(function(){a.Sc(n);var e=t.item;return a.xc().deleteProduct(e.productId)})),a.yc(20,"hasPermission"),a.ic(21,"clr-icon",27),a.bd(22),a.yc(23,"translate"),a.mc(),a.mc(),a.mc(),a.mc()}if(2&e){var c=t.item,r=a.Pc(4),i=a.xc();a.Yb("disabled",!c.enabled),a.Vb(2),a.Ec("ngIf",i.groupByProduct?c.productAsset:c.productVariantAsset||c.productAsset)("ngIfElse",r),a.Vb(3),a.Yb("disabled",!c.enabled),a.Vb(1),a.dd(" ",i.groupByProduct?c.productName:c.productVariantName," "),a.Vb(1),a.Yb("disabled",!c.enabled),a.Vb(1),a.Ec("ngIf",!c.enabled),a.Vb(1),a.Yb("disabled",!c.enabled),a.Vb(1),a.Ec("label",a.zc(11,19,"common.edit"))("linkTo",a.Jc(27,Qe,c.productId)),a.Vb(2),a.Yb("disabled",!c.enabled),a.Vb(3),a.dd(" ",a.zc(16,21,"common.actions")," "),a.Vb(4),a.Ec("disabled",!a.zc(20,23,"DeleteCatalog")),a.Vb(3),a.dd(" ",a.zc(23,25,"common.delete")," ")}}function Wt(e,t){if(1&e){var n=a.oc();a.nc(0,"div",6),a.nc(1,"div",7),a.nc(2,"label"),a.bd(3),a.yc(4,"translate"),a.mc(),a.nc(5,"input",8),a.vc("ngModelChange",(function(e){return a.Sc(n),t.$implicit.name=e})),a.mc(),a.mc(),a.nc(6,"div",9),a.nc(7,"label"),a.bd(8),a.yc(9,"translate"),a.mc(),a.nc(10,"vdr-option-value-input",10,11),a.vc("ngModelChange",(function(e){return a.Sc(n),t.$implicit.values=e}))("ngModelChange",(function(){return a.Sc(n),a.xc().generateVariants()})),a.mc(),a.mc(),a.mc()}if(2&e){var c=t.$implicit;a.Vb(3),a.cd(a.zc(4,7,"catalog.option")),a.Vb(2),a.Ec("ngModel",c.name)("readonly",!c.isNew),a.Vb(3),a.cd(a.zc(9,9,"catalog.option-values")),a.Vb(2),a.Ec("ngModel",c.values)("groupName",c.name)("disabled",""===c.name)}}function Qt(e,t){if(1&e){var n=a.oc();a.nc(0,"button",12),a.vc("click",(function(){return a.Sc(n),a.xc().addOption()})),a.ic(1,"clr-icon",13),a.bd(2),a.yc(3,"translate"),a.mc()}2&e&&(a.Vb(2),a.dd(" ",a.zc(3,1,"catalog.add-option"),"\n"))}function Xt(e,t){if(1&e){var n=a.oc();a.nc(0,"input",16),a.vc("ngModelChange",(function(e){a.Sc(n);var t=a.xc().$implicit;return a.xc().variantFormValues[t.id].enabled=e}))("ngModelChange",(function(){return a.Sc(n),a.xc(2).formValueChanged=!0})),a.mc()}if(2&e){var c=a.xc().$implicit,r=a.xc();a.Ec("ngModel",r.variantFormValues[c.id].enabled)}}function en(e,t){if(1&e){var n=a.oc();a.nc(0,"clr-input-container"),a.nc(1,"input",17),a.vc("ngModelChange",(function(e){a.Sc(n);var t=a.xc().$implicit;return a.xc().variantFormValues[t.id].sku=e}))("ngModelChange",(function(){a.Sc(n);var e=a.xc().$implicit,t=a.xc();return t.onFormChanged(t.variantFormValues[e.id])})),a.yc(2,"translate"),a.mc(),a.mc()}if(2&e){var c=a.xc().$implicit,r=a.xc();a.Vb(1),a.Ec("ngModel",r.variantFormValues[c.id].sku)("placeholder",a.zc(2,2,"catalog.sku"))}}function tn(e,t){if(1&e&&(a.nc(0,"span"),a.bd(1),a.mc()),2&e){var n=a.xc().$implicit,c=a.xc();a.Vb(1),a.cd(c.variantFormValues[n.id].sku)}}function nn(e,t){if(1&e){var n=a.oc();a.nc(0,"clr-input-container"),a.nc(1,"vdr-currency-input",18),a.vc("ngModelChange",(function(e){a.Sc(n);var t=a.xc().$implicit;return a.xc().variantFormValues[t.id].price=e}))("ngModelChange",(function(){a.Sc(n);var e=a.xc().$implicit,t=a.xc();return t.onFormChanged(t.variantFormValues[e.id])})),a.mc(),a.mc()}if(2&e){var c=a.xc().$implicit,r=a.xc();a.Vb(1),a.Ec("ngModel",r.variantFormValues[c.id].price)("currencyCode",r.currencyCode)}}function cn(e,t){if(1&e&&(a.nc(0,"span"),a.bd(1),a.yc(2,"currency"),a.mc()),2&e){var n=a.xc().$implicit,c=a.xc();a.Vb(1),a.cd(a.Ac(2,1,c.variantFormValues[n.id].price/100,c.currencyCode))}}function an(e,t){if(1&e){var n=a.oc();a.nc(0,"clr-input-container"),a.nc(1,"input",19),a.vc("ngModelChange",(function(e){a.Sc(n);var t=a.xc().$implicit;return a.xc().variantFormValues[t.id].stock=e}))("ngModelChange",(function(){a.Sc(n);var e=a.xc().$implicit,t=a.xc();return t.onFormChanged(t.variantFormValues[e.id])})),a.mc(),a.mc()}if(2&e){var c=a.xc().$implicit,r=a.xc();a.Vb(1),a.Ec("ngModel",r.variantFormValues[c.id].stock)}}function rn(e,t){if(1&e&&(a.nc(0,"span"),a.bd(1),a.mc()),2&e){var n=a.xc().$implicit,c=a.xc();a.Vb(1),a.cd(c.variantFormValues[n.id].stock)}}function on(e,t){if(1&e){var n=a.oc();a.nc(0,"vdr-dropdown"),a.nc(1,"button",20),a.ic(2,"clr-icon",21),a.mc(),a.nc(3,"vdr-dropdown-menu",22),a.nc(4,"button",23),a.vc("click",(function(){a.Sc(n);var e=t.ngIf;return a.xc(2).deleteVariant(e)})),a.ic(5,"clr-icon",24),a.bd(6),a.yc(7,"translate"),a.mc(),a.mc(),a.mc()}2&e&&(a.Vb(6),a.dd(" ",a.zc(7,1,"common.delete")," "))}function sn(e,t){if(1&e&&(a.nc(0,"tr"),a.nc(1,"td"),a.Zc(2,Xt,1,1,"input",14),a.mc(),a.nc(3,"td"),a.bd(4),a.mc(),a.nc(5,"td"),a.Zc(6,en,3,4,"clr-input-container",15),a.Zc(7,tn,2,1,"span",15),a.mc(),a.nc(8,"td"),a.Zc(9,nn,2,2,"clr-input-container",15),a.Zc(10,cn,3,4,"span",15),a.mc(),a.nc(11,"td"),a.Zc(12,an,2,1,"clr-input-container",15),a.Zc(13,rn,2,1,"span",15),a.mc(),a.nc(14,"td"),a.Zc(15,on,8,3,"vdr-dropdown",15),a.mc(),a.mc()),2&e){var n=t.$implicit,c=a.xc();a.Yb("disabled",!c.variantFormValues[n.id].enabled||c.variantFormValues[n.id].existing),a.Vb(2),a.Ec("ngIf",!c.variantFormValues[n.id].existing),a.Vb(2),a.dd(" ",c.getVariantName(n)," "),a.Vb(2),a.Ec("ngIf",!c.variantFormValues[n.id].existing),a.Vb(1),a.Ec("ngIf",c.variantFormValues[n.id].existing),a.Vb(2),a.Ec("ngIf",!c.variantFormValues[n.id].existing),a.Vb(1),a.Ec("ngIf",c.variantFormValues[n.id].existing),a.Vb(2),a.Ec("ngIf",!c.variantFormValues[n.id].existing),a.Vb(1),a.Ec("ngIf",c.variantFormValues[n.id].existing),a.Vb(2),a.Ec("ngIf",c.variantFormValues[n.id].productVariantId)}}function ln(e,t){if(1&e&&a.ic(0,"vdr-collection-tree-node",1),2&e){var n=a.xc();a.Ec("expandAll",n.expandAll)("collectionTree",n.collectionTree)("activeCollectionId",n.activeCollectionId)}}function un(e,t){1&e&&a.ic(0,"clr-icon",31)}function dn(e,t){1&e&&a.ic(0,"clr-icon",32)}function pn(e,t){if(1&e){var n=a.oc();a.nc(0,"button",28),a.vc("click",(function(){a.Sc(n);var e=a.xc().$implicit;return e.expanded=!e.expanded})),a.Zc(1,un,1,0,"clr-icon",29),a.Zc(2,dn,1,0,"clr-icon",30),a.mc()}if(2&e){var c=a.xc().$implicit,r=a.xc();a.Ec("disabled",r.expandAll),a.Vb(1),a.Ec("ngIf",!c.expanded&&!r.expandAll),a.Vb(1),a.Ec("ngIf",c.expanded||r.expandAll)}}function fn(e,t){1&e&&a.ic(0,"div",33)}function mn(e,t){1&e&&(a.nc(0,"vdr-chip"),a.bd(1),a.yc(2,"translate"),a.mc()),2&e&&(a.Vb(1),a.cd(a.zc(2,1,"catalog.private")))}function bn(e,t){1&e&&(a.nc(0,"div",34),a.ic(1,"clr-icon",35),a.mc())}var gn=function(e){return{parentId:e}},vn=function(e){return["./","create",e]};function hn(e,t){if(1&e&&(a.nc(0,"a",36),a.ic(1,"clr-icon",37),a.bd(2),a.yc(3,"translate"),a.mc()),2&e){var n=a.xc().$implicit;a.Ec("routerLink",a.Jc(6,vn,a.Jc(4,gn,n.id))),a.Vb(2),a.dd(" ",a.zc(3,2,"catalog.create-new-collection")," ")}}function yn(e,t){if(1&e){var n=a.oc();a.nc(0,"button",20),a.vc("click",(function(){a.Sc(n);var e=t.$implicit,c=a.xc().$implicit;return a.xc().move(c,e.id)})),a.yc(1,"async"),a.ic(2,"clr-icon",38),a.bd(3),a.mc()}if(2&e){var c=t.$implicit,r=a.xc(2);a.Ec("disabled",!a.zc(1,2,r.hasUpdatePermission$)),a.Vb(3),a.dd(" ",c.path," ")}}function Cn(e,t){if(1&e&&a.ic(0,"vdr-collection-tree-node",39),2&e){var n=a.xc().$implicit,c=a.xc();a.Ec("expandAll",c.expandAll)("collectionTree",n)("activeCollectionId",c.activeCollectionId)}}var On=function(e){return{contents:e}},Vn=function(e){return["/catalog/collections/",e]};function kn(e,t){if(1&e){var n=a.oc();a.nc(0,"div",3),a.nc(1,"div",4),a.nc(2,"div",5),a.Zc(3,pn,3,3,"button",6),a.Zc(4,fn,1,0,"ng-template",null,7,a.ad),a.bd(6),a.mc(),a.ic(7,"div",8),a.Zc(8,mn,3,3,"vdr-chip",9),a.nc(9,"a",10),a.ic(10,"clr-icon",11),a.bd(11),a.yc(12,"translate"),a.mc(),a.nc(13,"a",12),a.ic(14,"clr-icon",13),a.bd(15),a.yc(16,"translate"),a.mc(),a.Zc(17,bn,2,0,"div",14),a.nc(18,"vdr-dropdown"),a.nc(19,"button",15),a.ic(20,"clr-icon",16),a.mc(),a.nc(21,"vdr-dropdown-menu",17),a.Zc(22,hn,4,8,"a",18),a.ic(23,"div",19),a.nc(24,"button",20),a.vc("click",(function(){a.Sc(n);var e=t.$implicit,c=t.index;return a.xc().moveUp(e,c)})),a.yc(25,"async"),a.ic(26,"clr-icon",21),a.bd(27),a.yc(28,"translate"),a.mc(),a.nc(29,"button",20),a.vc("click",(function(){a.Sc(n);var e=t.$implicit,c=t.index;return a.xc().moveDown(e,c)})),a.yc(30,"async"),a.ic(31,"clr-icon",22),a.bd(32),a.yc(33,"translate"),a.mc(),a.nc(34,"h4",23),a.bd(35),a.yc(36,"translate"),a.mc(),a.Zc(37,yn,4,4,"button",24),a.ic(38,"div",19),a.nc(39,"button",25),a.vc("click",(function(){a.Sc(n);var e=t.$implicit;return a.xc().delete(e.id)})),a.yc(40,"async"),a.ic(41,"clr-icon",26),a.bd(42),a.yc(43,"translate"),a.mc(),a.mc(),a.mc(),a.mc(),a.Zc(44,Cn,1,3,"vdr-collection-tree-node",27),a.mc()}if(2&e){var c=t.$implicit,r=t.index,i=a.Pc(5),o=a.xc();a.Yb("private",c.isPrivate),a.Ec("cdkDragData",c),a.Vb(1),a.Yb("active",c.id===o.activeCollectionId),a.Ec("ngClass","depth-"+o.depth),a.Vb(2),a.Ec("ngIf",null==c.children?null:c.children.length)("ngIfElse",i),a.Vb(3),a.dd(" ",c.name," "),a.Vb(2),a.Ec("ngIf",c.isPrivate),a.Vb(1),a.Ec("routerLink",a.Jc(45,Qe,a.Jc(43,On,c.id))),a.Vb(2),a.dd(" ",a.zc(12,25,"catalog.view-contents")," "),a.Vb(2),a.Ec("routerLink",a.Jc(47,Vn,c.id)),a.Vb(2),a.dd(" ",a.zc(16,27,"common.edit")," "),a.Vb(2),a.Ec("vdrIfPermissions","UpdateCatalog"),a.Vb(5),a.Ec("vdrIfPermissions","CreateCatalog"),a.Vb(2),a.Ec("disabled",0===r||!a.zc(25,29,o.hasUpdatePermission$)),a.Vb(3),a.dd(" ",a.zc(28,31,"catalog.move-up")," "),a.Vb(2),a.Ec("disabled",r===o.collectionTree.children.length-1||!a.zc(30,33,o.hasUpdatePermission$)),a.Vb(3),a.dd(" ",a.zc(33,35,"catalog.move-down")," "),a.Vb(3),a.cd(a.zc(36,37,"catalog.move-to")),a.Vb(2),a.Ec("ngForOf",o.getMoveListItems(c)),a.Vb(2),a.Ec("disabled",!a.zc(40,39,o.hasDeletePermission$)),a.Vb(3),a.dd(" ",a.zc(43,41,"common.delete")," "),a.Vb(2),a.Ec("ngIf",c.expanded||o.expandAll)}}function xn(e,t){if(1&e){var n=a.oc();a.nc(0,"div",7),a.nc(1,"div",8),a.nc(2,"label"),a.bd(3),a.yc(4,"translate"),a.mc(),a.nc(5,"input",9),a.vc("ngModelChange",(function(e){return a.Sc(n),t.$implicit.name=e}))("keydown.enter",(function(e){a.Sc(n);var t=a.Pc(11);return a.xc().handleEnter(e,t)})),a.mc(),a.mc(),a.nc(6,"div",10),a.nc(7,"label"),a.bd(8),a.yc(9,"translate"),a.mc(),a.nc(10,"vdr-option-value-input",11,12),a.vc("ngModelChange",(function(e){return a.Sc(n),t.$implicit.values=e}))("ngModelChange",(function(){return a.Sc(n),a.xc().generateVariants()})),a.mc(),a.mc(),a.nc(12,"div",13),a.nc(13,"button",14),a.vc("click",(function(){a.Sc(n);var e=t.$implicit;return a.xc().removeOption(e.name)})),a.yc(14,"translate"),a.ic(15,"clr-icon",15),a.mc(),a.mc(),a.mc()}if(2&e){var c=t.$implicit;a.Vb(3),a.cd(a.zc(4,7,"catalog.option")),a.Vb(2),a.Ec("ngModel",c.name),a.Vb(3),a.cd(a.zc(9,9,"catalog.option-values")),a.Vb(2),a.Ec("ngModel",c.values)("groupName",c.name)("disabled",""===c.name),a.Vb(3),a.Ec("title",a.zc(14,11,"catalog.remove-option"))}}function Pn(e,t){1&e&&(a.nc(0,"th"),a.bd(1),a.yc(2,"translate"),a.mc()),2&e&&(a.Vb(1),a.cd(a.zc(2,1,"common.create")))}function Fn(e,t){1&e&&(a.nc(0,"th"),a.bd(1),a.yc(2,"translate"),a.mc()),2&e&&(a.Vb(1),a.cd(a.zc(2,1,"catalog.variant")))}function In(e,t){if(1&e){var n=a.oc();a.nc(0,"td"),a.nc(1,"input",19),a.vc("change",(function(){return a.Sc(n),a.xc(2).onFormChange()}))("ngModelChange",(function(e){a.Sc(n);var t=a.xc().$implicit;return a.xc().variantFormValues[t.id].enabled=e})),a.mc(),a.mc()}if(2&e){var c=a.xc().$implicit,r=a.xc();a.Vb(1),a.Ec("ngModel",r.variantFormValues[c.id].enabled)}}function jn(e,t){if(1&e&&(a.nc(0,"td"),a.bd(1),a.mc()),2&e){var n=a.xc().$implicit;a.Vb(1),a.dd(" ",n.values.join(" ")," ")}}function _n(e,t){if(1&e){var n=a.oc();a.nc(0,"tr"),a.Zc(1,In,2,1,"td",5),a.Zc(2,jn,2,1,"td",5),a.nc(3,"td"),a.nc(4,"clr-input-container"),a.nc(5,"input",16),a.vc("change",(function(){return a.Sc(n),a.xc().onFormChange()}))("ngModelChange",(function(e){a.Sc(n);var c=t.$implicit;return a.xc().variantFormValues[c.id].sku=e})),a.yc(6,"translate"),a.mc(),a.mc(),a.mc(),a.nc(7,"td"),a.nc(8,"clr-input-container"),a.nc(9,"vdr-currency-input",17),a.vc("ngModelChange",(function(e){a.Sc(n);var c=t.$implicit;return a.xc().variantFormValues[c.id].price=e}))("ngModelChange",(function(){return a.Sc(n),a.xc().onFormChange()})),a.mc(),a.mc(),a.mc(),a.nc(10,"td"),a.nc(11,"clr-input-container"),a.nc(12,"input",18),a.vc("ngModelChange",(function(e){a.Sc(n);var c=t.$implicit;return a.xc().variantFormValues[c.id].stock=e}))("change",(function(){return a.Sc(n),a.xc().onFormChange()})),a.mc(),a.mc(),a.mc(),a.mc()}if(2&e){var c=t.$implicit,r=a.xc();a.Yb("disabled",!r.variantFormValues[c.id].enabled),a.Vb(1),a.Ec("ngIf",1<r.variants.length),a.Vb(1),a.Ec("ngIf",1<r.variants.length),a.Vb(3),a.Ec("ngModel",r.variantFormValues[c.id].sku)("placeholder",a.zc(6,9,"catalog.sku")),a.Vb(4),a.Ec("ngModel",r.variantFormValues[c.id].price)("currencyCode",r.currencyCode),a.Vb(3),a.Ec("ngModel",r.variantFormValues[c.id].stock)}}var Sn=["textArea"];function En(e,t){if(1&e){var n=a.oc();a.nc(0,"vdr-chip",6),a.vc("iconClick",(function(){a.Sc(n);var e=t.$implicit;return a.xc(2).removeOption(e)})),a.bd(1),a.mc()}if(2&e){var c=t.$implicit,r=t.last,i=a.xc(2);a.Yb("selected",r&&i.lastSelected)("locked",c.locked),a.Ec("icon",c.locked?"lock":"times")("colorFrom",i.groupName),a.Vb(1),a.dd(" ",c.name," ")}}function wn(e,t){if(1&e&&(a.nc(0,"div",4),a.Zc(1,En,2,7,"vdr-chip",5),a.mc()),2&e){var n=a.xc();a.Vb(1),a.Ec("ngForOf",n.options)}}var An=["dlg"],Mn=["dl"];function zn(e,t){if(1&e){var n=a.oc();a.nc(0,"img",11),a.vc("click",(function(){a.Sc(n);var e=a.xc(2);return e.previewAsset(e.featuredAsset)})),a.yc(1,"assetPreview"),a.mc()}if(2&e){var c=a.xc(2);a.Ec("src",a.Ac(1,1,c.featuredAsset,"small"),a.Uc)}}function Dn(e,t){1&e&&(a.nc(0,"div",12),a.ic(1,"clr-icon",13),a.nc(2,"div"),a.bd(3),a.yc(4,"translate"),a.mc(),a.mc()),2&e&&(a.Vb(3),a.cd(a.zc(4,1,"catalog.no-featured-asset")))}function Tn(e,t){1&e&&a.jc(0)}function $n(e,t){if(1&e){var n=a.oc();a.nc(0,"div",14),a.nc(1,"button",15),a.vc("click",(function(){return a.Sc(n),a.xc(2).selectAssets()})),a.ic(2,"clr-icon",16),a.bd(3),a.yc(4,"translate"),a.mc(),a.mc()}2&e&&(a.Vb(3),a.dd(" ",a.zc(4,1,"asset.add-asset")," "))}function Zn(e,t){if(1&e&&(a.nc(0,"div",3),a.nc(1,"div",4),a.nc(2,"div",5),a.Zc(3,zn,2,4,"img",6),a.Zc(4,Dn,5,3,"div",7),a.mc(),a.mc(),a.nc(5,"div",8),a.Zc(6,Tn,1,0,"ng-container",9),a.mc(),a.Zc(7,$n,5,3,"div",10),a.mc()),2&e){var n=a.xc(),c=a.Pc(4);a.Vb(3),a.Ec("ngIf",n.featuredAsset),a.Vb(1),a.Ec("ngIf",!n.featuredAsset),a.Vb(2),a.Ec("ngTemplateOutlet",c),a.Vb(1),a.Ec("vdrIfPermissions","UpdateCatalog")}}function Nn(e,t){if(1&e){var n=a.oc();a.nc(0,"img",11),a.vc("click",(function(){a.Sc(n);var e=a.xc(2);return e.previewAsset(e.featuredAsset)})),a.yc(1,"assetPreview"),a.mc()}if(2&e){var c=a.xc(2);a.Ec("src",a.Ac(1,1,c.featuredAsset,"thumb"),a.Uc)}}function Ln(e,t){1&e&&(a.nc(0,"div",12),a.ic(1,"clr-icon",19),a.mc())}function Gn(e,t){1&e&&a.jc(0)}function Un(e,t){if(1&e){var n=a.oc();a.nc(0,"button",20),a.vc("click",(function(){return a.Sc(n),a.xc(2).selectAssets()})),a.yc(1,"translate"),a.ic(2,"clr-icon",16),a.bd(3),a.yc(4,"translate"),a.mc()}2&e&&(a.Ec("title",a.zc(1,2,"asset.add-asset")),a.Vb(3),a.dd(" ",a.zc(4,4,"asset.add-asset")," "))}function Kn(e,t){if(1&e&&(a.nc(0,"div",17),a.Zc(1,Nn,2,4,"img",6),a.Zc(2,Ln,2,0,"div",7),a.mc(),a.Zc(3,Gn,1,0,"ng-container",9),a.Zc(4,Un,5,6,"button",18)),2&e){var n=a.xc(),c=a.Pc(4);a.Vb(1),a.Ec("ngIf",n.featuredAsset),a.Vb(1),a.Ec("ngIf",!n.featuredAsset),a.Vb(1),a.Ec("ngTemplateOutlet",c),a.Vb(1),a.Ec("vdrIfPermissions","UpdateCatalog")}}function Bn(e,t){if(1&e){var n=a.oc();a.nc(0,"div",23),a.vc("cdkDropListDropped",(function(){return a.Sc(n),a.xc(2).dropListDropped()})),a.yc(1,"hasPermission"),a.nc(2,"vdr-dropdown",26),a.vc("cdkDragMoved",(function(e){return a.Sc(n),a.xc(2).dragMoved(e)})),a.nc(3,"div",27),a.ic(4,"img",28),a.yc(5,"assetPreview"),a.mc(),a.nc(6,"vdr-dropdown-menu",29),a.nc(7,"button",30),a.vc("click",(function(){a.Sc(n);var e=t.$implicit;return a.xc(2).previewAsset(e)})),a.bd(8),a.yc(9,"translate"),a.mc(),a.nc(10,"button",31),a.vc("click",(function(){a.Sc(n);var e=t.$implicit;return a.xc(2).setAsFeatured(e)})),a.yc(11,"hasPermission"),a.bd(12),a.yc(13,"translate"),a.mc(),a.ic(14,"div",32),a.nc(15,"button",33),a.vc("click",(function(){a.Sc(n);var e=t.$implicit;return a.xc(2).removeAsset(e)})),a.yc(16,"hasPermission"),a.bd(17),a.yc(18,"translate"),a.mc(),a.mc(),a.mc(),a.mc()}if(2&e){var c=t.$implicit,r=a.xc(2);a.Ec("cdkDropListDisabled",!a.zc(1,10,"UpdateCatalog"))("cdkDropListEnterPredicate",r.dropListEnterPredicate),a.Vb(3),a.Yb("featured",r.isFeatured(c)),a.Vb(1),a.Ec("src",a.Ac(5,12,c,"tiny"),a.Uc),a.Vb(4),a.dd(" ",a.zc(9,15,"asset.preview")," "),a.Vb(2),a.Ec("disabled",r.isFeatured(c)||!a.zc(11,17,"UpdateCatalog")),a.Vb(2),a.dd(" ",a.zc(13,19,"asset.set-as-featured-asset")," "),a.Vb(3),a.Ec("disabled",!a.zc(16,21,"UpdateCatalog")),a.Vb(2),a.dd(" ",a.zc(18,23,"asset.remove-asset")," ")}}function Rn(e,t){if(1&e){var n=a.oc();a.nc(0,"div",21,22),a.nc(2,"div",23,24),a.vc("cdkDropListDropped",(function(){return a.Sc(n),a.xc().dropListDropped()})),a.yc(4,"hasPermission"),a.mc(),a.Zc(5,Bn,19,25,"div",25),a.mc()}if(2&e){var c=a.xc();a.Yb("compact",c.compact),a.Vb(2),a.Ec("cdkDropListDisabled",!a.zc(4,5,"UpdateCatalog"))("cdkDropListEnterPredicate",c.dropListEnterPredicate),a.Vb(3),a.Ec("ngForOf",c.assets)}}function qn(e,t){1&e&&(a.bd(0),a.yc(1,"translate")),2&e&&a.cd(a.zc(1,1,"catalog.update-product-option"))}function Yn(e,t){if(1&e&&(a.ic(0,"vdr-custom-field-control",11),a.yc(1,"hasPermission")),2&e){var n=a.xc().$implicit,c=a.xc(2);a.Ec("customFieldsFormGroup",c.customFieldsForm)("customField",n)("readonly",!a.zc(1,3,"UpdateCatalog"))}}function Hn(e,t){if(1&e&&(a.lc(0),a.Zc(1,Yn,2,5,"vdr-custom-field-control",10),a.kc()),2&e){var n=t.$implicit,c=a.xc(2);a.Vb(1),a.Ec("ngIf",c.customFieldsForm.get(n.name))}}function Jn(e,t){if(1&e&&(a.nc(0,"section"),a.nc(1,"label"),a.bd(2),a.yc(3,"translate"),a.mc(),a.Zc(4,Hn,2,1,"ng-container",9),a.mc()),2&e){var n=a.xc();a.Vb(2),a.cd(a.zc(3,2,"common.custom-fields")),a.Vb(2),a.Ec("ngForOf",n.customFields)}}function Wn(e,t){if(1&e){var n=a.oc();a.nc(0,"button",12),a.vc("click",(function(){return a.Sc(n),a.xc().cancel()})),a.bd(1),a.yc(2,"translate"),a.mc(),a.nc(3,"button",13),a.vc("click",(function(){return a.Sc(n),a.xc().update()})),a.bd(4),a.yc(5,"translate"),a.mc()}if(2&e){var c=a.xc(),r=a.Pc(4),i=a.Pc(8);a.Vb(1),a.cd(a.zc(2,3,"common.cancel")),a.Vb(2),a.Ec("disabled",r.invalid||i.invalid||r.pristine&&i.pristine&&c.customFieldsForm.pristine),a.Vb(1),a.dd(" ",a.zc(5,5,"catalog.update-product-option")," ")}}function Qn(e,t){1&e&&(a.nc(0,"clr-toggle-wrapper"),a.ic(1,"input",38),a.nc(2,"label"),a.bd(3),a.yc(4,"translate"),a.mc(),a.mc()),2&e&&(a.Vb(3),a.cd(a.zc(4,1,"common.enabled")))}function Xn(e,t){if(1&e&&(a.nc(0,"option",41),a.bd(1),a.mc()),2&e){var n=t.$implicit;a.Ec("value",n.id),a.Vb(1),a.dd(" ",n.name," ")}}function ec(e,t){if(1&e&&(a.nc(0,"clr-select-container"),a.nc(1,"label"),a.bd(2),a.yc(3,"translate"),a.mc(),a.nc(4,"select",39),a.Zc(5,Xn,2,2,"option",40),a.mc(),a.mc()),2&e){var n=a.xc(3);a.Vb(2),a.cd(a.zc(3,2,"catalog.tax-category")),a.Vb(3),a.Ec("ngForOf",n.taxCategories)}}function tc(e,t){if(1&e&&(a.nc(0,"label",42),a.bd(1),a.yc(2,"translate"),a.mc(),a.nc(3,"div",43),a.bd(4),a.mc()),2&e){var n=a.xc(2).index,c=a.xc();a.Vb(1),a.cd(a.zc(2,2,"catalog.tax-category")),a.Vb(3),a.dd(" ",c.getTaxCategoryName(n)," ")}}function nc(e,t){if(1&e&&(a.ic(0,"vdr-custom-field-control",47),a.yc(1,"hasPermission")),2&e){var n=a.xc().$implicit,c=a.xc(3).index,r=a.xc();a.Ec("compact",!0)("customFieldsFormGroup",r.formArray.at(c).get(a.Ic(6,fe)))("readonly",!a.zc(1,4,"UpdateCatalog"))("customField",n)}}function cc(e,t){if(1&e&&(a.lc(0),a.Zc(1,nc,2,7,"vdr-custom-field-control",46),a.kc()),2&e){var n=t.$implicit,c=a.xc(3).index,r=a.xc();a.Vb(1),a.Ec("ngIf",r.customFieldIsSet(c,n.name))}}function ac(e,t){if(1&e&&(a.nc(0,"section",44),a.Zc(1,cc,2,1,"ng-container",45),a.mc()),2&e){var n=a.xc(3);a.Vb(1),a.Ec("ngForOf",n.customFields)}}function rc(e,t){if(1&e){var n=a.oc();a.nc(0,"vdr-chip",50),a.vc("iconClick",(function(){a.Sc(n);var e=t.$implicit;return a.xc(4).editOption(e)})),a.yc(1,"hasPermission"),a.nc(2,"span",51),a.bd(3),a.mc(),a.bd(4),a.mc()}if(2&e){var c=t.$implicit,r=a.xc(4);a.Ec("colorFrom",r.optionGroupName(c.groupId))("invert",!0)("icon",a.zc(1,5,"UpdateCatalog")&&"pencil"),a.Vb(3),a.cd(r.optionGroupName(c.groupId)),a.Vb(1),a.dd(" ",r.optionName(c)," ")}}function ic(e,t){if(1&e&&(a.nc(0,"div"),a.nc(1,"div",48),a.Zc(2,rc,5,7,"vdr-chip",49),a.yc(3,"sort"),a.mc(),a.mc()),2&e){var n=a.xc(2).$implicit;a.Vb(2),a.Ec("ngForOf",a.Ac(3,1,n.options,"groupId"))}}function oc(e,t){if(1&e){var n=a.oc();a.nc(0,"vdr-facet-value-chip",52),a.vc("remove",(function(){a.Sc(n);var e=t.$implicit,c=a.xc(2).index;return a.xc().removeFacetValue(c,e.id)})),a.yc(1,"hasPermission"),a.mc()}if(2&e){var c=t.$implicit;a.Ec("facetValue",c)("removable",a.zc(1,2,"UpdateCatalog"))}}function sc(e,t){if(1&e){var n=a.oc();a.nc(0,"vdr-facet-value-chip",52),a.vc("remove",(function(){a.Sc(n);var e=t.$implicit,c=a.xc(2).index;return a.xc().removeFacetValue(c,e.id)})),a.yc(1,"hasPermission"),a.mc()}if(2&e){var c=t.$implicit;a.Ec("facetValue",c)("removable",a.zc(1,2,"UpdateCatalog"))}}function lc(e,t){if(1&e){var n=a.oc();a.nc(0,"button",53),a.vc("click",(function(){a.Sc(n);var e=a.xc(2).$implicit;return a.xc().selectFacetValueClick.emit([e.id])})),a.ic(1,"clr-icon",54),a.bd(2),a.yc(3,"translate"),a.mc()}2&e&&(a.Vb(2),a.dd(" ",a.zc(3,1,"catalog.add-facets")," "))}var uc=function(e){return[e,"price"]},dc=function(e){return[e,"taxCategoryId"]};function pc(e,t){if(1&e){var n=a.oc();a.lc(0,4),a.nc(1,"div",5),a.nc(2,"div",6),a.nc(3,"vdr-title-input",7),a.yc(4,"hasPermission"),a.nc(5,"clr-input-container"),a.ic(6,"input",8),a.yc(7,"hasPermission"),a.yc(8,"translate"),a.mc(),a.mc(),a.nc(9,"vdr-title-input",9),a.yc(10,"hasPermission"),a.nc(11,"clr-input-container"),a.ic(12,"input",10),a.yc(13,"hasPermission"),a.yc(14,"translate"),a.mc(),a.mc(),a.mc(),a.nc(15,"div",11),a.Zc(16,Qn,5,3,"clr-toggle-wrapper",12),a.mc(),a.mc(),a.nc(17,"div",13),a.nc(18,"div",14),a.nc(19,"div",15),a.nc(20,"vdr-product-assets",16),a.vc("change",(function(e){a.Sc(n);var t=a.xc().$implicit;return a.xc().onAssetChange(t.id,e)})),a.mc(),a.mc(),a.nc(21,"div",17),a.nc(22,"div",18),a.nc(23,"div",19),a.nc(24,"div",20),a.Zc(25,ec,6,4,"clr-select-container",21),a.Zc(26,tc,5,4,"ng-template",null,22,a.ad),a.mc(),a.nc(28,"div",23),a.nc(29,"clr-input-container"),a.nc(30,"label"),a.bd(31),a.yc(32,"translate"),a.mc(),a.ic(33,"vdr-currency-input",24),a.yc(34,"hasPermission"),a.mc(),a.mc(),a.ic(35,"vdr-variant-price-detail",25),a.mc(),a.nc(36,"div",19),a.nc(37,"clr-input-container"),a.nc(38,"label"),a.bd(39),a.yc(40,"translate"),a.mc(),a.ic(41,"input",26),a.yc(42,"hasPermission"),a.mc(),a.nc(43,"clr-checkbox-wrapper",27),a.ic(44,"input",28),a.yc(45,"hasPermission"),a.nc(46,"label"),a.bd(47),a.yc(48,"translate"),a.mc(),a.mc(),a.mc(),a.mc(),a.nc(49,"div",29),a.nc(50,"div",19),a.Zc(51,ac,2,1,"section",30),a.mc(),a.mc(),a.mc(),a.mc(),a.mc(),a.nc(52,"div",13),a.nc(53,"div",31),a.ic(54,"vdr-entity-info",32),a.Zc(55,ic,4,4,"div",33),a.ic(56,"div",34),a.nc(57,"div",35),a.Zc(58,oc,2,4,"vdr-facet-value-chip",36),a.Zc(59,sc,2,4,"vdr-facet-value-chip",36),a.Zc(60,lc,4,3,"button",37),a.mc(),a.mc(),a.mc(),a.kc()}if(2&e){var c=a.Pc(27),r=a.xc(),i=r.index,o=r.$implicit,s=a.xc();a.Ec("formGroup",s.formArray.at(i)),a.Vb(3),a.Ec("readonly",!a.zc(4,30,"UpdateCatalog")),a.Vb(3),a.Ec("readonly",!a.zc(7,32,"UpdateCatalog"))("placeholder",a.zc(8,34,"catalog.sku")),a.Vb(3),a.Ec("readonly",!a.zc(10,36,"UpdateCatalog")),a.Vb(3),a.Ec("readonly",!a.zc(13,38,"UpdateCatalog"))("placeholder",a.zc(14,40,"common.name")),a.Vb(4),a.Ec("vdrIfPermissions","UpdateCatalog"),a.Vb(4),a.Ec("compact",!0)("assets",o.assets)("featuredAsset",o.featuredAsset),a.Vb(5),a.Ec("vdrIfPermissions","UpdateCatalog")("vdrIfPermissionsElse",c),a.Vb(6),a.cd(a.zc(32,42,"catalog.price")),a.Vb(2),a.Ec("currencyCode",o.currencyCode)("readonly",!a.zc(34,44,"UpdateCatalog")),a.Vb(2),a.Ec("price",s.formArray.get(a.Jc(54,uc,i)).value)("currencyCode",o.currencyCode)("priceIncludesTax",o.priceIncludesTax)("taxCategoryId",s.formArray.get(a.Jc(56,dc,i)).value),a.Vb(4),a.cd(a.zc(40,46,"catalog.stock-on-hand")),a.Vb(2),a.Ec("readonly",!a.zc(42,48,"UpdateCatalog")),a.Vb(3),a.Ec("vdrDisabled",!a.zc(45,50,"UpdateCatalog")),a.Vb(3),a.cd(a.zc(48,52,"catalog.track-inventory")),a.Vb(4),a.Ec("ngIf",s.customFields.length),a.Vb(3),a.Ec("entity",o),a.Vb(1),a.Ec("ngIf",o.options.length),a.Vb(3),a.Ec("ngForOf",s.existingFacetValues(i)),a.Vb(1),a.Ec("ngForOf",s.pendingFacetValues(i)),a.Vb(1),a.Ec("vdrIfPermissions","UpdateCatalog")}}var fc=function(e){return[e,"enabled"]};function mc(e,t){if(1&e&&(a.nc(0,"div",2),a.Zc(1,pc,61,58,"ng-container",3),a.mc()),2&e){var n,c=t.index,r=a.xc(),i=!(null!=(n=r.formArray.get(a.Jc(3,fc,c)))&&n.value);a.Yb("disabled",i),a.Vb(1),a.Ec("ngIf",r.formArray.at(c))}}function bc(e,t){if(1&e&&(a.lc(0),a.nc(1,"vdr-dt-column"),a.bd(2),a.mc(),a.kc()),2&e){var n=t.$implicit;a.Vb(2),a.cd(n.name)}}function gc(e,t){if(1&e&&(a.ic(0,"img",15),a.yc(1,"assetPreview")),2&e){var n=a.xc().item;a.Ec("src",a.Ac(1,1,n.featuredAsset,"tiny"),a.Uc)}}function vc(e,t){1&e&&(a.nc(0,"div",16),a.ic(1,"clr-icon",17),a.mc())}function hc(e,t){if(1&e&&(a.lc(0),a.nc(1,"td",3),a.yc(2,"stringToColor"),a.bd(3),a.mc(),a.kc()),2&e){var n=t.$implicit,c=a.xc().index,r=a.xc();a.Vb(1),a.Yc("color",a.zc(2,5,r.optionGroupName(n.groupId))),a.Yb("disabled",!r.formArray.get(a.Jc(7,fc,c)).value),a.Vb(2),a.dd(" ",n.name," ")}}function yc(e,t){if(1&e&&(a.lc(0,2),a.nc(1,"td",3),a.nc(2,"div",4),a.nc(3,"div",5),a.Zc(4,gc,2,4,"img",6),a.Zc(5,vc,2,0,"div",7),a.mc(),a.mc(),a.mc(),a.nc(6,"td",3),a.nc(7,"clr-input-container"),a.ic(8,"input",8),a.yc(9,"hasPermission"),a.yc(10,"translate"),a.mc(),a.mc(),a.nc(11,"td",3),a.nc(12,"clr-input-container"),a.ic(13,"input",9),a.yc(14,"hasPermission"),a.yc(15,"translate"),a.mc(),a.mc(),a.Zc(16,hc,4,9,"ng-container",1),a.yc(17,"sort"),a.nc(18,"td",10),a.nc(19,"clr-input-container"),a.ic(20,"vdr-currency-input",11),a.yc(21,"hasPermission"),a.mc(),a.mc(),a.nc(22,"td",12),a.nc(23,"clr-input-container"),a.ic(24,"input",13),a.yc(25,"hasPermission"),a.mc(),a.mc(),a.nc(26,"td",12),a.nc(27,"clr-toggle-wrapper"),a.ic(28,"input",14),a.yc(29,"hasPermission"),a.mc(),a.mc(),a.kc()),2&e){var n=t.item,c=t.index,r=a.xc();a.Ec("formGroup",r.formArray.at(c)),a.Vb(1),a.Yb("disabled",!r.formArray.get(a.Jc(41,fc,c)).value),a.Vb(3),a.Ec("ngIf",n.featuredAsset),a.Vb(1),a.Ec("ngIf",!n.featuredAsset),a.Vb(1),a.Yb("disabled",!r.formArray.get(a.Jc(43,fc,c)).value),a.Vb(2),a.Ec("readonly",!a.zc(9,24,"UpdateCatalog"))("placeholder",a.zc(10,26,"common.name")),a.Vb(3),a.Yb("disabled",!r.formArray.get(a.Jc(45,fc,c)).value),a.Vb(2),a.Ec("readonly",!a.zc(14,28,"UpdateCatalog"))("placeholder",a.zc(15,30,"catalog.sku")),a.Vb(3),a.Ec("ngForOf",a.Ac(17,32,n.options,"groupId")),a.Vb(2),a.Yb("disabled",!r.formArray.get(a.Jc(47,fc,c)).value),a.Vb(2),a.Ec("currencyCode",n.currencyCode)("readonly",!a.zc(21,35,"UpdateCatalog")),a.Vb(2),a.Yb("disabled",!r.formArray.get(a.Jc(49,fc,c)).value),a.Vb(2),a.Ec("readonly",!a.zc(25,37,"UpdateCatalog")),a.Vb(2),a.Yb("disabled",!r.formArray.get(a.Jc(51,fc,c)).value),a.Vb(2),a.Ec("vdrDisabled",!a.zc(29,39,"UpdateCatalog"))}}var Cc=function(e){return{rate:e}};function Oc(e,t){if(1&e&&(a.nc(0,"div",2),a.bd(1),a.yc(2,"translate"),a.yc(3,"async"),a.mc()),2&e){var n=a.xc();a.Vb(1),a.dd(" ",a.Ac(2,1,"catalog.price-includes-tax-at",a.Jc(6,Cc,a.zc(3,4,n.taxRate$))),"\n")}}var Vc=function(e,t){return{price:e,rate:t}};function kc(e,t){if(1&e&&(a.nc(0,"div",2),a.bd(1),a.yc(2,"translate"),a.yc(3,"currency"),a.yc(4,"async"),a.yc(5,"async"),a.mc()),2&e){var n=a.xc();a.Vb(1),a.dd(" ",a.Ac(2,1,"catalog.price-with-tax-in-default-zone",a.Kc(11,Vc,a.Ac(3,4,a.zc(4,7,n.grossPrice$),n.currencyCode),a.zc(5,9,n.taxRate$))),"\n")}}var xc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,c,a,r,i,o){var s;return _classCallCheck(this,n),(s=t.call(this,c,e,a,i)).notificationService=r,s.dataService=i,s.formBuilder=o,s.detailForm=new w.i({}),s}return _createClass(n,[{key:"ngOnInit",value:function(){this.detailForm=new w.i({name:new w.f("")}),this.init()}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"onAssetChange",value:function(e){this.detailForm.get("name").setValue(e.name),this.detailForm.get("name").markAsDirty()}},{key:"save",value:function(){var e=this;this.dataService.product.updateAsset({id:this.id,name:this.detailForm.value.name}).subscribe((function(){e.notificationService.success(Object(o.a)("common.notify-update-success"),{entity:"Asset"})}),(function(t){e.notificationService.error(Object(o.a)("common.notify-update-error"),{entity:"Asset"})}))}},{key:"setFormValues",value:function(e,t){this.detailForm.get("name").setValue(e.name)}}]),n}(i.u);xc.\u0275fac=function(e){return new(e||xc)(a.hc(r.e),a.hc(r.a),a.hc(i.Gb),a.hc(i.yb),a.hc(i.K),a.hc(w.e))},xc.\u0275cmp=a.bc({type:xc,selectors:[["vdr-asset-detail"]],features:[a.Sb],decls:9,vars:8,consts:[[3,"entity"],["locationId","asset-detail"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[3,"asset","editable","assetChange"],[1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(a.nc(0,"vdr-action-bar"),a.nc(1,"vdr-ab-left"),a.ic(2,"vdr-entity-info",0),a.yc(3,"async"),a.mc(),a.nc(4,"vdr-ab-right"),a.ic(5,"vdr-action-bar-items",1),a.Zc(6,ee,3,4,"button",2),a.mc(),a.mc(),a.nc(7,"vdr-asset-preview",3),a.vc("assetChange",(function(e){return t.onAssetChange(e)})),a.yc(8,"async"),a.mc()),2&e&&(a.Vb(2),a.Ec("entity",a.zc(3,4,t.entity$)),a.Vb(4),a.Ec("vdrIfPermissions","UpdateCatalog"),a.Vb(1),a.Ec("asset",a.zc(8,6,t.entity$))("editable",!0))},directives:[i.c,i.e,i.Z,i.f,i.d,i.ob,i.o],pipes:[B.b,W.d],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}"],changeDetection:0}),xc.ctorParameters=function(){return[{type:r.e},{type:r.a},{type:i.Gb},{type:i.yb},{type:i.K},{type:w.e}]},xc=Object(c.c)([Object(c.f)("design:paramtypes",[r.e,r.a,i.Gb,i.yb,i.K,w.e])],xc);var Pc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,c,a,r,i){var o,s;return _classCallCheck(this,n),(s=t.call(this,r,i)).notificationService=e,s.modalService=c,s.dataService=a,s.searchTerm=new w.f(""),s.uploading=!1,_get((o=_assertThisInitialized(s),_getPrototypeOf(n.prototype)),"setQueryFn",o).call(o,(function(){var e;return(e=s.dataService.product).getAssetList.apply(e,arguments)}),(function(e){return e.assets}),(function(e,t){return{options:{skip:e,take:t,filter:{name:{contains:s.searchTerm.value}},sort:{createdAt:A.SortOrder.DESC}}}})),s}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;_get(_getPrototypeOf(n.prototype),"ngOnInit",this).call(this),this.paginationConfig$=Object(M.a)(this.itemsPerPage$,this.currentPage$,this.totalItems$).pipe(Object(s.a)((function(e){var t=_slicedToArray(e,3);return{itemsPerPage:t[0],currentPage:t[1],totalItems:t[2]}}))),this.searchTerm.valueChanges.pipe(Object(l.a)(250),Object(u.a)(this.destroy$)).subscribe((function(){return e.refresh()}))}},{key:"filesSelected",value:function(e){var t=this;e.length&&(this.uploading=!0,this.dataService.product.createAssets(e).pipe(Object(d.a)((function(){return t.uploading=!1}))).subscribe((function(c){_get(_getPrototypeOf(n.prototype),"refresh",t).call(t),t.notificationService.success(Object(o.a)("asset.notify-create-assets-success"),{count:e.length})})))}},{key:"deleteAssets",value:function(e){var t=this;this.showModalAndDelete(e.map((function(e){return e.id}))).pipe(Object(p.a)((function(n){return n.result===i.O.DELETED?[!0]:t.showModalAndDelete(e.map((function(e){return e.id})),n.message||"").pipe(Object(s.a)((function(e){return e.result===i.O.DELETED})))}))).subscribe((function(){t.notificationService.success(Object(o.a)("common.notify-delete-success"),{entity:"Assets"}),t.refresh()}),(function(e){t.notificationService.error(Object(o.a)("common.notify-delete-error"),{entity:"Assets"})}))}},{key:"showModalAndDelete",value:function(e,t){var n=this;return this.modalService.dialog({title:Object(o.a)("catalog.confirm-delete-assets"),translationVars:{count:e.length},body:t,buttons:[{type:"secondary",label:Object(o.a)("common.cancel")},{type:"danger",label:Object(o.a)("common.delete"),returnValue:!0}]}).pipe(Object(p.a)((function(c){return c?n.dataService.product.deleteAssets(e,!!t):z.a})),Object(s.a)((function(e){return e.deleteAssets})))}}]),n}(i.w);Pc.\u0275fac=function(e){return new(e||Pc)(a.hc(i.yb),a.hc(i.xb),a.hc(i.K),a.hc(r.e),a.hc(r.a))},Pc.\u0275cmp=a.bc({type:Pc,selectors:[["vdr-asset-list"]],features:[a.Sb],decls:19,vars:30,consts:[["type","text","name","searchTerm",1,"clr-input","search-input",3,"formControl","placeholder"],["locationId","asset-list"],["dropZoneTarget",".content-area",3,"uploading","selectFiles"],[3,"assets","multiSelect","canDelete","deleteAssets"],[1,"paging-controls"],[3,"itemsPerPage","itemsPerPageChange"],[3,"currentPage","itemsPerPage","totalItems","pageChange"]],template:function(e,t){1&e&&(a.nc(0,"vdr-action-bar"),a.nc(1,"vdr-ab-left"),a.ic(2,"input",0),a.yc(3,"translate"),a.mc(),a.nc(4,"vdr-ab-right"),a.ic(5,"vdr-action-bar-items",1),a.nc(6,"vdr-asset-file-input",2),a.vc("selectFiles",(function(e){return t.filesSelected(e)})),a.mc(),a.mc(),a.mc(),a.nc(7,"vdr-asset-gallery",3),a.vc("deleteAssets",(function(e){return t.deleteAssets(e)})),a.yc(8,"paginate"),a.yc(9,"async"),a.yc(10,"async"),a.yc(11,"hasPermission"),a.mc(),a.nc(12,"div",4),a.nc(13,"vdr-items-per-page-controls",5),a.vc("itemsPerPageChange",(function(e){return t.setItemsPerPage(e)})),a.yc(14,"async"),a.mc(),a.nc(15,"vdr-pagination-controls",6),a.vc("pageChange",(function(e){return t.setPageNumber(e)})),a.yc(16,"async"),a.yc(17,"async"),a.yc(18,"async"),a.mc(),a.mc()),2&e&&(a.Vb(2),a.Ec("formControl",t.searchTerm)("placeholder",a.zc(3,10,"asset.search-asset-name")),a.Vb(4),a.Ec("uploading",t.uploading),a.Vb(1),a.Ec("assets",a.Ac(8,12,a.zc(9,15,t.items$),a.zc(10,17,t.paginationConfig$)||a.Ic(29,te)))("multiSelect",!0)("canDelete",a.zc(11,19,"DeleteCatalog")),a.Vb(6),a.Ec("itemsPerPage",a.zc(14,21,t.itemsPerPage$)),a.Vb(2),a.Ec("currentPage",a.zc(16,23,t.currentPage$))("itemsPerPage",a.zc(17,25,t.itemsPerPage$))("totalItems",a.zc(18,27,t.totalItems$)))},directives:[i.c,i.e,i.db,w.b,w.p,w.g,i.f,i.d,i.l,i.m,i.pb,i.Cb],pipes:[W.d,Q.b,B.b,i.gb],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}vdr-asset-gallery[_ngcontent-%COMP%]{flex:1}.paging-controls[_ngcontent-%COMP%]{padding-top:6px;border-top:1px solid #f2f3f5;display:flex;justify-content:space-between}.search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}"]}),Pc.ctorParameters=function(){return[{type:i.yb},{type:i.xb},{type:i.K},{type:r.e},{type:r.a}]},Pc=Object(c.c)([Object(c.f)("design:paramtypes",[i.yb,i.xb,i.K,r.e,r.a])],Pc);var Fc=function(){function e(t,n,c){_classCallCheck(this,e),this.route=t,this.router=n,this.dataService=c,this.filterTermControl=new w.f(""),this.collectionIdChange$=new D.a(""),this.refresh$=new D.a(!0),this.destroy$=new T.a}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.contentsCurrentPage$=this.route.paramMap.pipe(Object(s.a)((function(e){return e.get("contentsPage")})),Object(s.a)((function(e){return e?+e:1})),Object(f.a)(1),Object(m.a)()),this.contentsItemsPerPage$=this.route.paramMap.pipe(Object(s.a)((function(e){return e.get("contentsPerPage")})),Object(s.a)((function(e){return e?+e:10})),Object(f.a)(10),Object(m.a)());var t=this.filterTermControl.valueChanges.pipe(Object(l.a)(250),Object(b.a)((function(){return e.setContentsPageNumber(1)})),Object(f.a)("")),n=Object(M.a)(this.collectionIdChange$,this.contentsCurrentPage$,this.contentsItemsPerPage$,t,this.refresh$).pipe(Object(u.a)(this.destroy$),Object(p.a)((function(t){var n=_slicedToArray(t,4),c=n[0],a=n[1],r=n[2],i=n[3],o=r,s=(a-1)*r;return c?e.dataService.collection.getCollectionContents(c,o,s,i).mapSingle((function(e){return e.collection})):Object($.a)(null)})));this.contents$=n.pipe(Object(s.a)((function(e){return e?e.productVariants.items:[]}))),this.contentsTotalItems$=n.pipe(Object(s.a)((function(e){return e?e.productVariants.totalItems:0})))}},{key:"ngOnChanges",value:function(e){"collectionId"in e&&this.collectionIdChange$.next(e.collectionId.currentValue)}},{key:"ngOnDestroy",value:function(){this.destroy$.next(),this.destroy$.complete()}},{key:"setContentsPageNumber",value:function(e){this.setParam("contentsPage",e)}},{key:"setContentsItemsPerPage",value:function(e){this.setParam("contentsPerPage",e)}},{key:"refresh",value:function(){this.refresh$.next(!0)}},{key:"setParam",value:function(e,t){this.router.navigate(["./",Object.assign(Object.assign({},this.route.snapshot.params),_defineProperty({},e,t))],{relativeTo:this.route,queryParamsHandling:"merge"})}}]),e}();Fc.\u0275fac=function(e){return new(e||Fc)(a.hc(r.a),a.hc(r.e),a.hc(i.K))},Fc.\u0275cmp=a.bc({type:Fc,selectors:[["vdr-collection-contents"]],contentQueries:function(e,t,n){var c;1&e&&a.Wc(n,a.bb,!0),2&e&&a.Oc(c=a.wc())&&(t.headerTemplate=c.first)},inputs:{collectionId:"collectionId"},features:[a.Tb],decls:12,vars:22,consts:[[1,"contents-header"],[1,"header-title-row"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["type","text",1,"clr-input",3,"placeholder","formControl"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"left","align-middle"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"]],template:function(e,t){1&e&&(a.nc(0,"div",0),a.nc(1,"div",1),a.Zc(2,ne,1,0,"ng-container",2),a.yc(3,"async"),a.mc(),a.ic(4,"input",3),a.yc(5,"translate"),a.mc(),a.nc(6,"vdr-data-table",4),a.vc("pageChange",(function(e){return t.setContentsPageNumber(e)}))("itemsPerPageChange",(function(e){return t.setContentsItemsPerPage(e)})),a.yc(7,"async"),a.yc(8,"async"),a.yc(9,"async"),a.yc(10,"async"),a.Zc(11,re,5,9,"ng-template"),a.mc()),2&e&&(a.Vb(2),a.Ec("ngTemplateOutlet",t.headerTemplate)("ngTemplateOutletContext",a.Jc(20,ie,a.zc(3,8,t.contentsTotalItems$))),a.Vb(2),a.Ec("placeholder",a.zc(5,10,"catalog.filter-by-name"))("formControl",t.filterTermControl),a.Vb(2),a.Ec("items",a.zc(7,12,t.contents$))("itemsPerPage",a.zc(8,14,t.contentsItemsPerPage$))("totalItems",a.zc(9,16,t.contentsTotalItems$))("currentPage",a.zc(10,18,t.contentsCurrentPage$)))},directives:[B.u,i.db,w.b,w.p,w.g,i.M,i.Lb],pipes:[B.b,W.d],styles:[".contents-header[_ngcontent-%COMP%]{background-color:#fafafa;position:-webkit-sticky;position:sticky;top:0;padding:6px;z-index:1;border-bottom:1px solid #bfc3cc}.contents-header[_ngcontent-%COMP%]   .header-title-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.contents-header[_ngcontent-%COMP%]   .clr-input[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]     table{margin-top:-1px}"],changeDetection:0}),Fc.ctorParameters=function(){return[{type:r.a},{type:r.e},{type:i.K}]},Object(c.c)([Object(a.D)(),Object(c.f)("design:type",String)],Fc.prototype,"collectionId",void 0),Object(c.c)([Object(a.o)(a.bb,{static:!0}),Object(c.f)("design:type",a.bb)],Fc.prototype,"headerTemplate",void 0),Fc=Object(c.c)([Object(c.f)("design:paramtypes",[r.a,r.e,i.K])],Fc);var Ic=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,c,a,r,i,o,s,l){var u;return _classCallCheck(this,n),(u=t.call(this,c,e,a,i)).changeDetector=r,u.dataService=i,u.formBuilder=o,u.notificationService=s,u.modalService=l,u.assetChanges={},u.filters=[],u.allFilters=[],u.customFields=u.getCustomFieldConfig("Collection"),u.detailForm=u.formBuilder.group({name:["",w.C.required],slug:"",description:"",visible:!1,filters:u.formBuilder.array([]),customFields:u.formBuilder.group(u.customFields.reduce((function(e,t){return Object.assign(Object.assign({},e),_defineProperty({},t.name,""))}),{}))}),u}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;this.init(),this.facets$=this.dataService.facet.getAllFacets().mapSingle((function(e){return e.facets.items})).pipe(Object(g.a)(1)),this.dataService.collection.getCollectionFilters().single$.subscribe((function(t){e.allFilters=t.collectionFilters})),this.activeChannel$=this.dataService.settings.getActiveChannel().mapStream((function(e){return e.activeChannel}))}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"getFilterDefinition",value:function(e){return this.allFilters.find((function(t){return t.code===e.code}))}},{key:"customFieldIsSet",value:function(e){return!!this.detailForm.get(["customFields",e])}},{key:"assetsChanged",value:function(){return!!Object.values(this.assetChanges).length}},{key:"updateSlug",value:function(e){var t=this;this.isNew$.pipe(Object(v.a)(1)).subscribe((function(n){if(n){var c=t.detailForm.get(["slug"]);c&&c.pristine&&c.setValue(Object(U.normalizeString)("".concat(e),"-"))}}))}},{key:"addFilter",value:function(e){var t=this.detailForm.get("filters");if(-1===t.value.findIndex((function(t){return t.code===e.code}))){var n=e.args.reduce((function(e,t){return Object.assign(Object.assign({},e),_defineProperty({},t.name,t.value))}),{});t.push(this.formBuilder.control({code:e.code,args:n})),this.filters.push(e)}}},{key:"removeFilter",value:function(e){var t=this.detailForm.get("filters"),n=t.value.findIndex((function(t){return t.code===e.code}));-1!==n&&(t.removeAt(n),this.filters.splice(n,1))}},{key:"create",value:function(){var e=this;this.detailForm.dirty&&Object(M.a)(this.entity$,this.languageCode$).pipe(Object(v.a)(1),Object(h.a)((function(t){var n=_slicedToArray(t,2),c=n[0],a=n[1],r=e.getUpdatedCollection(c,e.detailForm,a),i=e.route.snapshot.paramMap.get("parentId");return i&&(r.parentId=i),e.dataService.collection.createCollection(r)}))).subscribe((function(t){e.notificationService.success(Object(o.a)("common.notify-create-success"),{entity:"Collection"}),e.assetChanges={},e.detailForm.markAsPristine(),e.changeDetector.markForCheck(),e.router.navigate(["../",t.createCollection.id],{relativeTo:e.route})}),(function(t){e.notificationService.error(Object(o.a)("common.notify-create-error"),{entity:"Collection"})}))}},{key:"save",value:function(){var e=this;Object(M.a)(this.entity$,this.languageCode$).pipe(Object(v.a)(1),Object(h.a)((function(t){var n=_slicedToArray(t,2),c=n[0],a=n[1],r=e.getUpdatedCollection(c,e.detailForm,a);return e.dataService.collection.updateCollection(r)}))).subscribe((function(){e.assetChanges={},e.detailForm.markAsPristine(),e.changeDetector.markForCheck(),e.notificationService.success(Object(o.a)("common.notify-update-success"),{entity:"Collection"}),e.contentsComponent.refresh()}),(function(t){e.notificationService.error(Object(o.a)("common.notify-update-error"),{entity:"Collection"})}))}},{key:"canDeactivate",value:function(){return _get(_getPrototypeOf(n.prototype),"canDeactivate",this).call(this)&&!this.assetChanges.assetIds&&!this.assetChanges.featuredAssetId}},{key:"setFormValues",value:function(e,t){var n=this,c=e.translations.find((function(e){return e.languageCode===t}));if(this.detailForm.patchValue({name:c?c.name:"",slug:c?c.slug:"",description:c?c.description:"",visible:!e.isPrivate}),e.filters.forEach((function(e){return n.addFilter(e)})),this.customFields.length){var a,r=this.detailForm.get(["customFields"]),i=_createForOfIteratorHelper(this.customFields);try{for(i.s();!(a=i.n()).done;){var o=a.value,s=o.name,l="localeString"===o.type?c.customFields[s]:e.customFields[s],u=r.get(s);u&&u.patchValue(l)}}catch(d){i.e(d)}finally{i.f()}}}},{key:"getUpdatedCollection",value:function(e,t,n){var c=Object(i.Sb)({translatable:e,updatedFields:t.value,customFieldConfig:this.customFields,languageCode:n,defaultTranslation:{languageCode:n,name:e.name||"",slug:e.slug||"",description:e.description||""}});return Object.assign(Object.assign(Object.assign({},c),this.assetChanges),{isPrivate:!t.value.visible,filters:this.mapOperationsToInputs(this.filters,this.detailForm.value.filters)})}},{key:"mapOperationsToInputs",value:function(e,t){return e.map((function(e,n){return{code:e.code,arguments:Object.values(t[n].args).map((function(t,n){return{name:e.args[n].name,value:t.toString(),type:e.args[n].type}}))}}))}}]),n}(i.u);Ic.\u0275fac=function(e){return new(e||Ic)(a.hc(r.e),a.hc(r.a),a.hc(i.Gb),a.hc(a.k),a.hc(i.K),a.hc(w.e),a.hc(i.yb),a.hc(i.xb))},Ic.\u0275cmp=a.bc({type:Ic,selectors:[["vdr-collection-detail"]],viewQuery:function(e,t){var n;1&e&&a.hd(oe,!0),2&e&&a.Oc(n=a.wc())&&(t.contentsComponent=n.first)},features:[a.Sb],decls:16,vars:19,consts:[[3,"entity"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","collection-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup"],[1,"clr-row"],[1,"clr-col"],["for","visibility",3,"label"],["type","checkbox","clrToggle","","formControlName","visible","id","visibility",3,"vdrDisabled"],[1,"visible-toggle"],[4,"ngIf","ngIfElse"],["private",""],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],["for","slug",3,"label","errors"],["id","slug","type","text","formControlName","slug","pattern","[a-z0-9_-]+",3,"readonly"],["formControlName","description",3,"readonly","label"],["formGroupName","customFields",4,"ngIf"],[1,"clr-col-md-auto"],[3,"assets","featuredAsset","change"],["formArrayName","filters",1,"clr-row"],[4,"ngFor","ngForOf"],[4,"vdrIfPermissions"],[3,"collectionId"],["collectionContents",""],["formGroupName","customFields"],["entityName","Collection",3,"customFieldsFormGroup","customField",4,"ngIf"],["entityName","Collection",3,"customFieldsFormGroup","customField"],[3,"facets","operation","operationDefinition","formControlName","readonly","activeChannel","remove"],["vdrDropdownTrigger","",1,"btn","btn-outline"],["shape","plus"],["vdrPosition","bottom-left"],["type","button","vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["type","button","vdrDropdownItem","",3,"click"],[1,"contents-title"]],template:function(e,t){if(1&e&&(a.nc(0,"vdr-action-bar"),a.nc(1,"vdr-ab-left"),a.ic(2,"vdr-entity-info",0),a.yc(3,"async"),a.nc(4,"vdr-language-selector",1),a.vc("languageCodeChange",(function(e){return t.setLanguage(e)})),a.yc(5,"async"),a.yc(6,"async"),a.yc(7,"async"),a.mc(),a.mc(),a.nc(8,"vdr-ab-right"),a.ic(9,"vdr-action-bar-items",2),a.Zc(10,se,3,4,"button",3),a.yc(11,"async"),a.Zc(12,ue,1,1,"ng-template",null,4,a.ad),a.mc(),a.mc(),a.Zc(14,ke,38,41,"form",5),a.yc(15,"async")),2&e){var n=a.Pc(13);a.Vb(2),a.Ec("entity",a.zc(3,7,t.entity$)),a.Vb(2),a.Ec("disabled",a.zc(5,9,t.isNew$))("availableLanguageCodes",a.zc(6,11,t.availableLanguages$))("currentLanguageCode",a.zc(7,13,t.languageCode$)),a.Vb(6),a.Ec("ngIf",a.zc(11,15,t.isNew$))("ngIfElse",n),a.Vb(4),a.Ec("ngIf",a.zc(15,17,t.entity$))}},directives:function(){return[i.c,i.e,i.Z,i.ub,i.f,i.d,B.p,i.ob,w.E,w.q,w.j,i.cb,X.k,i.db,w.a,X.i,w.p,w.h,i.R,X.t,w.b,w.w,i.Eb,fa,w.d,B.o,Fc,w.k,i.H,i.C,i.S,i.V,X.o,i.U,i.T]},pipes:function(){return[B.b,W.d,i.gb]},styles:[".visible-toggle[_ngcontent-%COMP%]{margin-top:-3px!important}"],changeDetection:0}),Ic.ctorParameters=function(){return[{type:r.e},{type:r.a},{type:i.Gb},{type:a.k},{type:i.K},{type:w.e},{type:i.yb},{type:i.xb}]},Object(c.c)([Object(a.fb)("collectionContents"),Object(c.f)("design:type",Fc)],Ic.prototype,"contentsComponent",void 0),Ic=Object(c.c)([Object(c.f)("design:paramtypes",[r.e,r.a,i.Gb,a.k,i.K,w.e,i.yb,i.xb])],Ic);var jc=function(){function e(t,n,c,a,r){_classCallCheck(this,e),this.dataService=t,this.notificationService=n,this.modalService=c,this.router=a,this.route=r,this.expandAll=!1}return _createClass(e,[{key:"ngOnInit",value:function(){this.queryResult=this.dataService.collection.getCollections(99999,0).refetchOnChannelChange(),this.items$=this.queryResult.mapStream((function(e){return e.collections.items})).pipe(Object(g.a)(1)),this.activeCollectionId$=this.route.paramMap.pipe(Object(s.a)((function(e){return e.get("contents")})),Object(m.a)()),this.activeCollectionTitle$=Object(M.a)(this.activeCollectionId$,this.items$).pipe(Object(s.a)((function(e){var t=_slicedToArray(e,2),n=t[0],c=t[1];if(n){var a=c.find((function(e){return e.id===n}));return a?a.name:""}return""})))}},{key:"onRearrange",value:function(e){var t=this;this.dataService.collection.moveCollection([e]).subscribe({next:function(){t.notificationService.success(Object(o.a)("common.notify-saved-changes")),t.refresh()},error:function(e){t.notificationService.error(Object(o.a)("common.notify-save-changes-error"))}})}},{key:"deleteCollection",value:function(e){var t=this;this.items$.pipe(Object(v.a)(1),Object(s.a)((function(t){return-1<t.findIndex((function(t){return t.parent&&t.parent.id===e}))})),Object(p.a)((function(e){return t.modalService.dialog({title:Object(o.a)("catalog.confirm-delete-collection"),body:e?Object(o.a)("catalog.confirm-delete-collection-and-children-body"):void 0,buttons:[{type:"secondary",label:Object(o.a)("common.cancel")},{type:"danger",label:Object(o.a)("common.delete"),returnValue:!0}]})})),Object(p.a)((function(n){return n?t.dataService.collection.deleteCollection(e):z.a}))).subscribe((function(){t.notificationService.success(Object(o.a)("common.notify-delete-success"),{entity:"Collection"}),t.refresh()}),(function(e){t.notificationService.error(Object(o.a)("common.notify-delete-error"),{entity:"Collection"})}))}},{key:"closeContents",value:function(){var e=Object.assign({},this.route.snapshot.params);delete e.contents,this.router.navigate(["./",e],{relativeTo:this.route,queryParamsHandling:"preserve"})}},{key:"refresh",value:function(){this.queryResult.ref.refetch()}}]),e}();jc.\u0275fac=function(e){return new(e||jc)(a.hc(i.K),a.hc(i.yb),a.hc(i.xb),a.hc(r.e),a.hc(r.a))},jc.\u0275cmp=a.bc({type:jc,selectors:[["vdr-collection-list"]],decls:19,vars:19,consts:[[1,"expand-all-toggle"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],["locationId","collection-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[1,"collection-wrapper"],[3,"collections","activeCollectionId","expandAll","rearrange","deleteCollection"],[1,"collection-contents"],[3,"collectionId"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"collection-title"],["type","button",1,"close-button",3,"click"],["shape","close"]],template:function(e,t){1&e&&(a.nc(0,"vdr-action-bar"),a.nc(1,"vdr-ab-left"),a.nc(2,"clr-checkbox-wrapper",0),a.nc(3,"input",1),a.vc("ngModelChange",(function(e){return t.expandAll=e})),a.mc(),a.nc(4,"label"),a.bd(5),a.yc(6,"translate"),a.mc(),a.mc(),a.mc(),a.nc(7,"vdr-ab-right"),a.ic(8,"vdr-action-bar-items",2),a.Zc(9,Pe,4,5,"a",3),a.mc(),a.mc(),a.nc(10,"div",4),a.nc(11,"vdr-collection-tree",5),a.vc("rearrange",(function(e){return t.onRearrange(e)}))("deleteCollection",(function(e){return t.deleteCollection(e)})),a.yc(12,"async"),a.yc(13,"async"),a.mc(),a.nc(14,"div",6),a.yc(15,"async"),a.nc(16,"vdr-collection-contents",7),a.yc(17,"async"),a.Zc(18,Fe,6,9,"ng-template"),a.mc(),a.mc(),a.mc()),2&e&&(a.Vb(3),a.Ec("ngModel",t.expandAll),a.Vb(2),a.cd(a.zc(6,9,"catalog.expand-all-collections")),a.Vb(4),a.Ec("vdrIfPermissions","CreateCatalog"),a.Vb(2),a.Ec("collections",a.zc(12,11,t.items$))("activeCollectionId",a.zc(13,13,t.activeCollectionId$))("expandAll",t.expandAll),a.Vb(3),a.Yb("expanded",a.zc(15,15,t.activeCollectionId$)),a.Vb(2),a.Ec("collectionId",a.zc(17,17,t.activeCollectionId$)))},directives:function(){return[i.c,i.e,X.k,i.db,w.a,X.i,w.p,w.s,X.t,i.f,i.d,i.ob,sa,Fc,r.h,X.o]},pipes:function(){return[W.d,B.b]},styles:["[_nghost-%COMP%]{height:100%;display:flex;flex-direction:column}.expand-all-toggle[_ngcontent-%COMP%]{display:block;margin-top:14px}.collection-wrapper[_ngcontent-%COMP%]{display:flex;height:calc(100% - 50px)}.collection-wrapper[_ngcontent-%COMP%]   vdr-collection-tree[_ngcontent-%COMP%]{flex:1;height:100%;overflow:auto}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents[_ngcontent-%COMP%]{height:100%;width:0;opacity:0;visibility:hidden;overflow:auto;transition:width .3s,opacity .2s .3s,visibility .3s}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents.expanded[_ngcontent-%COMP%]{width:30vw;visibility:visible;opacity:1;padding-left:12px}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{margin:0;background:0 0;border:none;cursor:pointer}.paging-controls[_ngcontent-%COMP%]{padding-top:6px;border-top:1px solid #f2f3f5;display:flex;justify-content:space-between}"],changeDetection:0}),jc.ctorParameters=function(){return[{type:i.K},{type:i.yb},{type:i.xb},{type:r.e},{type:r.a}]},jc=Object(c.c)([Object(c.f)("design:paramtypes",[i.K,i.yb,i.xb,r.e,r.a])],jc);var _c=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,c,a,r,i,o,s,l){var u;return _classCallCheck(this,n),(u=t.call(this,c,e,a,i)).changeDetector=r,u.dataService=i,u.formBuilder=o,u.notificationService=s,u.modalService=l,u.customFields=u.getCustomFieldConfig("Facet"),u.customValueFields=u.getCustomFieldConfig("FacetValue"),u.detailForm=u.formBuilder.group({facet:u.formBuilder.group({code:["",w.C.required],name:"",visible:!0,customFields:u.formBuilder.group(u.customFields.reduce((function(e,t){return Object.assign(Object.assign({},e),_defineProperty({},t.name,""))}),{}))}),values:u.formBuilder.array([])}),u}return _createClass(n,[{key:"ngOnInit",value:function(){this.init()}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"updateCode",value:function(e,t){if(!e){var n=this.detailForm.get(["facet","code"]);n&&n.pristine&&n.setValue(Object(U.normalizeString)(t,"-"))}}},{key:"updateValueCode",value:function(e,t,n){if(!e){var c=this.detailForm.get(["values",n,"code"]);c&&c.pristine&&c.setValue(Object(U.normalizeString)(t,"-"))}}},{key:"customFieldIsSet",value:function(e){return!!this.detailForm.get(["facet","customFields",e])}},{key:"customValueFieldIsSet",value:function(e,t){return!!this.detailForm.get(["values",e,"customFields",t])}},{key:"getValuesFormArray",value:function(){return this.detailForm.get("values")}},{key:"addFacetValue",value:function(){var e=this.detailForm.get("values");e&&(e.insert(e.length,this.formBuilder.group({name:["",w.C.required],code:""})),this.values.push({name:"",code:""}))}},{key:"create",value:function(){var e=this,t=this.detailForm.get("facet");t&&t.dirty&&Object(M.a)(this.entity$,this.languageCode$).pipe(Object(v.a)(1),Object(h.a)((function(n){var c=_slicedToArray(n,2),a=c[0],r=c[1],i=e.getUpdatedFacet(a,t,r);return e.dataService.facet.createFacet(i)})),Object(p.a)((function(t){return e.dataService.facet.getAllFacets(!0).single$.pipe(Object(y.a)(t))}))).subscribe((function(t){e.notificationService.success(Object(o.a)("common.notify-create-success"),{entity:"Facet"}),e.detailForm.markAsPristine(),e.changeDetector.markForCheck(),e.router.navigate(["../",t.createFacet.id],{relativeTo:e.route})}),(function(t){e.notificationService.error(Object(o.a)("common.notify-create-error"),{entity:"Facet"})}))}},{key:"save",value:function(){var e=this;Object(M.a)(this.entity$,this.languageCode$).pipe(Object(v.a)(1),Object(h.a)((function(t){var n=_slicedToArray(t,2),c=n[0],a=n[1],r=e.detailForm.get("facet"),i=[];if(r&&r.dirty){var o=e.getUpdatedFacet(c,r,a);o&&i.push(e.dataService.facet.updateFacet(o))}var s=e.detailForm.get("values");if(s&&s.dirty){var l=s.controls.filter((function(e){return!e.value.id})).map((function(e){return{facetId:c.id,code:e.value.code,translations:[{name:e.value.name,languageCode:a}]}}));l.length&&i.push(e.dataService.facet.createFacetValues(l).pipe(Object(p.a)((function(){return e.dataService.facet.getFacet(e.id).single$}))));var u=e.getUpdatedFacetValues(c,s,a);u.length&&i.push(e.dataService.facet.updateFacetValues(u))}return Object(Z.a)(i)})),Object(p.a)((function(){return e.dataService.facet.getAllFacets(!0).single$}))).subscribe((function(){e.detailForm.markAsPristine(),e.changeDetector.markForCheck(),e.notificationService.success(Object(o.a)("common.notify-update-success"),{entity:"Facet"})}),(function(t){e.notificationService.error(Object(o.a)("common.notify-update-error"),{entity:"Facet"})}))}},{key:"deleteFacetValue",value:function(e,t){var n=this;if(!e){var c=this.detailForm.get("values");return c&&c.removeAt(t),void this.values.splice(t,1)}this.showModalAndDelete(e).pipe(Object(p.a)((function(t){return t.result===i.O.DELETED?[!0]:n.showModalAndDelete(e,t.message||"").pipe(Object(s.a)((function(e){return e.result===i.O.DELETED})))})),Object(p.a)((function(e){return e?n.dataService.facet.getFacet(n.id).single$:[]}))).subscribe((function(){n.notificationService.success(Object(o.a)("common.notify-delete-success"),{entity:"FacetValue"})}),(function(e){n.notificationService.error(Object(o.a)("common.notify-delete-error"),{entity:"FacetValue"})}))}},{key:"showModalAndDelete",value:function(e,t){var n=this;return this.modalService.dialog({title:Object(o.a)("catalog.confirm-delete-facet-value"),body:t,buttons:[{type:"secondary",label:Object(o.a)("common.cancel")},{type:"danger",label:Object(o.a)("common.delete"),returnValue:!0}]}).pipe(Object(p.a)((function(c){return c?n.dataService.facet.deleteFacetValues([e],!!t):z.a})),Object(s.a)((function(e){return e.deleteFacetValues[0]})))}},{key:"setFormValues",value:function(e,t){var n=this,c=e.translations.find((function(e){return e.languageCode===t}));if(this.detailForm.patchValue({facet:{code:e.code,visible:!e.isPrivate,name:c?c.name:""}}),this.customFields.length){var a,r=this.detailForm.get(["facet","customFields"]),i=_createForOfIteratorHelper(this.customFields);try{for(i.s();!(a=i.n()).done;){var o=a.value,s=o.name,l="localeString"===o.type?c.customFields[s]:e.customFields[s],u=r.get(s);u&&u.patchValue(l)}}catch(p){i.e(p)}finally{i.f()}}var d=this.detailForm.get("values");d.clear(),this.values=_toConsumableArray(e.values),e.values.forEach((function(e,c){var a=e.translations&&e.translations.find((function(e){return e.languageCode===t})),r={id:e.id,code:e.code,name:a?a.name:""};if(d.insert(c,n.formBuilder.group(r)),n.customValueFields.length){var i=n.detailForm.get(["values",c,"customFields"]);if(i||(i=new w.i({}),n.detailForm.get(["values",c]).addControl("customFields",i)),i){var o,s=_createForOfIteratorHelper(n.customValueFields);try{for(s.s();!(o=s.n()).done;){var l=o.value,u=l.name,f="localeString"===l.type?a.customFields[u]:e.customFields[u],m=i.get(u);m?m.setValue(f):i.addControl(u,new w.f(f))}}catch(p){s.e(p)}finally{s.f()}}}}))}},{key:"getUpdatedFacet",value:function(e,t,n){var c=Object(i.Sb)({translatable:e,updatedFields:t.value,customFieldConfig:this.customFields,languageCode:n,defaultTranslation:{languageCode:n,name:e.name||""}});return c.isPrivate=!t.value.visible,c}},{key:"getUpdatedFacetValues",value:function(e,t,n){var c=this,a=e.values.filter((function(e,n){var c=t.get(n.toString());return c&&c.dirty&&c.value.id})),r=t.controls.filter((function(e){return e.dirty&&e.value.id})).map((function(e){return e.value}));if(a.length!==r.length)throw new Error(Object(o.a)("error.facet-value-form-values-do-not-match"));return a.map((function(e,t){return Object(i.Sb)({translatable:e,updatedFields:r[t],customFieldConfig:c.customValueFields,languageCode:n,defaultTranslation:{languageCode:n,name:""}})})).filter(K.notNullOrUndefined)}}]),n}(i.u);_c.\u0275fac=function(e){return new(e||_c)(a.hc(r.e),a.hc(r.a),a.hc(i.Gb),a.hc(a.k),a.hc(i.K),a.hc(w.e),a.hc(i.yb),a.hc(i.xb))},_c.\u0275cmp=a.bc({type:_c,selectors:[["vdr-facet-detail"]],features:[a.Sb],decls:16,vars:19,consts:[[3,"entity"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","facet-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup"],["formGroupName","facet",1,"form-block"],["for","visibility",3,"label"],["type","checkbox","clrToggle","","formControlName","visible","id","visibility",3,"vdrDisabled"],[1,"visible-toggle"],[4,"ngIf","ngIfElse"],["private",""],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],["for","code",3,"label","readOnlyToggle"],["id","code","type","text","formControlName","code",3,"readonly"],["formGroupName","customFields",4,"ngIf"],["class","form-block",4,"ngIf"],["formGroupName","customFields"],[4,"ngFor","ngForOf"],["entityName","Facet",3,"customFieldsFormGroup","customField",4,"ngIf"],["entityName","Facet",3,"customFieldsFormGroup","customField"],[1,"form-block"],["class","facet-values-list table","formArrayName","values",4,"ngIf"],["type","button","class","btn btn-secondary",3,"click",4,"vdrIfPermissions"],["formArrayName","values",1,"facet-values-list","table"],["class","facet-value",3,"formGroupName",4,"ngFor","ngForOf"],[1,"facet-value",3,"formGroupName"],[1,"align-middle"],["type","text","formControlName","name",3,"readonly","input"],["type","text","formControlName","code","readonly",""],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],["entityName","FacetValue",3,"showLabel","customFieldsFormGroup","customField",4,"ngIf"],["entityName","FacetValue",3,"showLabel","customFieldsFormGroup","customField"],["type","button",1,"btn","btn-secondary",3,"click"],["shape","add"]],template:function(e,t){if(1&e&&(a.nc(0,"vdr-action-bar"),a.nc(1,"vdr-ab-left"),a.ic(2,"vdr-entity-info",0),a.yc(3,"async"),a.nc(4,"vdr-language-selector",1),a.vc("languageCodeChange",(function(e){return t.setLanguage(e)})),a.yc(5,"async"),a.yc(6,"async"),a.yc(7,"async"),a.mc(),a.mc(),a.nc(8,"vdr-ab-right"),a.ic(9,"vdr-action-bar-items",2),a.Zc(10,Ie,3,4,"button",3),a.yc(11,"async"),a.Zc(12,_e,1,1,"ng-template",null,4,a.ad),a.mc(),a.mc(),a.Zc(14,Ke,23,28,"form",5),a.yc(15,"async")),2&e){var n=a.Pc(13);a.Vb(2),a.Ec("entity",a.zc(3,7,t.entity$)),a.Vb(2),a.Ec("disabled",a.zc(5,9,t.isNew$))("availableLanguageCodes",a.zc(6,11,t.availableLanguages$))("currentLanguageCode",a.zc(7,13,t.languageCode$)),a.Vb(6),a.Ec("ngIf",a.zc(11,15,t.isNew$))("ngIfElse",n),a.Vb(4),a.Ec("ngIf",a.zc(15,17,t.entity$))}},directives:[i.c,i.e,i.Z,i.ub,i.f,i.d,B.p,i.ob,w.E,w.q,w.j,w.k,i.cb,X.k,i.db,w.a,X.i,w.p,w.h,i.R,X.t,w.b,B.o,i.H,w.d,i.S,i.V,X.o,i.U,i.T],pipes:[B.b,W.d,i.gb],styles:[".visible-toggle[_ngcontent-%COMP%]{margin-top:-3px!important}"],changeDetection:0}),_c.ctorParameters=function(){return[{type:r.e},{type:r.a},{type:i.Gb},{type:a.k},{type:i.K},{type:w.e},{type:i.yb},{type:i.xb}]},_c=Object(c.c)([Object(c.f)("design:paramtypes",[r.e,r.a,i.Gb,a.k,i.K,w.e,i.yb,i.xb])],_c);var Sc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,c,a,r,i){var o,s;return _classCallCheck(this,n),(s=t.call(this,r,i)).dataService=e,s.modalService=c,s.notificationService=a,s.initialLimit=3,s.displayLimit={},_get((o=_assertThisInitialized(s),_getPrototypeOf(n.prototype)),"setQueryFn",o).call(o,(function(){var e;return(e=s.dataService.facet).getFacets.apply(e,arguments).refetchOnChannelChange()}),(function(e){return e.facets})),s}return _createClass(n,[{key:"toggleDisplayLimit",value:function(e){this.displayLimit[e.id]===e.values.length?this.displayLimit[e.id]=this.initialLimit:this.displayLimit[e.id]=e.values.length}},{key:"deleteFacet",value:function(e){var t=this;this.showModalAndDelete(e).pipe(Object(p.a)((function(n){return n.result===i.O.DELETED?[!0]:t.showModalAndDelete(e,n.message||"").pipe(Object(s.a)((function(e){return e.result===i.O.DELETED})))}))).subscribe((function(){t.notificationService.success(Object(o.a)("common.notify-delete-success"),{entity:"FacetValue"}),t.refresh()}),(function(e){t.notificationService.error(Object(o.a)("common.notify-delete-error"),{entity:"FacetValue"})}))}},{key:"showModalAndDelete",value:function(e,t){var n=this;return this.modalService.dialog({title:Object(o.a)("catalog.confirm-delete-facet"),body:t,buttons:[{type:"secondary",label:Object(o.a)("common.cancel")},{type:"danger",label:Object(o.a)("common.delete"),returnValue:!0}]}).pipe(Object(p.a)((function(c){return c?n.dataService.facet.deleteFacet(e,!!t):z.a})),Object(s.a)((function(e){return e.deleteFacet})))}}]),n}(i.w);Sc.\u0275fac=function(e){return new(e||Sc)(a.hc(i.K),a.hc(i.xb),a.hc(i.yb),a.hc(r.e),a.hc(r.a))},Sc.\u0275cmp=a.bc({type:Sc,selectors:[["vdr-facet-list"]],features:[a.Sb],decls:24,vars:26,consts:[["locationId","facet-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[3,"expand"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"left","align-middle"],[3,"facetValue","removable","displayFacetName",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary btn-icon",3,"click",4,"ngIf"],[4,"ngIf","ngIfElse"],["private",""],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"facetValue","removable","displayFacetName"],[1,"btn","btn-sm","btn-secondary","btn-icon",3,"click"],["collapse",""],["shape","minus"]],template:function(e,t){1&e&&(a.nc(0,"vdr-action-bar"),a.nc(1,"vdr-ab-right"),a.ic(2,"vdr-action-bar-items",0),a.Zc(3,Be,4,5,"a",1),a.mc(),a.mc(),a.nc(4,"vdr-data-table",2),a.vc("pageChange",(function(e){return t.setPageNumber(e)}))("itemsPerPageChange",(function(e){return t.setItemsPerPage(e)})),a.yc(5,"async"),a.yc(6,"async"),a.yc(7,"async"),a.yc(8,"async"),a.nc(9,"vdr-dt-column"),a.bd(10),a.yc(11,"translate"),a.mc(),a.nc(12,"vdr-dt-column"),a.bd(13),a.yc(14,"translate"),a.mc(),a.nc(15,"vdr-dt-column",3),a.bd(16),a.yc(17,"translate"),a.mc(),a.nc(18,"vdr-dt-column"),a.bd(19),a.yc(20,"translate"),a.mc(),a.ic(21,"vdr-dt-column"),a.ic(22,"vdr-dt-column"),a.Zc(23,Xe,28,37,"ng-template"),a.mc()),2&e&&(a.Vb(3),a.Ec("vdrIfPermissions","CreateCatalog"),a.Vb(1),a.Ec("items",a.zc(5,10,t.items$))("itemsPerPage",a.zc(6,12,t.itemsPerPage$))("totalItems",a.zc(7,14,t.totalItems$))("currentPage",a.zc(8,16,t.currentPage$)),a.Vb(6),a.cd(a.zc(11,18,"common.code")),a.Vb(3),a.cd(a.zc(14,20,"common.name")),a.Vb(2),a.Ec("expand",!0),a.Vb(1),a.cd(a.zc(17,22,"catalog.values")),a.Vb(3),a.cd(a.zc(20,24,"catalog.visibility")))},directives:[i.c,i.f,i.d,i.ob,i.M,i.L,r.h,X.o,B.o,B.p,i.B,i.Lb,i.S,i.V,i.U,i.T,i.ab],pipes:[B.b,W.d,B.y,i.gb],styles:["td.private[_ngcontent-%COMP%]{background-color:#f2f3f5}"]}),Sc.ctorParameters=function(){return[{type:i.K},{type:i.xb},{type:i.yb},{type:r.e},{type:r.a}]},Sc=Object(c.c)([Object(c.f)("design:paramtypes",[i.K,i.xb,i.yb,r.e,r.a])],Sc);var Ec=function(){function e(t){_classCallCheck(this,e),this.dataService=t}return _createClass(e,[{key:"getFacets",value:function(){return this.dataService.facet.getAllFacets().mapSingle((function(e){return e.facets.items}))}},{key:"getTaxCategories",value:function(){return this.dataService.settings.getTaxCategories().mapSingle((function(e){return e.taxCategories})).pipe(Object(g.a)(1))}},{key:"createProductWithVariants",value:function(e,t,n){var c=this,a=this.dataService.product.createProduct(e),r=t.groups.filter((function(e){return 0<e.values.length})),i=this.createProductOptionGroups(r,n);return Object(Z.a)(a,i).pipe(Object(h.a)((function(e){var t=_slicedToArray(e,2),n=t[0].createProduct,a=t[1];return(a.length?Object(Z.a)(a.map((function(e){return c.dataService.product.addOptionGroupToProduct({productId:n.id,optionGroupId:e.id})}))):Object($.a)([])).pipe(Object(s.a)((function(){return{createProduct:n,optionGroups:a}})))})),Object(h.a)((function(e){var a=e.createProduct,r=e.optionGroups,i=t.variants.map((function(e){var t=r.length?e.optionValues.map((function(e,t){var n=r[t].options.find((function(t){return t.name===e}));if(!n)throw new Error('Could not find a matching ProductOption "'.concat(e,'" when creating variant'));return n.id})):[];return Object.assign(Object.assign({},e),{optionIds:t})})),o=r.map((function(e){return e.options})).reduce((function(e,t){return[].concat(_toConsumableArray(e),_toConsumableArray(t))}),[]);return c.createProductVariants(a,i,o,n)})))}},{key:"createProductOptionGroups",value:function(e,t){var n=this;return e.length?Object(Z.a)(e.map((function(e){return n.dataService.product.createProductOptionGroups({code:Object(U.normalizeString)(e.name,"-"),translations:[{languageCode:t,name:e.name}],options:e.values.map((function(e){return{code:Object(U.normalizeString)(e,"-"),translations:[{languageCode:t,name:e}]}}))}).pipe(Object(s.a)((function(e){return e.createProductOptionGroup})))}))):Object($.a)([])}},{key:"createProductVariants",value:function(e,t,n,c){var a=t.map((function(t){var a=n.length?"".concat(e.name," ").concat(t.optionIds.map((function(e){return n.find((function(t){return t.id===e}))})).filter(K.notNullOrUndefined).map((function(e){return e.name})).join(" ")):e.name;return{productId:e.id,price:t.price,sku:t.sku,stockOnHand:t.stock,translations:[{languageCode:c,name:a}],optionIds:t.optionIds}}));return this.dataService.product.createProductVariants(a).pipe(Object(s.a)((function(t){return{createProductVariants:t.createProductVariants,productId:e.id}})))}},{key:"updateProduct",value:function(e,t){var n=[];return e&&n.push(this.dataService.product.updateProduct(e)),t&&n.push(this.dataService.product.updateProductVariants(t)),Object(Z.a)(n)}},{key:"updateProductOption",value:function(e){return this.dataService.product.updateProductOption(e)}},{key:"deleteProductVariant",value:function(e,t){var n=this;return this.dataService.product.deleteProductVariant(e).pipe(Object(p.a)((function(e){return e.deleteProductVariant.result===i.O.DELETED?n.dataService.product.getProduct(t).single$:Object(N.a)(e.deleteProductVariant.message)})))}}]),e}();Ec.\u0275fac=function(e){return new(e||Ec)(a.rc(i.K))},Ec.ctorParameters=function(){return[{type:i.K}]},Ec.\u0275prov=Object(a.dc)({factory:function(){return new Ec(Object(a.rc)(i.K))},token:Ec,providedIn:"root"}),Ec=Object(c.c)([Object(c.f)("design:paramtypes",[i.K])],Ec);var wc=function(){function e(t){_classCallCheck(this,e),this.changeDetector=t,this.selectedValues=[]}return _createClass(e,[{key:"ngAfterViewInit",value:function(){var e=this;setTimeout((function(){return e.selector.focus()}),0)}},{key:"selectValues",value:function(){this.resolveWith(this.selectedValues)}},{key:"cancel",value:function(){this.resolveWith()}}]),e}();wc.\u0275fac=function(e){return new(e||wc)(a.hc(a.k))},wc.\u0275cmp=a.bc({type:wc,selectors:[["vdr-apply-facet-dialog"]],viewQuery:function(e,t){var n;1&e&&a.hd(i.bb,!0),2&e&&a.Oc(n=a.wc())&&(t.selector=n.first)},decls:3,vars:1,consts:[["vdrDialogTitle",""],[3,"facets","selectedValuesChange"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(a.Zc(0,et,2,3,"ng-template",0),a.nc(1,"vdr-facet-value-selector",1),a.vc("selectedValuesChange",(function(e){return t.selectedValues=e})),a.mc(),a.Zc(2,tt,6,7,"ng-template",2)),2&e&&(a.Vb(1),a.Ec("facets",t.facets))},directives:[i.Q,i.bb,i.P],pipes:[W.d],styles:[""],changeDetection:0}),wc.ctorParameters=function(){return[{type:a.k}]},Object(c.c)([Object(a.fb)(i.bb),Object(c.f)("design:type",i.bb)],wc.prototype,"selector",void 0),wc=Object(c.c)([Object(c.f)("design:paramtypes",[a.k])],wc);var Ac=function(){function e(t,n){_classCallCheck(this,e),this.dataService=t,this.notificationService=n,this.priceFactorControl=new w.f(1),this.selectedChannelIdControl=new w.f}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this,t=this.dataService.client.userStatus().mapSingle((function(e){return e.userStatus.activeChannelId})),n=this.dataService.settings.getChannels().mapSingle((function(e){return e.channels}));Object(M.a)(t,n).subscribe((function(t){var n=_slicedToArray(t,2),c=n[0],a=n[1];e.currentChannel=a.find((function(e){return e.id===c})),e.availableChannels=a})),this.selectedChannelIdControl.valueChanges.subscribe((function(t){e.selectChannel(t)})),this.variantsPreview$=Object(M.a)(Object(L.a)(this.getTopVariants(10)),this.priceFactorControl.valueChanges.pipe(Object(f.a)(1))).pipe(Object(s.a)((function(e){var t=_slicedToArray(e,2),n=t[0],c=t[1];return n.map((function(e){return{id:e.id,name:e.name,price:e.price,pricePreview:e.price*+c}}))})))}},{key:"selectChannel",value:function(e){this.selectedChannel=this.availableChannels.find((function(t){return t.id===e[0]}))}},{key:"assign",value:function(){var e=this,t=this.selectedChannel;t&&this.dataService.product.assignProductsToChannel({channelId:t.id,productIds:this.productIds,priceFactor:+this.priceFactorControl.value}).subscribe((function(){e.notificationService.success(Object(o.a)("catalog.assign-product-to-channel-success"),{channel:t.code}),e.resolveWith(!0)}))}},{key:"cancel",value:function(){this.resolveWith()}},{key:"getTopVariants",value:function(e){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,c,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=[],c=0;case 2:if(!(c<this.productIds.length&&n.length<e)){t.next=10;break}return t.next=5,this.dataService.product.getProduct(this.productIds[c]).mapSingle((function(e){var t=e.product;return t&&t.variants})).toPromise();case 5:a=t.sent,n.push.apply(n,_toConsumableArray(a||[]));case 7:c++,t.next=2;break;case 10:return t.abrupt("return",n.slice(0,e));case 11:case"end":return t.stop()}}),t,this)})))}}]),e}();Ac.\u0275fac=function(e){return new(e||Ac)(a.hc(i.K),a.hc(i.yb))},Ac.\u0275cmp=a.bc({type:Ac,selectors:[["vdr-assign-products-to-channel-dialog"]],decls:36,vars:31,consts:[["vdrDialogTitle",""],[1,"flex"],["clrInput","",3,"multiple","includeDefaultChannel","formControl"],[1,"flex-spacer"],["clrInput","","type","number","min","0","max","99999",3,"formControl"],[1,"channel-price-preview"],[1,"clr-control-label"],[1,"table"],[3,"ngIf","ngIfElse"],["noSelection",""],[4,"ngFor","ngForOf"],["vdrDialogButtons",""],["noChannelSelected",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){if(1&e&&(a.Zc(0,nt,2,3,"ng-template",0),a.nc(1,"div",1),a.nc(2,"clr-input-container"),a.nc(3,"label"),a.bd(4),a.yc(5,"translate"),a.mc(),a.ic(6,"vdr-channel-assignment-control",2),a.mc(),a.ic(7,"div",3),a.nc(8,"clr-input-container"),a.nc(9,"label"),a.bd(10),a.yc(11,"translate"),a.mc(),a.ic(12,"input",4),a.mc(),a.mc(),a.nc(13,"div",5),a.nc(14,"label",6),a.bd(15),a.yc(16,"translate"),a.mc(),a.nc(17,"table",7),a.nc(18,"thead"),a.nc(19,"tr"),a.nc(20,"th"),a.bd(21),a.yc(22,"translate"),a.mc(),a.nc(23,"th"),a.bd(24),a.yc(25,"translate"),a.yc(26,"translate"),a.yc(27,"channelCodeToLabel"),a.mc(),a.nc(28,"th"),a.Zc(29,at,2,6,"ng-template",8),a.Zc(30,rt,2,3,"ng-template",null,9,a.ad),a.mc(),a.mc(),a.mc(),a.nc(32,"tbody"),a.Zc(33,st,10,7,"tr",10),a.yc(34,"async"),a.mc(),a.mc(),a.mc(),a.Zc(35,pt,7,6,"ng-template",11)),2&e){var n=a.Pc(31);a.Vb(4),a.cd(a.zc(5,12,"common.channel")),a.Vb(2),a.Ec("multiple",!1)("includeDefaultChannel",!1)("formControl",t.selectedChannelIdControl),a.Vb(4),a.cd(a.zc(11,14,"catalog.price-conversion-factor")),a.Vb(2),a.Ec("formControl",t.priceFactorControl),a.Vb(3),a.cd(a.zc(16,16,"catalog.channel-price-preview")),a.Vb(6),a.cd(a.zc(22,18,"common.name")),a.Vb(3),a.dd(" ",a.Ac(25,20,"catalog.price-in-channel",a.Jc(29,ct,a.zc(26,23,a.zc(27,25,null==t.currentChannel?null:t.currentChannel.code))))," "),a.Vb(5),a.Ec("ngIf",t.selectedChannel)("ngIfElse",n),a.Vb(4),a.Ec("ngForOf",a.zc(34,27,t.variantsPreview$))}},directives:[i.Q,X.s,X.t,i.y,X.r,w.p,w.g,i.db,w.v,w.b,B.p,B.o,i.P],pipes:[W.d,i.A,B.b,B.d],styles:["vdr-channel-assignment-control[_ngcontent-%COMP%]{min-width:200px}.channel-price-preview[_ngcontent-%COMP%]{margin-top:24px}.channel-price-preview[_ngcontent-%COMP%]   table.table[_ngcontent-%COMP%]{margin-top:6px}"],changeDetection:0}),Ac.ctorParameters=function(){return[{type:i.K},{type:i.yb}]},Ac=Object(c.c)([Object(c.f)("design:paramtypes",[i.K,i.yb])],Ac);var Mc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,c,a,r,i,o,s,l,u,d){var p;return _classCallCheck(this,n),(p=t.call(this,e,c,a,l)).productDetailService=r,p.formBuilder=i,p.modalService=o,p.notificationService=s,p.dataService=l,p.location=u,p.changeDetector=d,p.assetChanges={},p.variantAssetChanges={},p.selectedVariantIds=[],p.variantDisplayMode="card",p.createVariantsConfig={groups:[],variants:[]},p.customFields=p.getCustomFieldConfig("Product"),p.customVariantFields=p.getCustomFieldConfig("ProductVariant"),p.customOptionGroupFields=p.getCustomFieldConfig("ProductOptionGroup"),p.customOptionFields=p.getCustomFieldConfig("ProductOption"),p.detailForm=p.formBuilder.group({product:p.formBuilder.group({enabled:!0,name:["",w.C.required],slug:"",description:"",facetValueIds:[[]],customFields:p.formBuilder.group(p.customFields.reduce((function(e,t){return Object.assign(Object.assign({},e),_defineProperty({},t.name,""))}),{}))}),variants:p.formBuilder.array([])}),p}return _createClass(n,[{key:"ngOnInit",value:function(){this.init(),this.product$=this.entity$,this.variants$=this.product$.pipe(Object(s.a)((function(e){return e.variants}))),this.taxCategories$=this.productDetailService.getTaxCategories().pipe(Object(u.a)(this.destroy$)),this.activeTab$=this.route.paramMap.pipe(Object(s.a)((function(e){return e.get("tab")}))),this.facets$=this.productDetailService.getFacets();var e=this.product$.pipe(Object(s.a)((function(e){return e.facetValues}))),t=this.facets$.pipe(Object(s.a)(i.Ub)),n=this.getProductFormGroup().valueChanges.pipe(Object(s.a)((function(e){return e.facetValueIds})),Object(m.a)()),c=Object(M.a)(n,e,t).pipe(Object(s.a)((function(e){var t=_slicedToArray(e,3),n=t[0],c=t[1],a=t[2],r=[].concat(_toConsumableArray(c),_toConsumableArray(a));return n.map((function(e){return r.find((function(t){return t.id===e}))})).filter(K.notNullOrUndefined)})));this.facetValues$=Object(G.a)(e,c),this.productChannels$=this.product$.pipe(Object(s.a)((function(e){return e.channels})))}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"navigateToTab",value:function(e){this.router.navigate(["./",Object.assign(Object.assign({},this.route.snapshot.params),{tab:e})],{queryParamsHandling:"merge",relativeTo:this.route,state:_defineProperty({},i.lb,!0)})}},{key:"isDefaultChannel",value:function(e){return e===R.DEFAULT_CHANNEL_CODE}},{key:"assignToChannel",value:function(){this.modalService.fromComponent(Ac,{size:"lg",locals:{productIds:[this.id]}}).subscribe()}},{key:"removeFromChannel",value:function(e){var t=this;this.modalService.dialog({title:Object(o.a)("catalog.remove-product-from-channel"),buttons:[{type:"secondary",label:Object(o.a)("common.cancel")},{type:"danger",label:Object(o.a)("catalog.remove-from-channel"),returnValue:!0}]}).pipe(Object(p.a)((function(n){return n?t.dataService.product.removeProductsFromChannel({channelId:e,productIds:[t.id]}):z.a}))).subscribe((function(){t.notificationService.success(Object(o.a)("catalog.notify-remove-product-from-channel-success"))}),(function(e){t.notificationService.error(Object(o.a)("catalog.notify-remove-product-from-channel-error"))}))}},{key:"customFieldIsSet",value:function(e){return!!this.detailForm.get(["product","customFields",e])}},{key:"assetsChanged",value:function(){return!!Object.values(this.assetChanges).length}},{key:"variantAssetsChanged",value:function(){return!!Object.keys(this.variantAssetChanges).length}},{key:"variantAssetChange",value:function(e){this.variantAssetChanges[e.variantId]=e}},{key:"updateSlug",value:function(e){var t=this;this.isNew$.pipe(Object(v.a)(1)).subscribe((function(n){if(n){var c=t.detailForm.get(["product","slug"]);c&&c.pristine&&c.setValue(Object(U.normalizeString)("".concat(e),"-"))}}))}},{key:"selectProductFacetValue",value:function(){var e=this;this.displayFacetValueModal().subscribe((function(t){if(t){var n=e.getProductFormGroup(),c=n.value.facetValueIds;n.patchValue({facetValueIds:Object(q.unique)([].concat(_toConsumableArray(c),_toConsumableArray(t)))}),n.markAsDirty()}}))}},{key:"updateProductOption",value:function(e){var t=this;this.productDetailService.updateProductOption(e).subscribe((function(){t.notificationService.success(Object(o.a)("common.notify-update-success"),{entity:"ProductOption"})}),(function(e){t.notificationService.error(Object(o.a)("common.notify-update-error"),{entity:"ProductOption"})}))}},{key:"removeProductFacetValue",value:function(e){var t=this.getProductFormGroup(),n=t.value.facetValueIds;t.patchValue({facetValueIds:n.filter((function(t){return t!==e}))}),t.markAsDirty()}},{key:"selectVariantFacetValue",value:function(e){var t=this;this.displayFacetValueModal().pipe(V(this.variants$)).subscribe((function(n){var c=_slicedToArray(n,2),a=c[0],r=c[1];if(a){var i,o=_createForOfIteratorHelper(e);try{var s=function(){var e=i.value,n=r.findIndex((function(t){return t.id===e})),c=r[n],o=c?c.facetValues.map((function(e){return e.id})):[],s=t.detailForm.get(["variants",n]);s&&(s.patchValue({facetValueIds:Object(q.unique)([].concat(_toConsumableArray(o),_toConsumableArray(a)))}),s.markAsDirty())};for(o.s();!(i=o.n()).done;)s()}catch(l){o.e(l)}finally{o.f()}t.changeDetector.markForCheck()}}))}},{key:"variantsToCreateAreValid",value:function(){return 0<this.createVariantsConfig.variants.length&&this.createVariantsConfig.variants.every((function(e){return""!==e.sku}))}},{key:"displayFacetValueModal",value:function(){var e=this;return this.productDetailService.getFacets().pipe(Object(h.a)((function(t){return e.modalService.fromComponent(wc,{size:"md",closable:!0,locals:{facets:t}})})),Object(s.a)((function(e){return e&&e.map((function(e){return e.id}))})))}},{key:"create",value:function(){var e=this,t=this.getProductFormGroup();t.dirty&&Object(M.a)(this.product$,this.languageCode$).pipe(Object(v.a)(1),Object(h.a)((function(n){var c=_slicedToArray(n,2),a=c[0],r=c[1],i=e.getUpdatedProduct(a,t,r);return e.productDetailService.createProductWithVariants(i,e.createVariantsConfig,r)}))).subscribe((function(t){t.createProductVariants;var n=t.productId;e.notificationService.success(Object(o.a)("common.notify-create-success"),{entity:"Product"}),e.assetChanges={},e.variantAssetChanges={},e.detailForm.markAsPristine(),e.router.navigate(["../",n],{relativeTo:e.route})}),(function(t){console.error(t),e.notificationService.error(Object(o.a)("common.notify-create-error"),{entity:"Product"})}))}},{key:"save",value:function(){var e=this;Object(M.a)(this.product$,this.languageCode$).pipe(Object(v.a)(1),Object(h.a)((function(t){var n,c,a=_slicedToArray(t,2),r=a[0],i=a[1],o=e.getProductFormGroup();(o.dirty||e.assetsChanged())&&(n=e.getUpdatedProduct(r,o,i));var s=e.detailForm.get("variants");return(s&&s.dirty||e.variantAssetsChanged())&&(c=e.getUpdatedProductVariants(r,s,i)),e.productDetailService.updateProduct(n,c)}))).subscribe((function(t){e.updateSlugAfterSave(t),e.detailForm.markAsPristine(),e.assetChanges={},e.variantAssetChanges={},e.notificationService.success(Object(o.a)("common.notify-update-success"),{entity:"Product"}),e.changeDetector.markForCheck()}),(function(t){e.notificationService.error(Object(o.a)("common.notify-update-error"),{entity:"Product"})}))}},{key:"canDeactivate",value:function(){return _get(_getPrototypeOf(n.prototype),"canDeactivate",this).call(this)&&!this.assetChanges.assetIds&&!this.assetChanges.featuredAssetId}},{key:"setFormValues",value:function(e,t){var n=this,c=e.translations.find((function(e){return e.languageCode===t}));if(this.detailForm.patchValue({product:{enabled:e.enabled,name:c?c.name:"",slug:c?c.slug:"",description:c?c.description:"",facetValueIds:e.facetValues.map((function(e){return e.id}))}}),this.customFields.length){var a,r=this.detailForm.get(["product","customFields"]),i=c&&c.customFields||{},o=e.customFields||{},s=_createForOfIteratorHelper(this.customFields);try{for(s.s();!(a=s.n()).done;){var l=a.value,u=l.name,d="localeString"===l.type?i[u]:o[u],p=r.get(u);p&&p.patchValue(d)}}catch(m){s.e(m)}finally{s.f()}}var f=this.detailForm.get("variants");e.variants.forEach((function(e,c){var a=e.translations.find((function(e){return e.languageCode===t})),r=e.facetValues.map((function(e){return e.id})),i={enabled:e.enabled,sku:e.sku,name:a?a.name:"",price:e.price,priceIncludesTax:e.priceIncludesTax,priceWithTax:e.priceWithTax,taxCategoryId:e.taxCategory.id,stockOnHand:e.stockOnHand,trackInventory:e.trackInventory,facetValueIds:r},o=f.at(c);if(o?o.patchValue(i):(o=n.formBuilder.group(Object.assign(Object.assign({},i),{facetValueIds:n.formBuilder.control(r)})),f.insert(c,o)),n.customVariantFields.length){var s=o.get(["customFields"]);s||(s=n.formBuilder.group(n.customVariantFields.reduce((function(e,t){return Object.assign(Object.assign({},e),_defineProperty({},t.name,""))}),{})),o.addControl("customFields",s));var l,u=_createForOfIteratorHelper(n.customVariantFields);try{for(u.s();!(l=u.n()).done;){var d=l.value,p=d.name,b="localeString"===d.type?a.customFields[p]:e.customFields[p],g=s.get(p);g&&g.patchValue(b)}}catch(m){u.e(m)}finally{u.f()}}}))}},{key:"getUpdatedProduct",value:function(e,t,n){var c=Object(i.Sb)({translatable:e,updatedFields:t.value,customFieldConfig:this.customFields,languageCode:n,defaultTranslation:{languageCode:n,name:e.name||"",slug:e.slug||"",description:e.description||""}});return Object.assign(Object.assign(Object.assign({},c),this.assetChanges),{facetValueIds:t.value.facetValueIds})}},{key:"getUpdatedProductVariants",value:function(e,t,n){var c=this,a=e.variants.filter((function(e,n){var c=t.get(n.toString());return c&&c.dirty})),r=t.controls.filter((function(e){return e.dirty})).map((function(e){return e.value}));if(a.length!==r.length)throw new Error(Object(o.a)("error.product-variant-form-values-do-not-match"));return a.map((function(e,t){var a=r[t],o=Object(i.Sb)({translatable:e,updatedFields:a,customFieldConfig:c.customVariantFields,languageCode:n,defaultTranslation:{languageCode:n,name:""}});o.taxCategoryId=a.taxCategoryId,o.facetValueIds=a.facetValueIds;var s=c.variantAssetChanges[e.id];return s&&(o.featuredAssetId=s.featuredAssetId,o.assetIds=s.assetIds),o})).filter(K.notNullOrUndefined)}},{key:"getProductFormGroup",value:function(){return this.detailForm.get("product")}},{key:"updateSlugAfterSave",value:function(e){var t=e[0],n=this.detailForm.get(["product","slug"]);n&&t.hasOwnProperty("updateProduct")&&n.setValue(t.updateProduct.slug,{emitEvent:!1})}}]),n}(i.u);Mc.\u0275fac=function(e){return new(e||Mc)(a.hc(r.a),a.hc(r.e),a.hc(i.Gb),a.hc(Ec),a.hc(w.e),a.hc(i.xb),a.hc(i.yb),a.hc(i.K),a.hc(B.l),a.hc(a.k))},Mc.\u0275cmp=a.bc({type:Mc,selectors:[["vdr-product-detail"]],features:[a.Sb],decls:18,vars:20,consts:[[1,"flex","clr-flex-row"],[3,"entity"],[4,"vdrIfPermissions"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","product-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup","keydown.enter",4,"ngIf"],["type","checkbox","clrToggle","","name","enabled",3,"formControl"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup","keydown.enter"],["clrTabLink","",3,"click"],[4,"clrIfActive"],[4,"ngIf"],[1,"clr-row"],[1,"clr-col"],["formGroupName","product",1,"form-block"],[4,"vdrIfMultichannel"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],["for","slug",3,"label","errors"],["id","slug","type","text","formControlName","slug","pattern","[a-z0-9_-]+",3,"readonly"],["formControlName","description",3,"readonly","label"],["formGroupName","customFields",4,"ngIf"],[1,"facets"],[3,"facetValue","removable","remove",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary",3,"click",4,"vdrIfPermissions"],[1,"clr-col-md-auto"],[3,"assets","featuredAsset","change"],[3,"label",4,"vdrIfDefaultChannelActive"],[3,"label"],[1,"flex"],[1,"product-channels"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm",3,"click"],["shape","layers"],["icon","times-circle",3,"iconClick",4,"ngIf"],["icon","times-circle",3,"iconClick"],[3,"channelCode"],["formGroupName","customFields"],["entityName","Product",3,"customFieldsFormGroup","customField","readonly",4,"ngIf"],["entityName","Product",3,"customFieldsFormGroup","customField","readonly"],[3,"facetValue","removable","remove"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","plus"],[3,"variantsChange"],[1,"form-block"],[1,"view-mode"],[1,"btn-group","btn-sm"],[1,"btn","btn-secondary-outline",3,"click"],["shape","list"],[1,"btn",3,"click"],["shape","table"],[1,"flex-spacer"],["class","btn btn-secondary btn-sm edit-variants-btn",3,"routerLink",4,"vdrIfPermissions"],[3,"variants","optionGroups","productVariantsFormArray",4,"ngIf"],[3,"variants","facets","optionGroups","productVariantsFormArray","taxCategories","customFields","customOptionFields","activeLanguage","assetChange","updateProductOption","selectionChange","selectFacetValueClick",4,"ngIf"],[1,"btn","btn-secondary","btn-sm","edit-variants-btn",3,"routerLink"],["shape","add-text"],[3,"variants","optionGroups","productVariantsFormArray"],[3,"variants","facets","optionGroups","productVariantsFormArray","taxCategories","customFields","customOptionFields","activeLanguage","assetChange","updateProductOption","selectionChange","selectFacetValueClick"]],template:function(e,t){if(1&e&&(a.nc(0,"vdr-action-bar"),a.nc(1,"vdr-ab-left"),a.nc(2,"div",0),a.ic(3,"vdr-entity-info",1),a.yc(4,"async"),a.Zc(5,mt,5,5,"clr-toggle-wrapper",2),a.mc(),a.nc(6,"vdr-language-selector",3),a.vc("languageCodeChange",(function(e){return t.setLanguage(e)})),a.yc(7,"async"),a.yc(8,"async"),a.yc(9,"async"),a.mc(),a.mc(),a.nc(10,"vdr-ab-right"),a.ic(11,"vdr-action-bar-items",4),a.Zc(12,bt,3,4,"button",5),a.yc(13,"async"),a.Zc(14,vt,1,1,"ng-template",null,6,a.ad),a.mc(),a.mc(),a.Zc(16,Dt,10,10,"form",7),a.yc(17,"async")),2&e){var n=a.Pc(15);a.Vb(3),a.Ec("entity",a.zc(4,8,t.entity$)),a.Vb(2),a.Ec("vdrIfPermissions","UpdateCatalog"),a.Vb(1),a.Ec("disabled",a.zc(7,10,t.isNew$))("availableLanguageCodes",a.zc(8,12,t.availableLanguages$))("currentLanguageCode",a.zc(9,14,t.languageCode$)),a.Vb(6),a.Ec("ngIf",a.zc(13,16,t.isNew$))("ngIfElse",n),a.Vb(4),a.Ec("ngIf",a.zc(17,18,t.product$))}},directives:function(){return[i.c,i.e,i.Z,i.ob,i.ub,i.f,i.d,B.p,X.k,i.db,w.a,X.i,w.p,w.g,X.t,w.E,w.q,w.j,X.F,X.N,X.C,X.E,X.O,X.p,X.D,w.k,i.nb,i.cb,w.b,w.h,w.w,i.Eb,B.o,fa,i.mb,i.eb,X.o,i.B,i.z,i.H,i.ab,ua,r.h,va,ga]},pipes:function(){return[B.b,W.d,i.gb,i.A]},styles:["[_nghost-%COMP%]     trix-toolbar{top:24px}vdr-action-bar[_ngcontent-%COMP%]   clr-toggle-wrapper[_ngcontent-%COMP%]{margin-top:12px}.group-name[_ngcontent-%COMP%]{padding-right:6px}.view-mode[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.edit-variants-btn[_ngcontent-%COMP%]{margin-top:0}"],changeDetection:0}),Mc.ctorParameters=function(){return[{type:r.a},{type:r.e},{type:i.Gb},{type:Ec},{type:w.e},{type:i.xb},{type:i.yb},{type:i.K},{type:B.l},{type:a.k}]},Mc=Object(c.c)([Object(c.f)("design:paramtypes",[r.a,r.e,i.Gb,Ec,w.e,i.xb,i.yb,i.K,B.l,a.k])],Mc);var zc=function(){function e(){_classCallCheck(this,e),this._selected=[]}return _createClass(e,[{key:"select",value:function(e,t,n){if(e.selected=!0,n||!e.children)if(e.value.label){var c=function(e){return!!e.value.label};this._selected.filter(c).length>0?this._selected=this._selected.filter((function(e){return!c(e)})).concat(e):this._selected.push(e)}else this._selected.push(e)}},{key:"unselect",value:function(e,t){this._selected=this._selected.filter((function(t){return t!==e})),e.selected=!1}},{key:"clear",value:function(e){this._selected=e?this._selected.filter((function(e){return e.disabled})):[]}},{key:"_setChildrenSelectedState",value:function(e,t){e.forEach((function(e){return e.selected=t}))}},{key:"_removeChildren",value:function(e){this._selected=this._selected.filter((function(t){return t.parent!==e}))}},{key:"_removeParent",value:function(e){this._selected=this._selected.filter((function(t){return t!==e}))}},{key:"value",get:function(){return this._selected}}]),e}();function Dc(){return new zc}var Tc=Dc,$c=function(){function e(){var t=this;_classCallCheck(this,e),this.searchTermChange=new a.u,this.facetValueChange=new a.u,this.lastTerm="",this.lastFacetValueIds=[],this.filterFacetResults=function(e,n){return!!t.isFacetValueItem(n)&&(n.facetValue.name.toLowerCase().startsWith(e.toLowerCase())||n.facetValue.facet.name.toLowerCase().startsWith(e.toLowerCase()))},this.groupByFacet=function(e){return t.isFacetValueItem(e)?e.facetValue.facet.name:""},this.isFacetValueItem=function(e){return"object"==typeof e&&!!e&&e.hasOwnProperty("facetValue")}}return _createClass(e,[{key:"setSearchTerm",value:function(e){var t=this;if(e)this.selectComponent.select({label:e,value:{label:e}});else{var n=this.selectComponent.selectedItems.find((function(e){return!t.isFacetValueItem(e.value)}));n&&this.selectComponent.unselect(n)}}},{key:"setFacetValues",value:function(e){var t=this,n=this.selectComponent.items;this.selectComponent.selectedItems.forEach((function(n){t.isFacetValueItem(n.value)&&!e.includes(n.value.facetValue.id)&&t.selectComponent.unselect(n)})),e.map((function(e){return n.find((function(n){return t.isFacetValueItem(n)&&n.facetValue.id===e}))})).filter(K.notNullOrUndefined).forEach((function(e){t.selectComponent.selectedItems.find((function(n){var c=n.value;return!!t.isFacetValueItem(c)&&c.facetValue.id===e.facetValue.id}))||t.selectComponent.select({label:"",value:e})}))}},{key:"onSelectChange",value:function(e){var t=this;Array.isArray(e)||(e=[e]);var n=e.find((function(e){return!t.isFacetValueItem(e)})),c=n?n.label:"",a=e.filter(this.isFacetValueItem).map((function(e){return e.facetValue.id}));c!==this.lastTerm&&(this.searchTermChange.emit(c),this.lastTerm=c),this.lastFacetValueIds.join(",")!==a.join(",")&&(this.facetValueChange.emit(a),this.lastFacetValueIds=a)}},{key:"isSearchHeaderSelected",value:function(){return-1===this.selectComponent.itemsList.markedIndex}}]),e}();$c.\u0275fac=function(e){return new(e||$c)},$c.\u0275cmp=a.bc({type:$c,selectors:[["vdr-product-search-input"]],viewQuery:function(e,t){var n;1&e&&a.Xc(Tt,!0),2&e&&a.Oc(n=a.wc())&&(t.selectComponent=n.first)},inputs:{facetValueResults:"facetValueResults"},outputs:{searchTermChange:"searchTermChange",facetValueChange:"facetValueChange"},features:[a.Ub([{provide:Y.c,useValue:Tc}])],decls:6,vars:9,consts:[[3,"addTag","placeholder","items","searchFn","hideSelected","multiple","markFirst","change"],["selectComponent",""],["ng-header-tmp",""],["ng-label-tmp",""],["ng-option-tmp",""],["class","search-header",3,"selected","click",4,"ngIf"],[1,"search-header",3,"click"],[4,"ngIf"],[3,"facetValue","removable","remove"],[3,"icon","iconClick"],[3,"facetValue","removable"]],template:function(e,t){1&e&&(a.nc(0,"ng-select",0,1),a.vc("change",(function(e){return t.onSelectChange(e)})),a.yc(2,"translate"),a.Zc(3,Zt,1,1,"ng-template",2),a.Zc(4,Gt,2,2,"ng-template",3),a.Zc(5,Kt,1,1,"ng-template",4),a.mc()),2&e&&a.Ec("addTag",!0)("placeholder",a.zc(2,7,"catalog.search-product-name-or-code"))("items",t.facetValueResults)("searchFn",t.filterFacetResults)("hideSelected",!0)("multiple",!0)("markFirst",!1)},directives:[Y.a,Y.f,Y.e,Y.d,B.p,i.ab,i.B],pipes:[W.d],styles:["[_nghost-%COMP%]{margin-top:6px;display:block;width:100%}[_nghost-%COMP%]     .ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-value{background:0 0;margin:0}[_nghost-%COMP%]     .ng-dropdown-panel-items div.ng-option:last-child{display:none}[_nghost-%COMP%]     .ng-dropdown-panel .ng-dropdown-header{border:none;padding:0}[_nghost-%COMP%]     .ng-select.ng-select-multiple .ng-select-container .ng-value-container{padding:0}[_nghost-%COMP%]     .ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-placeholder{padding-left:8px}ng-select[_ngcontent-%COMP%]{width:100%;min-width:300px;margin-right:12px}.search-header[_ngcontent-%COMP%]{padding:8px 10px;border-bottom:1px solid #f2f3f5;cursor:pointer}.search-header.selected[_ngcontent-%COMP%], .search-header[_ngcontent-%COMP%]:hover{background-color:#f2f3f5}"],changeDetection:0}),Object(c.c)([Object(a.D)(),Object(c.f)("design:type",Array)],$c.prototype,"facetValueResults",void 0),Object(c.c)([Object(a.O)(),Object(c.f)("design:type",Object)],$c.prototype,"searchTermChange",void 0),Object(c.c)([Object(a.O)(),Object(c.f)("design:type",Object)],$c.prototype,"facetValueChange",void 0),Object(c.c)([Object(a.fb)("selectComponent",{static:!0}),Object(c.f)("design:type",Y.a)],$c.prototype,"selectComponent",void 0);var Zc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,c,a,r,o,s){var l,u;return _classCallCheck(this,n),(u=t.call(this,o,s)).dataService=e,u.modalService=c,u.notificationService=a,u.jobQueueService=r,u.searchTerm="",u.facetValueIds=[],u.groupByProduct=!0,_get((l=_assertThisInitialized(u),_getPrototypeOf(n.prototype)),"setQueryFn",l).call(l,(function(){for(var e,t=arguments.length,n=new Array(t),c=0;c<t;c++)n[c]=arguments[c];return(e=u.dataService.product).searchProducts.apply(e,[u.searchTerm].concat(n)).refetchOnChannelChange()}),(function(e){return e.search}),(function(e,t){return{input:{skip:e,take:t,term:u.searchTerm,facetValueIds:u.facetValueIds,facetValueOperator:i.wb.AND,groupByProduct:u.groupByProduct}}})),u}return _createClass(n,[{key:"ngOnInit",value:function(){var e=this;_get(_getPrototypeOf(n.prototype),"ngOnInit",this).call(this),this.facetValues$=this.result$.pipe(Object(s.a)((function(e){return e.search.facetValues}))),this.route.queryParamMap.pipe(Object(s.a)((function(e){return e.get("q")})),Object(u.a)(this.destroy$)).subscribe((function(t){e.productSearchInput.setSearchTerm(t)}));var t=this.route.queryParamMap.pipe(Object(s.a)((function(e){return e.getAll("fvids")})));t.pipe(Object(u.a)(this.destroy$)).subscribe((function(t){e.productSearchInput.setFacetValues(t)})),this.facetValues$.pipe(Object(v.a)(1),function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.a,c=(t=e)instanceof Date&&!isNaN(+t)?+e-n.now():Math.abs(e);return function(e){return e.lift(new j(c,n))}}(100),V(t)).subscribe((function(t){var n=_slicedToArray(t,2),c=(n[0],n[1]);e.productSearchInput.setFacetValues(c)}))}},{key:"setSearchTerm",value:function(e){this.searchTerm=e,this.setQueryParam({q:e||null,page:1}),this.refresh()}},{key:"setFacetValueIds",value:function(e){this.facetValueIds=e,this.setQueryParam({fvids:e,page:1}),this.refresh()}},{key:"rebuildSearchIndex",value:function(){var e=this;this.dataService.product.reindex().subscribe((function(t){var n=t.reindex;e.notificationService.info(Object(o.a)("catalog.reindexing")),e.jobQueueService.addJob(n.id,(function(t){if(t.state===i.rb.COMPLETED){var n=(new Intl.NumberFormat).format(t.duration||0);e.notificationService.success(Object(o.a)("catalog.reindex-successful"),{count:t.result.indexedItemCount,time:n}),e.refresh()}else e.notificationService.error(Object(o.a)("catalog.reindex-error"))}))}))}},{key:"deleteProduct",value:function(e){var t=this;this.modalService.dialog({title:Object(o.a)("catalog.confirm-delete-product"),buttons:[{type:"secondary",label:Object(o.a)("common.cancel")},{type:"danger",label:Object(o.a)("common.delete"),returnValue:!0}]}).pipe(Object(p.a)((function(n){return n?t.dataService.product.deleteProduct(e):z.a}))).subscribe((function(){t.notificationService.success(Object(o.a)("common.notify-delete-success"),{entity:"Product"}),t.refresh()}),(function(e){t.notificationService.error(Object(o.a)("common.notify-delete-error"),{entity:"Product"})}))}}]),n}(i.w);Zc.\u0275fac=function(e){return new(e||Zc)(a.hc(i.K),a.hc(i.xb),a.hc(i.yb),a.hc(i.qb),a.hc(r.e),a.hc(r.a))},Zc.\u0275cmp=a.bc({type:Zc,selectors:[["vdr-products-list"]],viewQuery:function(e,t){var n;1&e&&a.Xc(Bt,!0),2&e&&a.Oc(n=a.wc())&&(t.productSearchInput=n.first)},features:[a.Sb],decls:28,vars:27,consts:[[3,"grow"],[1,"search-form"],[3,"facetValueResults","searchTermChange","facetValueChange"],["productSearchInputComponent",""],[1,"search-settings-menu"],["type","button","vdrDropdownTrigger","",1,"icon-button"],["shape","cog"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",3,"disabled","click"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],["locationId","product-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"full-label"],[1,"left","align-middle"],[1,"image-placeholder"],[3,"src",4,"ngIf","ngIfElse"],["imagePlaceholder",""],[1,"align-middle"],[4,"ngIf"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"src"],[1,"placeholder"],["shape","image","size","48"]],template:function(e,t){1&e&&(a.nc(0,"vdr-action-bar"),a.nc(1,"vdr-ab-left",0),a.nc(2,"div",1),a.nc(3,"vdr-product-search-input",2,3),a.vc("searchTermChange",(function(e){return t.setSearchTerm(e)}))("facetValueChange",(function(e){return t.setFacetValueIds(e)})),a.yc(5,"async"),a.mc(),a.nc(6,"vdr-dropdown",4),a.nc(7,"button",5),a.ic(8,"clr-icon",6),a.mc(),a.nc(9,"vdr-dropdown-menu",7),a.nc(10,"button",8),a.vc("click",(function(){return t.rebuildSearchIndex()})),a.yc(11,"hasPermission"),a.bd(12),a.yc(13,"translate"),a.mc(),a.mc(),a.mc(),a.mc(),a.nc(14,"clr-checkbox-wrapper"),a.nc(15,"input",9),a.vc("ngModelChange",(function(e){return t.groupByProduct=e})),a.mc(),a.nc(16,"label"),a.bd(17),a.yc(18,"translate"),a.mc(),a.mc(),a.mc(),a.nc(19,"vdr-ab-right"),a.ic(20,"vdr-action-bar-items",10),a.Zc(21,Rt,5,5,"a",11),a.mc(),a.mc(),a.nc(22,"vdr-data-table",12),a.vc("pageChange",(function(e){return t.setPageNumber(e)}))("itemsPerPageChange",(function(e){return t.setItemsPerPage(e)})),a.yc(23,"async"),a.yc(24,"async"),a.yc(25,"async"),a.yc(26,"async"),a.Zc(27,Jt,24,29,"ng-template"),a.mc()),2&e&&(a.Vb(1),a.Ec("grow",!0),a.Vb(2),a.Ec("facetValueResults",a.zc(5,11,t.facetValues$)),a.Vb(7),a.Ec("disabled",!a.zc(11,13,"UpdateCatalog")),a.Vb(2),a.dd(" ",a.zc(13,15,"catalog.rebuild-search-index")," "),a.Vb(3),a.Ec("ngModel",t.groupByProduct),a.Vb(2),a.cd(a.zc(18,17,"catalog.group-by-product")),a.Vb(4),a.Ec("vdrIfPermissions","CreateCatalog"),a.Vb(1),a.Ec("items",a.zc(23,19,t.items$))("itemsPerPage",a.zc(24,21,t.itemsPerPage$))("totalItems",a.zc(25,23,t.totalItems$))("currentPage",a.zc(26,25,t.currentPage$)))},directives:[i.c,i.e,$c,i.S,i.V,X.o,i.U,i.T,X.k,i.db,w.a,X.i,w.p,w.s,X.t,i.f,i.d,i.ob,i.M,r.h,B.p,i.Lb,i.B],pipes:[B.b,i.gb,W.d,i.q],styles:[".image-placeholder[_ngcontent-%COMP%]{width:50px;height:50px;background-color:#f2f3f5}.image-placeholder[_ngcontent-%COMP%]   .placeholder[_ngcontent-%COMP%]{text-align:center;color:#bfc3cc}.search-form[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;margin-bottom:6px}.search-input[_ngcontent-%COMP%]{min-width:300px}@media screen and (max-width:768px){.search-input[_ngcontent-%COMP%]{min-width:100px}}.search-settings-menu[_ngcontent-%COMP%]{margin:0 12px}td.disabled[_ngcontent-%COMP%]{background-color:#f2f3f5}"]}),Zc.ctorParameters=function(){return[{type:i.K},{type:i.xb},{type:i.yb},{type:i.qb},{type:r.e},{type:r.a}]},Object(c.c)([Object(a.fb)("productSearchInputComponent",{static:!0}),Object(c.f)("design:type",$c)],Zc.prototype,"productSearchInput",void 0),Zc=Object(c.c)([Object(c.f)("design:paramtypes",[i.K,i.xb,i.yb,i.qb,r.e,r.a])],Zc);var Nc=function(){function e(t,n,c,a,r){_classCallCheck(this,e),this.route=t,this.dataService=n,this.productDetailService=c,this.notificationService=a,this.modalService=r,this.formValueChanged=!1,this.variants=[],this.variantFormValues={}}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.initOptionsAndVariants(),this.languageCode=this.route.snapshot.paramMap.get("lang")||Object(i.Wb)(),this.dataService.settings.getActiveChannel().single$.subscribe((function(t){e.currencyCode=t.activeChannel.currencyCode}))}},{key:"onFormChanged",value:function(e){this.formValueChanged=!0,e.enabled=!0}},{key:"canDeactivate",value:function(){return!this.formValueChanged}},{key:"getVariantsToAdd",value:function(){return Object.values(this.variantFormValues).filter((function(e){return!e.existing&&e.enabled}))}},{key:"getVariantName",value:function(e){return 0===e.options.length?Object(o.a)("catalog.default-variant"):e.options.map((function(e){return e.name})).join(" ")}},{key:"addOption",value:function(){this.optionGroups.push({isNew:!0,name:"",values:[]})}},{key:"generateVariants",value:function(){var e=this,t=this.optionGroups.map((function(e){return e.values})),n=this.variants;this.variants=t.length?Object(K.generateAllCombinations)(t).map((function(t,n){return{isDefault:1===e.product.variants.length&&0===n,id:t.map((function(e){return e.name})).join("|"),options:t}})):[{isDefault:!0,id:"__DEFAULT_VARIANT__",options:[]}],this.variants.forEach((function(t){if(!e.variantFormValues[t.id]){var c=e.getVariantPrototype(t,n);e.variantFormValues[t.id]={enabled:!1,existing:!1,options:t.options.map((function(e){return e.name})),price:c.price,sku:c.sku,stock:c.stock}}}))}},{key:"getVariantPrototype",value:function(e,t){if(e.isDefault)return this.variantFormValues.__DEFAULT_VARIANT__;var n=t.filter((function(t){return e.options.map((function(e){return e.name})).filter((function(e){return t.options.map((function(e){return e.name})).includes(e)}))}));return n.length?this.variantFormValues[n[0].options.map((function(e){return e.name})).join("|")]:{sku:"",price:0,stock:0}}},{key:"deleteVariant",value:function(e){var t=this;this.modalService.dialog({title:Object(o.a)("catalog.confirm-delete-product-variant"),buttons:[{type:"secondary",label:Object(o.a)("common.cancel")},{type:"danger",label:Object(o.a)("common.delete"),returnValue:!0}]}).pipe(Object(p.a)((function(n){return n?t.productDetailService.deleteProductVariant(e,t.product.id):z.a})),Object(p.a)((function(){return t.reFetchProduct(null)}))).subscribe((function(){t.notificationService.success(Object(o.a)("common.notify-delete-success"),{entity:"ProductVariant"}),t.initOptionsAndVariants()}),(function(e){t.notificationService.error(Object(o.a)("common.notify-delete-error"),{entity:"ProductVariant"})}))}},{key:"save",value:function(){var e=this,t=this.optionGroups.filter((function(e){return e.isNew})).map((function(e){return{name:e.name,values:[]}}));this.confirmDeletionOfDefault().pipe(Object(h.a)((function(){return e.productDetailService.createProductOptionGroups(t,e.languageCode)})),Object(h.a)((function(t){return e.addOptionGroupsToProduct(t)})),Object(h.a)((function(t){return e.addNewOptionsToGroups(t)})),Object(h.a)((function(t){return e.fetchOptionGroups(t)})),Object(h.a)((function(t){return e.createNewProductVariants(t)})),Object(h.a)((function(t){return e.deleteDefaultVariant(t.createProductVariants)})),Object(h.a)((function(t){return e.reFetchProduct(t)}))).subscribe({next:function(t){e.formValueChanged=!1,e.notificationService.success(Object(o.a)("catalog.created-new-variants-success"),{count:t.length}),e.initOptionsAndVariants()}})}},{key:"confirmDeletionOfDefault",value:function(){return 1===this.product.variants.length?this.modalService.dialog({title:Object(o.a)("catalog.confirm-adding-options-delete-default-title"),body:Object(o.a)("catalog.confirm-adding-options-delete-default-body"),buttons:[{type:"secondary",label:Object(o.a)("common.cancel")},{type:"danger",label:Object(o.a)("catalog.delete-default-variant"),returnValue:!0}]}).pipe(Object(h.a)((function(e){return!0===e?Object($.a)(!0):z.a}))):Object($.a)(!0)}},{key:"addOptionGroupsToProduct",value:function(e){var t=this;return e.length?Object(Z.a)(e.map((function(e){return t.dataService.product.addOptionGroupToProduct({productId:t.product.id,optionGroupId:e.id})}))).pipe(Object(s.a)((function(){return e}))):Object($.a)([])}},{key:"addNewOptionsToGroups",value:function(e){var t=this,n=this.optionGroups.map((function(n){var c=e.find((function(e){return e.name===n.name})),a=c?c.id:n.id;if(!a)throw new Error("Could not get a productOptionGroupId");return n.values.filter((function(e){return!e.locked})).map((function(e){return{productOptionGroupId:a,code:Object(U.normalizeString)(e.name,"-"),translations:[{name:e.name,languageCode:t.languageCode}]}}))})).reduce((function(e,t){return[].concat(_toConsumableArray(e),_toConsumableArray(t))}),[]),c=[].concat(_toConsumableArray(e.map((function(e){return e.id}))),_toConsumableArray(this.optionGroups.map((function(e){return e.id})).filter(K.notNullOrUndefined)));return n.length?Object(Z.a)(n.map((function(e){return t.dataService.product.addOptionToGroup(e)}))).pipe(Object(s.a)((function(){return c}))):Object($.a)(c)}},{key:"fetchOptionGroups",value:function(e){var t=this;return Object(Z.a)(e.map((function(e){return t.dataService.product.getProductOptionGroup(e).mapSingle((function(e){return e.productOptionGroup})).pipe(Object(E.a)(K.notNullOrUndefined))})))}},{key:"createNewProductVariants",value:function(e){var t=e.filter(K.notNullOrUndefined).map((function(e){return e.options})).reduce((function(e,t){return[].concat(_toConsumableArray(e),_toConsumableArray(t))}),[]),n=Object.values(this.variantFormValues).filter((function(e){return e.enabled&&!e.existing})).map((function(e){return{price:e.price,sku:e.sku,stock:e.stock,optionIds:e.options.map((function(e){return t.find((function(t){return t.name===e}))})).filter(K.notNullOrUndefined).map((function(e){return e.id}))}}));return this.productDetailService.createProductVariants(this.product,n,t,this.languageCode)}},{key:"deleteDefaultVariant",value:function(e){return 1===this.product.variants.length?this.dataService.product.deleteProductVariant(this.product.variants[0].id).pipe(Object(s.a)((function(){return e}))):Object($.a)(e)}},{key:"reFetchProduct",value:function(e){var t=this.route.snapshot.paramMap.get("id");return t?this.dataService.product.getProduct(t).single$.pipe(Object(s.a)((function(){return e}))):Object($.a)(e)}},{key:"initOptionsAndVariants",value:function(){var e=this;this.route.data.pipe(Object(p.a)((function(e){return e.entity})),Object(v.a)(1)).subscribe((function(t){e.product=t,e.optionGroups=t.optionGroups.map((function(e){return{id:e.id,isNew:!1,name:e.name,values:e.options.map((function(e){return{id:e.id,name:e.name,locked:!0}}))}})),e.variantFormValues=e.getExistingVariants(t.variants),e.generateVariants()}))}},{key:"getExistingVariants",value:function(e){return e.reduce((function(e,t){var n=t.options.length?t.options.map((function(e){return e.name})).join("|"):"__DEFAULT_VARIANT__";return Object.assign(Object.assign({},e),_defineProperty({},n,{productVariantId:t.id,enabled:!0,existing:!0,options:t.options.map((function(e){return e.name})),sku:t.sku,price:t.price,stock:t.stockOnHand}))}),{})}}]),e}();Nc.\u0275fac=function(e){return new(e||Nc)(a.hc(r.a),a.hc(i.K),a.hc(Ec),a.hc(i.yb),a.hc(i.xb))},Nc.\u0275cmp=a.bc({type:Nc,selectors:[["vdr-product-variants-editor"]],decls:28,vars:25,consts:[[1,"btn","btn-primary",3,"disabled","click"],["class","option-groups",4,"ngFor","ngForOf"],["class","btn btn-primary-outline btn-sm",3,"click",4,"ngIf"],[1,"variants-preview"],[1,"table"],[3,"disabled",4,"ngFor","ngForOf"],[1,"option-groups"],[1,"name"],["clrInput","","name","name",3,"ngModel","readonly","ngModelChange"],[1,"values"],[3,"ngModel","groupName","disabled","ngModelChange"],["optionValueInputComponent",""],[1,"btn","btn-primary-outline","btn-sm",3,"click"],["shape","plus"],["type","checkbox","name","enabled","clrCheckbox","",3,"ngModel","ngModelChange",4,"ngIf"],[4,"ngIf"],["type","checkbox","name","enabled","clrCheckbox","",3,"ngModel","ngModelChange"],["clrInput","","type","text","name","sku","required","",3,"ngModel","placeholder","ngModelChange"],["clrInput","","name","price",3,"ngModel","currencyCode","ngModelChange"],["clrInput","","type","number","name","stock","min","0","step","1",3,"ngModel","ngModelChange"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"click"],["shape","trash",1,"is-danger"]],template:function(e,t){1&e&&(a.nc(0,"vdr-action-bar"),a.nc(1,"vdr-ab-right"),a.nc(2,"button",0),a.vc("click",(function(){return t.save()})),a.bd(3),a.yc(4,"translate"),a.mc(),a.mc(),a.mc(),a.Zc(5,Wt,12,11,"div",1),a.Zc(6,Qt,4,3,"button",2),a.nc(7,"div",3),a.nc(8,"table",4),a.nc(9,"thead"),a.nc(10,"tr"),a.nc(11,"th"),a.bd(12),a.yc(13,"translate"),a.mc(),a.nc(14,"th"),a.bd(15),a.yc(16,"translate"),a.mc(),a.nc(17,"th"),a.bd(18),a.yc(19,"translate"),a.mc(),a.nc(20,"th"),a.bd(21),a.yc(22,"translate"),a.mc(),a.nc(23,"th"),a.bd(24),a.yc(25,"translate"),a.mc(),a.ic(26,"th"),a.mc(),a.mc(),a.Zc(27,sn,16,11,"tr",5),a.mc(),a.mc()),2&e&&(a.Vb(2),a.Ec("disabled",!t.formValueChanged||0===t.getVariantsToAdd().length),a.Vb(1),a.dd(" ",a.Ac(4,10,"common.add-new-variants",a.Jc(23,Ce,t.getVariantsToAdd().length))," "),a.Vb(2),a.Ec("ngForOf",t.optionGroups),a.Vb(1),a.Ec("ngIf",1===t.product.variants.length),a.Vb(6),a.cd(a.zc(13,13,"common.create")),a.Vb(3),a.cd(a.zc(16,15,"catalog.variant")),a.Vb(3),a.cd(a.zc(19,17,"catalog.sku")),a.Vb(3),a.cd(a.zc(22,19,"catalog.price")),a.Vb(3),a.cd(a.zc(25,21,"catalog.stock-on-hand")),a.Vb(3),a.Ec("ngForOf",t.variants))},directives:function(){return[i.c,i.f,B.o,B.p,X.t,i.db,w.b,X.r,w.p,w.s,pa,X.o,w.a,X.i,X.s,w.z,i.F,w.v,i.S,i.V,i.U,i.T]},pipes:function(){return[W.d,B.d]},styles:[".option-groups[_ngcontent-%COMP%]{display:flex}.option-groups[_ngcontent-%COMP%]:first-of-type{margin-top:24px}.values[_ngcontent-%COMP%]{flex:1;margin:0 6px}.variants-preview[_ngcontent-%COMP%]   tr.disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#fafafa;color:#97979a}"]}),Nc.ctorParameters=function(){return[{type:r.a},{type:i.K},{type:Ec},{type:i.yb},{type:i.xb}]},Nc=Object(c.c)([Object(c.f)("design:paramtypes",[r.a,i.K,Ec,i.yb,i.xb])],Nc);var Lc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,c){return _classCallCheck(this,n),t.call(this,e,{__typename:"Asset",id:"",createdAt:"",updatedAt:"",name:"",type:i.r.IMAGE,fileSize:0,mimeType:"",width:0,height:0,source:"",preview:"",focalPoint:null},(function(e){return c.product.getAsset(e).mapStream((function(e){return e.asset}))}))}return n}(i.v);Lc.\u0275fac=function(e){return new(e||Lc)(a.rc(r.e),a.rc(i.K))},Lc.ctorParameters=function(){return[{type:r.e},{type:i.K}]},Lc.\u0275prov=Object(a.dc)({factory:function(){return new Lc(Object(a.rc)(r.e),Object(a.rc)(i.K))},token:Lc,providedIn:"root"}),Lc=Object(c.c)([Object(c.f)("design:paramtypes",[r.e,i.K])],Lc);var Gc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,c){return _classCallCheck(this,n),t.call(this,e,{__typename:"Collection",id:"",createdAt:"",updatedAt:"",languageCode:Object(i.Wb)(),name:"",slug:"",isPrivate:!1,description:"",featuredAsset:null,assets:[],translations:[],filters:[],parent:{},children:null},(function(e){return c.collection.getCollection(e).mapStream((function(e){return e.collection}))}))}return n}(i.v);Gc.\u0275fac=function(e){return new(e||Gc)(a.rc(r.e),a.rc(i.K))},Gc.ctorParameters=function(){return[{type:r.e},{type:i.K}]},Gc.\u0275prov=Object(a.dc)({factory:function(){return new Gc(Object(a.rc)(r.e),Object(a.rc)(i.K))},token:Gc,providedIn:"root"}),Gc=Object(c.c)([Object(c.f)("design:paramtypes",[r.e,i.K])],Gc);var Uc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,c){return _classCallCheck(this,n),t.call(this,e,{__typename:"Facet",id:"",createdAt:"",updatedAt:"",isPrivate:!1,languageCode:Object(i.Wb)(),name:"",code:"",translations:[],values:[]},(function(e){return c.facet.getFacet(e).mapStream((function(e){return e.facet}))}))}return n}(i.v);Uc.\u0275fac=function(e){return new(e||Uc)(a.rc(r.e),a.rc(i.K))},Uc.ctorParameters=function(){return[{type:r.e},{type:i.K}]},Uc.\u0275prov=Object(a.dc)({factory:function(){return new Uc(Object(a.rc)(r.e),Object(a.rc)(i.K))},token:Uc,providedIn:"root"}),Uc=Object(c.c)([Object(c.f)("design:paramtypes",[r.e,i.K])],Uc);var Kc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,c){return _classCallCheck(this,n),t.call(this,c,{__typename:"Product",id:"",createdAt:"",updatedAt:"",enabled:!0,languageCode:Object(i.Wb)(),name:"",slug:"",featuredAsset:null,assets:[],description:"",translations:[],optionGroups:[],facetValues:[],variants:[],channels:[]},(function(t){return e.product.getProduct(t).refetchOnChannelChange().mapStream((function(e){return e.product}))}))}return n}(i.v);Kc.\u0275fac=function(e){return new(e||Kc)(a.rc(i.K),a.rc(r.e))},Kc.ctorParameters=function(){return[{type:i.K},{type:r.e}]},Kc.\u0275prov=Object(a.dc)({factory:function(){return new Kc(Object(a.rc)(i.K),Object(a.rc)(r.e))},token:Kc,providedIn:"root"}),Kc=Object(c.c)([Object(c.f)("design:paramtypes",[i.K,r.e])],Kc);var Bc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,c){return _classCallCheck(this,n),t.call(this,e,{__typename:"Product",id:"",createdAt:"",updatedAt:"",name:"",optionGroups:[],variants:[]},(function(e){return c.product.getProductVariantsOptions(e).mapStream((function(e){return e.product}))}))}return n}(i.v);Bc.\u0275fac=function(e){return new(e||Bc)(a.rc(r.e),a.rc(i.K))},Bc.ctorParameters=function(){return[{type:r.e},{type:i.K}]},Bc.\u0275prov=Object(a.dc)({factory:function(){return new Bc(Object(a.rc)(r.e),Object(a.rc)(i.K))},token:Bc,providedIn:"root"}),Bc=Object(c.c)([Object(c.f)("design:paramtypes",[r.e,i.K])],Bc);var Rc={breadcrumb:Object(o.a)("breadcrumb.products")},qc={breadcrumb:na},Yc={breadcrumb:ca},Hc={breadcrumb:Object(o.a)("breadcrumb.facets")},Jc={breadcrumb:aa},Wc={breadcrumb:Object(o.a)("breadcrumb.collections")},Qc={breadcrumb:ra},Xc={breadcrumb:Object(o.a)("breadcrumb.assets")},ea={breadcrumb:ia},ta=[{path:"products",component:Zc,data:Rc},{path:"products/:id",component:Mc,resolve:Object(i.Rb)(Kc),canDeactivate:[i.x],data:qc},{path:"products/:id/manage-variants",component:Nc,resolve:Object(i.Rb)(Bc),canDeactivate:[i.x],data:Yc},{path:"facets",component:Sc,data:Hc},{path:"facets/:id",component:_c,resolve:Object(i.Rb)(Uc),canDeactivate:[i.x],data:Jc},{path:"collections",component:jc,data:Wc},{path:"collections/:id",component:Ic,resolve:Object(i.Rb)(Gc),canDeactivate:[i.x],data:Qc},{path:"assets",component:Pc,data:Xc},{path:"assets/:id",component:xc,resolve:Object(i.Rb)(Lc),data:ea}];function na(e,t){return Object(i.Tb)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.products",getName:function(e){return e.name},route:"products"})}function ca(e,t){return e.entity.pipe(Object(s.a)((function(e){return[{label:Object(o.a)("breadcrumb.products"),link:["../","products"]},{label:"".concat(e.name),link:["../","products",t.id,{tab:"variants"}]},{label:Object(o.a)("breadcrumb.manage-variants"),link:["manage-variants"]}]})))}function aa(e,t){return Object(i.Tb)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.facets",getName:function(e){return e.name},route:"facets"})}function ra(e,t){return Object(i.Tb)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.collections",getName:function(e){return e.name},route:"collections"})}function ia(e,t){return Object(i.Tb)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.assets",getName:function(e){return e.name},route:"assets"})}function oa(e){var t,n=[],c={},a=_createForOfIteratorHelper(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;c[r.id]=Object.assign(Object.assign({},r),{children:[]})}}catch(d){a.e(d)}finally{a.f()}var i,o=_createForOfIteratorHelper(e.map((function(e){return e.id})));try{for(o.s();!(i=o.n()).done;){var s=i.value;if(c.hasOwnProperty(s)){var l=c[s];l.expanded=!1;var u=l.parent;if(!u)continue;c[u.id]?c[u.id]?c[u.id].children.push(l):c[u.id]={children:[l]}:n.push(l)}}}catch(d){o.e(d)}finally{o.f()}return{id:n.length?n[0].parent.id:void 0,children:n}}var sa=function(){function e(){_classCallCheck(this,e),this.expandAll=!1,this.rearrange=new a.u,this.deleteCollection=new a.u}return _createClass(e,[{key:"ngOnChanges",value:function(e){"collections"in e&&this.collections&&(this.collectionTree=oa(this.collections))}},{key:"onDrop",value:function(e){var t=e.item.data,n=e.container.data.id;if(null==n)throw new Error("Could not determine the ID of the root Collection");this.rearrange.emit({collectionId:t.id,parentId:n,index:e.currentIndex})}},{key:"onMove",value:function(e){this.rearrange.emit(e)}},{key:"onDelete",value:function(e){this.deleteCollection.emit(e)}},{key:"isRootNode",value:function(e){return!e.hasOwnProperty("parent")}}]),e}();sa.\u0275fac=function(e){return new(e||sa)},sa.\u0275cmp=a.bc({type:sa,selectors:[["vdr-collection-tree"]],inputs:{expandAll:"expandAll",collections:"collections",activeCollectionId:"activeCollectionId"},outputs:{rearrange:"rearrange",deleteCollection:"deleteCollection"},features:[a.Tb],decls:1,vars:1,consts:[["cdkDropListGroup","",3,"expandAll","collectionTree","activeCollectionId",4,"ngIf"],["cdkDropListGroup","",3,"expandAll","collectionTree","activeCollectionId"]],template:function(e,t){1&e&&a.Zc(0,ln,1,3,"vdr-collection-tree-node",0),2&e&&a.Ec("ngIf",t.collectionTree)},directives:function(){return[B.p,la,H.d]},styles:[""],changeDetection:0}),Object(c.c)([Object(a.D)(),Object(c.f)("design:type",Array)],sa.prototype,"collections",void 0),Object(c.c)([Object(a.D)(),Object(c.f)("design:type",String)],sa.prototype,"activeCollectionId",void 0),Object(c.c)([Object(a.D)(),Object(c.f)("design:type",Object)],sa.prototype,"expandAll",void 0),Object(c.c)([Object(a.O)(),Object(c.f)("design:type",Object)],sa.prototype,"rearrange",void 0),Object(c.c)([Object(a.O)(),Object(c.f)("design:type",Object)],sa.prototype,"deleteCollection",void 0);var la=function(){function e(t,n,c){_classCallCheck(this,e),this.parent=t,this.root=n,this.dataService=c,this.depth=0,this.expandAll=!1,t&&(this.depth=t.depth+1)}return _createClass(e,[{key:"ngOnInit",value:function(){this.parentName=this.collectionTree.name||"<root>";var e=this.dataService.client.userStatus().mapStream((function(e){return e.userStatus.permissions})).pipe(Object(g.a)(1));this.hasUpdatePermission$=e.pipe(Object(s.a)((function(e){return e.includes(i.Db.UpdateCatalog)}))),this.hasDeletePermission$=e.pipe(Object(s.a)((function(e){return e.includes(i.Db.DeleteCatalog)})))}},{key:"trackByFn",value:function(e,t){return t.id}},{key:"getMoveListItems",value:function(e){return function t(n,c,a){if(n.id!==e.id){var r=c.concat(n.name),i=e.parent&&e.parent.id;n.id!==i&&a.push({path:r.slice(1).join(" / ")||"root",id:n.id}),n.children.forEach((function(e){return t(e,r,a)}))}return a}(this.root.collectionTree,[],[])}},{key:"move",value:function(e,t){this.root.onMove({index:0,parentId:t,collectionId:e.id})}},{key:"moveUp",value:function(e,t){e.parent&&this.root.onMove({index:t-1,parentId:e.parent.id,collectionId:e.id})}},{key:"moveDown",value:function(e,t){e.parent&&this.root.onMove({index:t+1,parentId:e.parent.id,collectionId:e.id})}},{key:"drop",value:function(e){Object(H.f)(this.collectionTree.children,e.previousIndex,e.currentIndex),this.root.onDrop(e)}},{key:"delete",value:function(e){this.root.onDelete(e)}}]),e}();la.\u0275fac=function(e){return new(e||la)(a.hc(la,12),a.hc(sa),a.hc(i.K))},la.\u0275cmp=a.bc({type:la,selectors:[["vdr-collection-tree-node"]],inputs:{expandAll:"expandAll",collectionTree:"collectionTree",activeCollectionId:"activeCollectionId"},decls:4,vars:6,consts:[["cdkDropList","",1,"tree-node",3,"cdkDropListData","cdkDropListDisabled","cdkDropListDropped"],["dropList",""],["class","collection","cdkDrag","",3,"private","cdkDragData",4,"ngFor","ngForOf","ngForTrackBy"],["cdkDrag","",1,"collection",3,"cdkDragData"],[1,"collection-detail",3,"ngClass"],[1,"name"],["class","icon-button folder-button",3,"disabled","click",4,"ngIf","ngIfElse"],["folderSpacer",""],[1,"flex-spacer"],[4,"ngIf"],["queryParamsHandling","preserve",1,"btn","btn-link","btn-sm",3,"routerLink"],["shape","view-list"],[1,"btn","btn-link","btn-sm",3,"routerLink"],["shape","edit"],["class","drag-handle","cdkDragHandle","",4,"vdrIfPermissions"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["class","dropdown-item",3,"routerLink",4,"vdrIfPermissions"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",3,"disabled","click"],["shape","caret up"],["shape","caret down"],[1,"dropdown-header"],["type","button","vdrDropdownItem","",3,"disabled","click",4,"ngFor","ngForOf"],["vdrDropdownItem","",1,"button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"expandAll","collectionTree","activeCollectionId",4,"ngIf"],[1,"icon-button","folder-button",3,"disabled","click"],["shape","folder",4,"ngIf"],["shape","folder-open",4,"ngIf"],["shape","folder"],["shape","folder-open"],[1,"folder-button-spacer"],["cdkDragHandle","",1,"drag-handle"],["shape","drag-handle","size","24"],[1,"dropdown-item",3,"routerLink"],["shape","plus"],["shape","child-arrow"],[3,"expandAll","collectionTree","activeCollectionId"]],template:function(e,t){1&e&&(a.nc(0,"div",0,1),a.vc("cdkDropListDropped",(function(e){return t.drop(e)})),a.yc(2,"async"),a.Zc(3,kn,45,49,"div",2),a.mc()),2&e&&(a.Ec("cdkDropListData",t.collectionTree)("cdkDropListDisabled",!a.zc(2,4,t.hasUpdatePermission$)),a.Vb(3),a.Ec("ngForOf",t.collectionTree.children)("ngForTrackBy",t.trackByFn))},directives:[H.c,B.o,X.l,H.a,B.n,B.p,r.h,X.o,i.ob,i.S,i.V,i.U,i.T,i.B,H.b,la],pipes:[B.b,W.d],styles:["[_nghost-%COMP%]{display:block}.collection[_ngcontent-%COMP%]{background-color:#fff;font-size:.65rem;color:rgba(0,0,0,.87);transition:border-left-color .2s;margin-bottom:2px;border-left:2px solid transparent}.collection.private[_ngcontent-%COMP%]{background-color:#f2f3f5}.collection[_ngcontent-%COMP%]   .collection-detail[_ngcontent-%COMP%]{padding:6px 12px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #f2f3f5}.collection[_ngcontent-%COMP%]   .collection-detail.active[_ngcontent-%COMP%]{background-color:#f2f3f5}.collection[_ngcontent-%COMP%]   .collection-detail.depth-1[_ngcontent-%COMP%]{padding-left:36px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-2[_ngcontent-%COMP%]{padding-left:60px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-3[_ngcontent-%COMP%]{padding-left:84px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-4[_ngcontent-%COMP%]{padding-left:108px}.collection[_ngcontent-%COMP%]   .collection-detail[_ngcontent-%COMP%]   .folder-button-spacer[_ngcontent-%COMP%]{display:inline-block;width:28px}.tree-node[_ngcontent-%COMP%]{display:block;background:#fff;overflow:hidden}.tree-node.cdk-drop-list-dragging[_ngcontent-%COMP%] > .collection[_ngcontent-%COMP%]{border-left-color:#9adbf3}.drag-placeholder[_ngcontent-%COMP%]{min-height:120px;background-color:#bfc3cc;transition:transform 250ms cubic-bezier(0,0,.2,1)}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%], .example-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .tree-node[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform 250ms cubic-bezier(0,0,.2,1)}"],changeDetection:0}),la.ctorParameters=function(){return[{type:la,decorators:[{type:a.Z},{type:a.N}]},{type:sa},{type:i.K}]},Object(c.c)([Object(a.D)(),Object(c.f)("design:type",Object)],la.prototype,"collectionTree",void 0),Object(c.c)([Object(a.D)(),Object(c.f)("design:type",String)],la.prototype,"activeCollectionId",void 0),Object(c.c)([Object(a.D)(),Object(c.f)("design:type",Object)],la.prototype,"expandAll",void 0),la=Object(c.c)([Object(c.g)(0,Object(a.Z)()),Object(c.g)(0,Object(a.N)()),Object(c.f)("design:paramtypes",[la,sa,i.K])],la);var ua=function(){function e(t){_classCallCheck(this,e),this.dataService=t,this.variantsChange=new a.u,this.optionGroups=[],this.variantFormValues={}}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.dataService.settings.getActiveChannel().single$.subscribe((function(t){e.currencyCode=t.activeChannel.currencyCode})),this.generateVariants()}},{key:"addOption",value:function(){this.optionGroups.push({name:"",values:[]})}},{key:"removeOption",value:function(e){this.optionGroups=this.optionGroups.filter((function(t){return t.name!==e})),this.generateVariants()}},{key:"generateVariants",value:function(){var e=this,t=this.optionGroups.reduce((function(e,t){return e+t.values.length}),0)?this.optionGroups.map((function(e){return e.values.map((function(e){return e.name}))})):[["__DEFAULT_VARIANT__"]];this.variants=Object(K.generateAllCombinations)(t).map((function(e){return{id:e.join("|"),values:e}})),this.variants.forEach((function(t){e.variantFormValues[t.id]||(e.variantFormValues[t.id]={optionValues:t.values,enabled:!0,price:e.copyFromDefault(t.id,"price",0),sku:e.copyFromDefault(t.id,"sku",""),stock:e.copyFromDefault(t.id,"stock",0)})})),this.onFormChange()}},{key:"trackByFn",value:function(e,t){return t.values.join("|")}},{key:"handleEnter",value:function(e,t){e.preventDefault(),e.stopPropagation(),t.focus()}},{key:"onFormChange",value:function(){var e=this,t=this.variants.map((function(t){return e.variantFormValues[t.id]})).filter((function(e){return e.enabled}));this.variantsChange.emit({groups:this.optionGroups.map((function(e){return{name:e.name,values:e.values.map((function(e){return e.name}))}})),variants:t})}},{key:"copyFromDefault",value:function(e,t,n){return"__DEFAULT_VARIANT__"!==e?this.variantFormValues.__DEFAULT_VARIANT__[t]:n}}]),e}();ua.\u0275fac=function(e){return new(e||ua)(a.hc(i.K))},ua.\u0275cmp=a.bc({type:ua,selectors:[["vdr-generate-product-variants"]],outputs:{variantsChange:"variantsChange"},decls:21,vars:17,consts:[["class","option-groups",4,"ngFor","ngForOf"],[1,"btn","btn-primary-outline","btn-sm",3,"click"],["shape","plus"],[1,"variants-preview"],[1,"table"],[4,"ngIf"],[3,"disabled",4,"ngFor","ngForOf","ngForTrackBy"],[1,"option-groups"],[1,"name"],["placeholder","e.g. Size","clrInput","","name","name","required","",3,"ngModel","ngModelChange","keydown.enter"],[1,"values"],[3,"ngModel","groupName","disabled","ngModelChange"],["optionValueInputComponent",""],[1,"remove-group"],[1,"btn","btn-icon","btn-warning-outline",3,"title","click"],["shape","trash"],["clrInput","","type","text",3,"ngModel","placeholder","change","ngModelChange"],["clrInput","",3,"ngModel","currencyCode","ngModelChange"],["clrInput","","type","number","min","0","step","1",3,"ngModel","ngModelChange","change"],["type","checkbox","clrCheckbox","",3,"ngModel","change","ngModelChange"]],template:function(e,t){1&e&&(a.Zc(0,xn,16,13,"div",0),a.nc(1,"button",1),a.vc("click",(function(){return t.addOption()})),a.ic(2,"clr-icon",2),a.bd(3),a.yc(4,"translate"),a.mc(),a.nc(5,"div",3),a.nc(6,"table",4),a.nc(7,"thead"),a.nc(8,"tr"),a.Zc(9,Pn,3,3,"th",5),a.Zc(10,Fn,3,3,"th",5),a.nc(11,"th"),a.bd(12),a.yc(13,"translate"),a.mc(),a.nc(14,"th"),a.bd(15),a.yc(16,"translate"),a.mc(),a.nc(17,"th"),a.bd(18),a.yc(19,"translate"),a.mc(),a.mc(),a.mc(),a.Zc(20,_n,13,11,"tr",6),a.mc(),a.mc()),2&e&&(a.Ec("ngForOf",t.optionGroups),a.Vb(3),a.dd(" ",a.zc(4,9,"catalog.add-option"),"\n"),a.Vb(6),a.Ec("ngIf",1<t.variants.length),a.Vb(1),a.Ec("ngIf",1<t.variants.length),a.Vb(2),a.cd(a.zc(13,11,"catalog.sku")),a.Vb(3),a.cd(a.zc(16,13,"catalog.price")),a.Vb(3),a.cd(a.zc(19,15,"catalog.stock-on-hand")),a.Vb(2),a.Ec("ngForOf",t.variants)("ngForTrackBy",t.trackByFn))},directives:function(){return[B.o,X.o,B.p,X.l,X.t,i.db,w.b,X.r,w.z,w.p,w.s,pa,X.s,i.F,w.v,w.a,X.i]},pipes:function(){return[W.d]},styles:["[_nghost-%COMP%]{display:block;margin-bottom:120px}.option-groups[_ngcontent-%COMP%]{display:flex}.values[_ngcontent-%COMP%]{flex:1;margin:0 6px}.remove-group[_ngcontent-%COMP%]{padding-top:18px}.variants-preview[_ngcontent-%COMP%]   tr.disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#fafafa;color:#97979a}"]}),ua.ctorParameters=function(){return[{type:i.K}]},Object(c.c)([Object(a.O)(),Object(c.f)("design:type",Object)],ua.prototype,"variantsChange",void 0),ua=Object(c.c)([Object(c.f)("design:paramtypes",[i.K])],ua);var da={provide:w.n,useExisting:Object(a.mb)((function(){return pa})),multi:!0},pa=function(){function e(t){_classCallCheck(this,e),this.changeDetector=t,this.groupName="",this.disabled=!1,this.input="",this.isFocussed=!1,this.lastSelected=!1}return _createClass(e,[{key:"registerOnChange",value:function(e){this.onChangeFn=e}},{key:"registerOnTouched",value:function(e){this.onTouchFn=e}},{key:"setDisabledState",value:function(e){this.disabled=e,this.changeDetector.markForCheck()}},{key:"writeValue",value:function(e){this.options=e||[]}},{key:"focus",value:function(){this.textArea.nativeElement.focus()}},{key:"removeOption",value:function(e){e.locked||(this.options=this.options.filter((function(t){return t.name!==e.name})),this.onChangeFn(this.options))}},{key:"handleKey",value:function(e){switch(e.key){case",":case"Enter":this.addOptionValue(),e.preventDefault();break;case"Backspace":this.lastSelected?(this.removeLastOption(),this.lastSelected=!1):""===this.input&&(this.lastSelected=!0);break;default:this.lastSelected=!1}}},{key:"handleBlur",value:function(){this.isFocussed=!1,this.addOptionValue()}},{key:"addOptionValue",value:function(){this.options=Object(q.unique)([].concat(_toConsumableArray(this.options),_toConsumableArray(this.parseInputIntoOptions(this.input)))),this.input="",this.onChangeFn(this.options)}},{key:"parseInputIntoOptions",value:function(e){return e.split(/[,\n]/).map((function(e){return e.trim()})).filter((function(e){return""!==e})).map((function(e){return{name:e,locked:!1}}))}},{key:"removeLastOption",value:function(){this.options[this.options.length-1].locked||(this.options=this.options.slice(0,this.options.length-1))}}]),e}();pa.\u0275fac=function(e){return new(e||pa)(a.hc(a.k))},pa.\u0275cmp=a.bc({type:pa,selectors:[["vdr-option-value-input"]],viewQuery:function(e,t){var n;1&e&&a.Xc(Sn,!0),2&e&&a.Oc(n=a.wc())&&(t.textArea=n.first)},inputs:{groupName:"groupName"},features:[a.Ub([da])],decls:4,vars:5,consts:[[1,"input-wrapper",3,"click"],["class","chips",4,"ngIf"],[3,"ngModel","disabled","keyup","focus","blur","ngModelChange"],["textArea",""],[1,"chips"],[3,"icon","selected","locked","colorFrom","iconClick",4,"ngFor","ngForOf"],[3,"icon","colorFrom","iconClick"]],template:function(e,t){if(1&e){var n=a.oc();a.nc(0,"div",0),a.vc("click",(function(){return a.Sc(n),a.Pc(3).focus()})),a.Zc(1,wn,2,1,"div",1),a.nc(2,"textarea",2,3),a.vc("keyup",(function(e){return t.handleKey(e)}))("focus",(function(){return t.isFocussed=!0}))("blur",(function(){return t.handleBlur()}))("ngModelChange",(function(e){return t.input=e})),a.mc(),a.mc()}2&e&&(a.Yb("focus",t.isFocussed),a.Vb(1),a.Ec("ngIf",0<t.options.length),a.Vb(1),a.Ec("ngModel",t.input)("disabled",t.disabled))},directives:[B.p,i.db,w.b,w.p,w.s,B.o,i.B],styles:[".input-wrapper[_ngcontent-%COMP%]{background-color:#fff;border-radius:3px!important;border:1px solid #bfc3cc!important;cursor:text}.input-wrapper.focus[_ngcontent-%COMP%]{border-color:#13b7f3!important;box-shadow:0 0 1px 1px #e3f6fc}.input-wrapper[_ngcontent-%COMP%]   .chips[_ngcontent-%COMP%]{padding:5px}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border:none;width:100%;height:24px;margin-top:3px;padding:0 6px}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:0}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:disabled{background-color:#fafafa}vdr-chip[_ngcontent-%COMP%]     .wrapper{margin:0 3px}vdr-chip.locked[_ngcontent-%COMP%]{opacity:.8}vdr-chip.selected[_ngcontent-%COMP%]     .wrapper{border-color:#ff9f07!important;box-shadow:0 0 1px 1px #ffb74d;opacity:.6}"]}),pa.ctorParameters=function(){return[{type:a.k}]},Object(c.c)([Object(a.D)(),Object(c.f)("design:type",Object)],pa.prototype,"groupName",void 0),Object(c.c)([Object(a.fb)("textArea",{static:!0}),Object(c.f)("design:type",a.s)],pa.prototype,"textArea",void 0),pa=Object(c.c)([Object(c.f)("design:paramtypes",[a.k])],pa);var fa=function(){function e(t,n,c){var r=this;_classCallCheck(this,e),this.modalService=t,this.changeDetector=n,this.viewportRuler=c,this.assets=[],this.compact=!1,this.change=new a.u,this.dropListEnterPredicate=function(e,t){if(t===r.placeholder)return!0;if(t!==r.activeContainer)return!1;var n=r.placeholder.element.nativeElement,c=e.dropContainer.element.nativeElement,a=t.element.nativeElement,i=a.parentElement&&a.parentElement.children,o=ma(i,r.source?n:c),s=ma(i,a);return r.source||(r.sourceIndex=o,r.source=e.dropContainer,n.style.width=c.clientWidth+"px",n.style.height=c.clientHeight+"px",c.parentElement&&c.parentElement.removeChild(c)),r.targetIndex=s,r.target=t,n.style.display="",a.parentElement&&a.parentElement.insertBefore(n,s>o?a.nextSibling:a),r.placeholder.enter(e,e.element.nativeElement.offsetLeft,e.element.nativeElement.offsetTop),!1}}return _createClass(e,[{key:"ngAfterViewInit",value:function(){var e=this.placeholder.element.nativeElement;e.style.display="none",e.parentElement&&e.parentElement.removeChild(e)}},{key:"selectAssets",value:function(){var e=this;this.modalService.fromComponent(i.n,{size:"xl"}).subscribe((function(t){t&&t.length&&(e.assets=Object(q.unique)(e.assets.concat(t),"id"),e.featuredAsset||(e.featuredAsset=t[0]),e.emitChangeEvent(e.assets,e.featuredAsset),e.changeDetector.markForCheck())}))}},{key:"setAsFeatured",value:function(e){this.featuredAsset=e,this.emitChangeEvent(this.assets,e)}},{key:"isFeatured",value:function(e){return!!this.featuredAsset&&this.featuredAsset.id===e.id}},{key:"previewAsset",value:function(e){this.modalService.fromComponent(i.p,{size:"xl",closable:!0,locals:{asset:e}}).subscribe()}},{key:"removeAsset",value:function(e){this.assets=this.assets.filter((function(t){return t.id!==e.id})),this.featuredAsset&&this.featuredAsset.id===e.id&&(this.featuredAsset=this.assets.length>0?this.assets[0]:void 0),this.emitChangeEvent(this.assets,this.featuredAsset)}},{key:"emitChangeEvent",value:function(e,t){this.change.emit({assetIds:e.map((function(e){return e.id})),featuredAssetId:t&&t.id})}},{key:"dragMoved",value:function(e){var t=this,n=this.getPointerPositionOnPage(e.event);this.listGroup._items.forEach((function(e){(function(e,t,n){var c=e.element.nativeElement.getBoundingClientRect(),a=c.top,r=c.bottom,i=c.left,o=c.right;return n>=a&&n<=r&&t>=i&&t<=o})(e,n.x,n.y)&&(t.activeContainer=e)}))}},{key:"dropListDropped",value:function(){if(this.target&&this.source){var e=this.placeholder.element.nativeElement,t=e.parentElement;e.style.display="none",t.removeChild(e),t.appendChild(e),t.insertBefore(this.source.element.nativeElement,t.children[this.sourceIndex]),this.target=null,this.source=null,this.sourceIndex!==this.targetIndex&&(Object(H.f)(this.assets,this.sourceIndex,this.targetIndex),this.emitChangeEvent(this.assets,this.featuredAsset))}}},{key:"getPointerPositionOnPage",value:function(e){var t=function(e){return e.type.startsWith("touch")}(e)?e.touches[0]||e.changedTouches[0]:e,n=this.viewportRuler.getViewportScrollPosition();return{x:t.pageX-n.left,y:t.pageY-n.top}}}]),e}();function ma(e,t){return e?Array.prototype.indexOf.call(e,t):-1}fa.\u0275fac=function(e){return new(e||fa)(a.hc(i.xb),a.hc(a.k),a.hc(J.d))},fa.\u0275cmp=a.bc({type:fa,selectors:[["vdr-product-assets"]],viewQuery:function(e,t){var n;1&e&&(a.hd(An,!0,H.d),a.hd(Mn,!0,H.c)),2&e&&(a.Oc(n=a.wc())&&(t.listGroup=n.first),a.Oc(n=a.wc())&&(t.placeholder=n.first))},hostVars:2,hostBindings:function(e,t){2&e&&a.Yb("compact",t.compact)},inputs:{assets:"assets",compact:"compact",featuredAsset:"featuredAsset"},outputs:{change:"change"},decls:5,vars:2,consts:[["class","card",4,"ngIf","ngIfElse"],["compactView",""],["assetList",""],[1,"card"],[1,"card-img"],[1,"featured-asset"],[3,"src","click",4,"ngIf"],["class","placeholder",4,"ngIf"],[1,"card-block"],[4,"ngTemplateOutlet"],["class","card-footer",4,"vdrIfPermissions"],[3,"src","click"],[1,"placeholder"],["shape","image","size","128"],[1,"card-footer"],[1,"btn",3,"click"],["shape","attachment"],[1,"featured-asset","compact"],["class","compact-select btn btn-icon btn-sm btn-block",3,"title","click",4,"vdrIfPermissions"],["shape","image","size","150"],[1,"compact-select","btn","btn-icon","btn-sm","btn-block",3,"title","click"],["cdkDropListGroup","",1,"all-assets"],["dlg",""],["cdkDropList","",3,"cdkDropListDisabled","cdkDropListEnterPredicate","cdkDropListDropped"],["dl",""],["cdkDropList","",3,"cdkDropListDisabled","cdkDropListEnterPredicate","cdkDropListDropped",4,"ngFor","ngForOf"],["cdkDrag","",3,"cdkDragMoved"],["vdrDropdownTrigger","","tabindex","0",1,"asset-thumb",3,"title"],[3,"src"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",3,"click"],["type","button","vdrDropdownItem","",3,"disabled","click"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",1,"remove-asset",3,"disabled","click"]],template:function(e,t){if(1&e&&(a.Zc(0,Zn,8,4,"div",0),a.Zc(1,Kn,5,4,"ng-template",null,1,a.ad),a.Zc(3,Rn,6,7,"ng-template",null,2,a.ad)),2&e){var n=a.Pc(2);a.Ec("ngIf",!t.compact)("ngIfElse",n)}},directives:[B.p,B.u,i.ob,X.o,H.d,H.c,B.o,i.S,H.a,i.V,i.U,i.T],pipes:[i.q,W.d,i.gb],styles:["[_nghost-%COMP%]{width:340px;display:block}.compact[_nghost-%COMP%]{width:162px}.placeholder[_ngcontent-%COMP%]{text-align:center;color:#bfc3cc}.featured-asset[_ngcontent-%COMP%]{text-align:center;background:#f2f3f5;padding:6px;cursor:pointer}.featured-asset.compact[_ngcontent-%COMP%]{width:100%;min-height:40px;padding:6px;position:relative}.featured-asset[_ngcontent-%COMP%]   .compact-select[_ngcontent-%COMP%]{position:absolute;bottom:6px;right:6px;margin:0}.all-assets[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.all-assets[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{margin:3px;padding:0;border:2px solid #f2f3f5;cursor:pointer}.all-assets[_ngcontent-%COMP%]   .asset-thumb.featured[_ngcontent-%COMP%]{border-color:#13b7f3}.all-assets[_ngcontent-%COMP%]   .remove-asset[_ngcontent-%COMP%]{color:#ff9f07}.all-assets.compact[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{margin:1px;border-width:1px}.cdk-drag-preview[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:50px;background-color:#fafafa;opacity:.9;box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.8;width:60px;height:50px}.cdk-drag-placeholder[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{background-color:#bfc3cc;height:100%;width:54px}.cdk-drag-placeholder[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:none}.all-assets.compact[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%], .all-assets.compact[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{width:50px}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform 250ms cubic-bezier(0,0,.2,1)}.example-box[_ngcontent-%COMP%]:last-child{border:none}.all-assets.cdk-drop-list-dragging[_ngcontent-%COMP%]   vdr-dropdown[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform 250ms cubic-bezier(0,0,.2,1)}"],changeDetection:0}),fa.ctorParameters=function(){return[{type:i.xb},{type:a.k},{type:J.d}]},Object(c.c)([Object(a.D)(),Object(c.f)("design:type",Array)],fa.prototype,"assets",void 0),Object(c.c)([Object(a.D)(),Object(c.f)("design:type",Object)],fa.prototype,"featuredAsset",void 0),Object(c.c)([Object(a.w)("class.compact"),Object(a.D)(),Object(c.f)("design:type",Object)],fa.prototype,"compact",void 0),Object(c.c)([Object(a.O)(),Object(c.f)("design:type",Object)],fa.prototype,"change",void 0),Object(c.c)([Object(a.fb)("dlg",{static:!1,read:H.d}),Object(c.f)("design:type",H.d)],fa.prototype,"listGroup",void 0),Object(c.c)([Object(a.fb)("dl",{static:!1,read:H.c}),Object(c.f)("design:type",H.c)],fa.prototype,"placeholder",void 0),fa=Object(c.c)([Object(c.f)("design:paramtypes",[i.xb,a.k,J.d])],fa);var ba=function(){function e(){_classCallCheck(this,e),this.codeInputTouched=!1}return _createClass(e,[{key:"ngOnInit",value:function(){var e,t=this,n=this.productOption.translations.find((function(e){return e.languageCode===t.activeLanguage}));if(this.name=null!==(e=null==n?void 0:n.name)&&void 0!==e?e:"",this.code=this.productOption.code,this.customFieldsForm=new w.i({}),this.customFields){var c,a=n&&n.customFields||{},r=_createForOfIteratorHelper(this.customFields);try{for(r.s();!(c=r.n()).done;){var i=c.value,o=i.name,s="localeString"===i.type?a[o]:this.productOption.customFields[o];this.customFieldsForm.addControl(i.name,new w.f(s))}}catch(l){r.e(l)}finally{r.f()}}}},{key:"update",value:function(){var e=Object(i.Sb)({translatable:this.productOption,languageCode:this.activeLanguage,updatedFields:{code:this.code,name:this.name,customFields:this.customFieldsForm.value},customFieldConfig:this.customFields,defaultTranslation:{languageCode:this.activeLanguage,name:""}});this.resolveWith(e)}},{key:"cancel",value:function(){this.resolveWith()}},{key:"updateCode",value:function(e){this.codeInputTouched||this.productOption.code||(this.code=Object(U.normalizeString)(e,"-"))}}]),e}();ba.\u0275fac=function(e){return new(e||ba)},ba.\u0275cmp=a.bc({type:ba,selectors:[["vdr-update-product-option-dialog"]],decls:11,vars:9,consts:[["vdrDialogTitle",""],["for","name",3,"label"],["id","name","type","text","required","",3,"ngModel","ngModelChange","input"],["nameInput","ngModel"],["for","code",3,"label"],["id","code","type","text","required","","pattern","[a-z0-9_-]+",3,"ngModel","ngModelChange"],["codeInput","ngModel"],[4,"ngIf"],["vdrDialogButtons",""],[4,"ngFor","ngForOf"],["entityName","ProductOption",3,"customFieldsFormGroup","customField","readonly",4,"ngIf"],["entityName","ProductOption",3,"customFieldsFormGroup","customField","readonly"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(a.Zc(0,qn,2,3,"ng-template",0),a.nc(1,"vdr-form-field",1),a.yc(2,"translate"),a.nc(3,"input",2,3),a.vc("ngModelChange",(function(e){return t.name=e}))("input",(function(e){return t.updateCode(e.target.value)})),a.mc(),a.mc(),a.nc(5,"vdr-form-field",4),a.yc(6,"translate"),a.nc(7,"input",5,6),a.vc("ngModelChange",(function(e){return t.code=e})),a.mc(),a.mc(),a.Zc(9,Jn,5,4,"section",7),a.Zc(10,Wn,6,7,"ng-template",8)),2&e&&(a.Vb(1),a.Ec("label",a.zc(2,5,"catalog.option-name")),a.Vb(2),a.Ec("ngModel",t.name),a.Vb(2),a.Ec("label",a.zc(6,7,"common.code")),a.Vb(2),a.Ec("ngModel",t.code),a.Vb(2),a.Ec("ngIf",t.customFields.length))},directives:[i.Q,i.cb,i.db,w.b,w.z,w.p,w.s,w.w,B.p,i.P,X.t,B.o,i.H],pipes:[W.d,i.gb],styles:[""],changeDetection:0});var ga=function(){function e(t,n){_classCallCheck(this,e),this.changeDetector=t,this.modalService=n,this.assetChange=new a.u,this.selectionChange=new a.u,this.selectFacetValueClick=new a.u,this.updateProductOption=new a.u,this.selectedVariantIds=[]}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.formSubscription=this.formArray.valueChanges.subscribe((function(){return e.changeDetector.markForCheck()}))}},{key:"ngOnChanges",value:function(e){"facets"in e&&e.facets.currentValue&&(this.facetValues=Object(i.Ub)(this.facets))}},{key:"ngOnDestroy",value:function(){this.formSubscription&&this.formSubscription.unsubscribe()}},{key:"getTaxCategoryName",value:function(e){var t=this.formArray.at(e).get(["taxCategoryId"]);if(t&&this.taxCategories){var n=this.taxCategories.find((function(e){return e.id===t.value}));return n?n.name:""}return""}},{key:"areAllSelected",value:function(){return!!this.variants&&this.selectedVariantIds.length===this.variants.length}},{key:"onAssetChange",value:function(e,t){this.assetChange.emit(Object.assign({variantId:e},t));var n=this.variants.findIndex((function(t){return t.id===e}));this.formArray.at(n).markAsDirty()}},{key:"toggleSelectAll",value:function(){this.areAllSelected()?this.selectedVariantIds=[]:this.selectedVariantIds=this.variants.map((function(e){return e.id})),this.selectionChange.emit(this.selectedVariantIds)}},{key:"toggleSelectVariant",value:function(e){var t=this.selectedVariantIds.indexOf(e);-1<t?this.selectedVariantIds.splice(t,1):this.selectedVariantIds.push(e),this.selectionChange.emit(this.selectedVariantIds)}},{key:"optionGroupName",value:function(e){var t,n=this,c=this.optionGroups.find((function(t){return t.id===e}));if(c)return(null!==(t=null==c?void 0:c.translations.find((function(e){return e.languageCode===n.activeLanguage})))&&void 0!==t?t:c.translations[0]).name}},{key:"optionName",value:function(e){var t,n=this;return(null!==(t=e.translations.find((function(e){return e.languageCode===n.activeLanguage})))&&void 0!==t?t:e.translations[0]).name}},{key:"pendingFacetValues",value:function(e){var t=this;if(this.facets){var n=this.getFacetValueIds(e),c=this.variants[e].facetValues.map((function(e){return e.id}));return n.filter((function(e){return!c.includes(e)})).map((function(e){return t.facetValues.find((function(t){return t.id===e}))})).filter(K.notNullOrUndefined)}return[]}},{key:"existingFacetValues",value:function(e){var t=this.variants[e];return _toConsumableArray(this.getFacetValueIds(e)).filter((function(e){return t.facetValues.map((function(e){return e.id})).includes(e)})).map((function(e){return t.facetValues.find((function(t){return t.id===e}))})).filter(K.notNullOrUndefined)}},{key:"removeFacetValue",value:function(e,t){var n=this.formArray.at(e),c=n.value.facetValueIds.filter((function(e){return e!==t}));n.patchValue({facetValueIds:c}),n.markAsDirty()}},{key:"isVariantSelected",value:function(e){return-1<this.selectedVariantIds.indexOf(e)}},{key:"customFieldIsSet",value:function(e,t){return!!this.formArray.at(e).get(["customFields",t])}},{key:"editOption",value:function(e){var t=this;this.modalService.fromComponent(ba,{size:"md",locals:{productOption:e,activeLanguage:this.activeLanguage,customFields:this.customOptionFields}}).subscribe((function(e){e&&t.updateProductOption.emit(e)}))}},{key:"getFacetValueIds",value:function(e){return this.formArray.at(e).value.facetValueIds}}]),e}();ga.\u0275fac=function(e){return new(e||ga)(a.hc(a.k),a.hc(i.xb))},ga.\u0275cmp=a.bc({type:ga,selectors:[["vdr-product-variants-list"]],inputs:{formArray:["productVariantsFormArray","formArray"],variants:"variants",taxCategories:"taxCategories",facets:"facets",optionGroups:"optionGroups",customFields:"customFields",customOptionFields:"customOptionFields",activeLanguage:"activeLanguage"},outputs:{assetChange:"assetChange",selectionChange:"selectionChange",selectFacetValueClick:"selectFacetValueClick",updateProductOption:"updateProductOption"},features:[a.Tb],decls:2,vars:1,consts:[[1,"variants-list"],["class","variant-container card",3,"disabled",4,"ngFor","ngForOf"],[1,"variant-container","card"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"card-block","header-row"],[1,"details"],[1,"sku",3,"readonly"],["clrInput","","type","text","formControlName","sku",3,"readonly","placeholder"],[1,"name",3,"readonly"],["clrInput","","type","text","formControlName","name",3,"readonly","placeholder"],[1,"right-controls"],[4,"vdrIfPermissions"],[1,"card-block"],[1,"variant-body"],[1,"assets"],[3,"compact","assets","featuredAsset","change"],[1,"variant-form-inputs"],[1,"standard-fields"],[1,"variant-form-input-row"],[1,"tax-category"],[4,"vdrIfPermissions","vdrIfPermissionsElse"],["taxCategoryLabel",""],[1,"price"],["clrInput","","formControlName","price",3,"currencyCode","readonly"],[3,"price","currencyCode","priceIncludesTax","taxCategoryId"],["clrInput","","type","number","min","0","step","1","formControlName","stockOnHand",3,"readonly"],[1,"track-inventory-toggle"],["type","checkbox","clrCheckbox","","name","trackInventory","formControlName","trackInventory",3,"vdrDisabled"],[1,"custom-fields"],["formGroupName","customFields",4,"ngIf"],[1,"options-facets"],[3,"entity"],[4,"ngIf"],[1,"flex-spacer"],[1,"facets"],[3,"facetValue","removable","remove",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary",3,"click",4,"vdrIfPermissions"],["type","checkbox","clrToggle","","name","enabled","formControlName","enabled"],["clrSelect","","name","options","formControlName","taxCategoryId"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"clr-control-label"],[1,"tax-category-label"],["formGroupName","customFields"],[4,"ngFor","ngForOf"],["entityName","ProductVariant",3,"compact","customFieldsFormGroup","readonly","customField",4,"ngIf"],["entityName","ProductVariant",3,"compact","customFieldsFormGroup","readonly","customField"],[1,"options"],[3,"colorFrom","invert","icon","iconClick",4,"ngFor","ngForOf"],[3,"colorFrom","invert","icon","iconClick"],[1,"option-group-name"],[3,"facetValue","removable","remove"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","plus"]],template:function(e,t){1&e&&(a.nc(0,"div",0),a.Zc(1,mc,2,5,"div",1),a.mc()),2&e&&(a.Vb(1),a.Ec("ngForOf",t.variants))},directives:function(){return[B.o,B.p,w.q,w.j,i.Ob,X.s,i.db,w.b,X.r,w.p,w.h,i.ob,fa,X.t,i.F,ha,w.v,X.k,w.a,X.i,i.R,i.Z,X.A,w.A,X.z,w.u,w.D,w.k,i.H,i.B,i.ab,X.o]},pipes:function(){return[i.gb,W.d,i.Jb]},styles:[".with-selected[_ngcontent-%COMP%]{display:flex;min-height:52px;align-items:center;border:1px solid #f2f3f5;border-radius:3px;padding:6px 18px}.with-selected[_ngcontent-%COMP%]   vdr-select-toggle[_ngcontent-%COMP%], .with-selected[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{margin-right:12px}.variant-container[_ngcontent-%COMP%]{transition:background-color .2s}.variant-container.disabled[_ngcontent-%COMP%]{background-color:#f2f3f5}.variant-container[_ngcontent-%COMP%]   .header-row[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap}.variant-container[_ngcontent-%COMP%]   .variant-body[_ngcontent-%COMP%]{display:flex;flex-direction:column}@media screen and (min-width:768px){.variant-container[_ngcontent-%COMP%]   .variant-body[_ngcontent-%COMP%]{flex-direction:row}}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;margin-right:12px}@media screen and (min-width:768px){.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{flex-direction:row;height:36px}}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{flex:1}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]     .clr-control-container{width:100%}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]     .clr-control-container input.clr-input{min-width:100%}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .sku[_ngcontent-%COMP%]{width:160px;margin-right:20px;flex:0}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]     .name input{min-width:300px}.variant-container[_ngcontent-%COMP%]   .right-controls[_ngcontent-%COMP%]{display:flex}.variant-container[_ngcontent-%COMP%]   .tax-category-label[_ngcontent-%COMP%]{margin-top:3px}.variant-container[_ngcontent-%COMP%]   .variant-form-inputs[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}@media screen and (min-width:768px){.variant-container[_ngcontent-%COMP%]   .variant-form-inputs[_ngcontent-%COMP%]{flex-direction:row}.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%]{margin:0 6px 8px 24px}}.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-right:24px;margin-bottom:24px}.variant-container[_ngcontent-%COMP%]   .track-inventory-toggle[_ngcontent-%COMP%]{margin-top:22px}.variant-container[_ngcontent-%COMP%]   .clr-form-control[_ngcontent-%COMP%]{margin-top:0}.variant-container[_ngcontent-%COMP%]   .facets[_ngcontent-%COMP%]{display:flex;align-items:center}.variant-container[_ngcontent-%COMP%]   .pricing[_ngcontent-%COMP%]{display:flex}.variant-container[_ngcontent-%COMP%]   .pricing[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-right:12px}.variant-container[_ngcontent-%COMP%]   .option-group-name[_ngcontent-%COMP%]{color:#97979a;text-transform:uppercase;font-size:10px;margin-right:3px;height:11px}.variant-container[_ngcontent-%COMP%]   .options-facets[_ngcontent-%COMP%]{display:flex;color:#97979a}"],changeDetection:0}),ga.ctorParameters=function(){return[{type:a.k},{type:i.xb}]},Object(c.c)([Object(a.D)("productVariantsFormArray"),Object(c.f)("design:type",w.c)],ga.prototype,"formArray",void 0),Object(c.c)([Object(a.D)(),Object(c.f)("design:type",Array)],ga.prototype,"variants",void 0),Object(c.c)([Object(a.D)(),Object(c.f)("design:type",Array)],ga.prototype,"taxCategories",void 0),Object(c.c)([Object(a.D)(),Object(c.f)("design:type",Array)],ga.prototype,"facets",void 0),Object(c.c)([Object(a.D)(),Object(c.f)("design:type",Array)],ga.prototype,"optionGroups",void 0),Object(c.c)([Object(a.D)(),Object(c.f)("design:type",Array)],ga.prototype,"customFields",void 0),Object(c.c)([Object(a.D)(),Object(c.f)("design:type",Array)],ga.prototype,"customOptionFields",void 0),Object(c.c)([Object(a.D)(),Object(c.f)("design:type",String)],ga.prototype,"activeLanguage",void 0),Object(c.c)([Object(a.O)(),Object(c.f)("design:type",Object)],ga.prototype,"assetChange",void 0),Object(c.c)([Object(a.O)(),Object(c.f)("design:type",Object)],ga.prototype,"selectionChange",void 0),Object(c.c)([Object(a.O)(),Object(c.f)("design:type",Object)],ga.prototype,"selectFacetValueClick",void 0),Object(c.c)([Object(a.O)(),Object(c.f)("design:type",Object)],ga.prototype,"updateProductOption",void 0),ga=Object(c.c)([Object(c.f)("design:paramtypes",[a.k,i.xb])],ga);var va=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"optionGroupName",value:function(e){var t=this.optionGroups.find((function(t){return t.id===e}));return t&&t.name}}]),e}();va.\u0275fac=function(e){return new(e||va)},va.\u0275cmp=a.bc({type:va,selectors:[["vdr-product-variants-table"]],inputs:{formArray:["productVariantsFormArray","formArray"],variants:"variants",optionGroups:"optionGroups"},decls:20,vars:20,consts:[[3,"items"],[4,"ngFor","ngForOf"],[3,"formGroup"],[1,"left","align-middle"],[1,"card-img"],[1,"featured-asset"],[3,"src",4,"ngIf"],["class","placeholder",4,"ngIf"],["clrInput","","type","text","formControlName","name",3,"readonly","placeholder"],["clrInput","","type","text","formControlName","sku",3,"readonly","placeholder"],[1,"left","align-middle","price"],["clrInput","","formControlName","price",3,"currencyCode","readonly"],[1,"left","align-middle","stock"],["clrInput","","type","number","min","0","step","1","formControlName","stockOnHand",3,"readonly"],["type","checkbox","clrToggle","","name","enabled","formControlName","enabled",3,"vdrDisabled"],[3,"src"],[1,"placeholder"],["shape","image","size","48"]],template:function(e,t){1&e&&(a.nc(0,"vdr-data-table",0),a.ic(1,"vdr-dt-column"),a.nc(2,"vdr-dt-column"),a.bd(3),a.yc(4,"translate"),a.mc(),a.nc(5,"vdr-dt-column"),a.bd(6),a.yc(7,"translate"),a.mc(),a.Zc(8,bc,3,1,"ng-container",1),a.yc(9,"sort"),a.nc(10,"vdr-dt-column"),a.bd(11),a.yc(12,"translate"),a.mc(),a.nc(13,"vdr-dt-column"),a.bd(14),a.yc(15,"translate"),a.mc(),a.nc(16,"vdr-dt-column"),a.bd(17),a.yc(18,"translate"),a.mc(),a.Zc(19,yc,30,53,"ng-template"),a.mc()),2&e&&(a.Ec("items",t.variants),a.Vb(3),a.cd(a.zc(4,7,"common.name")),a.Vb(3),a.cd(a.zc(7,9,"catalog.sku")),a.Vb(2),a.Ec("ngForOf",a.Ac(9,11,t.optionGroups,"id")),a.Vb(3),a.cd(a.zc(12,14,"catalog.price")),a.Vb(3),a.cd(a.zc(15,16,"catalog.stock-on-hand")),a.Vb(3),a.cd(a.zc(18,18,"common.enabled")))},directives:[i.M,i.L,B.o,w.q,w.j,B.p,X.s,i.db,w.b,X.r,w.p,w.h,i.F,w.v,X.k,w.a,X.i,i.R,X.o],pipes:[W.d,i.Jb,i.gb,i.q,i.Kb],styles:[".placeholder[_ngcontent-%COMP%]{color:#bfc3cc}input[_ngcontent-%COMP%]{width:100%}.price[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .stock[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:96px}td[_ngcontent-%COMP%]{transition:background-color .2s}td.disabled[_ngcontent-%COMP%]{background-color:#f2f3f5}"],changeDetection:0}),Object(c.c)([Object(a.D)("productVariantsFormArray"),Object(c.f)("design:type",w.c)],va.prototype,"formArray",void 0),Object(c.c)([Object(a.D)(),Object(c.f)("design:type",Array)],va.prototype,"variants",void 0),Object(c.c)([Object(a.D)(),Object(c.f)("design:type",Array)],va.prototype,"optionGroups",void 0);var ha=function(){function e(t){_classCallCheck(this,e),this.dataService=t,this.priceChange$=new D.a(0),this.taxCategoryIdChange$=new D.a("")}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this.dataService.settings.getTaxRates(99999,0,"cache-first").mapStream((function(e){return e.taxRates.items})),t=this.dataService.settings.getActiveChannel("cache-first").mapStream((function(e){return e.activeChannel}));this.taxRate$=Object(M.a)(t,e,this.taxCategoryIdChange$).pipe(Object(s.a)((function(e){var t=_slicedToArray(e,3),n=t[0],c=t[1],a=t[2],r=n.defaultTaxZone;if(!r)return 0;var i=c.find((function(e){return e.zone.id===r.id&&e.category.id===a}));return i?i.value:0}))),this.grossPrice$=Object(M.a)(this.taxRate$,this.priceChange$).pipe(Object(s.a)((function(e){var t=_slicedToArray(e,2),n=t[0],c=t[1];return Math.round(c*((100+n)/100))/100})))}},{key:"ngOnChanges",value:function(e){"price"in e&&this.priceChange$.next(e.price.currentValue),"taxCategoryId"in e&&this.taxCategoryIdChange$.next(e.taxCategoryId.currentValue)}}]),e}();ha.\u0275fac=function(e){return new(e||ha)(a.hc(i.K))},ha.\u0275cmp=a.bc({type:ha,selectors:[["vdr-variant-price-detail"]],inputs:{priceIncludesTax:"priceIncludesTax",price:"price",currencyCode:"currencyCode",taxCategoryId:"taxCategoryId"},features:[a.Tb],decls:5,vars:5,consts:[[1,"clr-control-label"],["class","value",4,"ngIf"],[1,"value"]],template:function(e,t){1&e&&(a.nc(0,"label",0),a.bd(1),a.yc(2,"translate"),a.mc(),a.Zc(3,Oc,4,8,"div",1),a.Zc(4,kc,6,14,"div",1)),2&e&&(a.Vb(1),a.cd(a.zc(2,3,"catalog.taxes")),a.Vb(2),a.Ec("ngIf",t.priceIncludesTax),a.Vb(1),a.Ec("ngIf",!t.priceIncludesTax))},directives:[X.t,B.p],pipes:[W.d,B.b,B.d],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}.value[_ngcontent-%COMP%]{margin-top:3px}"],changeDetection:0}),ha.ctorParameters=function(){return[{type:i.K}]},Object(c.c)([Object(a.D)(),Object(c.f)("design:type",Boolean)],ha.prototype,"priceIncludesTax",void 0),Object(c.c)([Object(a.D)(),Object(c.f)("design:type",Number)],ha.prototype,"price",void 0),Object(c.c)([Object(a.D)(),Object(c.f)("design:type",String)],ha.prototype,"currencyCode",void 0),Object(c.c)([Object(a.D)(),Object(c.f)("design:type",String)],ha.prototype,"taxCategoryId",void 0),ha=Object(c.c)([Object(c.f)("design:paramtypes",[i.K])],ha);var ya=function e(){_classCallCheck(this,e)};ya.\u0275mod=a.fc({type:ya}),ya.\u0275inj=a.ec({factory:function(e){return new(e||ya)},imports:[[i.Hb,r.i.forChild(ta)]]})},qzMg:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unique=function(e,t){return e.filter((function(e,n,c){return n===c.findIndex((function(n){return void 0===t?n===e:n[t]===e[t]}))}))}}}]);