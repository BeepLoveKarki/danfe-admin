(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{UmAP:function(t,e,i){"use strict";i.r(e),i.d(e,"MailSubscriptionUIModule",(function(){return L})),i.d(e,"mailDetailBreadcrumb",(function(){return Z}));var c=i("sEIs"),a=i("ixhn"),r=i("nIj0"),n=i("OxKu"),s=i("FOa3"),o=i("6Oco"),l=i("mWib"),d=i("kuMc"),u=i("TLy2"),m=i("7RXT"),b=i("H5qd"),p=i.n(b),h=i("JReq");const f=p.a`
    query GetAllEmails($options: EmailListOptions){
		SubscriptionEmails(options: $options){
			items{
			...SubscribedEmails
			}
			totalItems
       }
    }
	${h.a}
`,v=p.a`
   mutation DeleteEmail($input:[ID!]!){
      deleteSubscriptionEmail(id:$input){
	     ...SubscribedEmails 
	  }
   }
   ${h.a}
`;var y=i("EM62"),g=i("DEd4"),S=i("Kej3"),E=i("s2Ay"),k=i("2kYt");function w(t,e){if(1&t){const t=y.jc();y.ic(0,"a",5),y.pc("click",(function(){y.Mc(t);return y.rc().downloadcsv()})),y.dc(1,"clr-icon",6),y.Xc(2),y.sc(3,"translate"),y.hc()}2&t&&(y.Rb(2),y.Zc(" ",y.tc(3,1,"vdr-subscription-plugin.download-csv")," "))}const P=function(){return["./create"]};function O(t,e){1&t&&(y.ic(0,"a",7),y.dc(1,"clr-icon",8),y.Xc(2),y.sc(3,"translate"),y.hc()),2&t&&(y.yc("routerLink",y.Cc(4,P)),y.Rb(2),y.Zc(" ",y.tc(3,2,"vdr-subscription-plugin.create-new-email")," "))}const I=function(t){return["/extensions","subscribedmails",t]};function j(t,e){if(1&t&&(y.ic(0,"td",11),y.dc(1,"vdr-table-row-action",12),y.sc(2,"translate"),y.hc()),2&t){const t=y.rc().item;y.Rb(1),y.yc("label",y.tc(2,2,"common.edit"))("linkTo",y.Dc(4,I,t.id))}}function R(t,e){if(1&t){const t=y.jc();y.ic(0,"td",11),y.ic(1,"vdr-dropdown"),y.ic(2,"button",13),y.Xc(3),y.sc(4,"translate"),y.dc(5,"clr-icon",14),y.hc(),y.ic(6,"vdr-dropdown-menu",15),y.ic(7,"button",16),y.pc("click",(function(){y.Mc(t);const e=y.rc().item;return y.rc().deleteEmail(e.id)})),y.dc(8,"clr-icon",17),y.Xc(9),y.sc(10,"translate"),y.hc(),y.hc(),y.hc(),y.hc()}2&t&&(y.Rb(3),y.Zc(" ",y.tc(4,2,"common.actions")," "),y.Rb(6),y.Zc(" ",y.tc(10,4,"common.delete")," "))}function C(t,e){if(1&t&&(y.ic(0,"td",9),y.Xc(1),y.hc(),y.ic(2,"td",9),y.Xc(3),y.sc(4,"date"),y.hc(),y.ic(5,"td",9),y.Xc(6),y.sc(7,"date"),y.hc(),y.Vc(8,j,3,6,"td",10),y.Vc(9,R,11,6,"td",10)),2&t){const t=e.item;y.Rb(1),y.Yc(t.email),y.Rb(2),y.Yc(y.uc(4,5,t.createdAt,"longDate")),y.Rb(3),y.Yc(y.uc(7,8,t.updatedAt,"longDate")),y.Rb(2),y.yc("vdrIfPermissions","UpdateSettings"),y.Rb(1),y.yc("vdrIfPermissions","DeleteSettings")}}class $ extends a.w{constructor(t,e,i,c,a,n){super(a,n),this.dataService=t,this.modalService=e,this.notificationService=i,this.apollo=c,this.searchTerm=new r.f(""),super.setQueryFn((...t)=>this.dataService.query(f,t),t=>t.SubscriptionEmails,(t,e)=>({options:{skip:t,take:e,filter:{email:{contains:this.searchTerm.value}},sort:{updatedAt:s.a.Desc}}}))}ngOnInit(){super.ngOnInit(),this.searchTerm.valueChanges.pipe(Object(l.a)(250),Object(d.a)(this.destroy$)).subscribe(()=>{this.refresh()})}downloadcsv(){this.apollo.watchQuery({query:f,variables:[]}).valueChanges.subscribe(t=>{m.a.exportToCsv("danfe-subscribed-emails.csv",t.data.SubscriptionEmails.items)})}deleteEmail(t){let e=[t];this.modalService.dialog({title:Object(n.a)("vdr-subscription-plugin.confirm-delete-email"),buttons:[{type:"secondary",label:Object(n.a)("common.cancel")},{type:"danger",label:Object(n.a)("common.delete"),returnValue:!0}]}).pipe(Object(u.a)(t=>t?this.dataService.mutate(v,{input:e}):o.a)).subscribe(()=>{this.notificationService.success(Object(n.a)("common.notify-delete-success"),{entity:"Email"}),this.refresh()},t=>{this.notificationService.error(Object(n.a)("common.notify-delete-error"),{entity:"Email"})})}}$.\u0275fac=function(t){return new(t||$)(y.cc(a.K),y.cc(a.Ab),y.cc(a.Bb),y.cc(g.b),y.cc(c.e),y.cc(c.a))},$.\u0275cmp=y.Wb({type:$,selectors:[["vdr-all-mails-list"]],features:[y.Ob],decls:25,vars:27,consts:[["type","text","name","searchTerm",1,"clr-input","search-input",3,"formControl","placeholder"],["locationId","email-list"],["href","javascript:void(0)","class","btn btn-primary","id","downloadbtn",3,"click",4,"vdrIfPermissions"],["class","btn btn-primary","id","createbtn",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],["href","javascript:void(0)","id","downloadbtn",1,"btn","btn-primary",3,"click"],["shape","download-cloud"],["id","createbtn",1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"left","align-middle"],["class","right align-middle",4,"vdrIfPermissions"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"click"],["shape","trash",1,"is-danger"]],template:function(t,e){1&t&&(y.ic(0,"vdr-action-bar"),y.ic(1,"vdr-ab-left"),y.dc(2,"input",0),y.sc(3,"translate"),y.hc(),y.ic(4,"vdr-ab-right"),y.dc(5,"vdr-action-bar-items",1),y.Vc(6,w,4,3,"a",2),y.Vc(7,O,4,5,"a",3),y.hc(),y.hc(),y.ic(8,"vdr-data-table",4),y.pc("pageChange",(function(t){return e.setPageNumber(t)}))("itemsPerPageChange",(function(t){return e.setItemsPerPage(t)})),y.sc(9,"async"),y.sc(10,"async"),y.sc(11,"async"),y.sc(12,"async"),y.ic(13,"vdr-dt-column"),y.Xc(14),y.sc(15,"translate"),y.hc(),y.ic(16,"vdr-dt-column"),y.Xc(17),y.sc(18,"translate"),y.hc(),y.ic(19,"vdr-dt-column"),y.Xc(20),y.sc(21,"translate"),y.hc(),y.dc(22,"vdr-dt-column"),y.dc(23,"vdr-dt-column"),y.Vc(24,C,10,11,"ng-template"),y.hc()),2&t&&(y.Rb(2),y.yc("formControl",e.searchTerm)("placeholder",y.tc(3,11,"vdr-subscription-plugin.search-by-email")),y.Rb(4),y.yc("vdrIfPermissions","CreateSettings"),y.Rb(1),y.yc("vdrIfPermissions","CreateSettings"),y.Rb(1),y.yc("items",y.tc(9,13,e.items$))("itemsPerPage",y.tc(10,15,e.itemsPerPage$))("totalItems",y.tc(11,17,e.totalItems$))("currentPage",y.tc(12,19,e.currentPage$)),y.Rb(6),y.Yc(y.tc(15,21,"vdr-subscription-plugin.email")),y.Rb(3),y.Yc(y.tc(18,23,"vdr-subscription-plugin.created")),y.Rb(3),y.Yc(y.tc(21,25,"vdr-subscription-plugin.updated")))},directives:[a.c,a.e,a.eb,r.b,r.p,r.g,a.f,a.d,a.rb,a.M,a.L,S.o,c.h,a.Pb,a.S,a.V,a.U,a.T],pipes:[E.d,k.b,k.f],styles:[".search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}"],changeDetection:0});var F=i("ROBh"),D=i("xVbo"),x=i("7SLS");const M=p.a`
    mutation UpdateEmail($input: [EmailUpdateInput!]!) {
        updateSubscriptionEmail(input: $input) {
            ...SubscribedEmails
        }
    }
    ${h.a}
`,V=p.a`
    mutation CreateEmail($input: [EmailAddInput!]!) {
        addSubscriptionEmail(input: $input) {
            ...SubscribedEmails
        }
    }
    ${h.a}
`;function X(t,e){if(1&t){const t=y.jc();y.ic(0,"button",5),y.pc("click",(function(){y.Mc(t);return y.rc().create()})),y.Xc(1),y.sc(2,"translate"),y.hc()}if(2&t){const t=y.rc();y.yc("disabled",!(t.detailForm.valid&&t.detailForm.dirty)),y.Rb(1),y.Zc(" ",y.tc(2,2,"common.create")," ")}}function A(t,e){if(1&t){const t=y.jc();y.ic(0,"button",6),y.pc("click",(function(){y.Mc(t);return y.rc().save()})),y.Xc(1),y.sc(2,"translate"),y.hc()}if(2&t){const t=y.rc();y.yc("disabled",!(t.detailForm.valid&&t.detailForm.dirty)),y.Rb(1),y.Zc(" ",y.tc(2,2,"common.update")," ")}}class T extends a.u{constructor(t,e,i,c,a,n,s){super(t,e,i,a),this.formBuilder=c,this.dataService=a,this.changeDetector=n,this.notificationService=s,this.which=!1,this.detailForm=this.formBuilder.group({email:["",r.C.required]})}ngOnInit(){"/extensions/subscribedmails/create"!=this.router.url?(this.which=!1,this.init()):this.which=!0}ngOnDestroy(){this.destroy()}create(){this.addNew().pipe(Object(D.a)(t=>!!t)).subscribe(()=>{this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success("common.notify-create-success",{entity:"Email"})},()=>{this.notificationService.error("common.notify-create-error",{entity:"Email"})})}save(){this.saveChanges().pipe(Object(D.a)(t=>!!t)).subscribe(()=>{this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success("common.notify-update-success",{entity:"Email"})},()=>{this.notificationService.error("common.notify-update-error",{entity:"Email"})})}addNew(){if(this.detailForm.dirty){const t=[{email:this.detailForm.value.email}];return this.dataService.mutate(V,{input:t}).pipe(Object(x.a)(!0))}return Object(F.a)(!1)}saveChanges(){if(this.detailForm.dirty){const t=this.detailForm.value,e=[{id:this.id,email:t.email}];return this.dataService.mutate(M,{input:e}).pipe(Object(x.a)(!0))}return Object(F.a)(!1)}setFormValues(t){this.detailForm.patchValue({email:t.email})}}T.\u0275fac=function(t){return new(t||T)(y.cc(c.a),y.cc(c.e),y.cc(a.Jb),y.cc(r.e),y.cc(a.K),y.cc(y.k),y.cc(a.Bb))},T.\u0275cmp=y.Wb({type:T,selectors:[["vdr-subscription-mail-detail"]],features:[y.Ob],decls:9,vars:7,consts:[["class","btn btn-primary","id","custbtn",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],[1,"form",3,"formGroup"],["for","email",3,"label"],["id","email","type","email","formControlName","email",3,"readonly"],["id","custbtn",1,"btn","btn-primary",3,"disabled","click"],["id","editbtn",1,"btn","btn-primary",3,"disabled","click"]],template:function(t,e){if(1&t&&(y.ic(0,"vdr-action-bar"),y.ic(1,"vdr-ab-right"),y.Vc(2,X,3,4,"button",0),y.Vc(3,A,3,4,"ng-template",null,1,y.Wc),y.hc(),y.hc(),y.ic(5,"form",2),y.ic(6,"vdr-form-field",3),y.sc(7,"translate"),y.dc(8,"input",4),y.hc(),y.hc()),2&t){const t=y.Jc(4);y.Rb(2),y.yc("ngIf",e.which)("ngIfElse",t),y.Rb(3),y.yc("formGroup",e.detailForm),y.Rb(1),y.yc("label",y.tc(7,5,"vdr-subscription-plugin.email-label")),y.Rb(2),y.yc("readonly",!1)}},directives:[a.c,a.f,k.p,r.E,r.q,r.j,a.db,a.eb,r.b,r.p,r.h],pipes:[E.d],styles:[".search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}"]});const Y=p.a`
  query GetEmail($id: ID!) {
    SubscriptionEmail(id: $id) {
      ...SubscribedEmails
    }
  }
  ${h.a}
`;class q extends a.v{constructor(t,e){super(t,{__typename:"Email",id:"",email:"",createdAt:"",updatedAt:""},t=>e.query(Y,{id:t}).mapStream(t=>t.SubscriptionEmail))}}q.\u0275fac=function(t){return new(t||q)(y.mc(c.e),y.mc(a.K))},q.\u0275prov=y.Yb({token:q,factory:q.\u0275fac});var B=i("YtkY");class L{}function Z(t){return t.entity.pipe(Object(B.a)(t=>[{label:"Subscribed Mails",link:["/extensions","subscribedmails"]},{label:""+t.email,link:[]}]))}L.\u0275mod=y.ac({type:L}),L.\u0275inj=y.Zb({factory:function(t){return new(t||L)},providers:[q],imports:[[a.Kb,c.i.forChild([{path:"",pathMatch:"full",component:$,data:{breadcrumb:"Subscribed Mails"}},{path:"create",component:T,data:{breadcrumb:[{label:"Subscribed Mails",link:["/extensions","subscribedmails"]},{label:"Create Email",link:[]}]}},{path:":id",component:T,resolve:Object(a.Vb)(q),data:{breadcrumb:Z}}])]]})}}]);