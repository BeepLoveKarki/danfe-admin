(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{FGij:function(t,e,c){"use strict";c.r(e);var n=c("D57K"),a=c("EM62"),i=c("sEIs"),o=c("ixhn"),r=c("OxKu"),s=c("YtkY"),l=c("mWib"),d=c("kuMc"),u=c("ruxD"),p=c("TLy2"),m=c("jIqt"),g=c("Ohay"),b=c("8j5Y"),h=c("wqq/"),f=c("J+dc"),v=c("cJ9h"),y=c("7SLS"),O=c("pBDD"),C=c("mW0F");function x(...t){return e=>{let c;"function"==typeof t[t.length-1]&&(c=t.pop());const n=t;return e.lift(new P(n,c))}}class P{constructor(t,e){this.observables=t,this.project=e}call(t,e){return e.subscribe(new F(t,this.observables,this.project))}}class F extends O.a{constructor(t,e,c){super(t),this.observables=e,this.project=c,this.toRespond=[];const n=e.length;this.values=new Array(n);for(let a=0;a<n;a++)this.toRespond.push(a);for(let a=0;a<n;a++){let t=e[a];this.add(Object(C.a)(this,t,t,a))}}notifyNext(t,e,c,n,a){this.values[c]=e;const i=this.toRespond;if(i.length>0){const t=i.indexOf(c);-1!==t&&i.splice(t,1)}}notifyComplete(){}_next(t){if(0===this.toRespond.length){const e=[t,...this.values];this.project?this._tryProject(e):this.destination.next(e)}}_tryProject(t){let e;try{e=this.project.apply(this,t)}catch(c){return void this.destination.error(c)}this.destination.next(e)}}var w=c("Efrr");var j=c("5uGe"),D=c("ryP2");function I(t,e=w.a){var c;const n=(c=t)instanceof Date&&!isNaN(+c)?+t-e.now():Math.abs(t);return t=>t.lift(new U(n,e))}class U{constructor(t,e){this.delay=t,this.scheduler=e}call(t,e){return e.subscribe(new k(t,this.delay,this.scheduler))}}class k extends j.a{constructor(t,e,c){super(t),this.delay=e,this.scheduler=c,this.queue=[],this.active=!1,this.errored=!1}static dispatch(t){const e=t.source,c=e.queue,n=t.scheduler,a=t.destination;for(;c.length>0&&c[0].time-n.now()<=0;)c.shift().notification.observe(a);if(c.length>0){const e=Math.max(0,c[0].time-n.now());this.schedule(t,e)}else this.unsubscribe(),e.active=!1}_schedule(t){this.active=!0,this.destination.add(t.schedule(k.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))}scheduleNotification(t){if(!0===this.errored)return;const e=this.scheduler,c=new V(e.now()+this.delay,t);this.queue.push(c),!1===this.active&&this._schedule(e)}_next(t){this.scheduleNotification(D.a.createNext(t))}_error(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()}_complete(){this.scheduleNotification(D.a.createComplete()),this.unsubscribe()}}class V{constructor(t,e){this.time=t,this.notification=e}}var M=c("xVbo"),S=c("nIj0"),_=c("8hOy"),A=c("HM3f"),$=c("6Oco"),T=c("C05f"),Y=c("ZTXN"),N=c("ROBh"),R=c("P4Xx"),L=c("47ST"),G=c("GoAz"),E=c("g6G6"),K=c("hbhS"),q=c("hG4v"),B=c("2kYt"),z=c("Ui7s"),X=c("qzMg"),H=c("jY47"),Z=c("oqI+"),Q=c("qvOF"),W=c("s2Ay"),J=c("iNDR"),tt=c("Kej3");function et(t,e){if(1&t){const t=a.nc();a.mc(0,"button",4),a.uc("click",(function(){return a.Rc(t),a.wc().save()})),a.ad(1),a.xc(2,"translate"),a.lc()}if(2&t){const t=a.wc();a.Dc("disabled",t.detailForm.invalid||t.detailForm.pristine),a.Ub(1),a.cd(" ",a.yc(2,2,"common.update")," ")}}c.d(e,"ApplyFacetDialogComponent",(function(){return Sn})),c.d(e,"AssetDetailComponent",(function(){return wn})),c.d(e,"AssetListComponent",(function(){return jn})),c.d(e,"AssetResolver",(function(){return Gn})),c.d(e,"AssignProductsToChannelDialogComponent",(function(){return _n})),c.d(e,"CatalogModule",(function(){return Oa})),c.d(e,"CollectionContentsComponent",(function(){return Dn})),c.d(e,"CollectionDetailComponent",(function(){return In})),c.d(e,"CollectionListComponent",(function(){return Un})),c.d(e,"CollectionResolver",(function(){return En})),c.d(e,"CollectionTreeComponent",(function(){return la})),c.d(e,"CollectionTreeNodeComponent",(function(){return da})),c.d(e,"FacetDetailComponent",(function(){return kn})),c.d(e,"FacetListComponent",(function(){return Vn})),c.d(e,"FacetResolver",(function(){return Kn})),c.d(e,"GenerateProductVariantsComponent",(function(){return ua})),c.d(e,"OPTION_VALUE_INPUT_VALUE_ACCESSOR",(function(){return pa})),c.d(e,"OptionValueInputComponent",(function(){return ma})),c.d(e,"ProductAssetsComponent",(function(){return ga})),c.d(e,"ProductDetailComponent",(function(){return An})),c.d(e,"ProductDetailService",(function(){return Mn})),c.d(e,"ProductListComponent",(function(){return Rn})),c.d(e,"ProductResolver",(function(){return qn})),c.d(e,"ProductSearchInputComponent",(function(){return Nn})),c.d(e,"ProductSearchSelectionModel",(function(){return $n})),c.d(e,"ProductSearchSelectionModelFactory",(function(){return Tn})),c.d(e,"ProductVariantsEditorComponent",(function(){return Ln})),c.d(e,"ProductVariantsListComponent",(function(){return fa})),c.d(e,"ProductVariantsResolver",(function(){return Bn})),c.d(e,"ProductVariantsTableComponent",(function(){return va})),c.d(e,"UpdateProductOptionDialogComponent",(function(){return ha})),c.d(e,"VariantPriceDetailComponent",(function(){return ya})),c.d(e,"arrayToTree",(function(){return sa})),c.d(e,"assetBreadcrumb",(function(){return ra})),c.d(e,"catalogRoutes",(function(){return ca})),c.d(e,"collectionBreadcrumb",(function(){return oa})),c.d(e,"facetBreadcrumb",(function(){return ia})),c.d(e,"productBreadcrumb",(function(){return na})),c.d(e,"productVariantEditorBreadcrumb",(function(){return aa})),c.d(e,"\u02750",(function(){return zn})),c.d(e,"\u02751",(function(){return Xn})),c.d(e,"\u02752",(function(){return Hn})),c.d(e,"\u02753",(function(){return Zn})),c.d(e,"\u02754",(function(){return Qn})),c.d(e,"\u02755",(function(){return Wn})),c.d(e,"\u02756",(function(){return Jn})),c.d(e,"\u02757",(function(){return ta})),c.d(e,"\u02758",(function(){return ea}));const ct=function(){return{}};function nt(t,e){1&t&&a.ic(0)}const at=function(){return{tab:"variants"}},it=function(t,e){return["/catalog/products",t,e]};function ot(t,e){if(1&t&&(a.mc(0,"td",5),a.ad(1),a.lc(),a.mc(2,"td",6),a.hc(3,"vdr-table-row-action",7),a.xc(4,"translate"),a.lc()),2&t){const t=e.item;a.Ub(1),a.bd(t.name),a.Ub(2),a.Dc("label",a.yc(4,3,"common.edit"))("linkTo",a.Jc(6,it,t.productId,a.Hc(5,at)))}}const rt=function(t){return{$implicit:t}},st=["collectionContents"];function lt(t,e){if(1&t){const t=a.nc();a.mc(0,"button",6),a.uc("click",(function(){return a.Rc(t),a.wc().create()})),a.ad(1),a.xc(2,"translate"),a.lc()}if(2&t){const t=a.wc();a.Dc("disabled",t.detailForm.invalid||t.detailForm.pristine),a.Ub(1),a.cd(" ",a.yc(2,2,"common.create")," ")}}function dt(t,e){if(1&t){const t=a.nc();a.mc(0,"button",6),a.uc("click",(function(){return a.Rc(t),a.wc(2).save()})),a.ad(1),a.xc(2,"translate"),a.lc()}if(2&t){const t=a.wc(2);a.Dc("disabled",(t.detailForm.invalid||t.detailForm.pristine)&&!t.assetsChanged()),a.Ub(1),a.cd(" ",a.yc(2,2,"common.update")," ")}}function ut(t,e){1&t&&a.Yc(0,dt,3,4,"button",7),2&t&&a.Dc("vdrIfPermissions","UpdateCatalog")}function pt(t,e){1&t&&(a.kc(0),a.ad(1),a.xc(2,"translate"),a.jc()),2&t&&(a.Ub(1),a.bd(a.yc(2,1,"catalog.public")))}function mt(t,e){1&t&&(a.ad(0),a.xc(1,"translate")),2&t&&a.bd(a.yc(1,1,"catalog.private"))}const gt=function(){return["customFields"]};function bt(t,e){if(1&t&&a.hc(0,"vdr-custom-field-control",31),2&t){const t=a.wc().$implicit,e=a.wc(3);a.Dc("customFieldsFormGroup",e.detailForm.get(a.Hc(2,gt)))("customField",t)}}function ht(t,e){if(1&t&&(a.kc(0),a.Yc(1,bt,1,3,"vdr-custom-field-control",30),a.jc()),2&t){const t=e.$implicit,c=a.wc(3);a.Ub(1),a.Dc("ngIf",c.customFieldIsSet(t.name))}}function ft(t,e){if(1&t&&(a.mc(0,"section",29),a.mc(1,"label"),a.ad(2),a.xc(3,"translate"),a.lc(),a.Yc(4,ht,2,1,"ng-container",25),a.lc()),2&t){const t=a.wc(2);a.Ub(2),a.bd(a.yc(3,2,"common.custom-fields")),a.Ub(2),a.Dc("ngForOf",t.customFields)}}function vt(t,e){if(1&t){const t=a.nc();a.kc(0),a.mc(1,"vdr-configurable-input",32),a.uc("remove",(function(e){return a.Rc(t),a.wc(2).removeFilter(e)})),a.xc(2,"async"),a.xc(3,"hasPermission"),a.xc(4,"async"),a.lc(),a.jc()}if(2&t){const t=e.$implicit,c=e.index,n=a.wc(2);a.Ub(1),a.Dc("facets",a.yc(2,6,n.facets$))("operation",t)("operationDefinition",n.getFilterDefinition(t))("formControlName",c)("readonly",!a.yc(3,8,"UpdateCatalog"))("activeChannel",a.yc(4,10,n.activeChannel$))}}function yt(t,e){if(1&t){const t=a.nc();a.mc(0,"button",37),a.uc("click",(function(){a.Rc(t);const c=e.$implicit;return a.wc(3).addFilter(c)})),a.ad(1),a.lc()}if(2&t){const t=e.$implicit;a.Ub(1),a.cd(" ",t.description," ")}}function Ot(t,e){if(1&t&&(a.mc(0,"div"),a.mc(1,"vdr-dropdown"),a.mc(2,"button",33),a.hc(3,"clr-icon",34),a.ad(4),a.xc(5,"translate"),a.lc(),a.mc(6,"vdr-dropdown-menu",35),a.Yc(7,yt,2,1,"button",36),a.lc(),a.lc(),a.lc()),2&t){const t=a.wc(2);a.Ub(4),a.cd(" ",a.yc(5,2,"marketing.add-condition")," "),a.Ub(3),a.Dc("ngForOf",t.allFilters)}}const Ct=function(t){return{count:t}};function xt(t,e){if(1&t&&(a.mc(0,"div",38),a.ad(1),a.xc(2,"translate"),a.xc(3,"translate"),a.lc()),2&t){const t=e.$implicit;a.Ub(1),a.dd(" ",a.yc(2,2,"catalog.collection-contents")," (",a.zc(3,4,"common.results-count",a.Ic(7,Ct,t)),") ")}}const Pt=function(t){return{pattern:t}};function Ft(t,e){if(1&t){const t=a.nc();a.mc(0,"form",8),a.mc(1,"div",9),a.mc(2,"div",10),a.mc(3,"vdr-form-field",11),a.xc(4,"translate"),a.mc(5,"clr-toggle-wrapper"),a.hc(6,"input",12),a.xc(7,"hasPermission"),a.mc(8,"label",13),a.Yc(9,pt,3,3,"ng-container",14),a.Yc(10,mt,2,3,"ng-template",null,15,a.Zc),a.lc(),a.lc(),a.lc(),a.mc(12,"vdr-form-field",16),a.xc(13,"translate"),a.mc(14,"input",17),a.uc("input",(function(e){return a.Rc(t),a.wc().updateSlug(e.target.value)})),a.xc(15,"hasPermission"),a.lc(),a.lc(),a.mc(16,"vdr-form-field",18),a.xc(17,"translate"),a.xc(18,"translate"),a.hc(19,"input",19),a.xc(20,"hasPermission"),a.lc(),a.hc(21,"vdr-rich-text-editor",20),a.xc(22,"hasPermission"),a.xc(23,"translate"),a.Yc(24,ft,5,4,"section",21),a.lc(),a.mc(25,"div",22),a.mc(26,"vdr-product-assets",23),a.uc("change",(function(e){return a.Rc(t),a.wc().assetChanges=e})),a.lc(),a.lc(),a.lc(),a.mc(27,"div",24),a.mc(28,"div",10),a.mc(29,"label"),a.ad(30),a.xc(31,"translate"),a.lc(),a.Yc(32,vt,5,12,"ng-container",25),a.Yc(33,Ot,8,4,"div",26),a.lc(),a.mc(34,"div",10),a.mc(35,"vdr-collection-contents",27,28),a.Yc(37,xt,4,9,"ng-template"),a.lc(),a.lc(),a.lc(),a.lc()}if(2&t){const t=e.ngIf,c=a.Oc(11),n=a.wc();a.Dc("formGroup",n.detailForm),a.Ub(3),a.Dc("label",a.yc(4,19,"catalog.visibility")),a.Ub(3),a.Dc("vdrDisabled",!a.yc(7,21,"UpdateCatalog")),a.Ub(3),a.Dc("ngIf",n.detailForm.value.visible)("ngIfElse",c),a.Ub(3),a.Dc("label",a.yc(13,23,"common.name")),a.Ub(2),a.Dc("readonly",!a.yc(15,25,"UpdateCatalog")),a.Ub(2),a.Dc("label",a.yc(17,27,"catalog.slug"))("errors",a.Ic(39,Pt,a.yc(18,29,"catalog.slug-pattern-error"))),a.Ub(3),a.Dc("readonly",!a.yc(20,31,"UpdateCatalog")),a.Ub(2),a.Dc("readonly",!a.yc(22,33,"UpdateCatalog"))("label",a.yc(23,35,"common.description")),a.Ub(3),a.Dc("ngIf",n.customFields.length),a.Ub(2),a.Dc("assets",t.assets)("featuredAsset",t.featuredAsset),a.Ub(4),a.bd(a.yc(31,37,"catalog.filters")),a.Ub(2),a.Dc("ngForOf",n.filters),a.Ub(1),a.Dc("vdrIfPermissions","UpdateCatalog"),a.Ub(2),a.Dc("collectionId",n.id)}}const wt=function(){return["./create"]};function jt(t,e){1&t&&(a.mc(0,"a",8),a.hc(1,"clr-icon",9),a.ad(2),a.xc(3,"translate"),a.lc()),2&t&&(a.Dc("routerLink",a.Hc(4,wt)),a.Ub(2),a.cd(" ",a.yc(3,2,"catalog.create-new-collection")," "))}function Dt(t,e){if(1&t){const t=a.nc();a.mc(0,"div",10),a.ad(1),a.xc(2,"async"),a.xc(3,"translate"),a.lc(),a.mc(4,"button",11),a.uc("click",(function(){return a.Rc(t),a.wc().closeContents()})),a.hc(5,"clr-icon",12),a.lc()}if(2&t){const t=e.$implicit,c=a.wc();a.Ub(1),a.dd(" ",a.yc(2,2,c.activeCollectionTitle$)," (",a.zc(3,4,"common.results-count",a.Ic(7,Ct,t)),") ")}}function It(t,e){if(1&t){const t=a.nc();a.mc(0,"button",6),a.uc("click",(function(){return a.Rc(t),a.wc().create()})),a.ad(1),a.xc(2,"translate"),a.lc()}if(2&t){const t=a.wc();a.Dc("disabled",t.detailForm.invalid||t.detailForm.pristine),a.Ub(1),a.cd(" ",a.yc(2,2,"common.create")," ")}}function Ut(t,e){if(1&t){const t=a.nc();a.mc(0,"button",6),a.uc("click",(function(){return a.Rc(t),a.wc(2).save()})),a.ad(1),a.xc(2,"translate"),a.lc()}if(2&t){const t=a.wc(2);a.Dc("disabled",t.detailForm.invalid||t.detailForm.pristine),a.Ub(1),a.cd(" ",a.yc(2,2,"common.update")," ")}}function kt(t,e){1&t&&a.Yc(0,Ut,3,4,"button",7),2&t&&a.Dc("vdrIfPermissions","UpdateCatalog")}function Vt(t,e){1&t&&(a.kc(0),a.ad(1),a.xc(2,"translate"),a.jc()),2&t&&(a.Ub(1),a.bd(a.yc(2,1,"catalog.public")))}function Mt(t,e){1&t&&(a.ad(0),a.xc(1,"translate")),2&t&&a.bd(a.yc(1,1,"catalog.private"))}const St=function(){return["facet","customFields"]};function _t(t,e){if(1&t&&a.hc(0,"vdr-custom-field-control",24),2&t){const t=a.wc().$implicit,e=a.wc(3);a.Dc("customFieldsFormGroup",e.detailForm.get(a.Hc(2,St)))("customField",t)}}function At(t,e){if(1&t&&(a.kc(0),a.Yc(1,_t,1,3,"vdr-custom-field-control",23),a.jc()),2&t){const t=e.$implicit,c=a.wc(3);a.Ub(1),a.Dc("ngIf",c.customFieldIsSet(t.name))}}function $t(t,e){if(1&t&&(a.mc(0,"section",21),a.mc(1,"label"),a.ad(2),a.xc(3,"translate"),a.lc(),a.Yc(4,At,2,1,"ng-container",22),a.lc()),2&t){const t=a.wc(2);a.Ub(2),a.bd(a.yc(3,2,"common.custom-fields")),a.Ub(2),a.Dc("ngForOf",t.customFields)}}function Tt(t,e){if(1&t&&(a.kc(0),a.mc(1,"th"),a.ad(2),a.lc(),a.jc()),2&t){const t=e.$implicit;a.Ub(2),a.bd(t.name)}}const Yt=function(t){return["values",t,"customFields"]};function Nt(t,e){if(1&t&&a.hc(0,"vdr-custom-field-control",40),2&t){const t=a.wc().$implicit,e=a.wc().index,c=a.wc(4);a.Dc("showLabel",!1)("customFieldsFormGroup",c.detailForm.get(a.Ic(3,Yt,e)))("customField",t)}}function Rt(t,e){if(1&t&&(a.kc(0),a.mc(1,"td",31),a.Yc(2,Nt,1,5,"vdr-custom-field-control",39),a.lc(),a.jc()),2&t){const t=e.$implicit,c=a.wc().index,n=a.wc(4);a.Ub(2),a.Dc("ngIf",n.customValueFieldIsSet(c,t.name))}}function Lt(t,e){if(1&t){const t=a.nc();a.mc(0,"tr",30),a.mc(1,"td",31),a.hc(2,"vdr-entity-info",0),a.lc(),a.mc(3,"td",31),a.mc(4,"input",32),a.uc("input",(function(c){a.Rc(t);const n=e.index,i=a.wc(3).ngIf;return a.wc().updateValueCode(null==i.values[n]?null:i.values[n].code,c.target.value,n)})),a.xc(5,"hasPermission"),a.lc(),a.lc(),a.mc(6,"td",31),a.hc(7,"input",33),a.lc(),a.Yc(8,Rt,3,1,"ng-container",22),a.mc(9,"td",31),a.mc(10,"vdr-dropdown"),a.mc(11,"button",34),a.ad(12),a.xc(13,"translate"),a.hc(14,"clr-icon",35),a.lc(),a.mc(15,"vdr-dropdown-menu",36),a.mc(16,"button",37),a.uc("click",(function(){a.Rc(t);const c=e.index,n=a.wc(3).ngIf;return a.wc().deleteFacetValue(null==n.values[c]?null:n.values[c].id,c)})),a.xc(17,"hasPermission"),a.hc(18,"clr-icon",38),a.ad(19),a.xc(20,"translate"),a.lc(),a.lc(),a.lc(),a.lc(),a.lc()}if(2&t){const t=e.$implicit,c=e.index,n=a.wc(4);a.Dc("formGroupName",c),a.Ub(2),a.Dc("entity",t),a.Ub(2),a.Dc("readonly",!a.yc(5,7,"UpdateCatalog")),a.Ub(4),a.Dc("ngForOf",n.customValueFields),a.Ub(4),a.cd(" ",a.yc(13,9,"common.actions")," "),a.Ub(4),a.Dc("disabled",!a.yc(17,11,"UpdateCatalog")),a.Ub(3),a.cd(" ",a.yc(20,13,"common.delete")," ")}}function Gt(t,e){if(1&t&&(a.mc(0,"table",28),a.mc(1,"thead"),a.mc(2,"tr"),a.hc(3,"th"),a.mc(4,"th"),a.ad(5),a.xc(6,"translate"),a.lc(),a.mc(7,"th"),a.ad(8),a.xc(9,"translate"),a.lc(),a.Yc(10,Tt,3,1,"ng-container",22),a.hc(11,"th"),a.lc(),a.lc(),a.mc(12,"tbody"),a.Yc(13,Lt,21,15,"tr",29),a.lc(),a.lc()),2&t){const t=a.wc(3);a.Ub(5),a.bd(a.yc(6,4,"common.name")),a.Ub(3),a.bd(a.yc(9,6,"common.code")),a.Ub(2),a.Dc("ngForOf",t.customValueFields),a.Ub(3),a.Dc("ngForOf",t.values)}}function Et(t,e){if(1&t){const t=a.nc();a.mc(0,"button",41),a.uc("click",(function(){return a.Rc(t),a.wc(3).addFacetValue()})),a.hc(1,"clr-icon",42),a.ad(2),a.xc(3,"translate"),a.lc()}2&t&&(a.Ub(2),a.cd(" ",a.yc(3,1,"catalog.add-facet-value")," "))}function Kt(t,e){if(1&t&&(a.mc(0,"section",25),a.mc(1,"label"),a.ad(2),a.xc(3,"translate"),a.lc(),a.Yc(4,Gt,14,8,"table",26),a.mc(5,"div"),a.Yc(6,Et,4,3,"button",27),a.lc(),a.lc()),2&t){const t=a.wc(2);a.Ub(2),a.bd(a.yc(3,3,"catalog.facet-values")),a.Ub(2),a.Dc("ngIf",0<t.getValuesFormArray().length),a.Ub(2),a.Dc("vdrIfPermissions","CreateCatalog")}}function qt(t,e){if(1&t){const t=a.nc();a.mc(0,"form",8),a.mc(1,"section",9),a.mc(2,"vdr-form-field",10),a.xc(3,"translate"),a.mc(4,"clr-toggle-wrapper"),a.hc(5,"input",11),a.xc(6,"hasPermission"),a.mc(7,"label",12),a.Yc(8,Vt,3,3,"ng-container",13),a.Yc(9,Mt,2,3,"ng-template",null,14,a.Zc),a.lc(),a.lc(),a.lc(),a.mc(11,"vdr-form-field",15),a.xc(12,"translate"),a.mc(13,"input",16),a.uc("input",(function(c){a.Rc(t);const n=e.ngIf;return a.wc().updateCode(n.code,c.target.value)})),a.xc(14,"hasPermission"),a.lc(),a.lc(),a.mc(15,"vdr-form-field",17),a.xc(16,"translate"),a.xc(17,"hasPermission"),a.hc(18,"input",18),a.xc(19,"hasPermission"),a.lc(),a.Yc(20,$t,5,4,"section",19),a.lc(),a.Yc(21,Kt,7,5,"section",20),a.xc(22,"async"),a.lc()}if(2&t){const t=a.Oc(10),e=a.wc();a.Dc("formGroup",e.detailForm),a.Ub(2),a.Dc("label",a.yc(3,12,"catalog.visibility")),a.Ub(3),a.Dc("vdrDisabled",!a.yc(6,14,"UpdateCatalog")),a.Ub(3),a.Dc("ngIf",e.detailForm.value.facet.visible)("ngIfElse",t),a.Ub(3),a.Dc("label",a.yc(12,16,"common.name")),a.Ub(2),a.Dc("readonly",!a.yc(14,18,"UpdateCatalog")),a.Ub(2),a.Dc("label",a.yc(16,20,"common.code"))("readOnlyToggle",a.yc(17,22,"UpdateCatalog")),a.Ub(3),a.Dc("readonly",!a.yc(19,24,"UpdateCatalog")),a.Ub(2),a.Dc("ngIf",e.customFields.length),a.Ub(1),a.Dc("ngIf",!a.yc(22,26,e.isNew$))}}function Bt(t,e){1&t&&(a.mc(0,"a",4),a.hc(1,"clr-icon",5),a.ad(2),a.xc(3,"translate"),a.lc()),2&t&&(a.Dc("routerLink",a.Hc(4,wt)),a.Ub(2),a.cd(" ",a.yc(3,2,"catalog.create-new-facet")," "))}function zt(t,e){if(1&t&&a.hc(0,"vdr-facet-value-chip",18),2&t){const t=e.$implicit;a.Dc("facetValue",t)("removable",!1)("displayFacetName",!1)}}function Xt(t,e){if(1&t&&(a.kc(0),a.hc(1,"clr-icon",5),a.ad(2),a.jc()),2&t){const t=a.wc(2).item,e=a.wc();a.Ub(2),a.cd(" ",t.values.length-e.initialLimit," ")}}function Ht(t,e){1&t&&a.hc(0,"clr-icon",21)}function Zt(t,e){if(1&t){const t=a.nc();a.mc(0,"button",19),a.uc("click",(function(){a.Rc(t);const e=a.wc().item;return a.wc().toggleDisplayLimit(e)})),a.Yc(1,Xt,3,1,"ng-container",9),a.Yc(2,Ht,1,0,"ng-template",null,20,a.Zc),a.lc()}if(2&t){const t=a.Oc(3),e=a.wc().item,c=a.wc();a.Ub(1),a.Dc("ngIf",(c.displayLimit[e.id]||0)<e.values.length)("ngIfElse",t)}}function Qt(t,e){1&t&&(a.kc(0),a.ad(1),a.xc(2,"translate"),a.jc()),2&t&&(a.Ub(1),a.bd(a.yc(2,1,"catalog.public")))}function Wt(t,e){1&t&&(a.ad(0),a.xc(1,"translate")),2&t&&a.bd(a.yc(1,1,"catalog.private"))}const Jt=function(t){return["./",t]};function te(t,e){if(1&t){const t=a.nc();a.mc(0,"td",6),a.ad(1),a.lc(),a.mc(2,"td",6),a.ad(3),a.lc(),a.mc(4,"td",6),a.Yc(5,zt,1,3,"vdr-facet-value-chip",7),a.xc(6,"slice"),a.Yc(7,Zt,4,2,"button",8),a.lc(),a.mc(8,"td",6),a.mc(9,"vdr-chip"),a.Yc(10,Qt,3,3,"ng-container",9),a.Yc(11,Wt,2,3,"ng-template",null,10,a.Zc),a.lc(),a.lc(),a.mc(13,"td",11),a.hc(14,"vdr-table-row-action",12),a.xc(15,"translate"),a.lc(),a.mc(16,"td",11),a.mc(17,"vdr-dropdown"),a.mc(18,"button",13),a.ad(19),a.xc(20,"translate"),a.hc(21,"clr-icon",14),a.lc(),a.mc(22,"vdr-dropdown-menu",15),a.mc(23,"button",16),a.uc("click",(function(){a.Rc(t);const c=e.item;return a.wc().deleteFacet(c.id)})),a.xc(24,"hasPermission"),a.hc(25,"clr-icon",17),a.ad(26),a.xc(27,"translate"),a.lc(),a.lc(),a.lc(),a.lc()}if(2&t){const t=e.item,c=a.Oc(12),n=a.wc();a.Xb("private",t.isPrivate),a.Ub(1),a.bd(t.code),a.Ub(1),a.Xb("private",t.isPrivate),a.Ub(1),a.bd(t.name),a.Ub(1),a.Xb("private",t.isPrivate),a.Ub(1),a.Dc("ngForOf",a.Ac(6,23,t.values,0,n.displayLimit[t.id]||3)),a.Ub(2),a.Dc("ngIf",t.values.length>n.initialLimit),a.Ub(1),a.Xb("private",t.isPrivate),a.Ub(2),a.Dc("ngIf",!t.isPrivate)("ngIfElse",c),a.Ub(3),a.Xb("private",t.isPrivate),a.Ub(1),a.Dc("label",a.yc(15,27,"common.edit"))("linkTo",a.Ic(35,Jt,t.id)),a.Ub(2),a.Xb("private",t.isPrivate),a.Ub(3),a.cd(" ",a.yc(20,29,"common.actions")," "),a.Ub(4),a.Dc("disabled",!a.yc(24,31,"DeleteCatalog")),a.Ub(3),a.cd(" ",a.yc(27,33,"common.delete")," ")}}function ee(t,e){1&t&&(a.ad(0),a.xc(1,"translate")),2&t&&a.bd(a.yc(1,1,"catalog.add-facets"))}function ce(t,e){if(1&t){const t=a.nc();a.mc(0,"button",3),a.uc("click",(function(){return a.Rc(t),a.wc().cancel()})),a.ad(1),a.xc(2,"translate"),a.lc(),a.mc(3,"button",4),a.uc("click",(function(){return a.Rc(t),a.wc().selectValues()})),a.ad(4),a.xc(5,"translate"),a.lc()}if(2&t){const t=a.wc();a.Ub(1),a.bd(a.yc(2,3,"common.cancel")),a.Ub(2),a.Dc("disabled",0===t.selectedValues.length),a.Ub(1),a.cd(" ",a.yc(5,5,"catalog.add-facets")," ")}}function ne(t,e){1&t&&(a.ad(0),a.xc(1,"translate")),2&t&&a.bd(a.yc(1,1,"catalog.assign-products-to-channel"))}const ae=function(t){return{channel:t}};function ie(t,e){if(1&t&&(a.ad(0),a.xc(1,"translate")),2&t){const t=a.wc();a.cd(" ",a.zc(1,1,"catalog.price-in-channel",a.Ic(4,ae,null==t.selectedChannel?null:t.selectedChannel.code))," ")}}function oe(t,e){1&t&&(a.ad(0),a.xc(1,"translate")),2&t&&a.cd(" ",a.yc(1,1,"catalog.no-channel-selected")," ")}function re(t,e){if(1&t&&(a.ad(0),a.xc(1,"currency")),2&t){const t=a.wc().$implicit,e=a.wc();a.cd(" ",a.zc(1,1,t.pricePreview/100,null==e.selectedChannel?null:e.selectedChannel.currencyCode)," ")}}function se(t,e){1&t&&a.ad(0," - ")}function le(t,e){if(1&t&&(a.mc(0,"tr"),a.mc(1,"td"),a.ad(2),a.lc(),a.mc(3,"td"),a.ad(4),a.xc(5,"currency"),a.lc(),a.mc(6,"td"),a.Yc(7,re,2,4,"ng-template",8),a.Yc(8,se,1,0,"ng-template",null,12,a.Zc),a.lc(),a.lc()),2&t){const t=e.$implicit,c=a.Oc(9),n=a.wc();a.Ub(2),a.bd(t.name),a.Ub(2),a.bd(a.zc(5,4,t.price/100,null==n.currentChannel?null:n.currentChannel.currencyCode)),a.Ub(3),a.Dc("ngIf",n.selectedChannel)("ngIfElse",c)}}const de=function(t){return{channelCode:t}};function ue(t,e){if(1&t&&(a.ad(0),a.xc(1,"translate")),2&t){const t=a.wc(2);a.cd(" ",a.zc(1,1,"catalog.assign-to-named-channel",a.Ic(4,de,null==t.selectedChannel?null:t.selectedChannel.code))," ")}}function pe(t,e){1&t&&(a.ad(0),a.xc(1,"translate")),2&t&&a.cd(" ",a.yc(1,1,"catalog.no-channel-selected")," ")}function me(t,e){if(1&t){const t=a.nc();a.mc(0,"button",13),a.uc("click",(function(){return a.Rc(t),a.wc().cancel()})),a.ad(1),a.xc(2,"translate"),a.lc(),a.mc(3,"button",14),a.uc("click",(function(){return a.Rc(t),a.wc().assign()})),a.Yc(4,ue,2,6,"ng-template",8),a.Yc(5,pe,2,3,"ng-template",null,9,a.Zc),a.lc()}if(2&t){const t=a.Oc(6),e=a.wc();a.Ub(1),a.bd(a.yc(2,4,"common.cancel")),a.Ub(2),a.Dc("disabled",!e.selectedChannel),a.Ub(1),a.Dc("ngIf",e.selectedChannel)("ngIfElse",t)}}const ge=function(){return["product","enabled"]};function be(t,e){if(1&t&&(a.mc(0,"clr-toggle-wrapper"),a.hc(1,"input",8),a.mc(2,"label"),a.ad(3),a.xc(4,"translate"),a.lc(),a.lc()),2&t){const t=a.wc();a.Ub(1),a.Dc("formControl",t.detailForm.get(a.Hc(4,ge))),a.Ub(2),a.bd(a.yc(4,2,"common.enabled"))}}function he(t,e){if(1&t){const t=a.nc();a.mc(0,"button",9),a.uc("click",(function(){return a.Rc(t),a.wc().create()})),a.ad(1),a.xc(2,"translate"),a.lc()}if(2&t){const t=a.wc();a.Dc("disabled",t.detailForm.invalid||t.detailForm.pristine||!t.variantsToCreateAreValid()),a.Ub(1),a.cd(" ",a.yc(2,2,"common.create")," ")}}function fe(t,e){if(1&t){const t=a.nc();a.mc(0,"button",9),a.uc("click",(function(){return a.Rc(t),a.wc(2).save()})),a.ad(1),a.xc(2,"translate"),a.lc()}if(2&t){const t=a.wc(2);a.Dc("disabled",(t.detailForm.invalid||t.detailForm.pristine)&&!t.assetsChanged()&&!t.variantAssetsChanged()),a.Ub(1),a.cd(" ",a.yc(2,2,"common.update")," ")}}function ve(t,e){1&t&&a.Yc(0,fe,3,4,"button",10),2&t&&a.Dc("vdrIfPermissions","UpdateCatalog")}function ye(t,e){if(1&t){const t=a.nc();a.mc(0,"vdr-chip",38),a.uc("iconClick",(function(){a.Rc(t);const e=a.wc().$implicit;return a.wc(5).removeFromChannel(e.id)})),a.hc(1,"vdr-channel-badge",39),a.ad(2),a.xc(3,"channelCodeToLabel"),a.lc()}if(2&t){const t=a.wc().$implicit;a.Ub(1),a.Dc("channelCode",t.code),a.Ub(1),a.cd(" ",a.yc(3,2,t.code)," ")}}function Oe(t,e){if(1&t&&(a.kc(0),a.Yc(1,ye,4,4,"vdr-chip",37),a.jc()),2&t){const t=e.$implicit,c=a.wc(5);a.Ub(1),a.Dc("ngIf",!c.isDefaultChannel(t.code))}}function Ce(t,e){if(1&t){const t=a.nc();a.mc(0,"vdr-form-item",31),a.xc(1,"translate"),a.mc(2,"div",32),a.mc(3,"div",33),a.Yc(4,Oe,2,1,"ng-container",34),a.xc(5,"async"),a.lc(),a.mc(6,"button",35),a.uc("click",(function(){return a.Rc(t),a.wc(4).assignToChannel()})),a.hc(7,"clr-icon",36),a.ad(8),a.xc(9,"translate"),a.lc(),a.lc(),a.lc()}if(2&t){const t=a.wc(4);a.Dc("label",a.yc(1,3,"common.channels")),a.Ub(4),a.Dc("ngForOf",a.yc(5,5,t.productChannels$)),a.Ub(4),a.cd(" ",a.yc(9,7,"catalog.assign-to-channel")," ")}}function xe(t,e){1&t&&(a.kc(0),a.Yc(1,Ce,10,9,"vdr-form-item",30),a.jc())}const Pe=function(){return["product","customFields"]};function Fe(t,e){if(1&t&&(a.hc(0,"vdr-custom-field-control",42),a.xc(1,"hasPermission")),2&t){const t=a.wc().$implicit,e=a.wc(4);a.Dc("customFieldsFormGroup",e.detailForm.get(a.Hc(5,Pe)))("customField",t)("readonly",!a.yc(1,3,"UpdateCatalog"))}}function we(t,e){if(1&t&&(a.kc(0),a.Yc(1,Fe,2,6,"vdr-custom-field-control",41),a.jc()),2&t){const t=e.$implicit,c=a.wc(4);a.Ub(1),a.Dc("ngIf",c.customFieldIsSet(t.name))}}function je(t,e){if(1&t&&(a.mc(0,"section",40),a.mc(1,"label"),a.ad(2),a.xc(3,"translate"),a.lc(),a.Yc(4,we,2,1,"ng-container",34),a.lc()),2&t){const t=a.wc(3);a.Ub(2),a.bd(a.yc(3,2,"common.custom-fields")),a.Ub(2),a.Dc("ngForOf",t.customFields)}}function De(t,e){if(1&t){const t=a.nc();a.mc(0,"vdr-facet-value-chip",43),a.uc("remove",(function(){a.Rc(t);const c=e.$implicit;return a.wc(3).removeProductFacetValue(c.id)})),a.xc(1,"hasPermission"),a.lc()}if(2&t){const t=e.$implicit;a.Dc("facetValue",t)("removable",a.yc(1,2,"UpdateCatalog"))}}function Ie(t,e){if(1&t){const t=a.nc();a.mc(0,"button",44),a.uc("click",(function(){return a.Rc(t),a.wc(3).selectProductFacetValue()})),a.hc(1,"clr-icon",45),a.ad(2),a.xc(3,"translate"),a.lc()}2&t&&(a.Ub(2),a.cd(" ",a.yc(3,1,"catalog.add-facets")," "))}function Ue(t,e){if(1&t){const t=a.nc();a.mc(0,"div"),a.mc(1,"h4"),a.ad(2),a.xc(3,"translate"),a.lc(),a.mc(4,"vdr-generate-product-variants",46),a.uc("variantsChange",(function(e){return a.Rc(t),a.wc(3).createVariantsConfig=e})),a.lc(),a.lc()}2&t&&(a.Ub(2),a.bd(a.yc(3,1,"catalog.product-variants")))}function ke(t,e){if(1&t){const t=a.nc();a.mc(0,"clr-tab-content"),a.mc(1,"div",15),a.mc(2,"div",16),a.mc(3,"section",17),a.Yc(4,xe,2,0,"ng-container",18),a.mc(5,"vdr-form-field",19),a.xc(6,"translate"),a.mc(7,"input",20),a.uc("input",(function(e){return a.Rc(t),a.wc(2).updateSlug(e.target.value)})),a.xc(8,"hasPermission"),a.lc(),a.lc(),a.mc(9,"vdr-form-field",21),a.xc(10,"translate"),a.xc(11,"translate"),a.hc(12,"input",22),a.xc(13,"hasPermission"),a.lc(),a.hc(14,"vdr-rich-text-editor",23),a.xc(15,"hasPermission"),a.xc(16,"translate"),a.Yc(17,je,5,4,"section",24),a.mc(18,"div",25),a.Yc(19,De,2,4,"vdr-facet-value-chip",26),a.xc(20,"async"),a.Yc(21,Ie,4,3,"button",27),a.lc(),a.lc(),a.lc(),a.mc(22,"div",28),a.mc(23,"vdr-product-assets",29),a.uc("change",(function(e){return a.Rc(t),a.wc(2).assetChanges=e})),a.lc(),a.lc(),a.lc(),a.Yc(24,Ue,5,3,"div",14),a.xc(25,"async"),a.lc()}if(2&t){const t=a.wc().ngIf,e=a.wc();a.Ub(5),a.Dc("label",a.yc(6,13,"catalog.product-name")),a.Ub(2),a.Dc("readonly",!a.yc(8,15,"UpdateCatalog")),a.Ub(2),a.Dc("label",a.yc(10,17,"catalog.slug"))("errors",a.Ic(31,Pt,a.yc(11,19,"catalog.slug-pattern-error"))),a.Ub(3),a.Dc("readonly",!a.yc(13,21,"UpdateCatalog")),a.Ub(2),a.Dc("readonly",!a.yc(15,23,"UpdateCatalog"))("label",a.yc(16,25,"common.description")),a.Ub(3),a.Dc("ngIf",e.customFields.length),a.Ub(2),a.Dc("ngForOf",a.yc(20,27,e.facetValues$)),a.Ub(2),a.Dc("vdrIfPermissions","UpdateCatalog"),a.Ub(2),a.Dc("assets",t.assets)("featuredAsset",t.featuredAsset),a.Ub(1),a.Dc("ngIf",a.yc(25,29,e.isNew$))}}const Ve=function(){return["./","manage-variants"]};function Me(t,e){1&t&&(a.mc(0,"a",58),a.hc(1,"clr-icon",59),a.ad(2),a.xc(3,"translate"),a.lc()),2&t&&(a.Dc("routerLink",a.Hc(4,Ve)),a.Ub(2),a.cd(" ",a.yc(3,2,"catalog.manage-variants")," "))}function Se(t,e){if(1&t&&(a.hc(0,"vdr-product-variants-table",60),a.xc(1,"async")),2&t){const t=a.wc(3).ngIf,e=a.wc();a.Dc("variants",a.yc(1,3,e.variants$))("optionGroups",t.optionGroups)("productVariantsFormArray",e.detailForm.get("variants"))}}function _e(t,e){if(1&t){const t=a.nc();a.mc(0,"vdr-product-variants-list",61),a.uc("assetChange",(function(e){return a.Rc(t),a.wc(4).variantAssetChange(e)}))("updateProductOption",(function(e){return a.Rc(t),a.wc(4).updateProductOption(e)}))("selectionChange",(function(e){return a.Rc(t),a.wc(4).selectedVariantIds=e}))("selectFacetValueClick",(function(e){return a.Rc(t),a.wc(4).selectVariantFacetValue(e)})),a.xc(1,"async"),a.xc(2,"async"),a.xc(3,"async"),a.xc(4,"async"),a.lc()}if(2&t){const t=a.wc(3).ngIf,e=a.wc();a.Dc("variants",a.yc(1,8,e.variants$))("facets",a.yc(2,10,e.facets$))("optionGroups",t.optionGroups)("productVariantsFormArray",e.detailForm.get("variants"))("taxCategories",a.yc(3,12,e.taxCategories$))("customFields",e.customVariantFields)("customOptionFields",e.customOptionFields)("activeLanguage",a.yc(4,14,e.languageCode$))}}function Ae(t,e){if(1&t){const t=a.nc();a.mc(0,"clr-tab-content"),a.mc(1,"section",47),a.mc(2,"div",48),a.mc(3,"div",49),a.mc(4,"button",50),a.uc("click",(function(){return a.Rc(t),a.wc(3).variantDisplayMode="card"})),a.hc(5,"clr-icon",51),a.ad(6),a.xc(7,"translate"),a.lc(),a.mc(8,"button",52),a.uc("click",(function(){return a.Rc(t),a.wc(3).variantDisplayMode="table"})),a.hc(9,"clr-icon",53),a.ad(10),a.xc(11,"translate"),a.lc(),a.lc(),a.hc(12,"div",54),a.Yc(13,Me,4,5,"a",55),a.lc(),a.Yc(14,Se,2,5,"vdr-product-variants-table",56),a.Yc(15,_e,5,16,"vdr-product-variants-list",57),a.lc(),a.lc()}if(2&t){const t=a.wc(3);a.Ub(4),a.Xb("btn-primary","card"===t.variantDisplayMode),a.Ub(2),a.cd(" ",a.yc(7,9,"catalog.display-variant-cards")," "),a.Ub(2),a.Xb("btn-primary","table"===t.variantDisplayMode),a.Ub(2),a.cd(" ",a.yc(11,11,"catalog.display-variant-table")," "),a.Ub(3),a.Dc("vdrIfPermissions","UpdateCatalog"),a.Ub(1),a.Dc("ngIf","table"===t.variantDisplayMode),a.Ub(1),a.Dc("ngIf","card"===t.variantDisplayMode)}}function $e(t,e){if(1&t){const t=a.nc();a.mc(0,"clr-tab"),a.mc(1,"button",12),a.uc("click",(function(){return a.Rc(t),a.wc(2).navigateToTab("variants")})),a.ad(2),a.xc(3,"translate"),a.lc(),a.Yc(4,Ae,16,13,"clr-tab-content",13),a.xc(5,"async"),a.lc()}if(2&t){const t=a.wc(2);a.Ub(2),a.cd(" ",a.yc(3,2,"catalog.product-variants")," "),a.Ub(2),a.Dc("clrIfActive","variants"===a.yc(5,4,t.activeTab$))}}function Te(t,e){if(1&t){const t=a.nc();a.mc(0,"form",11),a.uc("keydown.enter",(function(e){return a.Rc(t),e.preventDefault()})),a.mc(1,"clr-tabs"),a.mc(2,"clr-tab"),a.mc(3,"button",12),a.uc("click",(function(){return a.Rc(t),a.wc().navigateToTab("details")})),a.ad(4),a.xc(5,"translate"),a.lc(),a.Yc(6,ke,26,33,"clr-tab-content",13),a.xc(7,"async"),a.lc(),a.Yc(8,$e,6,6,"clr-tab",14),a.xc(9,"async"),a.lc(),a.lc()}if(2&t){const t=a.wc();a.Dc("formGroup",t.detailForm),a.Ub(4),a.cd(" ",a.yc(5,4,"catalog.product-details")," "),a.Ub(2),a.Dc("clrIfActive","details"===a.yc(7,6,t.activeTab$)),a.Ub(2),a.Dc("ngIf",!a.yc(9,8,t.isNew$))}}const Ye=["selectComponent"];function Ne(t,e){if(1&t){const t=a.nc();a.mc(0,"div",6),a.uc("click",(function(){return a.Rc(t),a.wc(2),a.Oc(1).selectTag()})),a.ad(1),a.xc(2,"translate"),a.lc()}if(2&t){const t=a.wc(2),e=a.Oc(1);a.Xb("selected",t.isSearchHeaderSelected()),a.Ub(1),a.dd(" ",a.yc(2,4,"catalog.search-for-term"),": ",e.searchTerm," ")}}function Re(t,e){if(1&t&&a.Yc(0,Ne,3,6,"div",5),2&t){a.wc();const t=a.Oc(1);a.Dc("ngIf",t.searchTerm)}}function Le(t,e){if(1&t){const t=a.nc();a.kc(0),a.mc(1,"vdr-facet-value-chip",8),a.uc("remove",(function(){a.Rc(t);const e=a.wc(),c=e.item;return(0,e.clear)(c)})),a.lc(),a.jc()}if(2&t){const t=a.wc().item;a.Ub(1),a.Dc("facetValue",t.facetValue)("removable",!0)}}function Ge(t,e){if(1&t){const t=a.nc();a.kc(0),a.mc(1,"vdr-chip",9),a.uc("iconClick",(function(){a.Rc(t);const e=a.wc(),c=e.item;return(0,e.clear)(c)})),a.ad(2),a.lc(),a.jc()}if(2&t){const t=a.wc().item;a.Ub(1),a.Dc("icon","times"),a.Ub(1),a.cd('"',t.label,'"')}}function Ee(t,e){if(1&t&&(a.Yc(0,Le,2,2,"ng-container",7),a.Yc(1,Ge,3,2,"ng-container",7)),2&t){const t=e.item;a.Dc("ngIf",t.facetValue),a.Ub(1),a.Dc("ngIf",!t.facetValue)}}function Ke(t,e){if(1&t&&(a.kc(0),a.hc(1,"vdr-facet-value-chip",10),a.jc()),2&t){const t=a.wc().item;a.Ub(1),a.Dc("facetValue",t.facetValue)("removable",!1)}}function qe(t,e){if(1&t&&a.Yc(0,Ke,2,2,"ng-container",7),2&t){const t=e.item;a.Dc("ngIf",t.facetValue)}}const Be=["productSearchInputComponent"];function ze(t,e){1&t&&(a.mc(0,"a",13),a.hc(1,"clr-icon",14),a.mc(2,"span",15),a.ad(3),a.xc(4,"translate"),a.lc(),a.lc()),2&t&&(a.Dc("routerLink",a.Hc(4,wt)),a.Ub(3),a.bd(a.yc(4,2,"catalog.create-new-product")))}function Xe(t,e){if(1&t&&(a.hc(0,"img",28),a.xc(1,"assetPreview")),2&t){const t=e.ngIf;a.Dc("src",a.zc(1,1,t,"tiny"),a.Tc)}}function He(t,e){1&t&&(a.mc(0,"div",29),a.hc(1,"clr-icon",30),a.lc())}function Ze(t,e){1&t&&(a.mc(0,"vdr-chip"),a.ad(1),a.xc(2,"translate"),a.lc()),2&t&&(a.Ub(1),a.bd(a.yc(2,1,"common.disabled")))}function Qe(t,e){if(1&t){const t=a.nc();a.mc(0,"td",16),a.mc(1,"div",17),a.Yc(2,Xe,2,4,"img",18),a.Yc(3,He,2,0,"ng-template",null,19,a.Zc),a.lc(),a.lc(),a.mc(5,"td",16),a.ad(6),a.lc(),a.mc(7,"td",20),a.Yc(8,Ze,3,3,"vdr-chip",21),a.lc(),a.mc(9,"td",22),a.hc(10,"vdr-table-row-action",23),a.xc(11,"translate"),a.lc(),a.mc(12,"td",22),a.mc(13,"vdr-dropdown"),a.mc(14,"button",24),a.ad(15),a.xc(16,"translate"),a.hc(17,"clr-icon",25),a.lc(),a.mc(18,"vdr-dropdown-menu",7),a.mc(19,"button",26),a.uc("click",(function(){a.Rc(t);const c=e.item;return a.wc().deleteProduct(c.productId)})),a.xc(20,"hasPermission"),a.hc(21,"clr-icon",27),a.ad(22),a.xc(23,"translate"),a.lc(),a.lc(),a.lc(),a.lc()}if(2&t){const t=e.item,c=a.Oc(4),n=a.wc();a.Xb("disabled",!t.enabled),a.Ub(2),a.Dc("ngIf",n.groupByProduct?t.productAsset:t.productVariantAsset||t.productAsset)("ngIfElse",c),a.Ub(3),a.Xb("disabled",!t.enabled),a.Ub(1),a.cd(" ",n.groupByProduct?t.productName:t.productVariantName," "),a.Ub(1),a.Xb("disabled",!t.enabled),a.Ub(1),a.Dc("ngIf",!t.enabled),a.Ub(1),a.Xb("disabled",!t.enabled),a.Ub(1),a.Dc("label",a.yc(11,19,"common.edit"))("linkTo",a.Ic(27,Jt,t.productId)),a.Ub(2),a.Xb("disabled",!t.enabled),a.Ub(3),a.cd(" ",a.yc(16,21,"common.actions")," "),a.Ub(4),a.Dc("disabled",!a.yc(20,23,"DeleteCatalog")),a.Ub(3),a.cd(" ",a.yc(23,25,"common.delete")," ")}}function We(t,e){if(1&t){const t=a.nc();a.mc(0,"div",6),a.mc(1,"div",7),a.mc(2,"label"),a.ad(3),a.xc(4,"translate"),a.lc(),a.mc(5,"input",8),a.uc("ngModelChange",(function(c){return a.Rc(t),e.$implicit.name=c})),a.lc(),a.lc(),a.mc(6,"div",9),a.mc(7,"label"),a.ad(8),a.xc(9,"translate"),a.lc(),a.mc(10,"vdr-option-value-input",10,11),a.uc("ngModelChange",(function(c){return a.Rc(t),e.$implicit.values=c}))("ngModelChange",(function(){return a.Rc(t),a.wc().generateVariants()})),a.lc(),a.lc(),a.lc()}if(2&t){const t=e.$implicit;a.Ub(3),a.bd(a.yc(4,7,"catalog.option")),a.Ub(2),a.Dc("ngModel",t.name)("readonly",!t.isNew),a.Ub(3),a.bd(a.yc(9,9,"catalog.option-values")),a.Ub(2),a.Dc("ngModel",t.values)("groupName",t.name)("disabled",""===t.name)}}function Je(t,e){if(1&t){const t=a.nc();a.mc(0,"button",12),a.uc("click",(function(){return a.Rc(t),a.wc().addOption()})),a.hc(1,"clr-icon",13),a.ad(2),a.xc(3,"translate"),a.lc()}2&t&&(a.Ub(2),a.cd(" ",a.yc(3,1,"catalog.add-option"),"\n"))}function tc(t,e){if(1&t){const t=a.nc();a.mc(0,"input",16),a.uc("ngModelChange",(function(e){a.Rc(t);const c=a.wc().$implicit;return a.wc().variantFormValues[c.id].enabled=e}))("ngModelChange",(function(){return a.Rc(t),a.wc(2).formValueChanged=!0})),a.lc()}if(2&t){const t=a.wc().$implicit,e=a.wc();a.Dc("ngModel",e.variantFormValues[t.id].enabled)}}function ec(t,e){if(1&t){const t=a.nc();a.mc(0,"clr-input-container"),a.mc(1,"input",17),a.uc("ngModelChange",(function(e){a.Rc(t);const c=a.wc().$implicit;return a.wc().variantFormValues[c.id].sku=e}))("ngModelChange",(function(){a.Rc(t);const e=a.wc().$implicit,c=a.wc();return c.onFormChanged(c.variantFormValues[e.id])})),a.xc(2,"translate"),a.lc(),a.lc()}if(2&t){const t=a.wc().$implicit,e=a.wc();a.Ub(1),a.Dc("ngModel",e.variantFormValues[t.id].sku)("placeholder",a.yc(2,2,"catalog.sku"))}}function cc(t,e){if(1&t&&(a.mc(0,"span"),a.ad(1),a.lc()),2&t){const t=a.wc().$implicit,e=a.wc();a.Ub(1),a.bd(e.variantFormValues[t.id].sku)}}function nc(t,e){if(1&t){const t=a.nc();a.mc(0,"clr-input-container"),a.mc(1,"vdr-currency-input",18),a.uc("ngModelChange",(function(e){a.Rc(t);const c=a.wc().$implicit;return a.wc().variantFormValues[c.id].price=e}))("ngModelChange",(function(){a.Rc(t);const e=a.wc().$implicit,c=a.wc();return c.onFormChanged(c.variantFormValues[e.id])})),a.lc(),a.lc()}if(2&t){const t=a.wc().$implicit,e=a.wc();a.Ub(1),a.Dc("ngModel",e.variantFormValues[t.id].price)("currencyCode",e.currencyCode)}}function ac(t,e){if(1&t&&(a.mc(0,"span"),a.ad(1),a.xc(2,"currency"),a.lc()),2&t){const t=a.wc().$implicit,e=a.wc();a.Ub(1),a.bd(a.zc(2,1,e.variantFormValues[t.id].price/100,e.currencyCode))}}function ic(t,e){if(1&t){const t=a.nc();a.mc(0,"clr-input-container"),a.mc(1,"input",19),a.uc("ngModelChange",(function(e){a.Rc(t);const c=a.wc().$implicit;return a.wc().variantFormValues[c.id].stock=e}))("ngModelChange",(function(){a.Rc(t);const e=a.wc().$implicit,c=a.wc();return c.onFormChanged(c.variantFormValues[e.id])})),a.lc(),a.lc()}if(2&t){const t=a.wc().$implicit,e=a.wc();a.Ub(1),a.Dc("ngModel",e.variantFormValues[t.id].stock)}}function oc(t,e){if(1&t&&(a.mc(0,"span"),a.ad(1),a.lc()),2&t){const t=a.wc().$implicit,e=a.wc();a.Ub(1),a.bd(e.variantFormValues[t.id].stock)}}function rc(t,e){if(1&t){const t=a.nc();a.mc(0,"vdr-dropdown"),a.mc(1,"button",20),a.hc(2,"clr-icon",21),a.lc(),a.mc(3,"vdr-dropdown-menu",22),a.mc(4,"button",23),a.uc("click",(function(){a.Rc(t);const c=e.ngIf;return a.wc(2).deleteVariant(c)})),a.hc(5,"clr-icon",24),a.ad(6),a.xc(7,"translate"),a.lc(),a.lc(),a.lc()}2&t&&(a.Ub(6),a.cd(" ",a.yc(7,1,"common.delete")," "))}function sc(t,e){if(1&t&&(a.mc(0,"tr"),a.mc(1,"td"),a.Yc(2,tc,1,1,"input",14),a.lc(),a.mc(3,"td"),a.ad(4),a.lc(),a.mc(5,"td"),a.Yc(6,ec,3,4,"clr-input-container",15),a.Yc(7,cc,2,1,"span",15),a.lc(),a.mc(8,"td"),a.Yc(9,nc,2,2,"clr-input-container",15),a.Yc(10,ac,3,4,"span",15),a.lc(),a.mc(11,"td"),a.Yc(12,ic,2,1,"clr-input-container",15),a.Yc(13,oc,2,1,"span",15),a.lc(),a.mc(14,"td"),a.Yc(15,rc,8,3,"vdr-dropdown",15),a.lc(),a.lc()),2&t){const t=e.$implicit,c=a.wc();a.Xb("disabled",!c.variantFormValues[t.id].enabled||c.variantFormValues[t.id].existing),a.Ub(2),a.Dc("ngIf",!c.variantFormValues[t.id].existing),a.Ub(2),a.cd(" ",c.getVariantName(t)," "),a.Ub(2),a.Dc("ngIf",!c.variantFormValues[t.id].existing),a.Ub(1),a.Dc("ngIf",c.variantFormValues[t.id].existing),a.Ub(2),a.Dc("ngIf",!c.variantFormValues[t.id].existing),a.Ub(1),a.Dc("ngIf",c.variantFormValues[t.id].existing),a.Ub(2),a.Dc("ngIf",!c.variantFormValues[t.id].existing),a.Ub(1),a.Dc("ngIf",c.variantFormValues[t.id].existing),a.Ub(2),a.Dc("ngIf",c.variantFormValues[t.id].productVariantId)}}function lc(t,e){if(1&t&&a.hc(0,"vdr-collection-tree-node",1),2&t){const t=a.wc();a.Dc("expandAll",t.expandAll)("collectionTree",t.collectionTree)("activeCollectionId",t.activeCollectionId)}}function dc(t,e){1&t&&a.hc(0,"clr-icon",31)}function uc(t,e){1&t&&a.hc(0,"clr-icon",32)}function pc(t,e){if(1&t){const t=a.nc();a.mc(0,"button",28),a.uc("click",(function(){a.Rc(t);const e=a.wc().$implicit;return e.expanded=!e.expanded})),a.Yc(1,dc,1,0,"clr-icon",29),a.Yc(2,uc,1,0,"clr-icon",30),a.lc()}if(2&t){const t=a.wc().$implicit,e=a.wc();a.Dc("disabled",e.expandAll),a.Ub(1),a.Dc("ngIf",!t.expanded&&!e.expandAll),a.Ub(1),a.Dc("ngIf",t.expanded||e.expandAll)}}function mc(t,e){1&t&&a.hc(0,"div",33)}function gc(t,e){1&t&&(a.mc(0,"vdr-chip"),a.ad(1),a.xc(2,"translate"),a.lc()),2&t&&(a.Ub(1),a.bd(a.yc(2,1,"catalog.private")))}function bc(t,e){1&t&&(a.mc(0,"div",34),a.hc(1,"clr-icon",35),a.lc())}const hc=function(t){return{parentId:t}},fc=function(t){return["./","create",t]};function vc(t,e){if(1&t&&(a.mc(0,"a",36),a.hc(1,"clr-icon",37),a.ad(2),a.xc(3,"translate"),a.lc()),2&t){const t=a.wc().$implicit;a.Dc("routerLink",a.Ic(6,fc,a.Ic(4,hc,t.id))),a.Ub(2),a.cd(" ",a.yc(3,2,"catalog.create-new-collection")," ")}}function yc(t,e){if(1&t){const t=a.nc();a.mc(0,"button",20),a.uc("click",(function(){a.Rc(t);const c=e.$implicit,n=a.wc().$implicit;return a.wc().move(n,c.id)})),a.xc(1,"async"),a.hc(2,"clr-icon",38),a.ad(3),a.lc()}if(2&t){const t=e.$implicit,c=a.wc(2);a.Dc("disabled",!a.yc(1,2,c.hasUpdatePermission$)),a.Ub(3),a.cd(" ",t.path," ")}}function Oc(t,e){if(1&t&&a.hc(0,"vdr-collection-tree-node",39),2&t){const t=a.wc().$implicit,e=a.wc();a.Dc("expandAll",e.expandAll)("collectionTree",t)("activeCollectionId",e.activeCollectionId)}}const Cc=function(t){return{contents:t}},xc=function(t){return["/catalog/collections/",t]};function Pc(t,e){if(1&t){const t=a.nc();a.mc(0,"div",3),a.mc(1,"div",4),a.mc(2,"div",5),a.Yc(3,pc,3,3,"button",6),a.Yc(4,mc,1,0,"ng-template",null,7,a.Zc),a.ad(6),a.lc(),a.hc(7,"div",8),a.Yc(8,gc,3,3,"vdr-chip",9),a.mc(9,"a",10),a.hc(10,"clr-icon",11),a.ad(11),a.xc(12,"translate"),a.lc(),a.mc(13,"a",12),a.hc(14,"clr-icon",13),a.ad(15),a.xc(16,"translate"),a.lc(),a.Yc(17,bc,2,0,"div",14),a.mc(18,"vdr-dropdown"),a.mc(19,"button",15),a.hc(20,"clr-icon",16),a.lc(),a.mc(21,"vdr-dropdown-menu",17),a.Yc(22,vc,4,8,"a",18),a.hc(23,"div",19),a.mc(24,"button",20),a.uc("click",(function(){a.Rc(t);const c=e.$implicit,n=e.index;return a.wc().moveUp(c,n)})),a.xc(25,"async"),a.hc(26,"clr-icon",21),a.ad(27),a.xc(28,"translate"),a.lc(),a.mc(29,"button",20),a.uc("click",(function(){a.Rc(t);const c=e.$implicit,n=e.index;return a.wc().moveDown(c,n)})),a.xc(30,"async"),a.hc(31,"clr-icon",22),a.ad(32),a.xc(33,"translate"),a.lc(),a.mc(34,"h4",23),a.ad(35),a.xc(36,"translate"),a.lc(),a.Yc(37,yc,4,4,"button",24),a.hc(38,"div",19),a.mc(39,"button",25),a.uc("click",(function(){a.Rc(t);const c=e.$implicit;return a.wc().delete(c.id)})),a.xc(40,"async"),a.hc(41,"clr-icon",26),a.ad(42),a.xc(43,"translate"),a.lc(),a.lc(),a.lc(),a.lc(),a.Yc(44,Oc,1,3,"vdr-collection-tree-node",27),a.lc()}if(2&t){const t=e.$implicit,c=e.index,n=a.Oc(5),i=a.wc();a.Xb("private",t.isPrivate),a.Dc("cdkDragData",t),a.Ub(1),a.Xb("active",t.id===i.activeCollectionId),a.Dc("ngClass","depth-"+i.depth),a.Ub(2),a.Dc("ngIf",null==t.children?null:t.children.length)("ngIfElse",n),a.Ub(3),a.cd(" ",t.name," "),a.Ub(2),a.Dc("ngIf",t.isPrivate),a.Ub(1),a.Dc("routerLink",a.Ic(45,Jt,a.Ic(43,Cc,t.id))),a.Ub(2),a.cd(" ",a.yc(12,25,"catalog.view-contents")," "),a.Ub(2),a.Dc("routerLink",a.Ic(47,xc,t.id)),a.Ub(2),a.cd(" ",a.yc(16,27,"common.edit")," "),a.Ub(2),a.Dc("vdrIfPermissions","UpdateCatalog"),a.Ub(5),a.Dc("vdrIfPermissions","CreateCatalog"),a.Ub(2),a.Dc("disabled",0===c||!a.yc(25,29,i.hasUpdatePermission$)),a.Ub(3),a.cd(" ",a.yc(28,31,"catalog.move-up")," "),a.Ub(2),a.Dc("disabled",c===i.collectionTree.children.length-1||!a.yc(30,33,i.hasUpdatePermission$)),a.Ub(3),a.cd(" ",a.yc(33,35,"catalog.move-down")," "),a.Ub(3),a.bd(a.yc(36,37,"catalog.move-to")),a.Ub(2),a.Dc("ngForOf",i.getMoveListItems(t)),a.Ub(2),a.Dc("disabled",!a.yc(40,39,i.hasDeletePermission$)),a.Ub(3),a.cd(" ",a.yc(43,41,"common.delete")," "),a.Ub(2),a.Dc("ngIf",t.expanded||i.expandAll)}}function Fc(t,e){if(1&t){const t=a.nc();a.mc(0,"div",7),a.mc(1,"div",8),a.mc(2,"label"),a.ad(3),a.xc(4,"translate"),a.lc(),a.mc(5,"input",9),a.uc("ngModelChange",(function(c){return a.Rc(t),e.$implicit.name=c}))("keydown.enter",(function(e){a.Rc(t);const c=a.Oc(11);return a.wc().handleEnter(e,c)})),a.lc(),a.lc(),a.mc(6,"div",10),a.mc(7,"label"),a.ad(8),a.xc(9,"translate"),a.lc(),a.mc(10,"vdr-option-value-input",11,12),a.uc("ngModelChange",(function(c){return a.Rc(t),e.$implicit.values=c}))("ngModelChange",(function(){return a.Rc(t),a.wc().generateVariants()})),a.lc(),a.lc(),a.mc(12,"div",13),a.mc(13,"button",14),a.uc("click",(function(){a.Rc(t);const c=e.$implicit;return a.wc().removeOption(c.name)})),a.xc(14,"translate"),a.hc(15,"clr-icon",15),a.lc(),a.lc(),a.lc()}if(2&t){const t=e.$implicit;a.Ub(3),a.bd(a.yc(4,7,"catalog.option")),a.Ub(2),a.Dc("ngModel",t.name),a.Ub(3),a.bd(a.yc(9,9,"catalog.option-values")),a.Ub(2),a.Dc("ngModel",t.values)("groupName",t.name)("disabled",""===t.name),a.Ub(3),a.Dc("title",a.yc(14,11,"catalog.remove-option"))}}function wc(t,e){1&t&&(a.mc(0,"th"),a.ad(1),a.xc(2,"translate"),a.lc()),2&t&&(a.Ub(1),a.bd(a.yc(2,1,"common.create")))}function jc(t,e){1&t&&(a.mc(0,"th"),a.ad(1),a.xc(2,"translate"),a.lc()),2&t&&(a.Ub(1),a.bd(a.yc(2,1,"catalog.variant")))}function Dc(t,e){if(1&t){const t=a.nc();a.mc(0,"td"),a.mc(1,"input",19),a.uc("change",(function(){return a.Rc(t),a.wc(2).onFormChange()}))("ngModelChange",(function(e){a.Rc(t);const c=a.wc().$implicit;return a.wc().variantFormValues[c.id].enabled=e})),a.lc(),a.lc()}if(2&t){const t=a.wc().$implicit,e=a.wc();a.Ub(1),a.Dc("ngModel",e.variantFormValues[t.id].enabled)}}function Ic(t,e){if(1&t&&(a.mc(0,"td"),a.ad(1),a.lc()),2&t){const t=a.wc().$implicit;a.Ub(1),a.cd(" ",t.values.join(" ")," ")}}function Uc(t,e){if(1&t){const t=a.nc();a.mc(0,"tr"),a.Yc(1,Dc,2,1,"td",5),a.Yc(2,Ic,2,1,"td",5),a.mc(3,"td"),a.mc(4,"clr-input-container"),a.mc(5,"input",16),a.uc("change",(function(){return a.Rc(t),a.wc().onFormChange()}))("ngModelChange",(function(c){a.Rc(t);const n=e.$implicit;return a.wc().variantFormValues[n.id].sku=c})),a.xc(6,"translate"),a.lc(),a.lc(),a.lc(),a.mc(7,"td"),a.mc(8,"clr-input-container"),a.mc(9,"vdr-currency-input",17),a.uc("ngModelChange",(function(c){a.Rc(t);const n=e.$implicit;return a.wc().variantFormValues[n.id].price=c}))("ngModelChange",(function(){return a.Rc(t),a.wc().onFormChange()})),a.lc(),a.lc(),a.lc(),a.mc(10,"td"),a.mc(11,"clr-input-container"),a.mc(12,"input",18),a.uc("ngModelChange",(function(c){a.Rc(t);const n=e.$implicit;return a.wc().variantFormValues[n.id].stock=c}))("change",(function(){return a.Rc(t),a.wc().onFormChange()})),a.lc(),a.lc(),a.lc(),a.lc()}if(2&t){const t=e.$implicit,c=a.wc();a.Xb("disabled",!c.variantFormValues[t.id].enabled),a.Ub(1),a.Dc("ngIf",1<c.variants.length),a.Ub(1),a.Dc("ngIf",1<c.variants.length),a.Ub(3),a.Dc("ngModel",c.variantFormValues[t.id].sku)("placeholder",a.yc(6,9,"catalog.sku")),a.Ub(4),a.Dc("ngModel",c.variantFormValues[t.id].price)("currencyCode",c.currencyCode),a.Ub(3),a.Dc("ngModel",c.variantFormValues[t.id].stock)}}const kc=["textArea"];function Vc(t,e){if(1&t){const t=a.nc();a.mc(0,"vdr-chip",6),a.uc("iconClick",(function(){a.Rc(t);const c=e.$implicit;return a.wc(2).removeOption(c)})),a.ad(1),a.lc()}if(2&t){const t=e.$implicit,c=e.last,n=a.wc(2);a.Xb("selected",c&&n.lastSelected)("locked",t.locked),a.Dc("icon",t.locked?"lock":"times")("colorFrom",n.groupName),a.Ub(1),a.cd(" ",t.name," ")}}function Mc(t,e){if(1&t&&(a.mc(0,"div",4),a.Yc(1,Vc,2,7,"vdr-chip",5),a.lc()),2&t){const t=a.wc();a.Ub(1),a.Dc("ngForOf",t.options)}}const Sc=["dlg"],_c=["dl"];function Ac(t,e){if(1&t){const t=a.nc();a.mc(0,"img",11),a.uc("click",(function(){a.Rc(t);const e=a.wc(2);return e.previewAsset(e.featuredAsset)})),a.xc(1,"assetPreview"),a.lc()}if(2&t){const t=a.wc(2);a.Dc("src",a.zc(1,1,t.featuredAsset,"small"),a.Tc)}}function $c(t,e){1&t&&(a.mc(0,"div",12),a.hc(1,"clr-icon",13),a.mc(2,"div"),a.ad(3),a.xc(4,"translate"),a.lc(),a.lc()),2&t&&(a.Ub(3),a.bd(a.yc(4,1,"catalog.no-featured-asset")))}function Tc(t,e){1&t&&a.ic(0)}function Yc(t,e){if(1&t){const t=a.nc();a.mc(0,"div",14),a.mc(1,"button",15),a.uc("click",(function(){return a.Rc(t),a.wc(2).selectAssets()})),a.hc(2,"clr-icon",16),a.ad(3),a.xc(4,"translate"),a.lc(),a.lc()}2&t&&(a.Ub(3),a.cd(" ",a.yc(4,1,"asset.add-asset")," "))}function Nc(t,e){if(1&t&&(a.mc(0,"div",3),a.mc(1,"div",4),a.mc(2,"div",5),a.Yc(3,Ac,2,4,"img",6),a.Yc(4,$c,5,3,"div",7),a.lc(),a.lc(),a.mc(5,"div",8),a.Yc(6,Tc,1,0,"ng-container",9),a.lc(),a.Yc(7,Yc,5,3,"div",10),a.lc()),2&t){const t=a.wc(),e=a.Oc(4);a.Ub(3),a.Dc("ngIf",t.featuredAsset),a.Ub(1),a.Dc("ngIf",!t.featuredAsset),a.Ub(2),a.Dc("ngTemplateOutlet",e),a.Ub(1),a.Dc("vdrIfPermissions","UpdateCatalog")}}function Rc(t,e){if(1&t){const t=a.nc();a.mc(0,"img",11),a.uc("click",(function(){a.Rc(t);const e=a.wc(2);return e.previewAsset(e.featuredAsset)})),a.xc(1,"assetPreview"),a.lc()}if(2&t){const t=a.wc(2);a.Dc("src",a.zc(1,1,t.featuredAsset,"thumb"),a.Tc)}}function Lc(t,e){1&t&&(a.mc(0,"div",12),a.hc(1,"clr-icon",19),a.lc())}function Gc(t,e){1&t&&a.ic(0)}function Ec(t,e){if(1&t){const t=a.nc();a.mc(0,"button",20),a.uc("click",(function(){return a.Rc(t),a.wc(2).selectAssets()})),a.xc(1,"translate"),a.hc(2,"clr-icon",16),a.ad(3),a.xc(4,"translate"),a.lc()}2&t&&(a.Dc("title",a.yc(1,2,"asset.add-asset")),a.Ub(3),a.cd(" ",a.yc(4,4,"asset.add-asset")," "))}function Kc(t,e){if(1&t&&(a.mc(0,"div",17),a.Yc(1,Rc,2,4,"img",6),a.Yc(2,Lc,2,0,"div",7),a.lc(),a.Yc(3,Gc,1,0,"ng-container",9),a.Yc(4,Ec,5,6,"button",18)),2&t){const t=a.wc(),e=a.Oc(4);a.Ub(1),a.Dc("ngIf",t.featuredAsset),a.Ub(1),a.Dc("ngIf",!t.featuredAsset),a.Ub(1),a.Dc("ngTemplateOutlet",e),a.Ub(1),a.Dc("vdrIfPermissions","UpdateCatalog")}}function qc(t,e){if(1&t){const t=a.nc();a.mc(0,"div",23),a.uc("cdkDropListDropped",(function(){return a.Rc(t),a.wc(2).dropListDropped()})),a.xc(1,"hasPermission"),a.mc(2,"vdr-dropdown",26),a.uc("cdkDragMoved",(function(e){return a.Rc(t),a.wc(2).dragMoved(e)})),a.mc(3,"div",27),a.hc(4,"img",28),a.xc(5,"assetPreview"),a.lc(),a.mc(6,"vdr-dropdown-menu",29),a.mc(7,"button",30),a.uc("click",(function(){a.Rc(t);const c=e.$implicit;return a.wc(2).previewAsset(c)})),a.ad(8),a.xc(9,"translate"),a.lc(),a.mc(10,"button",31),a.uc("click",(function(){a.Rc(t);const c=e.$implicit;return a.wc(2).setAsFeatured(c)})),a.xc(11,"hasPermission"),a.ad(12),a.xc(13,"translate"),a.lc(),a.hc(14,"div",32),a.mc(15,"button",33),a.uc("click",(function(){a.Rc(t);const c=e.$implicit;return a.wc(2).removeAsset(c)})),a.xc(16,"hasPermission"),a.ad(17),a.xc(18,"translate"),a.lc(),a.lc(),a.lc(),a.lc()}if(2&t){const t=e.$implicit,c=a.wc(2);a.Dc("cdkDropListDisabled",!a.yc(1,10,"UpdateCatalog"))("cdkDropListEnterPredicate",c.dropListEnterPredicate),a.Ub(3),a.Xb("featured",c.isFeatured(t)),a.Ub(1),a.Dc("src",a.zc(5,12,t,"tiny"),a.Tc),a.Ub(4),a.cd(" ",a.yc(9,15,"asset.preview")," "),a.Ub(2),a.Dc("disabled",c.isFeatured(t)||!a.yc(11,17,"UpdateCatalog")),a.Ub(2),a.cd(" ",a.yc(13,19,"asset.set-as-featured-asset")," "),a.Ub(3),a.Dc("disabled",!a.yc(16,21,"UpdateCatalog")),a.Ub(2),a.cd(" ",a.yc(18,23,"asset.remove-asset")," ")}}function Bc(t,e){if(1&t){const t=a.nc();a.mc(0,"div",21,22),a.mc(2,"div",23,24),a.uc("cdkDropListDropped",(function(){return a.Rc(t),a.wc().dropListDropped()})),a.xc(4,"hasPermission"),a.lc(),a.Yc(5,qc,19,25,"div",25),a.lc()}if(2&t){const t=a.wc();a.Xb("compact",t.compact),a.Ub(2),a.Dc("cdkDropListDisabled",!a.yc(4,5,"UpdateCatalog"))("cdkDropListEnterPredicate",t.dropListEnterPredicate),a.Ub(3),a.Dc("ngForOf",t.assets)}}function zc(t,e){1&t&&(a.ad(0),a.xc(1,"translate")),2&t&&a.bd(a.yc(1,1,"catalog.update-product-option"))}function Xc(t,e){if(1&t&&(a.hc(0,"vdr-custom-field-control",11),a.xc(1,"hasPermission")),2&t){const t=a.wc().$implicit,e=a.wc(2);a.Dc("customFieldsFormGroup",e.customFieldsForm)("customField",t)("readonly",!a.yc(1,3,"UpdateCatalog"))}}function Hc(t,e){if(1&t&&(a.kc(0),a.Yc(1,Xc,2,5,"vdr-custom-field-control",10),a.jc()),2&t){const t=e.$implicit,c=a.wc(2);a.Ub(1),a.Dc("ngIf",c.customFieldsForm.get(t.name))}}function Zc(t,e){if(1&t&&(a.mc(0,"section"),a.mc(1,"label"),a.ad(2),a.xc(3,"translate"),a.lc(),a.Yc(4,Hc,2,1,"ng-container",9),a.lc()),2&t){const t=a.wc();a.Ub(2),a.bd(a.yc(3,2,"common.custom-fields")),a.Ub(2),a.Dc("ngForOf",t.customFields)}}function Qc(t,e){if(1&t){const t=a.nc();a.mc(0,"button",12),a.uc("click",(function(){return a.Rc(t),a.wc().cancel()})),a.ad(1),a.xc(2,"translate"),a.lc(),a.mc(3,"button",13),a.uc("click",(function(){return a.Rc(t),a.wc().update()})),a.ad(4),a.xc(5,"translate"),a.lc()}if(2&t){const t=a.wc(),e=a.Oc(4),c=a.Oc(8);a.Ub(1),a.bd(a.yc(2,3,"common.cancel")),a.Ub(2),a.Dc("disabled",e.invalid||c.invalid||e.pristine&&c.pristine&&t.customFieldsForm.pristine),a.Ub(1),a.cd(" ",a.yc(5,5,"catalog.update-product-option")," ")}}function Wc(t,e){1&t&&(a.mc(0,"clr-toggle-wrapper"),a.hc(1,"input",38),a.mc(2,"label"),a.ad(3),a.xc(4,"translate"),a.lc(),a.lc()),2&t&&(a.Ub(3),a.bd(a.yc(4,1,"common.enabled")))}function Jc(t,e){if(1&t&&(a.mc(0,"option",41),a.ad(1),a.lc()),2&t){const t=e.$implicit;a.Dc("value",t.id),a.Ub(1),a.cd(" ",t.name," ")}}function tn(t,e){if(1&t&&(a.mc(0,"clr-select-container"),a.mc(1,"label"),a.ad(2),a.xc(3,"translate"),a.lc(),a.mc(4,"select",39),a.Yc(5,Jc,2,2,"option",40),a.lc(),a.lc()),2&t){const t=a.wc(3);a.Ub(2),a.bd(a.yc(3,2,"catalog.tax-category")),a.Ub(3),a.Dc("ngForOf",t.taxCategories)}}function en(t,e){if(1&t&&(a.mc(0,"label",42),a.ad(1),a.xc(2,"translate"),a.lc(),a.mc(3,"div",43),a.ad(4),a.lc()),2&t){const t=a.wc(2).index,e=a.wc();a.Ub(1),a.bd(a.yc(2,2,"catalog.tax-category")),a.Ub(3),a.cd(" ",e.getTaxCategoryName(t)," ")}}function cn(t,e){if(1&t&&(a.hc(0,"vdr-custom-field-control",47),a.xc(1,"hasPermission")),2&t){const t=a.wc().$implicit,e=a.wc(3).index,c=a.wc();a.Dc("compact",!0)("customFieldsFormGroup",c.formArray.at(e).get(a.Hc(6,gt)))("readonly",!a.yc(1,4,"UpdateCatalog"))("customField",t)}}function nn(t,e){if(1&t&&(a.kc(0),a.Yc(1,cn,2,7,"vdr-custom-field-control",46),a.jc()),2&t){const t=e.$implicit,c=a.wc(3).index,n=a.wc();a.Ub(1),a.Dc("ngIf",n.customFieldIsSet(c,t.name))}}function an(t,e){if(1&t&&(a.mc(0,"section",44),a.Yc(1,nn,2,1,"ng-container",45),a.lc()),2&t){const t=a.wc(3);a.Ub(1),a.Dc("ngForOf",t.customFields)}}function on(t,e){if(1&t){const t=a.nc();a.mc(0,"vdr-chip",50),a.uc("iconClick",(function(){a.Rc(t);const c=e.$implicit;return a.wc(4).editOption(c)})),a.xc(1,"hasPermission"),a.mc(2,"span",51),a.ad(3),a.lc(),a.ad(4),a.lc()}if(2&t){const t=e.$implicit,c=a.wc(4);a.Dc("colorFrom",c.optionGroupName(t.groupId))("invert",!0)("icon",a.yc(1,5,"UpdateCatalog")&&"pencil"),a.Ub(3),a.bd(c.optionGroupName(t.groupId)),a.Ub(1),a.cd(" ",c.optionName(t)," ")}}function rn(t,e){if(1&t&&(a.mc(0,"div"),a.mc(1,"div",48),a.Yc(2,on,5,7,"vdr-chip",49),a.xc(3,"sort"),a.lc(),a.lc()),2&t){const t=a.wc(2).$implicit;a.Ub(2),a.Dc("ngForOf",a.zc(3,1,t.options,"groupId"))}}function sn(t,e){if(1&t){const t=a.nc();a.mc(0,"vdr-facet-value-chip",52),a.uc("remove",(function(){a.Rc(t);const c=e.$implicit,n=a.wc(2).index;return a.wc().removeFacetValue(n,c.id)})),a.xc(1,"hasPermission"),a.lc()}if(2&t){const t=e.$implicit;a.Dc("facetValue",t)("removable",a.yc(1,2,"UpdateCatalog"))}}function ln(t,e){if(1&t){const t=a.nc();a.mc(0,"vdr-facet-value-chip",52),a.uc("remove",(function(){a.Rc(t);const c=e.$implicit,n=a.wc(2).index;return a.wc().removeFacetValue(n,c.id)})),a.xc(1,"hasPermission"),a.lc()}if(2&t){const t=e.$implicit;a.Dc("facetValue",t)("removable",a.yc(1,2,"UpdateCatalog"))}}function dn(t,e){if(1&t){const t=a.nc();a.mc(0,"button",53),a.uc("click",(function(){a.Rc(t);const e=a.wc(2).$implicit;return a.wc().selectFacetValueClick.emit([e.id])})),a.hc(1,"clr-icon",54),a.ad(2),a.xc(3,"translate"),a.lc()}2&t&&(a.Ub(2),a.cd(" ",a.yc(3,1,"catalog.add-facets")," "))}const un=function(t){return[t,"price"]},pn=function(t){return[t,"taxCategoryId"]};function mn(t,e){if(1&t){const t=a.nc();a.kc(0,4),a.mc(1,"div",5),a.mc(2,"div",6),a.mc(3,"vdr-title-input",7),a.xc(4,"hasPermission"),a.mc(5,"clr-input-container"),a.hc(6,"input",8),a.xc(7,"hasPermission"),a.xc(8,"translate"),a.lc(),a.lc(),a.mc(9,"vdr-title-input",9),a.xc(10,"hasPermission"),a.mc(11,"clr-input-container"),a.hc(12,"input",10),a.xc(13,"hasPermission"),a.xc(14,"translate"),a.lc(),a.lc(),a.lc(),a.mc(15,"div",11),a.Yc(16,Wc,5,3,"clr-toggle-wrapper",12),a.lc(),a.lc(),a.mc(17,"div",13),a.mc(18,"div",14),a.mc(19,"div",15),a.mc(20,"vdr-product-assets",16),a.uc("change",(function(e){a.Rc(t);const c=a.wc().$implicit;return a.wc().onAssetChange(c.id,e)})),a.lc(),a.lc(),a.mc(21,"div",17),a.mc(22,"div",18),a.mc(23,"div",19),a.mc(24,"div",20),a.Yc(25,tn,6,4,"clr-select-container",21),a.Yc(26,en,5,4,"ng-template",null,22,a.Zc),a.lc(),a.mc(28,"div",23),a.mc(29,"clr-input-container"),a.mc(30,"label"),a.ad(31),a.xc(32,"translate"),a.lc(),a.hc(33,"vdr-currency-input",24),a.xc(34,"hasPermission"),a.lc(),a.lc(),a.hc(35,"vdr-variant-price-detail",25),a.lc(),a.mc(36,"div",19),a.mc(37,"clr-input-container"),a.mc(38,"label"),a.ad(39),a.xc(40,"translate"),a.lc(),a.hc(41,"input",26),a.xc(42,"hasPermission"),a.lc(),a.mc(43,"clr-checkbox-wrapper",27),a.hc(44,"input",28),a.xc(45,"hasPermission"),a.mc(46,"label"),a.ad(47),a.xc(48,"translate"),a.lc(),a.lc(),a.lc(),a.lc(),a.mc(49,"div",29),a.mc(50,"div",19),a.Yc(51,an,2,1,"section",30),a.lc(),a.lc(),a.lc(),a.lc(),a.lc(),a.mc(52,"div",13),a.mc(53,"div",31),a.hc(54,"vdr-entity-info",32),a.Yc(55,rn,4,4,"div",33),a.hc(56,"div",34),a.mc(57,"div",35),a.Yc(58,sn,2,4,"vdr-facet-value-chip",36),a.Yc(59,ln,2,4,"vdr-facet-value-chip",36),a.Yc(60,dn,4,3,"button",37),a.lc(),a.lc(),a.lc(),a.jc()}if(2&t){const t=a.Oc(27),e=a.wc(),c=e.index,n=e.$implicit,i=a.wc();a.Dc("formGroup",i.formArray.at(c)),a.Ub(3),a.Dc("readonly",!a.yc(4,30,"UpdateCatalog")),a.Ub(3),a.Dc("readonly",!a.yc(7,32,"UpdateCatalog"))("placeholder",a.yc(8,34,"catalog.sku")),a.Ub(3),a.Dc("readonly",!a.yc(10,36,"UpdateCatalog")),a.Ub(3),a.Dc("readonly",!a.yc(13,38,"UpdateCatalog"))("placeholder",a.yc(14,40,"common.name")),a.Ub(4),a.Dc("vdrIfPermissions","UpdateCatalog"),a.Ub(4),a.Dc("compact",!0)("assets",n.assets)("featuredAsset",n.featuredAsset),a.Ub(5),a.Dc("vdrIfPermissions","UpdateCatalog")("vdrIfPermissionsElse",t),a.Ub(6),a.bd(a.yc(32,42,"catalog.price")),a.Ub(2),a.Dc("currencyCode",n.currencyCode)("readonly",!a.yc(34,44,"UpdateCatalog")),a.Ub(2),a.Dc("price",i.formArray.get(a.Ic(54,un,c)).value)("currencyCode",n.currencyCode)("priceIncludesTax",n.priceIncludesTax)("taxCategoryId",i.formArray.get(a.Ic(56,pn,c)).value),a.Ub(4),a.bd(a.yc(40,46,"catalog.stock-on-hand")),a.Ub(2),a.Dc("readonly",!a.yc(42,48,"UpdateCatalog")),a.Ub(3),a.Dc("vdrDisabled",!a.yc(45,50,"UpdateCatalog")),a.Ub(3),a.bd(a.yc(48,52,"catalog.track-inventory")),a.Ub(4),a.Dc("ngIf",i.customFields.length),a.Ub(3),a.Dc("entity",n),a.Ub(1),a.Dc("ngIf",n.options.length),a.Ub(3),a.Dc("ngForOf",i.existingFacetValues(c)),a.Ub(1),a.Dc("ngForOf",i.pendingFacetValues(c)),a.Ub(1),a.Dc("vdrIfPermissions","UpdateCatalog")}}const gn=function(t){return[t,"enabled"]};function bn(t,e){if(1&t&&(a.mc(0,"div",2),a.Yc(1,mn,61,58,"ng-container",3),a.lc()),2&t){const t=e.index,n=a.wc();var c;const i=!(null!=(c=n.formArray.get(a.Ic(3,gn,t)))&&c.value);a.Xb("disabled",i),a.Ub(1),a.Dc("ngIf",n.formArray.at(t))}}function hn(t,e){if(1&t&&(a.kc(0),a.mc(1,"vdr-dt-column"),a.ad(2),a.lc(),a.jc()),2&t){const t=e.$implicit;a.Ub(2),a.bd(t.name)}}function fn(t,e){if(1&t&&(a.hc(0,"img",15),a.xc(1,"assetPreview")),2&t){const t=a.wc().item;a.Dc("src",a.zc(1,1,t.featuredAsset,"tiny"),a.Tc)}}function vn(t,e){1&t&&(a.mc(0,"div",16),a.hc(1,"clr-icon",17),a.lc())}function yn(t,e){if(1&t&&(a.kc(0),a.mc(1,"td",3),a.xc(2,"stringToColor"),a.ad(3),a.lc(),a.jc()),2&t){const t=e.$implicit,c=a.wc().index,n=a.wc();a.Ub(1),a.Xc("color",a.yc(2,5,n.optionGroupName(t.groupId))),a.Xb("disabled",!n.formArray.get(a.Ic(7,gn,c)).value),a.Ub(2),a.cd(" ",t.name," ")}}function On(t,e){if(1&t&&(a.kc(0,2),a.mc(1,"td",3),a.mc(2,"div",4),a.mc(3,"div",5),a.Yc(4,fn,2,4,"img",6),a.Yc(5,vn,2,0,"div",7),a.lc(),a.lc(),a.lc(),a.mc(6,"td",3),a.mc(7,"clr-input-container"),a.hc(8,"input",8),a.xc(9,"hasPermission"),a.xc(10,"translate"),a.lc(),a.lc(),a.mc(11,"td",3),a.mc(12,"clr-input-container"),a.hc(13,"input",9),a.xc(14,"hasPermission"),a.xc(15,"translate"),a.lc(),a.lc(),a.Yc(16,yn,4,9,"ng-container",1),a.xc(17,"sort"),a.mc(18,"td",10),a.mc(19,"clr-input-container"),a.hc(20,"vdr-currency-input",11),a.xc(21,"hasPermission"),a.lc(),a.lc(),a.mc(22,"td",12),a.mc(23,"clr-input-container"),a.hc(24,"input",13),a.xc(25,"hasPermission"),a.lc(),a.lc(),a.mc(26,"td",12),a.mc(27,"clr-toggle-wrapper"),a.hc(28,"input",14),a.xc(29,"hasPermission"),a.lc(),a.lc(),a.jc()),2&t){const t=e.item,c=e.index,n=a.wc();a.Dc("formGroup",n.formArray.at(c)),a.Ub(1),a.Xb("disabled",!n.formArray.get(a.Ic(41,gn,c)).value),a.Ub(3),a.Dc("ngIf",t.featuredAsset),a.Ub(1),a.Dc("ngIf",!t.featuredAsset),a.Ub(1),a.Xb("disabled",!n.formArray.get(a.Ic(43,gn,c)).value),a.Ub(2),a.Dc("readonly",!a.yc(9,24,"UpdateCatalog"))("placeholder",a.yc(10,26,"common.name")),a.Ub(3),a.Xb("disabled",!n.formArray.get(a.Ic(45,gn,c)).value),a.Ub(2),a.Dc("readonly",!a.yc(14,28,"UpdateCatalog"))("placeholder",a.yc(15,30,"catalog.sku")),a.Ub(3),a.Dc("ngForOf",a.zc(17,32,t.options,"groupId")),a.Ub(2),a.Xb("disabled",!n.formArray.get(a.Ic(47,gn,c)).value),a.Ub(2),a.Dc("currencyCode",t.currencyCode)("readonly",!a.yc(21,35,"UpdateCatalog")),a.Ub(2),a.Xb("disabled",!n.formArray.get(a.Ic(49,gn,c)).value),a.Ub(2),a.Dc("readonly",!a.yc(25,37,"UpdateCatalog")),a.Ub(2),a.Xb("disabled",!n.formArray.get(a.Ic(51,gn,c)).value),a.Ub(2),a.Dc("vdrDisabled",!a.yc(29,39,"UpdateCatalog"))}}const Cn=function(t){return{rate:t}};function xn(t,e){if(1&t&&(a.mc(0,"div",2),a.ad(1),a.xc(2,"translate"),a.xc(3,"async"),a.lc()),2&t){const t=a.wc();a.Ub(1),a.cd(" ",a.zc(2,1,"catalog.price-includes-tax-at",a.Ic(6,Cn,a.yc(3,4,t.taxRate$))),"\n")}}const Pn=function(t,e){return{price:t,rate:e}};function Fn(t,e){if(1&t&&(a.mc(0,"div",2),a.ad(1),a.xc(2,"translate"),a.xc(3,"currency"),a.xc(4,"async"),a.xc(5,"async"),a.lc()),2&t){const t=a.wc();a.Ub(1),a.cd(" ",a.zc(2,1,"catalog.price-with-tax-in-default-zone",a.Jc(11,Pn,a.zc(3,4,a.yc(4,7,t.grossPrice$),t.currencyCode),a.yc(5,9,t.taxRate$))),"\n")}}let wn=class extends o.u{constructor(t,e,c,n,a,i){super(e,t,c,a),this.notificationService=n,this.dataService=a,this.formBuilder=i,this.detailForm=new S.i({})}ngOnInit(){this.detailForm=new S.i({name:new S.f("")}),this.init()}ngOnDestroy(){this.destroy()}onAssetChange(t){this.detailForm.get("name").setValue(t.name),this.detailForm.get("name").markAsDirty()}save(){this.dataService.product.updateAsset({id:this.id,name:this.detailForm.value.name}).subscribe(()=>{this.notificationService.success(Object(r.a)("common.notify-update-success"),{entity:"Asset"})},t=>{this.notificationService.error(Object(r.a)("common.notify-update-error"),{entity:"Asset"})})}setFormValues(t,e){this.detailForm.get("name").setValue(t.name)}};wn.\u0275fac=function(t){return new(t||wn)(a.gc(i.e),a.gc(i.a),a.gc(o.Fb),a.gc(o.yb),a.gc(o.K),a.gc(S.e))},wn.\u0275cmp=a.ac({type:wn,selectors:[["vdr-asset-detail"]],features:[a.Rb],decls:9,vars:8,consts:[[3,"entity"],["locationId","asset-detail"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[3,"asset","editable","assetChange"],[1,"btn","btn-primary",3,"disabled","click"]],template:function(t,e){1&t&&(a.mc(0,"vdr-action-bar"),a.mc(1,"vdr-ab-left"),a.hc(2,"vdr-entity-info",0),a.xc(3,"async"),a.lc(),a.mc(4,"vdr-ab-right"),a.hc(5,"vdr-action-bar-items",1),a.Yc(6,et,3,4,"button",2),a.lc(),a.lc(),a.mc(7,"vdr-asset-preview",3),a.uc("assetChange",(function(t){return e.onAssetChange(t)})),a.xc(8,"async"),a.lc()),2&t&&(a.Ub(2),a.Dc("entity",a.yc(3,4,e.entity$)),a.Ub(4),a.Dc("vdrIfPermissions","UpdateCatalog"),a.Ub(1),a.Dc("asset",a.yc(8,6,e.entity$))("editable",!0))},directives:[o.c,o.e,o.Z,o.f,o.d,o.ob,o.o],pipes:[B.b,W.d],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}"],changeDetection:0}),wn.ctorParameters=()=>[{type:i.e},{type:i.a},{type:o.Fb},{type:o.yb},{type:o.K},{type:S.e}],wn=Object(n.c)([Object(n.f)("design:paramtypes",[i.e,i.a,o.Fb,o.yb,o.K,S.e])],wn);let jn=class extends o.w{constructor(t,e,c,n,a){super(n,a),this.notificationService=t,this.modalService=e,this.dataService=c,this.searchTerm=new S.f(""),this.uploading=!1,super.setQueryFn((...t)=>this.dataService.product.getAssetList(...t),t=>t.assets,(t,e)=>({options:{skip:t,take:e,filter:{name:{contains:this.searchTerm.value}},sort:{createdAt:_.SortOrder.DESC}}}))}ngOnInit(){super.ngOnInit(),this.paginationConfig$=Object(A.a)(this.itemsPerPage$,this.currentPage$,this.totalItems$).pipe(Object(s.a)(([t,e,c])=>({itemsPerPage:t,currentPage:e,totalItems:c}))),this.searchTerm.valueChanges.pipe(Object(l.a)(250),Object(d.a)(this.destroy$)).subscribe(()=>this.refresh())}filesSelected(t){t.length&&(this.uploading=!0,this.dataService.product.createAssets(t).pipe(Object(u.a)(()=>this.uploading=!1)).subscribe(e=>{super.refresh(),this.notificationService.success(Object(r.a)("asset.notify-create-assets-success"),{count:t.length})}))}deleteAsset(t){this.showModalAndDelete(t.id).pipe(Object(p.a)(e=>e.result===o.O.DELETED?[!0]:this.showModalAndDelete(t.id,e.message||"").pipe(Object(s.a)(t=>t.result===o.O.DELETED)))).subscribe(()=>{this.notificationService.success(Object(r.a)("common.notify-delete-success"),{entity:"Asset"}),this.refresh()},t=>{this.notificationService.error(Object(r.a)("common.notify-delete-error"),{entity:"Asset"})})}showModalAndDelete(t,e){return this.modalService.dialog({title:Object(r.a)("catalog.confirm-delete-asset"),body:e,buttons:[{type:"secondary",label:Object(r.a)("common.cancel")},{type:"danger",label:Object(r.a)("common.delete"),returnValue:!0}]}).pipe(Object(p.a)(c=>c?this.dataService.product.deleteAsset(t,!!e):$.a),Object(s.a)(t=>t.deleteAsset))}};jn.\u0275fac=function(t){return new(t||jn)(a.gc(o.yb),a.gc(o.xb),a.gc(o.K),a.gc(i.e),a.gc(i.a))},jn.\u0275cmp=a.ac({type:jn,selectors:[["vdr-asset-list"]],features:[a.Rb],decls:19,vars:30,consts:[["type","text","name","searchTerm",1,"clr-input","search-input",3,"formControl","placeholder"],["locationId","asset-list"],["dropZoneTarget",".content-area",3,"uploading","selectFiles"],[3,"assets","multiSelect","canDelete","deleteAsset"],[1,"paging-controls"],[3,"itemsPerPage","itemsPerPageChange"],[3,"currentPage","itemsPerPage","totalItems","pageChange"]],template:function(t,e){1&t&&(a.mc(0,"vdr-action-bar"),a.mc(1,"vdr-ab-left"),a.hc(2,"input",0),a.xc(3,"translate"),a.lc(),a.mc(4,"vdr-ab-right"),a.hc(5,"vdr-action-bar-items",1),a.mc(6,"vdr-asset-file-input",2),a.uc("selectFiles",(function(t){return e.filesSelected(t)})),a.lc(),a.lc(),a.lc(),a.mc(7,"vdr-asset-gallery",3),a.uc("deleteAsset",(function(t){return e.deleteAsset(t)})),a.xc(8,"paginate"),a.xc(9,"async"),a.xc(10,"async"),a.xc(11,"hasPermission"),a.lc(),a.mc(12,"div",4),a.mc(13,"vdr-items-per-page-controls",5),a.uc("itemsPerPageChange",(function(t){return e.setItemsPerPage(t)})),a.xc(14,"async"),a.lc(),a.mc(15,"vdr-pagination-controls",6),a.uc("pageChange",(function(t){return e.setPageNumber(t)})),a.xc(16,"async"),a.xc(17,"async"),a.xc(18,"async"),a.lc(),a.lc()),2&t&&(a.Ub(2),a.Dc("formControl",e.searchTerm)("placeholder",a.yc(3,10,"asset.search-asset-name")),a.Ub(4),a.Dc("uploading",e.uploading),a.Ub(1),a.Dc("assets",a.zc(8,12,a.yc(9,15,e.items$),a.yc(10,17,e.paginationConfig$)||a.Hc(29,ct)))("multiSelect",!0)("canDelete",a.yc(11,19,"DeleteCatalog")),a.Ub(6),a.Dc("itemsPerPage",a.yc(14,21,e.itemsPerPage$)),a.Ub(2),a.Dc("currentPage",a.yc(16,23,e.currentPage$))("itemsPerPage",a.yc(17,25,e.itemsPerPage$))("totalItems",a.yc(18,27,e.totalItems$)))},directives:[o.c,o.e,o.db,S.b,S.p,S.g,o.f,o.d,o.l,o.m,o.pb,o.Bb],pipes:[W.d,J.b,B.b,o.gb],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}vdr-asset-gallery[_ngcontent-%COMP%]{flex:1}.paging-controls[_ngcontent-%COMP%]{padding-top:6px;border-top:1px solid #f2f3f5;display:flex;justify-content:space-between}.search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}"]}),jn.ctorParameters=()=>[{type:o.yb},{type:o.xb},{type:o.K},{type:i.e},{type:i.a}],jn=Object(n.c)([Object(n.f)("design:paramtypes",[o.yb,o.xb,o.K,i.e,i.a])],jn);let Dn=class{constructor(t,e,c){this.route=t,this.router=e,this.dataService=c,this.filterTermControl=new S.f(""),this.collectionIdChange$=new T.a(""),this.refresh$=new T.a(!0),this.destroy$=new Y.a}ngOnInit(){this.contentsCurrentPage$=this.route.paramMap.pipe(Object(s.a)(t=>t.get("contentsPage")),Object(s.a)(t=>t?+t:1),Object(m.a)(1),Object(g.a)()),this.contentsItemsPerPage$=this.route.paramMap.pipe(Object(s.a)(t=>t.get("contentsPerPage")),Object(s.a)(t=>t?+t:10),Object(m.a)(10),Object(g.a)());const t=this.filterTermControl.valueChanges.pipe(Object(l.a)(250),Object(b.a)(()=>this.setContentsPageNumber(1)),Object(m.a)("")),e=Object(A.a)(this.collectionIdChange$,this.contentsCurrentPage$,this.contentsItemsPerPage$,t,this.refresh$).pipe(Object(d.a)(this.destroy$),Object(p.a)(([t,e,c,n])=>{const a=c,i=(e-1)*c;return t?this.dataService.collection.getCollectionContents(t,a,i,n).mapSingle(t=>t.collection):Object(N.a)(null)}));this.contents$=e.pipe(Object(s.a)(t=>t?t.productVariants.items:[])),this.contentsTotalItems$=e.pipe(Object(s.a)(t=>t?t.productVariants.totalItems:0))}ngOnChanges(t){"collectionId"in t&&this.collectionIdChange$.next(t.collectionId.currentValue)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setContentsPageNumber(t){this.setParam("contentsPage",t)}setContentsItemsPerPage(t){this.setParam("contentsPerPage",t)}refresh(){this.refresh$.next(!0)}setParam(t,e){this.router.navigate(["./",Object.assign(Object.assign({},this.route.snapshot.params),{[t]:e})],{relativeTo:this.route,queryParamsHandling:"merge"})}};Dn.\u0275fac=function(t){return new(t||Dn)(a.gc(i.a),a.gc(i.e),a.gc(o.K))},Dn.\u0275cmp=a.ac({type:Dn,selectors:[["vdr-collection-contents"]],contentQueries:function(t,e,c){var n;(1&t&&a.Vc(c,a.bb,!0),2&t)&&(a.Nc(n=a.vc())&&(e.headerTemplate=n.first))},inputs:{collectionId:"collectionId"},features:[a.Sb],decls:12,vars:22,consts:[[1,"contents-header"],[1,"header-title-row"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["type","text",1,"clr-input",3,"placeholder","formControl"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"left","align-middle"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"]],template:function(t,e){1&t&&(a.mc(0,"div",0),a.mc(1,"div",1),a.Yc(2,nt,1,0,"ng-container",2),a.xc(3,"async"),a.lc(),a.hc(4,"input",3),a.xc(5,"translate"),a.lc(),a.mc(6,"vdr-data-table",4),a.uc("pageChange",(function(t){return e.setContentsPageNumber(t)}))("itemsPerPageChange",(function(t){return e.setContentsItemsPerPage(t)})),a.xc(7,"async"),a.xc(8,"async"),a.xc(9,"async"),a.xc(10,"async"),a.Yc(11,ot,5,9,"ng-template"),a.lc()),2&t&&(a.Ub(2),a.Dc("ngTemplateOutlet",e.headerTemplate)("ngTemplateOutletContext",a.Ic(20,rt,a.yc(3,8,e.contentsTotalItems$))),a.Ub(2),a.Dc("placeholder",a.yc(5,10,"catalog.filter-by-name"))("formControl",e.filterTermControl),a.Ub(2),a.Dc("items",a.yc(7,12,e.contents$))("itemsPerPage",a.yc(8,14,e.contentsItemsPerPage$))("totalItems",a.yc(9,16,e.contentsTotalItems$))("currentPage",a.yc(10,18,e.contentsCurrentPage$)))},directives:[B.u,o.db,S.b,S.p,S.g,o.M,o.Kb],pipes:[B.b,W.d],styles:[".contents-header[_ngcontent-%COMP%]{background-color:#fafafa;position:-webkit-sticky;position:sticky;top:0;padding:6px;z-index:1;border-bottom:1px solid #bfc3cc}.contents-header[_ngcontent-%COMP%]   .header-title-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.contents-header[_ngcontent-%COMP%]   .clr-input[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]     table{margin-top:-1px}"],changeDetection:0}),Dn.ctorParameters=()=>[{type:i.a},{type:i.e},{type:o.K}],Object(n.c)([Object(a.D)(),Object(n.f)("design:type",String)],Dn.prototype,"collectionId",void 0),Object(n.c)([Object(a.o)(a.bb,{static:!0}),Object(n.f)("design:type",a.bb)],Dn.prototype,"headerTemplate",void 0),Dn=Object(n.c)([Object(n.f)("design:paramtypes",[i.a,i.e,o.K])],Dn);let In=class extends o.u{constructor(t,e,c,n,a,i,o,r){super(e,t,c,a),this.changeDetector=n,this.dataService=a,this.formBuilder=i,this.notificationService=o,this.modalService=r,this.assetChanges={},this.filters=[],this.allFilters=[],this.customFields=this.getCustomFieldConfig("Collection"),this.detailForm=this.formBuilder.group({name:["",S.C.required],slug:"",description:"",visible:!1,filters:this.formBuilder.array([]),customFields:this.formBuilder.group(this.customFields.reduce((t,e)=>Object.assign(Object.assign({},t),{[e.name]:""}),{}))})}ngOnInit(){this.init(),this.facets$=this.dataService.facet.getAllFacets().mapSingle(t=>t.facets.items).pipe(Object(h.a)(1)),this.dataService.collection.getCollectionFilters().single$.subscribe(t=>{this.allFilters=t.collectionFilters}),this.activeChannel$=this.dataService.settings.getActiveChannel().mapStream(t=>t.activeChannel)}ngOnDestroy(){this.destroy()}getFilterDefinition(t){return this.allFilters.find(e=>e.code===t.code)}customFieldIsSet(t){return!!this.detailForm.get(["customFields",t])}assetsChanged(){return!!Object.values(this.assetChanges).length}updateSlug(t){this.isNew$.pipe(Object(f.a)(1)).subscribe(e=>{if(e){const e=this.detailForm.get(["slug"]);e&&e.pristine&&e.setValue(Object(K.normalizeString)(`${t}`,"-"))}})}addFilter(t){const e=this.detailForm.get("filters");if(-1===e.value.findIndex(e=>e.code===t.code)){const c=t.args.reduce((t,e)=>Object.assign(Object.assign({},t),{[e.name]:e.value}),{});e.push(this.formBuilder.control({code:t.code,args:c})),this.filters.push(t)}}removeFilter(t){const e=this.detailForm.get("filters"),c=e.value.findIndex(e=>e.code===t.code);-1!==c&&(e.removeAt(c),this.filters.splice(c,1))}create(){this.detailForm.dirty&&Object(A.a)(this.entity$,this.languageCode$).pipe(Object(f.a)(1),Object(v.a)(([t,e])=>{const c=this.getUpdatedCollection(t,this.detailForm,e),n=this.route.snapshot.paramMap.get("parentId");return n&&(c.parentId=n),this.dataService.collection.createCollection(c)})).subscribe(t=>{this.notificationService.success(Object(r.a)("common.notify-create-success"),{entity:"Collection"}),this.assetChanges={},this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.router.navigate(["../",t.createCollection.id],{relativeTo:this.route})},t=>{this.notificationService.error(Object(r.a)("common.notify-create-error"),{entity:"Collection"})})}save(){Object(A.a)(this.entity$,this.languageCode$).pipe(Object(f.a)(1),Object(v.a)(([t,e])=>{const c=this.getUpdatedCollection(t,this.detailForm,e);return this.dataService.collection.updateCollection(c)})).subscribe(()=>{this.assetChanges={},this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success(Object(r.a)("common.notify-update-success"),{entity:"Collection"}),this.contentsComponent.refresh()},t=>{this.notificationService.error(Object(r.a)("common.notify-update-error"),{entity:"Collection"})})}canDeactivate(){return super.canDeactivate()&&!this.assetChanges.assetIds&&!this.assetChanges.featuredAssetId}setFormValues(t,e){const c=t.translations.find(t=>t.languageCode===e);if(this.detailForm.patchValue({name:c?c.name:"",slug:c?c.slug:"",description:c?c.description:"",visible:!t.isPrivate}),t.filters.forEach(t=>this.addFilter(t)),this.customFields.length){const e=this.detailForm.get(["customFields"]);for(const n of this.customFields){const a=n.name,i="localeString"===n.type?c.customFields[a]:t.customFields[a],o=e.get(a);o&&o.patchValue(i)}}}getUpdatedCollection(t,e,c){const n=Object(o.Rb)({translatable:t,updatedFields:e.value,customFieldConfig:this.customFields,languageCode:c,defaultTranslation:{languageCode:c,name:t.name||"",slug:t.slug||"",description:t.description||""}});return Object.assign(Object.assign(Object.assign({},n),this.assetChanges),{isPrivate:!e.value.visible,filters:this.mapOperationsToInputs(this.filters,this.detailForm.value.filters)})}mapOperationsToInputs(t,e){return t.map((t,c)=>({code:t.code,arguments:Object.values(e[c].args).map((e,c)=>({name:t.args[c].name,value:e.toString(),type:t.args[c].type}))}))}};In.\u0275fac=function(t){return new(t||In)(a.gc(i.e),a.gc(i.a),a.gc(o.Fb),a.gc(a.k),a.gc(o.K),a.gc(S.e),a.gc(o.yb),a.gc(o.xb))},In.\u0275cmp=a.ac({type:In,selectors:[["vdr-collection-detail"]],viewQuery:function(t,e){var c;(1&t&&a.gd(st,!0),2&t)&&(a.Nc(c=a.vc())&&(e.contentsComponent=c.first))},features:[a.Rb],decls:16,vars:19,consts:[[3,"entity"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","collection-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup"],[1,"clr-row"],[1,"clr-col"],["for","visibility",3,"label"],["type","checkbox","clrToggle","","formControlName","visible","id","visibility",3,"vdrDisabled"],[1,"visible-toggle"],[4,"ngIf","ngIfElse"],["private",""],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],["for","slug",3,"label","errors"],["id","slug","type","text","formControlName","slug","pattern","[a-z0-9_-]+",3,"readonly"],["formControlName","description",3,"readonly","label"],["formGroupName","customFields",4,"ngIf"],[1,"clr-col-md-auto"],[3,"assets","featuredAsset","change"],["formArrayName","filters",1,"clr-row"],[4,"ngFor","ngForOf"],[4,"vdrIfPermissions"],[3,"collectionId"],["collectionContents",""],["formGroupName","customFields"],["entityName","Collection",3,"customFieldsFormGroup","customField",4,"ngIf"],["entityName","Collection",3,"customFieldsFormGroup","customField"],[3,"facets","operation","operationDefinition","formControlName","readonly","activeChannel","remove"],["vdrDropdownTrigger","",1,"btn","btn-outline"],["shape","plus"],["vdrPosition","bottom-left"],["type","button","vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["type","button","vdrDropdownItem","",3,"click"],[1,"contents-title"]],template:function(t,e){if(1&t&&(a.mc(0,"vdr-action-bar"),a.mc(1,"vdr-ab-left"),a.hc(2,"vdr-entity-info",0),a.xc(3,"async"),a.mc(4,"vdr-language-selector",1),a.uc("languageCodeChange",(function(t){return e.setLanguage(t)})),a.xc(5,"async"),a.xc(6,"async"),a.xc(7,"async"),a.lc(),a.lc(),a.mc(8,"vdr-ab-right"),a.hc(9,"vdr-action-bar-items",2),a.Yc(10,lt,3,4,"button",3),a.xc(11,"async"),a.Yc(12,ut,1,1,"ng-template",null,4,a.Zc),a.lc(),a.lc(),a.Yc(14,Ft,38,41,"form",5),a.xc(15,"async")),2&t){const t=a.Oc(13);a.Ub(2),a.Dc("entity",a.yc(3,7,e.entity$)),a.Ub(2),a.Dc("disabled",a.yc(5,9,e.isNew$))("availableLanguageCodes",a.yc(6,11,e.availableLanguages$))("currentLanguageCode",a.yc(7,13,e.languageCode$)),a.Ub(6),a.Dc("ngIf",a.yc(11,15,e.isNew$))("ngIfElse",t),a.Ub(4),a.Dc("ngIf",a.yc(15,17,e.entity$))}},directives:function(){return[o.c,o.e,o.Z,o.ub,o.f,o.d,B.p,o.ob,S.E,S.q,S.j,o.cb,tt.k,o.db,S.a,tt.i,S.p,S.h,o.R,tt.t,S.b,S.w,o.Db,ga,S.d,B.o,Dn,S.k,o.H,o.C,o.S,o.V,tt.o,o.U,o.T]},pipes:function(){return[B.b,W.d,o.gb]},styles:[".visible-toggle[_ngcontent-%COMP%]{margin-top:-3px!important}"],changeDetection:0}),In.ctorParameters=()=>[{type:i.e},{type:i.a},{type:o.Fb},{type:a.k},{type:o.K},{type:S.e},{type:o.yb},{type:o.xb}],Object(n.c)([Object(a.fb)("collectionContents"),Object(n.f)("design:type",Dn)],In.prototype,"contentsComponent",void 0),In=Object(n.c)([Object(n.f)("design:paramtypes",[i.e,i.a,o.Fb,a.k,o.K,S.e,o.yb,o.xb])],In);let Un=class{constructor(t,e,c,n,a){this.dataService=t,this.notificationService=e,this.modalService=c,this.router=n,this.route=a,this.expandAll=!1}ngOnInit(){this.queryResult=this.dataService.collection.getCollections(99999,0).refetchOnChannelChange(),this.items$=this.queryResult.mapStream(t=>t.collections.items).pipe(Object(h.a)(1)),this.activeCollectionId$=this.route.paramMap.pipe(Object(s.a)(t=>t.get("contents")),Object(g.a)()),this.activeCollectionTitle$=Object(A.a)(this.activeCollectionId$,this.items$).pipe(Object(s.a)(([t,e])=>{if(t){const c=e.find(e=>e.id===t);return c?c.name:""}return""}))}onRearrange(t){this.dataService.collection.moveCollection([t]).subscribe({next:()=>{this.notificationService.success(Object(r.a)("common.notify-saved-changes")),this.refresh()},error:t=>{this.notificationService.error(Object(r.a)("common.notify-save-changes-error"))}})}deleteCollection(t){this.items$.pipe(Object(f.a)(1),Object(s.a)(e=>-1<e.findIndex(e=>e.parent&&e.parent.id===t)),Object(p.a)(t=>this.modalService.dialog({title:Object(r.a)("catalog.confirm-delete-collection"),body:t?Object(r.a)("catalog.confirm-delete-collection-and-children-body"):void 0,buttons:[{type:"secondary",label:Object(r.a)("common.cancel")},{type:"danger",label:Object(r.a)("common.delete"),returnValue:!0}]})),Object(p.a)(e=>e?this.dataService.collection.deleteCollection(t):$.a)).subscribe(()=>{this.notificationService.success(Object(r.a)("common.notify-delete-success"),{entity:"Collection"}),this.refresh()},t=>{this.notificationService.error(Object(r.a)("common.notify-delete-error"),{entity:"Collection"})})}closeContents(){const t=Object.assign({},this.route.snapshot.params);delete t.contents,this.router.navigate(["./",t],{relativeTo:this.route,queryParamsHandling:"preserve"})}refresh(){this.queryResult.ref.refetch()}};Un.\u0275fac=function(t){return new(t||Un)(a.gc(o.K),a.gc(o.yb),a.gc(o.xb),a.gc(i.e),a.gc(i.a))},Un.\u0275cmp=a.ac({type:Un,selectors:[["vdr-collection-list"]],decls:19,vars:19,consts:[[1,"expand-all-toggle"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],["locationId","collection-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[1,"collection-wrapper"],[3,"collections","activeCollectionId","expandAll","rearrange","deleteCollection"],[1,"collection-contents"],[3,"collectionId"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"collection-title"],["type","button",1,"close-button",3,"click"],["shape","close"]],template:function(t,e){1&t&&(a.mc(0,"vdr-action-bar"),a.mc(1,"vdr-ab-left"),a.mc(2,"clr-checkbox-wrapper",0),a.mc(3,"input",1),a.uc("ngModelChange",(function(t){return e.expandAll=t})),a.lc(),a.mc(4,"label"),a.ad(5),a.xc(6,"translate"),a.lc(),a.lc(),a.lc(),a.mc(7,"vdr-ab-right"),a.hc(8,"vdr-action-bar-items",2),a.Yc(9,jt,4,5,"a",3),a.lc(),a.lc(),a.mc(10,"div",4),a.mc(11,"vdr-collection-tree",5),a.uc("rearrange",(function(t){return e.onRearrange(t)}))("deleteCollection",(function(t){return e.deleteCollection(t)})),a.xc(12,"async"),a.xc(13,"async"),a.lc(),a.mc(14,"div",6),a.xc(15,"async"),a.mc(16,"vdr-collection-contents",7),a.xc(17,"async"),a.Yc(18,Dt,6,9,"ng-template"),a.lc(),a.lc(),a.lc()),2&t&&(a.Ub(3),a.Dc("ngModel",e.expandAll),a.Ub(2),a.bd(a.yc(6,9,"catalog.expand-all-collections")),a.Ub(4),a.Dc("vdrIfPermissions","CreateCatalog"),a.Ub(2),a.Dc("collections",a.yc(12,11,e.items$))("activeCollectionId",a.yc(13,13,e.activeCollectionId$))("expandAll",e.expandAll),a.Ub(3),a.Xb("expanded",a.yc(15,15,e.activeCollectionId$)),a.Ub(2),a.Dc("collectionId",a.yc(17,17,e.activeCollectionId$)))},directives:function(){return[o.c,o.e,tt.k,o.db,S.a,tt.i,S.p,S.s,tt.t,o.f,o.d,o.ob,la,Dn,i.h,tt.o]},pipes:function(){return[W.d,B.b]},styles:["[_nghost-%COMP%]{height:100%;display:flex;flex-direction:column}.expand-all-toggle[_ngcontent-%COMP%]{display:block;margin-top:14px}.collection-wrapper[_ngcontent-%COMP%]{display:flex;height:calc(100% - 50px)}.collection-wrapper[_ngcontent-%COMP%]   vdr-collection-tree[_ngcontent-%COMP%]{flex:1;height:100%;overflow:auto}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents[_ngcontent-%COMP%]{height:100%;width:0;opacity:0;visibility:hidden;overflow:auto;transition:width .3s,opacity .2s .3s,visibility .3s}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents.expanded[_ngcontent-%COMP%]{width:30vw;visibility:visible;opacity:1;padding-left:12px}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{margin:0;background:0 0;border:none;cursor:pointer}.paging-controls[_ngcontent-%COMP%]{padding-top:6px;border-top:1px solid #f2f3f5;display:flex;justify-content:space-between}"],changeDetection:0}),Un.ctorParameters=()=>[{type:o.K},{type:o.yb},{type:o.xb},{type:i.e},{type:i.a}],Un=Object(n.c)([Object(n.f)("design:paramtypes",[o.K,o.yb,o.xb,i.e,i.a])],Un);let kn=class extends o.u{constructor(t,e,c,n,a,i,o,r){super(e,t,c,a),this.changeDetector=n,this.dataService=a,this.formBuilder=i,this.notificationService=o,this.modalService=r,this.customFields=this.getCustomFieldConfig("Facet"),this.customValueFields=this.getCustomFieldConfig("FacetValue"),this.detailForm=this.formBuilder.group({facet:this.formBuilder.group({code:["",S.C.required],name:"",visible:!0,customFields:this.formBuilder.group(this.customFields.reduce((t,e)=>Object.assign(Object.assign({},t),{[e.name]:""}),{}))}),values:this.formBuilder.array([])})}ngOnInit(){this.init()}ngOnDestroy(){this.destroy()}updateCode(t,e){if(!t){const t=this.detailForm.get(["facet","code"]);t&&t.pristine&&t.setValue(Object(K.normalizeString)(e,"-"))}}updateValueCode(t,e,c){if(!t){const t=this.detailForm.get(["values",c,"code"]);t&&t.pristine&&t.setValue(Object(K.normalizeString)(e,"-"))}}customFieldIsSet(t){return!!this.detailForm.get(["facet","customFields",t])}customValueFieldIsSet(t,e){return!!this.detailForm.get(["values",t,"customFields",e])}getValuesFormArray(){return this.detailForm.get("values")}addFacetValue(){const t=this.detailForm.get("values");t&&(t.insert(t.length,this.formBuilder.group({name:["",S.C.required],code:""})),this.values.push({name:"",code:""}))}create(){const t=this.detailForm.get("facet");t&&t.dirty&&Object(A.a)(this.entity$,this.languageCode$).pipe(Object(f.a)(1),Object(v.a)(([e,c])=>{const n=this.getUpdatedFacet(e,t,c);return this.dataService.facet.createFacet(n)}),Object(p.a)(t=>this.dataService.facet.getAllFacets(!0).single$.pipe(Object(y.a)(t)))).subscribe(t=>{this.notificationService.success(Object(r.a)("common.notify-create-success"),{entity:"Facet"}),this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.router.navigate(["../",t.createFacet.id],{relativeTo:this.route})},t=>{this.notificationService.error(Object(r.a)("common.notify-create-error"),{entity:"Facet"})})}save(){Object(A.a)(this.entity$,this.languageCode$).pipe(Object(f.a)(1),Object(v.a)(([t,e])=>{const c=this.detailForm.get("facet"),n=[];if(c&&c.dirty){const a=this.getUpdatedFacet(t,c,e);a&&n.push(this.dataService.facet.updateFacet(a))}const a=this.detailForm.get("values");if(a&&a.dirty){const c=a.controls.filter(t=>!t.value.id).map(c=>({facetId:t.id,code:c.value.code,translations:[{name:c.value.name,languageCode:e}]}));c.length&&n.push(this.dataService.facet.createFacetValues(c).pipe(Object(p.a)(()=>this.dataService.facet.getFacet(this.id).single$)));const i=this.getUpdatedFacetValues(t,a,e);i.length&&n.push(this.dataService.facet.updateFacetValues(i))}return Object(R.a)(n)}),Object(p.a)(()=>this.dataService.facet.getAllFacets(!0).single$)).subscribe(()=>{this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success(Object(r.a)("common.notify-update-success"),{entity:"Facet"})},t=>{this.notificationService.error(Object(r.a)("common.notify-update-error"),{entity:"Facet"})})}deleteFacetValue(t,e){if(!t){const t=this.detailForm.get("values");return t&&t.removeAt(e),void this.values.splice(e,1)}this.showModalAndDelete(t).pipe(Object(p.a)(e=>e.result===o.O.DELETED?[!0]:this.showModalAndDelete(t,e.message||"").pipe(Object(s.a)(t=>t.result===o.O.DELETED))),Object(p.a)(t=>t?this.dataService.facet.getFacet(this.id).single$:[])).subscribe(()=>{this.notificationService.success(Object(r.a)("common.notify-delete-success"),{entity:"FacetValue"})},t=>{this.notificationService.error(Object(r.a)("common.notify-delete-error"),{entity:"FacetValue"})})}showModalAndDelete(t,e){return this.modalService.dialog({title:Object(r.a)("catalog.confirm-delete-facet-value"),body:e,buttons:[{type:"secondary",label:Object(r.a)("common.cancel")},{type:"danger",label:Object(r.a)("common.delete"),returnValue:!0}]}).pipe(Object(p.a)(c=>c?this.dataService.facet.deleteFacetValues([t],!!e):$.a),Object(s.a)(t=>t.deleteFacetValues[0]))}setFormValues(t,e){const c=t.translations.find(t=>t.languageCode===e);if(this.detailForm.patchValue({facet:{code:t.code,visible:!t.isPrivate,name:c?c.name:""}}),this.customFields.length){const e=this.detailForm.get(["facet","customFields"]);for(const n of this.customFields){const a=n.name,i="localeString"===n.type?c.customFields[a]:t.customFields[a],o=e.get(a);o&&o.patchValue(i)}}const n=this.detailForm.get("values");n.clear(),this.values=[...t.values],t.values.forEach((t,c)=>{const a=t.translations&&t.translations.find(t=>t.languageCode===e),i={id:t.id,code:t.code,name:a?a.name:""};if(n.insert(c,this.formBuilder.group(i)),this.customValueFields.length){let e=this.detailForm.get(["values",c,"customFields"]);if(e||(e=new S.i({}),this.detailForm.get(["values",c]).addControl("customFields",e)),e)for(const c of this.customValueFields){const n=c.name,i="localeString"===c.type?a.customFields[n]:t.customFields[n],o=e.get(n);o?o.setValue(i):e.addControl(n,new S.f(i))}}})}getUpdatedFacet(t,e,c){const n=Object(o.Rb)({translatable:t,updatedFields:e.value,customFieldConfig:this.customFields,languageCode:c,defaultTranslation:{languageCode:c,name:t.name||""}});return n.isPrivate=!e.value.visible,n}getUpdatedFacetValues(t,e,c){const n=t.values.filter((t,c)=>{const n=e.get(c.toString());return n&&n.dirty&&n.value.id}),a=e.controls.filter(t=>t.dirty&&t.value.id).map(t=>t.value);if(n.length!==a.length)throw new Error(Object(r.a)("error.facet-value-form-values-do-not-match"));return n.map((t,e)=>Object(o.Rb)({translatable:t,updatedFields:a[e],customFieldConfig:this.customValueFields,languageCode:c,defaultTranslation:{languageCode:c,name:""}})).filter(q.notNullOrUndefined)}};kn.\u0275fac=function(t){return new(t||kn)(a.gc(i.e),a.gc(i.a),a.gc(o.Fb),a.gc(a.k),a.gc(o.K),a.gc(S.e),a.gc(o.yb),a.gc(o.xb))},kn.\u0275cmp=a.ac({type:kn,selectors:[["vdr-facet-detail"]],features:[a.Rb],decls:16,vars:19,consts:[[3,"entity"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","facet-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup"],["formGroupName","facet",1,"form-block"],["for","visibility",3,"label"],["type","checkbox","clrToggle","","formControlName","visible","id","visibility",3,"vdrDisabled"],[1,"visible-toggle"],[4,"ngIf","ngIfElse"],["private",""],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],["for","code",3,"label","readOnlyToggle"],["id","code","type","text","formControlName","code",3,"readonly"],["formGroupName","customFields",4,"ngIf"],["class","form-block",4,"ngIf"],["formGroupName","customFields"],[4,"ngFor","ngForOf"],["entityName","Facet",3,"customFieldsFormGroup","customField",4,"ngIf"],["entityName","Facet",3,"customFieldsFormGroup","customField"],[1,"form-block"],["class","facet-values-list table","formArrayName","values",4,"ngIf"],["type","button","class","btn btn-secondary",3,"click",4,"vdrIfPermissions"],["formArrayName","values",1,"facet-values-list","table"],["class","facet-value",3,"formGroupName",4,"ngFor","ngForOf"],[1,"facet-value",3,"formGroupName"],[1,"align-middle"],["type","text","formControlName","name",3,"readonly","input"],["type","text","formControlName","code","readonly",""],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],["entityName","FacetValue",3,"showLabel","customFieldsFormGroup","customField",4,"ngIf"],["entityName","FacetValue",3,"showLabel","customFieldsFormGroup","customField"],["type","button",1,"btn","btn-secondary",3,"click"],["shape","add"]],template:function(t,e){if(1&t&&(a.mc(0,"vdr-action-bar"),a.mc(1,"vdr-ab-left"),a.hc(2,"vdr-entity-info",0),a.xc(3,"async"),a.mc(4,"vdr-language-selector",1),a.uc("languageCodeChange",(function(t){return e.setLanguage(t)})),a.xc(5,"async"),a.xc(6,"async"),a.xc(7,"async"),a.lc(),a.lc(),a.mc(8,"vdr-ab-right"),a.hc(9,"vdr-action-bar-items",2),a.Yc(10,It,3,4,"button",3),a.xc(11,"async"),a.Yc(12,kt,1,1,"ng-template",null,4,a.Zc),a.lc(),a.lc(),a.Yc(14,qt,23,28,"form",5),a.xc(15,"async")),2&t){const t=a.Oc(13);a.Ub(2),a.Dc("entity",a.yc(3,7,e.entity$)),a.Ub(2),a.Dc("disabled",a.yc(5,9,e.isNew$))("availableLanguageCodes",a.yc(6,11,e.availableLanguages$))("currentLanguageCode",a.yc(7,13,e.languageCode$)),a.Ub(6),a.Dc("ngIf",a.yc(11,15,e.isNew$))("ngIfElse",t),a.Ub(4),a.Dc("ngIf",a.yc(15,17,e.entity$))}},directives:[o.c,o.e,o.Z,o.ub,o.f,o.d,B.p,o.ob,S.E,S.q,S.j,S.k,o.cb,tt.k,o.db,S.a,tt.i,S.p,S.h,o.R,tt.t,S.b,B.o,o.H,S.d,o.S,o.V,tt.o,o.U,o.T],pipes:[B.b,W.d,o.gb],styles:[".visible-toggle[_ngcontent-%COMP%]{margin-top:-3px!important}"],changeDetection:0}),kn.ctorParameters=()=>[{type:i.e},{type:i.a},{type:o.Fb},{type:a.k},{type:o.K},{type:S.e},{type:o.yb},{type:o.xb}],kn=Object(n.c)([Object(n.f)("design:paramtypes",[i.e,i.a,o.Fb,a.k,o.K,S.e,o.yb,o.xb])],kn);let Vn=class extends o.w{constructor(t,e,c,n,a){super(n,a),this.dataService=t,this.modalService=e,this.notificationService=c,this.initialLimit=3,this.displayLimit={},super.setQueryFn((...t)=>this.dataService.facet.getFacets(...t).refetchOnChannelChange(),t=>t.facets)}toggleDisplayLimit(t){this.displayLimit[t.id]===t.values.length?this.displayLimit[t.id]=this.initialLimit:this.displayLimit[t.id]=t.values.length}deleteFacet(t){this.showModalAndDelete(t).pipe(Object(p.a)(e=>e.result===o.O.DELETED?[!0]:this.showModalAndDelete(t,e.message||"").pipe(Object(s.a)(t=>t.result===o.O.DELETED)))).subscribe(()=>{this.notificationService.success(Object(r.a)("common.notify-delete-success"),{entity:"FacetValue"}),this.refresh()},t=>{this.notificationService.error(Object(r.a)("common.notify-delete-error"),{entity:"FacetValue"})})}showModalAndDelete(t,e){return this.modalService.dialog({title:Object(r.a)("catalog.confirm-delete-facet"),body:e,buttons:[{type:"secondary",label:Object(r.a)("common.cancel")},{type:"danger",label:Object(r.a)("common.delete"),returnValue:!0}]}).pipe(Object(p.a)(c=>c?this.dataService.facet.deleteFacet(t,!!e):$.a),Object(s.a)(t=>t.deleteFacet))}};Vn.\u0275fac=function(t){return new(t||Vn)(a.gc(o.K),a.gc(o.xb),a.gc(o.yb),a.gc(i.e),a.gc(i.a))},Vn.\u0275cmp=a.ac({type:Vn,selectors:[["vdr-facet-list"]],features:[a.Rb],decls:24,vars:26,consts:[["locationId","facet-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[3,"expand"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"left","align-middle"],[3,"facetValue","removable","displayFacetName",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary btn-icon",3,"click",4,"ngIf"],[4,"ngIf","ngIfElse"],["private",""],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"facetValue","removable","displayFacetName"],[1,"btn","btn-sm","btn-secondary","btn-icon",3,"click"],["collapse",""],["shape","minus"]],template:function(t,e){1&t&&(a.mc(0,"vdr-action-bar"),a.mc(1,"vdr-ab-right"),a.hc(2,"vdr-action-bar-items",0),a.Yc(3,Bt,4,5,"a",1),a.lc(),a.lc(),a.mc(4,"vdr-data-table",2),a.uc("pageChange",(function(t){return e.setPageNumber(t)}))("itemsPerPageChange",(function(t){return e.setItemsPerPage(t)})),a.xc(5,"async"),a.xc(6,"async"),a.xc(7,"async"),a.xc(8,"async"),a.mc(9,"vdr-dt-column"),a.ad(10),a.xc(11,"translate"),a.lc(),a.mc(12,"vdr-dt-column"),a.ad(13),a.xc(14,"translate"),a.lc(),a.mc(15,"vdr-dt-column",3),a.ad(16),a.xc(17,"translate"),a.lc(),a.mc(18,"vdr-dt-column"),a.ad(19),a.xc(20,"translate"),a.lc(),a.hc(21,"vdr-dt-column"),a.hc(22,"vdr-dt-column"),a.Yc(23,te,28,37,"ng-template"),a.lc()),2&t&&(a.Ub(3),a.Dc("vdrIfPermissions","CreateCatalog"),a.Ub(1),a.Dc("items",a.yc(5,10,e.items$))("itemsPerPage",a.yc(6,12,e.itemsPerPage$))("totalItems",a.yc(7,14,e.totalItems$))("currentPage",a.yc(8,16,e.currentPage$)),a.Ub(6),a.bd(a.yc(11,18,"common.code")),a.Ub(3),a.bd(a.yc(14,20,"common.name")),a.Ub(2),a.Dc("expand",!0),a.Ub(1),a.bd(a.yc(17,22,"catalog.values")),a.Ub(3),a.bd(a.yc(20,24,"catalog.visibility")))},directives:[o.c,o.f,o.d,o.ob,o.M,o.L,i.h,tt.o,B.o,B.p,o.B,o.Kb,o.S,o.V,o.U,o.T,o.ab],pipes:[B.b,W.d,B.y,o.gb],styles:["td.private[_ngcontent-%COMP%]{background-color:#f2f3f5}"]}),Vn.ctorParameters=()=>[{type:o.K},{type:o.xb},{type:o.yb},{type:i.e},{type:i.a}],Vn=Object(n.c)([Object(n.f)("design:paramtypes",[o.K,o.xb,o.yb,i.e,i.a])],Vn);let Mn=class{constructor(t){this.dataService=t}getFacets(){return this.dataService.facet.getAllFacets().mapSingle(t=>t.facets.items)}getTaxCategories(){return this.dataService.settings.getTaxCategories().mapSingle(t=>t.taxCategories).pipe(Object(h.a)(1))}createProductWithVariants(t,e,c){const n=this.dataService.product.createProduct(t),a=e.groups.filter(t=>0<t.values.length),i=this.createProductOptionGroups(a,c);return Object(R.a)(n,i).pipe(Object(v.a)(([{createProduct:t},e])=>(e.length?Object(R.a)(e.map(e=>this.dataService.product.addOptionGroupToProduct({productId:t.id,optionGroupId:e.id}))):Object(N.a)([])).pipe(Object(s.a)(()=>({createProduct:t,optionGroups:e})))),Object(v.a)(({createProduct:t,optionGroups:n})=>{const a=e.variants.map(t=>{const e=n.length?t.optionValues.map((t,e)=>{const c=n[e].options.find(e=>e.name===t);if(!c)throw new Error(`Could not find a matching ProductOption "${t}" when creating variant`);return c.id}):[];return Object.assign(Object.assign({},t),{optionIds:e})}),i=n.map(t=>t.options).reduce((t,e)=>[...t,...e],[]);return this.createProductVariants(t,a,i,c)}))}createProductOptionGroups(t,e){return t.length?Object(R.a)(t.map(t=>this.dataService.product.createProductOptionGroups({code:Object(K.normalizeString)(t.name,"-"),translations:[{languageCode:e,name:t.name}],options:t.values.map(t=>({code:Object(K.normalizeString)(t,"-"),translations:[{languageCode:e,name:t}]}))}).pipe(Object(s.a)(t=>t.createProductOptionGroup)))):Object(N.a)([])}createProductVariants(t,e,c,n){const a=e.map(e=>{const a=c.length?`${t.name} ${e.optionIds.map(t=>c.find(e=>e.id===t)).filter(q.notNullOrUndefined).map(t=>t.name).join(" ")}`:t.name;return{productId:t.id,price:e.price,sku:e.sku,stockOnHand:e.stock,translations:[{languageCode:n,name:a}],optionIds:e.optionIds}});return this.dataService.product.createProductVariants(a).pipe(Object(s.a)(({createProductVariants:e})=>({createProductVariants:e,productId:t.id})))}updateProduct(t,e){const c=[];return t&&c.push(this.dataService.product.updateProduct(t)),e&&c.push(this.dataService.product.updateProductVariants(e)),Object(R.a)(c)}updateProductOption(t){return this.dataService.product.updateProductOption(t)}deleteProductVariant(t,e){return this.dataService.product.deleteProductVariant(t).pipe(Object(p.a)(t=>t.deleteProductVariant.result===o.O.DELETED?this.dataService.product.getProduct(e).single$:Object(L.a)(t.deleteProductVariant.message)))}};Mn.\u0275fac=function(t){return new(t||Mn)(a.qc(o.K))},Mn.ctorParameters=()=>[{type:o.K}],Mn.\u0275prov=Object(a.cc)({factory:function(){return new Mn(Object(a.qc)(o.K))},token:Mn,providedIn:"root"}),Mn=Object(n.c)([Object(n.f)("design:paramtypes",[o.K])],Mn);let Sn=class{constructor(t){this.changeDetector=t,this.selectedValues=[]}ngAfterViewInit(){setTimeout(()=>this.selector.focus(),0)}selectValues(){this.resolveWith(this.selectedValues)}cancel(){this.resolveWith()}};Sn.\u0275fac=function(t){return new(t||Sn)(a.gc(a.k))},Sn.\u0275cmp=a.ac({type:Sn,selectors:[["vdr-apply-facet-dialog"]],viewQuery:function(t,e){var c;(1&t&&a.gd(o.bb,!0),2&t)&&(a.Nc(c=a.vc())&&(e.selector=c.first))},decls:3,vars:1,consts:[["vdrDialogTitle",""],[3,"facets","selectedValuesChange"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(t,e){1&t&&(a.Yc(0,ee,2,3,"ng-template",0),a.mc(1,"vdr-facet-value-selector",1),a.uc("selectedValuesChange",(function(t){return e.selectedValues=t})),a.lc(),a.Yc(2,ce,6,7,"ng-template",2)),2&t&&(a.Ub(1),a.Dc("facets",e.facets))},directives:[o.Q,o.bb,o.P],pipes:[W.d],styles:[""],changeDetection:0}),Sn.ctorParameters=()=>[{type:a.k}],Object(n.c)([Object(a.fb)(o.bb),Object(n.f)("design:type",o.bb)],Sn.prototype,"selector",void 0),Sn=Object(n.c)([Object(n.f)("design:paramtypes",[a.k])],Sn);let _n=class{constructor(t,e){this.dataService=t,this.notificationService=e,this.priceFactorControl=new S.f(1),this.selectedChannelIdControl=new S.f}ngOnInit(){const t=this.dataService.client.userStatus().mapSingle(({userStatus:t})=>t.activeChannelId),e=this.dataService.settings.getChannels().mapSingle(t=>t.channels);Object(A.a)(t,e).subscribe(([t,e])=>{this.currentChannel=e.find(e=>e.id===t),this.availableChannels=e}),this.selectedChannelIdControl.valueChanges.subscribe(t=>{this.selectChannel(t)}),this.variantsPreview$=Object(A.a)(Object(G.a)(this.getTopVariants(10)),this.priceFactorControl.valueChanges.pipe(Object(m.a)(1))).pipe(Object(s.a)(([t,e])=>t.map(t=>({id:t.id,name:t.name,price:t.price,pricePreview:t.price*+e}))))}selectChannel(t){this.selectedChannel=this.availableChannels.find(e=>e.id===t[0])}assign(){const t=this.selectedChannel;t&&this.dataService.product.assignProductsToChannel({channelId:t.id,productIds:this.productIds,priceFactor:+this.priceFactorControl.value}).subscribe(()=>{this.notificationService.success(Object(r.a)("catalog.assign-product-to-channel-success"),{channel:t.code}),this.resolveWith(!0)})}cancel(){this.resolveWith()}getTopVariants(t){return Object(n.b)(this,void 0,void 0,(function*(){const e=[];for(let c=0;c<this.productIds.length&&e.length<t;c++){const t=yield this.dataService.product.getProduct(this.productIds[c]).mapSingle(({product:t})=>t&&t.variants).toPromise();e.push(...t||[])}return e.slice(0,t)}))}};_n.\u0275fac=function(t){return new(t||_n)(a.gc(o.K),a.gc(o.yb))},_n.\u0275cmp=a.ac({type:_n,selectors:[["vdr-assign-products-to-channel-dialog"]],decls:36,vars:31,consts:[["vdrDialogTitle",""],[1,"flex"],["clrInput","",3,"multiple","includeDefaultChannel","formControl"],[1,"flex-spacer"],["clrInput","","type","number","min","0","max","99999",3,"formControl"],[1,"channel-price-preview"],[1,"clr-control-label"],[1,"table"],[3,"ngIf","ngIfElse"],["noSelection",""],[4,"ngFor","ngForOf"],["vdrDialogButtons",""],["noChannelSelected",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(t,e){if(1&t&&(a.Yc(0,ne,2,3,"ng-template",0),a.mc(1,"div",1),a.mc(2,"clr-input-container"),a.mc(3,"label"),a.ad(4),a.xc(5,"translate"),a.lc(),a.hc(6,"vdr-channel-assignment-control",2),a.lc(),a.hc(7,"div",3),a.mc(8,"clr-input-container"),a.mc(9,"label"),a.ad(10),a.xc(11,"translate"),a.lc(),a.hc(12,"input",4),a.lc(),a.lc(),a.mc(13,"div",5),a.mc(14,"label",6),a.ad(15),a.xc(16,"translate"),a.lc(),a.mc(17,"table",7),a.mc(18,"thead"),a.mc(19,"tr"),a.mc(20,"th"),a.ad(21),a.xc(22,"translate"),a.lc(),a.mc(23,"th"),a.ad(24),a.xc(25,"translate"),a.xc(26,"translate"),a.xc(27,"channelCodeToLabel"),a.lc(),a.mc(28,"th"),a.Yc(29,ie,2,6,"ng-template",8),a.Yc(30,oe,2,3,"ng-template",null,9,a.Zc),a.lc(),a.lc(),a.lc(),a.mc(32,"tbody"),a.Yc(33,le,10,7,"tr",10),a.xc(34,"async"),a.lc(),a.lc(),a.lc(),a.Yc(35,me,7,6,"ng-template",11)),2&t){const t=a.Oc(31);a.Ub(4),a.bd(a.yc(5,12,"common.channel")),a.Ub(2),a.Dc("multiple",!1)("includeDefaultChannel",!1)("formControl",e.selectedChannelIdControl),a.Ub(4),a.bd(a.yc(11,14,"catalog.price-conversion-factor")),a.Ub(2),a.Dc("formControl",e.priceFactorControl),a.Ub(3),a.bd(a.yc(16,16,"catalog.channel-price-preview")),a.Ub(6),a.bd(a.yc(22,18,"common.name")),a.Ub(3),a.cd(" ",a.zc(25,20,"catalog.price-in-channel",a.Ic(29,ae,a.yc(26,23,a.yc(27,25,null==e.currentChannel?null:e.currentChannel.code))))," "),a.Ub(5),a.Dc("ngIf",e.selectedChannel)("ngIfElse",t),a.Ub(4),a.Dc("ngForOf",a.yc(34,27,e.variantsPreview$))}},directives:[o.Q,tt.s,tt.t,o.y,tt.r,S.p,S.g,o.db,S.v,S.b,B.p,B.o,o.P],pipes:[W.d,o.A,B.b,B.d],styles:["vdr-channel-assignment-control[_ngcontent-%COMP%]{min-width:200px}.channel-price-preview[_ngcontent-%COMP%]{margin-top:24px}.channel-price-preview[_ngcontent-%COMP%]   table.table[_ngcontent-%COMP%]{margin-top:6px}"],changeDetection:0}),_n.ctorParameters=()=>[{type:o.K},{type:o.yb}],_n=Object(n.c)([Object(n.f)("design:paramtypes",[o.K,o.yb])],_n);let An=class extends o.u{constructor(t,e,c,n,a,i,o,r,s,l){super(t,e,c,r),this.productDetailService=n,this.formBuilder=a,this.modalService=i,this.notificationService=o,this.dataService=r,this.location=s,this.changeDetector=l,this.assetChanges={},this.variantAssetChanges={},this.selectedVariantIds=[],this.variantDisplayMode="card",this.createVariantsConfig={groups:[],variants:[]},this.customFields=this.getCustomFieldConfig("Product"),this.customVariantFields=this.getCustomFieldConfig("ProductVariant"),this.customOptionGroupFields=this.getCustomFieldConfig("ProductOptionGroup"),this.customOptionFields=this.getCustomFieldConfig("ProductOption"),this.detailForm=this.formBuilder.group({product:this.formBuilder.group({enabled:!0,name:["",S.C.required],slug:"",description:"",facetValueIds:[[]],customFields:this.formBuilder.group(this.customFields.reduce((t,e)=>Object.assign(Object.assign({},t),{[e.name]:""}),{}))}),variants:this.formBuilder.array([])})}ngOnInit(){this.init(),this.product$=this.entity$,this.variants$=this.product$.pipe(Object(s.a)(t=>t.variants)),this.taxCategories$=this.productDetailService.getTaxCategories().pipe(Object(d.a)(this.destroy$)),this.activeTab$=this.route.paramMap.pipe(Object(s.a)(t=>t.get("tab"))),this.facets$=this.productDetailService.getFacets();const t=this.product$.pipe(Object(s.a)(t=>t.facetValues)),e=this.facets$.pipe(Object(s.a)(o.Tb)),c=this.getProductFormGroup().valueChanges.pipe(Object(s.a)(t=>t.facetValueIds),Object(g.a)()),n=Object(A.a)(c,t,e).pipe(Object(s.a)(([t,e,c])=>{const n=[...e,...c];return t.map(t=>n.find(e=>e.id===t)).filter(q.notNullOrUndefined)}));this.facetValues$=Object(E.a)(t,n),this.productChannels$=this.product$.pipe(Object(s.a)(t=>t.channels))}ngOnDestroy(){this.destroy()}navigateToTab(t){this.router.navigate(["./",Object.assign(Object.assign({},this.route.snapshot.params),{tab:t})],{queryParamsHandling:"merge",relativeTo:this.route,state:{[o.lb]:!0}})}isDefaultChannel(t){return t===z.DEFAULT_CHANNEL_CODE}assignToChannel(){this.modalService.fromComponent(_n,{size:"lg",locals:{productIds:[this.id]}}).subscribe()}removeFromChannel(t){this.modalService.dialog({title:Object(r.a)("catalog.remove-product-from-channel"),buttons:[{type:"secondary",label:Object(r.a)("common.cancel")},{type:"danger",label:Object(r.a)("catalog.remove-from-channel"),returnValue:!0}]}).pipe(Object(p.a)(e=>e?this.dataService.product.removeProductsFromChannel({channelId:t,productIds:[this.id]}):$.a)).subscribe(()=>{this.notificationService.success(Object(r.a)("catalog.notify-remove-product-from-channel-success"))},t=>{this.notificationService.error(Object(r.a)("catalog.notify-remove-product-from-channel-error"))})}customFieldIsSet(t){return!!this.detailForm.get(["product","customFields",t])}assetsChanged(){return!!Object.values(this.assetChanges).length}variantAssetsChanged(){return!!Object.keys(this.variantAssetChanges).length}variantAssetChange(t){this.variantAssetChanges[t.variantId]=t}updateSlug(t){this.isNew$.pipe(Object(f.a)(1)).subscribe(e=>{if(e){const e=this.detailForm.get(["product","slug"]);e&&e.pristine&&e.setValue(Object(K.normalizeString)(`${t}`,"-"))}})}selectProductFacetValue(){this.displayFacetValueModal().subscribe(t=>{if(t){const e=this.getProductFormGroup(),c=e.value.facetValueIds;e.patchValue({facetValueIds:Object(X.unique)([...c,...t])}),e.markAsDirty()}})}updateProductOption(t){this.productDetailService.updateProductOption(t).subscribe(()=>{this.notificationService.success(Object(r.a)("common.notify-update-success"),{entity:"ProductOption"})},t=>{this.notificationService.error(Object(r.a)("common.notify-update-error"),{entity:"ProductOption"})})}removeProductFacetValue(t){const e=this.getProductFormGroup(),c=e.value.facetValueIds;e.patchValue({facetValueIds:c.filter(e=>e!==t)}),e.markAsDirty()}selectVariantFacetValue(t){this.displayFacetValueModal().pipe(x(this.variants$)).subscribe(([e,c])=>{if(e){for(const n of t){const t=c.findIndex(t=>t.id===n),a=c[t],i=a?a.facetValues.map(t=>t.id):[],o=this.detailForm.get(["variants",t]);o&&(o.patchValue({facetValueIds:Object(X.unique)([...i,...e])}),o.markAsDirty())}this.changeDetector.markForCheck()}})}variantsToCreateAreValid(){return 0<this.createVariantsConfig.variants.length&&this.createVariantsConfig.variants.every(t=>""!==t.sku)}displayFacetValueModal(){return this.productDetailService.getFacets().pipe(Object(v.a)(t=>this.modalService.fromComponent(Sn,{size:"md",closable:!0,locals:{facets:t}})),Object(s.a)(t=>t&&t.map(t=>t.id)))}create(){const t=this.getProductFormGroup();t.dirty&&Object(A.a)(this.product$,this.languageCode$).pipe(Object(f.a)(1),Object(v.a)(([e,c])=>{const n=this.getUpdatedProduct(e,t,c);return this.productDetailService.createProductWithVariants(n,this.createVariantsConfig,c)})).subscribe(({createProductVariants:t,productId:e})=>{this.notificationService.success(Object(r.a)("common.notify-create-success"),{entity:"Product"}),this.assetChanges={},this.variantAssetChanges={},this.detailForm.markAsPristine(),this.router.navigate(["../",e],{relativeTo:this.route})},t=>{console.error(t),this.notificationService.error(Object(r.a)("common.notify-create-error"),{entity:"Product"})})}save(){Object(A.a)(this.product$,this.languageCode$).pipe(Object(f.a)(1),Object(v.a)(([t,e])=>{const c=this.getProductFormGroup();let n,a;(c.dirty||this.assetsChanged())&&(n=this.getUpdatedProduct(t,c,e));const i=this.detailForm.get("variants");return(i&&i.dirty||this.variantAssetsChanged())&&(a=this.getUpdatedProductVariants(t,i,e)),this.productDetailService.updateProduct(n,a)})).subscribe(t=>{this.updateSlugAfterSave(t),this.detailForm.markAsPristine(),this.assetChanges={},this.variantAssetChanges={},this.notificationService.success(Object(r.a)("common.notify-update-success"),{entity:"Product"}),this.changeDetector.markForCheck()},t=>{this.notificationService.error(Object(r.a)("common.notify-update-error"),{entity:"Product"})})}canDeactivate(){return super.canDeactivate()&&!this.assetChanges.assetIds&&!this.assetChanges.featuredAssetId}setFormValues(t,e){const c=t.translations.find(t=>t.languageCode===e);if(this.detailForm.patchValue({product:{enabled:t.enabled,name:c?c.name:"",slug:c?c.slug:"",description:c?c.description:"",facetValueIds:t.facetValues.map(t=>t.id)}}),this.customFields.length){const e=this.detailForm.get(["product","customFields"]),n=c&&c.customFields||{},a=t.customFields||{};for(const t of this.customFields){const c=t.name,i="localeString"===t.type?n[c]:a[c],o=e.get(c);o&&o.patchValue(i)}}const n=this.detailForm.get("variants");t.variants.forEach((t,c)=>{const a=t.translations.find(t=>t.languageCode===e),i=t.facetValues.map(t=>t.id),o={enabled:t.enabled,sku:t.sku,name:a?a.name:"",price:t.price,priceIncludesTax:t.priceIncludesTax,priceWithTax:t.priceWithTax,taxCategoryId:t.taxCategory.id,stockOnHand:t.stockOnHand,trackInventory:t.trackInventory,facetValueIds:i};let r=n.at(c);if(r?r.patchValue(o):(r=this.formBuilder.group(Object.assign(Object.assign({},o),{facetValueIds:this.formBuilder.control(i)})),n.insert(c,r)),this.customVariantFields.length){let e=r.get(["customFields"]);e||(e=this.formBuilder.group(this.customVariantFields.reduce((t,e)=>Object.assign(Object.assign({},t),{[e.name]:""}),{})),r.addControl("customFields",e));for(const c of this.customVariantFields){const n=c.name,i="localeString"===c.type?a.customFields[n]:t.customFields[n],o=e.get(n);o&&o.patchValue(i)}}})}getUpdatedProduct(t,e,c){const n=Object(o.Rb)({translatable:t,updatedFields:e.value,customFieldConfig:this.customFields,languageCode:c,defaultTranslation:{languageCode:c,name:t.name||"",slug:t.slug||"",description:t.description||""}});return Object.assign(Object.assign(Object.assign({},n),this.assetChanges),{facetValueIds:e.value.facetValueIds})}getUpdatedProductVariants(t,e,c){const n=t.variants.filter((t,c)=>{const n=e.get(c.toString());return n&&n.dirty}),a=e.controls.filter(t=>t.dirty).map(t=>t.value);if(n.length!==a.length)throw new Error(Object(r.a)("error.product-variant-form-values-do-not-match"));return n.map((t,e)=>{const n=a[e],i=Object(o.Rb)({translatable:t,updatedFields:n,customFieldConfig:this.customVariantFields,languageCode:c,defaultTranslation:{languageCode:c,name:""}});i.taxCategoryId=n.taxCategoryId,i.facetValueIds=n.facetValueIds;const r=this.variantAssetChanges[t.id];return r&&(i.featuredAssetId=r.featuredAssetId,i.assetIds=r.assetIds),i}).filter(q.notNullOrUndefined)}getProductFormGroup(){return this.detailForm.get("product")}updateSlugAfterSave(t){const e=t[0],c=this.detailForm.get(["product","slug"]);c&&e.hasOwnProperty("updateProduct")&&c.setValue(e.updateProduct.slug,{emitEvent:!1})}};An.\u0275fac=function(t){return new(t||An)(a.gc(i.a),a.gc(i.e),a.gc(o.Fb),a.gc(Mn),a.gc(S.e),a.gc(o.xb),a.gc(o.yb),a.gc(o.K),a.gc(B.l),a.gc(a.k))},An.\u0275cmp=a.ac({type:An,selectors:[["vdr-product-detail"]],features:[a.Rb],decls:18,vars:20,consts:[[1,"flex","clr-flex-row"],[3,"entity"],[4,"vdrIfPermissions"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","product-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup","keydown.enter",4,"ngIf"],["type","checkbox","clrToggle","","name","enabled",3,"formControl"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup","keydown.enter"],["clrTabLink","",3,"click"],[4,"clrIfActive"],[4,"ngIf"],[1,"clr-row"],[1,"clr-col"],["formGroupName","product",1,"form-block"],[4,"vdrIfMultichannel"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],["for","slug",3,"label","errors"],["id","slug","type","text","formControlName","slug","pattern","[a-z0-9_-]+",3,"readonly"],["formControlName","description",3,"readonly","label"],["formGroupName","customFields",4,"ngIf"],[1,"facets"],[3,"facetValue","removable","remove",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary",3,"click",4,"vdrIfPermissions"],[1,"clr-col-md-auto"],[3,"assets","featuredAsset","change"],[3,"label",4,"vdrIfDefaultChannelActive"],[3,"label"],[1,"flex"],[1,"product-channels"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm",3,"click"],["shape","layers"],["icon","times-circle",3,"iconClick",4,"ngIf"],["icon","times-circle",3,"iconClick"],[3,"channelCode"],["formGroupName","customFields"],["entityName","Product",3,"customFieldsFormGroup","customField","readonly",4,"ngIf"],["entityName","Product",3,"customFieldsFormGroup","customField","readonly"],[3,"facetValue","removable","remove"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","plus"],[3,"variantsChange"],[1,"form-block"],[1,"view-mode"],[1,"btn-group","btn-sm"],[1,"btn","btn-secondary-outline",3,"click"],["shape","list"],[1,"btn",3,"click"],["shape","table"],[1,"flex-spacer"],["class","btn btn-secondary btn-sm edit-variants-btn",3,"routerLink",4,"vdrIfPermissions"],[3,"variants","optionGroups","productVariantsFormArray",4,"ngIf"],[3,"variants","facets","optionGroups","productVariantsFormArray","taxCategories","customFields","customOptionFields","activeLanguage","assetChange","updateProductOption","selectionChange","selectFacetValueClick",4,"ngIf"],[1,"btn","btn-secondary","btn-sm","edit-variants-btn",3,"routerLink"],["shape","add-text"],[3,"variants","optionGroups","productVariantsFormArray"],[3,"variants","facets","optionGroups","productVariantsFormArray","taxCategories","customFields","customOptionFields","activeLanguage","assetChange","updateProductOption","selectionChange","selectFacetValueClick"]],template:function(t,e){if(1&t&&(a.mc(0,"vdr-action-bar"),a.mc(1,"vdr-ab-left"),a.mc(2,"div",0),a.hc(3,"vdr-entity-info",1),a.xc(4,"async"),a.Yc(5,be,5,5,"clr-toggle-wrapper",2),a.lc(),a.mc(6,"vdr-language-selector",3),a.uc("languageCodeChange",(function(t){return e.setLanguage(t)})),a.xc(7,"async"),a.xc(8,"async"),a.xc(9,"async"),a.lc(),a.lc(),a.mc(10,"vdr-ab-right"),a.hc(11,"vdr-action-bar-items",4),a.Yc(12,he,3,4,"button",5),a.xc(13,"async"),a.Yc(14,ve,1,1,"ng-template",null,6,a.Zc),a.lc(),a.lc(),a.Yc(16,Te,10,10,"form",7),a.xc(17,"async")),2&t){const t=a.Oc(15);a.Ub(3),a.Dc("entity",a.yc(4,8,e.entity$)),a.Ub(2),a.Dc("vdrIfPermissions","UpdateCatalog"),a.Ub(1),a.Dc("disabled",a.yc(7,10,e.isNew$))("availableLanguageCodes",a.yc(8,12,e.availableLanguages$))("currentLanguageCode",a.yc(9,14,e.languageCode$)),a.Ub(6),a.Dc("ngIf",a.yc(13,16,e.isNew$))("ngIfElse",t),a.Ub(4),a.Dc("ngIf",a.yc(17,18,e.product$))}},directives:function(){return[o.c,o.e,o.Z,o.ob,o.ub,o.f,o.d,B.p,tt.k,o.db,S.a,tt.i,S.p,S.g,tt.t,S.E,S.q,S.j,tt.F,tt.N,tt.C,tt.E,tt.O,tt.p,tt.D,S.k,o.nb,o.cb,S.b,S.h,S.w,o.Db,B.o,ga,o.mb,o.eb,tt.o,o.B,o.z,o.H,o.ab,ua,i.h,va,fa]},pipes:function(){return[B.b,W.d,o.gb,o.A]},styles:["[_nghost-%COMP%]     trix-toolbar{top:24px}vdr-action-bar[_ngcontent-%COMP%]   clr-toggle-wrapper[_ngcontent-%COMP%]{margin-top:12px}.group-name[_ngcontent-%COMP%]{padding-right:6px}.view-mode[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.edit-variants-btn[_ngcontent-%COMP%]{margin-top:0}"],changeDetection:0}),An.ctorParameters=()=>[{type:i.a},{type:i.e},{type:o.Fb},{type:Mn},{type:S.e},{type:o.xb},{type:o.yb},{type:o.K},{type:B.l},{type:a.k}],An=Object(n.c)([Object(n.f)("design:paramtypes",[i.a,i.e,o.Fb,Mn,S.e,o.xb,o.yb,o.K,B.l,a.k])],An);class $n{constructor(){this._selected=[]}get value(){return this._selected}select(t,e,c){if(t.selected=!0,c||!t.children)if(t.value.label){const e=t=>!!t.value.label;this._selected.filter(e).length>0?this._selected=this._selected.filter(t=>!e(t)).concat(t):this._selected.push(t)}else this._selected.push(t)}unselect(t,e){this._selected=this._selected.filter(e=>e!==t),t.selected=!1}clear(t){this._selected=t?this._selected.filter(t=>t.disabled):[]}_setChildrenSelectedState(t,e){t.forEach(t=>t.selected=e)}_removeChildren(t){this._selected=this._selected.filter(e=>e.parent!==t)}_removeParent(t){this._selected=this._selected.filter(e=>e!==t)}}function Tn(){return new $n}const Yn=Tn;let Nn=class{constructor(){this.searchTermChange=new a.u,this.facetValueChange=new a.u,this.lastTerm="",this.lastFacetValueIds=[],this.filterFacetResults=(t,e)=>!!this.isFacetValueItem(e)&&(e.facetValue.name.toLowerCase().startsWith(t.toLowerCase())||e.facetValue.facet.name.toLowerCase().startsWith(t.toLowerCase())),this.groupByFacet=t=>this.isFacetValueItem(t)?t.facetValue.facet.name:"",this.isFacetValueItem=t=>"object"==typeof t&&!!t&&t.hasOwnProperty("facetValue")}setSearchTerm(t){if(t)this.selectComponent.select({label:t,value:{label:t}});else{const t=this.selectComponent.selectedItems.find(t=>!this.isFacetValueItem(t.value));t&&this.selectComponent.unselect(t)}}setFacetValues(t){const e=this.selectComponent.items;this.selectComponent.selectedItems.forEach(e=>{this.isFacetValueItem(e.value)&&!t.includes(e.value.facetValue.id)&&this.selectComponent.unselect(e)}),t.map(t=>e.find(e=>this.isFacetValueItem(e)&&e.facetValue.id===t)).filter(q.notNullOrUndefined).forEach(t=>{this.selectComponent.selectedItems.find(e=>{const c=e.value;return!!this.isFacetValueItem(c)&&c.facetValue.id===t.facetValue.id})||this.selectComponent.select({label:"",value:t})})}onSelectChange(t){Array.isArray(t)||(t=[t]);const e=t.find(t=>!this.isFacetValueItem(t)),c=e?e.label:"",n=t.filter(this.isFacetValueItem).map(t=>t.facetValue.id);c!==this.lastTerm&&(this.searchTermChange.emit(c),this.lastTerm=c),this.lastFacetValueIds.join(",")!==n.join(",")&&(this.facetValueChange.emit(n),this.lastFacetValueIds=n)}isSearchHeaderSelected(){return-1===this.selectComponent.itemsList.markedIndex}};Nn.\u0275fac=function(t){return new(t||Nn)},Nn.\u0275cmp=a.ac({type:Nn,selectors:[["vdr-product-search-input"]],viewQuery:function(t,e){var c;(1&t&&a.Wc(Ye,!0),2&t)&&(a.Nc(c=a.vc())&&(e.selectComponent=c.first))},inputs:{facetValueResults:"facetValueResults"},outputs:{searchTermChange:"searchTermChange",facetValueChange:"facetValueChange"},features:[a.Tb([{provide:H.c,useValue:Yn}])],decls:6,vars:9,consts:[[3,"addTag","placeholder","items","searchFn","hideSelected","multiple","markFirst","change"],["selectComponent",""],["ng-header-tmp",""],["ng-label-tmp",""],["ng-option-tmp",""],["class","search-header",3,"selected","click",4,"ngIf"],[1,"search-header",3,"click"],[4,"ngIf"],[3,"facetValue","removable","remove"],[3,"icon","iconClick"],[3,"facetValue","removable"]],template:function(t,e){1&t&&(a.mc(0,"ng-select",0,1),a.uc("change",(function(t){return e.onSelectChange(t)})),a.xc(2,"translate"),a.Yc(3,Re,1,1,"ng-template",2),a.Yc(4,Ee,2,2,"ng-template",3),a.Yc(5,qe,1,1,"ng-template",4),a.lc()),2&t&&a.Dc("addTag",!0)("placeholder",a.yc(2,7,"catalog.search-product-name-or-code"))("items",e.facetValueResults)("searchFn",e.filterFacetResults)("hideSelected",!0)("multiple",!0)("markFirst",!1)},directives:[H.a,H.f,H.e,H.d,B.p,o.ab,o.B],pipes:[W.d],styles:["[_nghost-%COMP%]{margin-top:6px;display:block;width:100%}[_nghost-%COMP%]     .ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-value{background:0 0;margin:0}[_nghost-%COMP%]     .ng-dropdown-panel-items div.ng-option:last-child{display:none}[_nghost-%COMP%]     .ng-dropdown-panel .ng-dropdown-header{border:none;padding:0}[_nghost-%COMP%]     .ng-select.ng-select-multiple .ng-select-container .ng-value-container{padding:0}[_nghost-%COMP%]     .ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-placeholder{padding-left:8px}ng-select[_ngcontent-%COMP%]{width:100%;min-width:300px;margin-right:12px}.search-header[_ngcontent-%COMP%]{padding:8px 10px;border-bottom:1px solid #f2f3f5;cursor:pointer}.search-header.selected[_ngcontent-%COMP%], .search-header[_ngcontent-%COMP%]:hover{background-color:#f2f3f5}"],changeDetection:0}),Object(n.c)([Object(a.D)(),Object(n.f)("design:type",Array)],Nn.prototype,"facetValueResults",void 0),Object(n.c)([Object(a.O)(),Object(n.f)("design:type",Object)],Nn.prototype,"searchTermChange",void 0),Object(n.c)([Object(a.O)(),Object(n.f)("design:type",Object)],Nn.prototype,"facetValueChange",void 0),Object(n.c)([Object(a.fb)("selectComponent",{static:!0}),Object(n.f)("design:type",H.a)],Nn.prototype,"selectComponent",void 0);let Rn=class extends o.w{constructor(t,e,c,n,a,i){super(a,i),this.dataService=t,this.modalService=e,this.notificationService=c,this.jobQueueService=n,this.searchTerm="",this.facetValueIds=[],this.groupByProduct=!0,super.setQueryFn((...t)=>this.dataService.product.searchProducts(this.searchTerm,...t).refetchOnChannelChange(),t=>t.search,(t,e)=>({input:{skip:t,take:e,term:this.searchTerm,facetValueIds:this.facetValueIds,facetValueOperator:o.wb.AND,groupByProduct:this.groupByProduct}}))}ngOnInit(){super.ngOnInit(),this.facetValues$=this.result$.pipe(Object(s.a)(t=>t.search.facetValues)),this.route.queryParamMap.pipe(Object(s.a)(t=>t.get("q")),Object(d.a)(this.destroy$)).subscribe(t=>{this.productSearchInput.setSearchTerm(t)});const t=this.route.queryParamMap.pipe(Object(s.a)(t=>t.getAll("fvids")));t.pipe(Object(d.a)(this.destroy$)).subscribe(t=>{this.productSearchInput.setFacetValues(t)}),this.facetValues$.pipe(Object(f.a)(1),I(100),x(t)).subscribe(([t,e])=>{this.productSearchInput.setFacetValues(e)})}setSearchTerm(t){this.searchTerm=t,this.setQueryParam({q:t||null,page:1}),this.refresh()}setFacetValueIds(t){this.facetValueIds=t,this.setQueryParam({fvids:t,page:1}),this.refresh()}rebuildSearchIndex(){this.dataService.product.reindex().subscribe(({reindex:t})=>{this.notificationService.info(Object(r.a)("catalog.reindexing")),this.jobQueueService.addJob(t.id,t=>{if(t.state===o.rb.COMPLETED){const e=(new Intl.NumberFormat).format(t.duration||0);this.notificationService.success(Object(r.a)("catalog.reindex-successful"),{count:t.result.indexedItemCount,time:e}),this.refresh()}else this.notificationService.error(Object(r.a)("catalog.reindex-error"))})})}deleteProduct(t){this.modalService.dialog({title:Object(r.a)("catalog.confirm-delete-product"),buttons:[{type:"secondary",label:Object(r.a)("common.cancel")},{type:"danger",label:Object(r.a)("common.delete"),returnValue:!0}]}).pipe(Object(p.a)(e=>e?this.dataService.product.deleteProduct(t):$.a)).subscribe(()=>{this.notificationService.success(Object(r.a)("common.notify-delete-success"),{entity:"Product"}),this.refresh()},t=>{this.notificationService.error(Object(r.a)("common.notify-delete-error"),{entity:"Product"})})}};Rn.\u0275fac=function(t){return new(t||Rn)(a.gc(o.K),a.gc(o.xb),a.gc(o.yb),a.gc(o.qb),a.gc(i.e),a.gc(i.a))},Rn.\u0275cmp=a.ac({type:Rn,selectors:[["vdr-products-list"]],viewQuery:function(t,e){var c;(1&t&&a.Wc(Be,!0),2&t)&&(a.Nc(c=a.vc())&&(e.productSearchInput=c.first))},features:[a.Rb],decls:28,vars:27,consts:[[3,"grow"],[1,"search-form"],[3,"facetValueResults","searchTermChange","facetValueChange"],["productSearchInputComponent",""],[1,"search-settings-menu"],["type","button","vdrDropdownTrigger","",1,"icon-button"],["shape","cog"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",3,"disabled","click"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],["locationId","product-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"full-label"],[1,"left","align-middle"],[1,"image-placeholder"],[3,"src",4,"ngIf","ngIfElse"],["imagePlaceholder",""],[1,"align-middle"],[4,"ngIf"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"src"],[1,"placeholder"],["shape","image","size","48"]],template:function(t,e){1&t&&(a.mc(0,"vdr-action-bar"),a.mc(1,"vdr-ab-left",0),a.mc(2,"div",1),a.mc(3,"vdr-product-search-input",2,3),a.uc("searchTermChange",(function(t){return e.setSearchTerm(t)}))("facetValueChange",(function(t){return e.setFacetValueIds(t)})),a.xc(5,"async"),a.lc(),a.mc(6,"vdr-dropdown",4),a.mc(7,"button",5),a.hc(8,"clr-icon",6),a.lc(),a.mc(9,"vdr-dropdown-menu",7),a.mc(10,"button",8),a.uc("click",(function(){return e.rebuildSearchIndex()})),a.xc(11,"hasPermission"),a.ad(12),a.xc(13,"translate"),a.lc(),a.lc(),a.lc(),a.lc(),a.mc(14,"clr-checkbox-wrapper"),a.mc(15,"input",9),a.uc("ngModelChange",(function(t){return e.groupByProduct=t})),a.lc(),a.mc(16,"label"),a.ad(17),a.xc(18,"translate"),a.lc(),a.lc(),a.lc(),a.mc(19,"vdr-ab-right"),a.hc(20,"vdr-action-bar-items",10),a.Yc(21,ze,5,5,"a",11),a.lc(),a.lc(),a.mc(22,"vdr-data-table",12),a.uc("pageChange",(function(t){return e.setPageNumber(t)}))("itemsPerPageChange",(function(t){return e.setItemsPerPage(t)})),a.xc(23,"async"),a.xc(24,"async"),a.xc(25,"async"),a.xc(26,"async"),a.Yc(27,Qe,24,29,"ng-template"),a.lc()),2&t&&(a.Ub(1),a.Dc("grow",!0),a.Ub(2),a.Dc("facetValueResults",a.yc(5,11,e.facetValues$)),a.Ub(7),a.Dc("disabled",!a.yc(11,13,"UpdateCatalog")),a.Ub(2),a.cd(" ",a.yc(13,15,"catalog.rebuild-search-index")," "),a.Ub(3),a.Dc("ngModel",e.groupByProduct),a.Ub(2),a.bd(a.yc(18,17,"catalog.group-by-product")),a.Ub(4),a.Dc("vdrIfPermissions","CreateCatalog"),a.Ub(1),a.Dc("items",a.yc(23,19,e.items$))("itemsPerPage",a.yc(24,21,e.itemsPerPage$))("totalItems",a.yc(25,23,e.totalItems$))("currentPage",a.yc(26,25,e.currentPage$)))},directives:[o.c,o.e,Nn,o.S,o.V,tt.o,o.U,o.T,tt.k,o.db,S.a,tt.i,S.p,S.s,tt.t,o.f,o.d,o.ob,o.M,i.h,B.p,o.Kb,o.B],pipes:[B.b,o.gb,W.d,o.q],styles:[".image-placeholder[_ngcontent-%COMP%]{width:50px;height:50px;background-color:#f2f3f5}.image-placeholder[_ngcontent-%COMP%]   .placeholder[_ngcontent-%COMP%]{text-align:center;color:#bfc3cc}.search-form[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;margin-bottom:6px}.search-input[_ngcontent-%COMP%]{min-width:300px}@media screen and (max-width:768px){.search-input[_ngcontent-%COMP%]{min-width:100px}}.search-settings-menu[_ngcontent-%COMP%]{margin:0 12px}td.disabled[_ngcontent-%COMP%]{background-color:#f2f3f5}"]}),Rn.ctorParameters=()=>[{type:o.K},{type:o.xb},{type:o.yb},{type:o.qb},{type:i.e},{type:i.a}],Object(n.c)([Object(a.fb)("productSearchInputComponent",{static:!0}),Object(n.f)("design:type",Nn)],Rn.prototype,"productSearchInput",void 0),Rn=Object(n.c)([Object(n.f)("design:paramtypes",[o.K,o.xb,o.yb,o.qb,i.e,i.a])],Rn);let Ln=class{constructor(t,e,c,n,a){this.route=t,this.dataService=e,this.productDetailService=c,this.notificationService=n,this.modalService=a,this.formValueChanged=!1,this.variants=[],this.variantFormValues={}}ngOnInit(){this.initOptionsAndVariants(),this.languageCode=this.route.snapshot.paramMap.get("lang")||Object(o.Vb)(),this.dataService.settings.getActiveChannel().single$.subscribe(t=>{this.currencyCode=t.activeChannel.currencyCode})}onFormChanged(t){this.formValueChanged=!0,t.enabled=!0}canDeactivate(){return!this.formValueChanged}getVariantsToAdd(){return Object.values(this.variantFormValues).filter(t=>!t.existing&&t.enabled)}getVariantName(t){return 0===t.options.length?Object(r.a)("catalog.default-variant"):t.options.map(t=>t.name).join(" ")}addOption(){this.optionGroups.push({isNew:!0,name:"",values:[]})}generateVariants(){const t=this.optionGroups.map(t=>t.values),e=this.variants;this.variants=t.length?Object(q.generateAllCombinations)(t).map((t,e)=>({isDefault:1===this.product.variants.length&&0===e,id:t.map(t=>t.name).join("|"),options:t})):[{isDefault:!0,id:"__DEFAULT_VARIANT__",options:[]}],this.variants.forEach(t=>{if(!this.variantFormValues[t.id]){const c=this.getVariantPrototype(t,e);this.variantFormValues[t.id]={enabled:!1,existing:!1,options:t.options.map(t=>t.name),price:c.price,sku:c.sku,stock:c.stock}}})}getVariantPrototype(t,e){if(t.isDefault)return this.variantFormValues.__DEFAULT_VARIANT__;const c=e.filter(e=>t.options.map(t=>t.name).filter(t=>e.options.map(t=>t.name).includes(t)));return c.length?this.variantFormValues[c[0].options.map(t=>t.name).join("|")]:{sku:"",price:0,stock:0}}deleteVariant(t){this.modalService.dialog({title:Object(r.a)("catalog.confirm-delete-product-variant"),buttons:[{type:"secondary",label:Object(r.a)("common.cancel")},{type:"danger",label:Object(r.a)("common.delete"),returnValue:!0}]}).pipe(Object(p.a)(e=>e?this.productDetailService.deleteProductVariant(t,this.product.id):$.a),Object(p.a)(()=>this.reFetchProduct(null))).subscribe(()=>{this.notificationService.success(Object(r.a)("common.notify-delete-success"),{entity:"ProductVariant"}),this.initOptionsAndVariants()},t=>{this.notificationService.error(Object(r.a)("common.notify-delete-error"),{entity:"ProductVariant"})})}save(){const t=this.optionGroups.filter(t=>t.isNew).map(t=>({name:t.name,values:[]}));this.confirmDeletionOfDefault().pipe(Object(v.a)(()=>this.productDetailService.createProductOptionGroups(t,this.languageCode)),Object(v.a)(t=>this.addOptionGroupsToProduct(t)),Object(v.a)(t=>this.addNewOptionsToGroups(t)),Object(v.a)(t=>this.fetchOptionGroups(t)),Object(v.a)(t=>this.createNewProductVariants(t)),Object(v.a)(t=>this.deleteDefaultVariant(t.createProductVariants)),Object(v.a)(t=>this.reFetchProduct(t))).subscribe({next:t=>{this.formValueChanged=!1,this.notificationService.success(Object(r.a)("catalog.created-new-variants-success"),{count:t.length}),this.initOptionsAndVariants()}})}confirmDeletionOfDefault(){return 1===this.product.variants.length?this.modalService.dialog({title:Object(r.a)("catalog.confirm-adding-options-delete-default-title"),body:Object(r.a)("catalog.confirm-adding-options-delete-default-body"),buttons:[{type:"secondary",label:Object(r.a)("common.cancel")},{type:"danger",label:Object(r.a)("catalog.delete-default-variant"),returnValue:!0}]}).pipe(Object(v.a)(t=>!0===t?Object(N.a)(!0):$.a)):Object(N.a)(!0)}addOptionGroupsToProduct(t){return t.length?Object(R.a)(t.map(t=>this.dataService.product.addOptionGroupToProduct({productId:this.product.id,optionGroupId:t.id}))).pipe(Object(s.a)(()=>t)):Object(N.a)([])}addNewOptionsToGroups(t){const e=this.optionGroups.map(e=>{const c=t.find(t=>t.name===e.name),n=c?c.id:e.id;if(!n)throw new Error("Could not get a productOptionGroupId");return e.values.filter(t=>!t.locked).map(t=>({productOptionGroupId:n,code:Object(K.normalizeString)(t.name,"-"),translations:[{name:t.name,languageCode:this.languageCode}]}))}).reduce((t,e)=>[...t,...e],[]),c=[...t.map(t=>t.id),...this.optionGroups.map(t=>t.id).filter(q.notNullOrUndefined)];return e.length?Object(R.a)(e.map(t=>this.dataService.product.addOptionToGroup(t))).pipe(Object(s.a)(()=>c)):Object(N.a)(c)}fetchOptionGroups(t){return Object(R.a)(t.map(t=>this.dataService.product.getProductOptionGroup(t).mapSingle(t=>t.productOptionGroup).pipe(Object(M.a)(q.notNullOrUndefined))))}createNewProductVariants(t){const e=t.filter(q.notNullOrUndefined).map(t=>t.options).reduce((t,e)=>[...t,...e],[]),c=Object.values(this.variantFormValues).filter(t=>t.enabled&&!t.existing).map(t=>({price:t.price,sku:t.sku,stock:t.stock,optionIds:t.options.map(t=>e.find(e=>e.name===t)).filter(q.notNullOrUndefined).map(t=>t.id)}));return this.productDetailService.createProductVariants(this.product,c,e,this.languageCode)}deleteDefaultVariant(t){return 1===this.product.variants.length?this.dataService.product.deleteProductVariant(this.product.variants[0].id).pipe(Object(s.a)(()=>t)):Object(N.a)(t)}reFetchProduct(t){const e=this.route.snapshot.paramMap.get("id");return e?this.dataService.product.getProduct(e).single$.pipe(Object(s.a)(()=>t)):Object(N.a)(t)}initOptionsAndVariants(){this.route.data.pipe(Object(p.a)(t=>t.entity),Object(f.a)(1)).subscribe(t=>{this.product=t,this.optionGroups=t.optionGroups.map(t=>({id:t.id,isNew:!1,name:t.name,values:t.options.map(t=>({id:t.id,name:t.name,locked:!0}))})),this.variantFormValues=this.getExistingVariants(t.variants),this.generateVariants()})}getExistingVariants(t){return t.reduce((t,e)=>{const c=e.options.length?e.options.map(t=>t.name).join("|"):"__DEFAULT_VARIANT__";return Object.assign(Object.assign({},t),{[c]:{productVariantId:e.id,enabled:!0,existing:!0,options:e.options.map(t=>t.name),sku:e.sku,price:e.price,stock:e.stockOnHand}})},{})}};Ln.\u0275fac=function(t){return new(t||Ln)(a.gc(i.a),a.gc(o.K),a.gc(Mn),a.gc(o.yb),a.gc(o.xb))},Ln.\u0275cmp=a.ac({type:Ln,selectors:[["vdr-product-variants-editor"]],decls:28,vars:25,consts:[[1,"btn","btn-primary",3,"disabled","click"],["class","option-groups",4,"ngFor","ngForOf"],["class","btn btn-primary-outline btn-sm",3,"click",4,"ngIf"],[1,"variants-preview"],[1,"table"],[3,"disabled",4,"ngFor","ngForOf"],[1,"option-groups"],[1,"name"],["clrInput","","name","name",3,"ngModel","readonly","ngModelChange"],[1,"values"],[3,"ngModel","groupName","disabled","ngModelChange"],["optionValueInputComponent",""],[1,"btn","btn-primary-outline","btn-sm",3,"click"],["shape","plus"],["type","checkbox","name","enabled","clrCheckbox","",3,"ngModel","ngModelChange",4,"ngIf"],[4,"ngIf"],["type","checkbox","name","enabled","clrCheckbox","",3,"ngModel","ngModelChange"],["clrInput","","type","text","name","sku","required","",3,"ngModel","placeholder","ngModelChange"],["clrInput","","name","price",3,"ngModel","currencyCode","ngModelChange"],["clrInput","","type","number","name","stock","min","0","step","1",3,"ngModel","ngModelChange"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"click"],["shape","trash",1,"is-danger"]],template:function(t,e){1&t&&(a.mc(0,"vdr-action-bar"),a.mc(1,"vdr-ab-right"),a.mc(2,"button",0),a.uc("click",(function(){return e.save()})),a.ad(3),a.xc(4,"translate"),a.lc(),a.lc(),a.lc(),a.Yc(5,We,12,11,"div",1),a.Yc(6,Je,4,3,"button",2),a.mc(7,"div",3),a.mc(8,"table",4),a.mc(9,"thead"),a.mc(10,"tr"),a.mc(11,"th"),a.ad(12),a.xc(13,"translate"),a.lc(),a.mc(14,"th"),a.ad(15),a.xc(16,"translate"),a.lc(),a.mc(17,"th"),a.ad(18),a.xc(19,"translate"),a.lc(),a.mc(20,"th"),a.ad(21),a.xc(22,"translate"),a.lc(),a.mc(23,"th"),a.ad(24),a.xc(25,"translate"),a.lc(),a.hc(26,"th"),a.lc(),a.lc(),a.Yc(27,sc,16,11,"tr",5),a.lc(),a.lc()),2&t&&(a.Ub(2),a.Dc("disabled",!e.formValueChanged||0===e.getVariantsToAdd().length),a.Ub(1),a.cd(" ",a.zc(4,10,"common.add-new-variants",a.Ic(23,Ct,e.getVariantsToAdd().length))," "),a.Ub(2),a.Dc("ngForOf",e.optionGroups),a.Ub(1),a.Dc("ngIf",1===e.product.variants.length),a.Ub(6),a.bd(a.yc(13,13,"common.create")),a.Ub(3),a.bd(a.yc(16,15,"catalog.variant")),a.Ub(3),a.bd(a.yc(19,17,"catalog.sku")),a.Ub(3),a.bd(a.yc(22,19,"catalog.price")),a.Ub(3),a.bd(a.yc(25,21,"catalog.stock-on-hand")),a.Ub(3),a.Dc("ngForOf",e.variants))},directives:function(){return[o.c,o.f,B.o,B.p,tt.t,o.db,S.b,tt.r,S.p,S.s,ma,tt.o,S.a,tt.i,tt.s,S.z,o.F,S.v,o.S,o.V,o.U,o.T]},pipes:function(){return[W.d,B.d]},styles:[".option-groups[_ngcontent-%COMP%]{display:flex}.option-groups[_ngcontent-%COMP%]:first-of-type{margin-top:24px}.values[_ngcontent-%COMP%]{flex:1;margin:0 6px}.variants-preview[_ngcontent-%COMP%]   tr.disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#fafafa;color:#97979a}"]}),Ln.ctorParameters=()=>[{type:i.a},{type:o.K},{type:Mn},{type:o.yb},{type:o.xb}],Ln=Object(n.c)([Object(n.f)("design:paramtypes",[i.a,o.K,Mn,o.yb,o.xb])],Ln);let Gn=class extends o.v{constructor(t,e){super(t,{__typename:"Asset",id:"",createdAt:"",updatedAt:"",name:"",type:o.r.IMAGE,fileSize:0,mimeType:"",width:0,height:0,source:"",preview:"",focalPoint:null},t=>e.product.getAsset(t).mapStream(t=>t.asset))}};Gn.\u0275fac=function(t){return new(t||Gn)(a.qc(i.e),a.qc(o.K))},Gn.ctorParameters=()=>[{type:i.e},{type:o.K}],Gn.\u0275prov=Object(a.cc)({factory:function(){return new Gn(Object(a.qc)(i.e),Object(a.qc)(o.K))},token:Gn,providedIn:"root"}),Gn=Object(n.c)([Object(n.f)("design:paramtypes",[i.e,o.K])],Gn);let En=class extends o.v{constructor(t,e){super(t,{__typename:"Collection",id:"",createdAt:"",updatedAt:"",languageCode:Object(o.Vb)(),name:"",slug:"",isPrivate:!1,description:"",featuredAsset:null,assets:[],translations:[],filters:[],parent:{},children:null},t=>e.collection.getCollection(t).mapStream(t=>t.collection))}};En.\u0275fac=function(t){return new(t||En)(a.qc(i.e),a.qc(o.K))},En.ctorParameters=()=>[{type:i.e},{type:o.K}],En.\u0275prov=Object(a.cc)({factory:function(){return new En(Object(a.qc)(i.e),Object(a.qc)(o.K))},token:En,providedIn:"root"}),En=Object(n.c)([Object(n.f)("design:paramtypes",[i.e,o.K])],En);let Kn=class extends o.v{constructor(t,e){super(t,{__typename:"Facet",id:"",createdAt:"",updatedAt:"",isPrivate:!1,languageCode:Object(o.Vb)(),name:"",code:"",translations:[],values:[]},t=>e.facet.getFacet(t).mapStream(t=>t.facet))}};Kn.\u0275fac=function(t){return new(t||Kn)(a.qc(i.e),a.qc(o.K))},Kn.ctorParameters=()=>[{type:i.e},{type:o.K}],Kn.\u0275prov=Object(a.cc)({factory:function(){return new Kn(Object(a.qc)(i.e),Object(a.qc)(o.K))},token:Kn,providedIn:"root"}),Kn=Object(n.c)([Object(n.f)("design:paramtypes",[i.e,o.K])],Kn);let qn=class extends o.v{constructor(t,e){super(e,{__typename:"Product",id:"",createdAt:"",updatedAt:"",enabled:!0,languageCode:Object(o.Vb)(),name:"",slug:"",featuredAsset:null,assets:[],description:"",translations:[],optionGroups:[],facetValues:[],variants:[],channels:[]},e=>t.product.getProduct(e).refetchOnChannelChange().mapStream(t=>t.product))}};qn.\u0275fac=function(t){return new(t||qn)(a.qc(o.K),a.qc(i.e))},qn.ctorParameters=()=>[{type:o.K},{type:i.e}],qn.\u0275prov=Object(a.cc)({factory:function(){return new qn(Object(a.qc)(o.K),Object(a.qc)(i.e))},token:qn,providedIn:"root"}),qn=Object(n.c)([Object(n.f)("design:paramtypes",[o.K,i.e])],qn);let Bn=class extends o.v{constructor(t,e){super(t,{__typename:"Product",id:"",createdAt:"",updatedAt:"",name:"",optionGroups:[],variants:[]},t=>e.product.getProductVariantsOptions(t).mapStream(t=>t.product))}};Bn.\u0275fac=function(t){return new(t||Bn)(a.qc(i.e),a.qc(o.K))},Bn.ctorParameters=()=>[{type:i.e},{type:o.K}],Bn.\u0275prov=Object(a.cc)({factory:function(){return new Bn(Object(a.qc)(i.e),Object(a.qc)(o.K))},token:Bn,providedIn:"root"}),Bn=Object(n.c)([Object(n.f)("design:paramtypes",[i.e,o.K])],Bn);const zn={breadcrumb:Object(r.a)("breadcrumb.products")},Xn={breadcrumb:na},Hn={breadcrumb:aa},Zn={breadcrumb:Object(r.a)("breadcrumb.facets")},Qn={breadcrumb:ia},Wn={breadcrumb:Object(r.a)("breadcrumb.collections")},Jn={breadcrumb:oa},ta={breadcrumb:Object(r.a)("breadcrumb.assets")},ea={breadcrumb:ra},ca=[{path:"products",component:Rn,data:zn},{path:"products/:id",component:An,resolve:Object(o.Qb)(qn),canDeactivate:[o.x],data:Xn},{path:"products/:id/manage-variants",component:Ln,resolve:Object(o.Qb)(Bn),canDeactivate:[o.x],data:Hn},{path:"facets",component:Vn,data:Zn},{path:"facets/:id",component:kn,resolve:Object(o.Qb)(Kn),canDeactivate:[o.x],data:Qn},{path:"collections",component:Un,data:Wn},{path:"collections/:id",component:In,resolve:Object(o.Qb)(En),canDeactivate:[o.x],data:Jn},{path:"assets",component:jn,data:ta},{path:"assets/:id",component:wn,resolve:Object(o.Qb)(Gn),data:ea}];function na(t,e){return Object(o.Sb)({entity:t.entity,id:e.id,breadcrumbKey:"breadcrumb.products",getName:t=>t.name,route:"products"})}function aa(t,e){return t.entity.pipe(Object(s.a)(t=>[{label:Object(r.a)("breadcrumb.products"),link:["../","products"]},{label:`${t.name}`,link:["../","products",e.id,{tab:"variants"}]},{label:Object(r.a)("breadcrumb.manage-variants"),link:["manage-variants"]}]))}function ia(t,e){return Object(o.Sb)({entity:t.entity,id:e.id,breadcrumbKey:"breadcrumb.facets",getName:t=>t.name,route:"facets"})}function oa(t,e){return Object(o.Sb)({entity:t.entity,id:e.id,breadcrumbKey:"breadcrumb.collections",getName:t=>t.name,route:"collections"})}function ra(t,e){return Object(o.Sb)({entity:t.entity,id:e.id,breadcrumbKey:"breadcrumb.assets",getName:t=>t.name,route:"assets"})}function sa(t){const e=[],c={};for(const n of t)c[n.id]=Object.assign(Object.assign({},n),{children:[]});for(const n of t.map(t=>t.id))if(c.hasOwnProperty(n)){const t=c[n];t.expanded=!1;const a=t.parent;if(!a)continue;!c[a.id]?e.push(t):c[a.id]?c[a.id].children.push(t):c[a.id]={children:[t]}}return{id:e.length?e[0].parent.id:void 0,children:e}}let la=class{constructor(){this.expandAll=!1,this.rearrange=new a.u,this.deleteCollection=new a.u}ngOnChanges(t){"collections"in t&&this.collections&&(this.collectionTree=sa(this.collections))}onDrop(t){const e=t.item.data,c=t.container.data.id;if(null==c)throw new Error("Could not determine the ID of the root Collection");this.rearrange.emit({collectionId:e.id,parentId:c,index:t.currentIndex})}onMove(t){this.rearrange.emit(t)}onDelete(t){this.deleteCollection.emit(t)}isRootNode(t){return!t.hasOwnProperty("parent")}};la.\u0275fac=function(t){return new(t||la)},la.\u0275cmp=a.ac({type:la,selectors:[["vdr-collection-tree"]],inputs:{expandAll:"expandAll",collections:"collections",activeCollectionId:"activeCollectionId"},outputs:{rearrange:"rearrange",deleteCollection:"deleteCollection"},features:[a.Sb],decls:1,vars:1,consts:[["cdkDropListGroup","",3,"expandAll","collectionTree","activeCollectionId",4,"ngIf"],["cdkDropListGroup","",3,"expandAll","collectionTree","activeCollectionId"]],template:function(t,e){1&t&&a.Yc(0,lc,1,3,"vdr-collection-tree-node",0),2&t&&a.Dc("ngIf",e.collectionTree)},directives:function(){return[B.p,da,Z.d]},styles:[""],changeDetection:0}),Object(n.c)([Object(a.D)(),Object(n.f)("design:type",Array)],la.prototype,"collections",void 0),Object(n.c)([Object(a.D)(),Object(n.f)("design:type",String)],la.prototype,"activeCollectionId",void 0),Object(n.c)([Object(a.D)(),Object(n.f)("design:type",Object)],la.prototype,"expandAll",void 0),Object(n.c)([Object(a.O)(),Object(n.f)("design:type",Object)],la.prototype,"rearrange",void 0),Object(n.c)([Object(a.O)(),Object(n.f)("design:type",Object)],la.prototype,"deleteCollection",void 0);let da=class{constructor(t,e,c){this.parent=t,this.root=e,this.dataService=c,this.depth=0,this.expandAll=!1,t&&(this.depth=t.depth+1)}ngOnInit(){this.parentName=this.collectionTree.name||"<root>";const t=this.dataService.client.userStatus().mapStream(t=>t.userStatus.permissions).pipe(Object(h.a)(1));this.hasUpdatePermission$=t.pipe(Object(s.a)(t=>t.includes(o.Cb.UpdateCatalog))),this.hasDeletePermission$=t.pipe(Object(s.a)(t=>t.includes(o.Cb.DeleteCatalog)))}trackByFn(t,e){return e.id}getMoveListItems(t){const e=(c,n,a)=>{if(c.id!==t.id){const i=n.concat(c.name),o=t.parent&&t.parent.id;c.id!==o&&a.push({path:i.slice(1).join(" / ")||"root",id:c.id}),c.children.forEach(t=>e(t,i,a))}return a};return e(this.root.collectionTree,[],[])}move(t,e){this.root.onMove({index:0,parentId:e,collectionId:t.id})}moveUp(t,e){t.parent&&this.root.onMove({index:e-1,parentId:t.parent.id,collectionId:t.id})}moveDown(t,e){t.parent&&this.root.onMove({index:e+1,parentId:t.parent.id,collectionId:t.id})}drop(t){Object(Z.f)(this.collectionTree.children,t.previousIndex,t.currentIndex),this.root.onDrop(t)}delete(t){this.root.onDelete(t)}};da.\u0275fac=function(t){return new(t||da)(a.gc(da,12),a.gc(la),a.gc(o.K))},da.\u0275cmp=a.ac({type:da,selectors:[["vdr-collection-tree-node"]],inputs:{expandAll:"expandAll",collectionTree:"collectionTree",activeCollectionId:"activeCollectionId"},decls:4,vars:6,consts:[["cdkDropList","",1,"tree-node",3,"cdkDropListData","cdkDropListDisabled","cdkDropListDropped"],["dropList",""],["class","collection","cdkDrag","",3,"private","cdkDragData",4,"ngFor","ngForOf","ngForTrackBy"],["cdkDrag","",1,"collection",3,"cdkDragData"],[1,"collection-detail",3,"ngClass"],[1,"name"],["class","icon-button folder-button",3,"disabled","click",4,"ngIf","ngIfElse"],["folderSpacer",""],[1,"flex-spacer"],[4,"ngIf"],["queryParamsHandling","preserve",1,"btn","btn-link","btn-sm",3,"routerLink"],["shape","view-list"],[1,"btn","btn-link","btn-sm",3,"routerLink"],["shape","edit"],["class","drag-handle","cdkDragHandle","",4,"vdrIfPermissions"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["class","dropdown-item",3,"routerLink",4,"vdrIfPermissions"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",3,"disabled","click"],["shape","caret up"],["shape","caret down"],[1,"dropdown-header"],["type","button","vdrDropdownItem","",3,"disabled","click",4,"ngFor","ngForOf"],["vdrDropdownItem","",1,"button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"expandAll","collectionTree","activeCollectionId",4,"ngIf"],[1,"icon-button","folder-button",3,"disabled","click"],["shape","folder",4,"ngIf"],["shape","folder-open",4,"ngIf"],["shape","folder"],["shape","folder-open"],[1,"folder-button-spacer"],["cdkDragHandle","",1,"drag-handle"],["shape","drag-handle","size","24"],[1,"dropdown-item",3,"routerLink"],["shape","plus"],["shape","child-arrow"],[3,"expandAll","collectionTree","activeCollectionId"]],template:function(t,e){1&t&&(a.mc(0,"div",0,1),a.uc("cdkDropListDropped",(function(t){return e.drop(t)})),a.xc(2,"async"),a.Yc(3,Pc,45,49,"div",2),a.lc()),2&t&&(a.Dc("cdkDropListData",e.collectionTree)("cdkDropListDisabled",!a.yc(2,4,e.hasUpdatePermission$)),a.Ub(3),a.Dc("ngForOf",e.collectionTree.children)("ngForTrackBy",e.trackByFn))},directives:[Z.c,B.o,tt.l,Z.a,B.n,B.p,i.h,tt.o,o.ob,o.S,o.V,o.U,o.T,o.B,Z.b,da],pipes:[B.b,W.d],styles:["[_nghost-%COMP%]{display:block}.collection[_ngcontent-%COMP%]{background-color:#fff;font-size:.65rem;color:rgba(0,0,0,.87);transition:border-left-color .2s;margin-bottom:2px;border-left:2px solid transparent}.collection.private[_ngcontent-%COMP%]{background-color:#f2f3f5}.collection[_ngcontent-%COMP%]   .collection-detail[_ngcontent-%COMP%]{padding:6px 12px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #f2f3f5}.collection[_ngcontent-%COMP%]   .collection-detail.active[_ngcontent-%COMP%]{background-color:#f2f3f5}.collection[_ngcontent-%COMP%]   .collection-detail.depth-1[_ngcontent-%COMP%]{padding-left:36px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-2[_ngcontent-%COMP%]{padding-left:60px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-3[_ngcontent-%COMP%]{padding-left:84px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-4[_ngcontent-%COMP%]{padding-left:108px}.collection[_ngcontent-%COMP%]   .collection-detail[_ngcontent-%COMP%]   .folder-button-spacer[_ngcontent-%COMP%]{display:inline-block;width:28px}.tree-node[_ngcontent-%COMP%]{display:block;background:#fff;overflow:hidden}.tree-node.cdk-drop-list-dragging[_ngcontent-%COMP%] > .collection[_ngcontent-%COMP%]{border-left-color:#9adbf3}.drag-placeholder[_ngcontent-%COMP%]{min-height:120px;background-color:#bfc3cc;transition:transform 250ms cubic-bezier(0,0,.2,1)}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%], .example-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .tree-node[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform 250ms cubic-bezier(0,0,.2,1)}"],changeDetection:0}),da.ctorParameters=()=>[{type:da,decorators:[{type:a.Z},{type:a.N}]},{type:la},{type:o.K}],Object(n.c)([Object(a.D)(),Object(n.f)("design:type",Object)],da.prototype,"collectionTree",void 0),Object(n.c)([Object(a.D)(),Object(n.f)("design:type",String)],da.prototype,"activeCollectionId",void 0),Object(n.c)([Object(a.D)(),Object(n.f)("design:type",Object)],da.prototype,"expandAll",void 0),da=Object(n.c)([Object(n.g)(0,Object(a.Z)()),Object(n.g)(0,Object(a.N)()),Object(n.f)("design:paramtypes",[da,la,o.K])],da);let ua=class{constructor(t){this.dataService=t,this.variantsChange=new a.u,this.optionGroups=[],this.variantFormValues={}}ngOnInit(){this.dataService.settings.getActiveChannel().single$.subscribe(t=>{this.currencyCode=t.activeChannel.currencyCode}),this.generateVariants()}addOption(){this.optionGroups.push({name:"",values:[]})}removeOption(t){this.optionGroups=this.optionGroups.filter(e=>e.name!==t),this.generateVariants()}generateVariants(){const t=this.optionGroups.reduce((t,e)=>t+e.values.length,0)?this.optionGroups.map(t=>t.values.map(t=>t.name)):[["__DEFAULT_VARIANT__"]];this.variants=Object(q.generateAllCombinations)(t).map(t=>({id:t.join("|"),values:t})),this.variants.forEach(t=>{this.variantFormValues[t.id]||(this.variantFormValues[t.id]={optionValues:t.values,enabled:!0,price:this.copyFromDefault(t.id,"price",0),sku:this.copyFromDefault(t.id,"sku",""),stock:this.copyFromDefault(t.id,"stock",0)})}),this.onFormChange()}trackByFn(t,e){return e.values.join("|")}handleEnter(t,e){t.preventDefault(),t.stopPropagation(),e.focus()}onFormChange(){const t=this.variants.map(t=>this.variantFormValues[t.id]).filter(t=>t.enabled);this.variantsChange.emit({groups:this.optionGroups.map(t=>({name:t.name,values:t.values.map(t=>t.name)})),variants:t})}copyFromDefault(t,e,c){return"__DEFAULT_VARIANT__"!==t?this.variantFormValues.__DEFAULT_VARIANT__[e]:c}};ua.\u0275fac=function(t){return new(t||ua)(a.gc(o.K))},ua.\u0275cmp=a.ac({type:ua,selectors:[["vdr-generate-product-variants"]],outputs:{variantsChange:"variantsChange"},decls:21,vars:17,consts:[["class","option-groups",4,"ngFor","ngForOf"],[1,"btn","btn-primary-outline","btn-sm",3,"click"],["shape","plus"],[1,"variants-preview"],[1,"table"],[4,"ngIf"],[3,"disabled",4,"ngFor","ngForOf","ngForTrackBy"],[1,"option-groups"],[1,"name"],["placeholder","e.g. Size","clrInput","","name","name","required","",3,"ngModel","ngModelChange","keydown.enter"],[1,"values"],[3,"ngModel","groupName","disabled","ngModelChange"],["optionValueInputComponent",""],[1,"remove-group"],[1,"btn","btn-icon","btn-warning-outline",3,"title","click"],["shape","trash"],["clrInput","","type","text",3,"ngModel","placeholder","change","ngModelChange"],["clrInput","",3,"ngModel","currencyCode","ngModelChange"],["clrInput","","type","number","min","0","step","1",3,"ngModel","ngModelChange","change"],["type","checkbox","clrCheckbox","",3,"ngModel","change","ngModelChange"]],template:function(t,e){1&t&&(a.Yc(0,Fc,16,13,"div",0),a.mc(1,"button",1),a.uc("click",(function(){return e.addOption()})),a.hc(2,"clr-icon",2),a.ad(3),a.xc(4,"translate"),a.lc(),a.mc(5,"div",3),a.mc(6,"table",4),a.mc(7,"thead"),a.mc(8,"tr"),a.Yc(9,wc,3,3,"th",5),a.Yc(10,jc,3,3,"th",5),a.mc(11,"th"),a.ad(12),a.xc(13,"translate"),a.lc(),a.mc(14,"th"),a.ad(15),a.xc(16,"translate"),a.lc(),a.mc(17,"th"),a.ad(18),a.xc(19,"translate"),a.lc(),a.lc(),a.lc(),a.Yc(20,Uc,13,11,"tr",6),a.lc(),a.lc()),2&t&&(a.Dc("ngForOf",e.optionGroups),a.Ub(3),a.cd(" ",a.yc(4,9,"catalog.add-option"),"\n"),a.Ub(6),a.Dc("ngIf",1<e.variants.length),a.Ub(1),a.Dc("ngIf",1<e.variants.length),a.Ub(2),a.bd(a.yc(13,11,"catalog.sku")),a.Ub(3),a.bd(a.yc(16,13,"catalog.price")),a.Ub(3),a.bd(a.yc(19,15,"catalog.stock-on-hand")),a.Ub(2),a.Dc("ngForOf",e.variants)("ngForTrackBy",e.trackByFn))},directives:function(){return[B.o,tt.o,B.p,tt.l,tt.t,o.db,S.b,tt.r,S.z,S.p,S.s,ma,tt.s,o.F,S.v,S.a,tt.i]},pipes:function(){return[W.d]},styles:["[_nghost-%COMP%]{display:block;margin-bottom:120px}.option-groups[_ngcontent-%COMP%]{display:flex}.values[_ngcontent-%COMP%]{flex:1;margin:0 6px}.remove-group[_ngcontent-%COMP%]{padding-top:18px}.variants-preview[_ngcontent-%COMP%]   tr.disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#fafafa;color:#97979a}"]}),ua.ctorParameters=()=>[{type:o.K}],Object(n.c)([Object(a.O)(),Object(n.f)("design:type",Object)],ua.prototype,"variantsChange",void 0),ua=Object(n.c)([Object(n.f)("design:paramtypes",[o.K])],ua);const pa={provide:S.n,useExisting:Object(a.lb)(()=>ma),multi:!0};let ma=class{constructor(t){this.changeDetector=t,this.groupName="",this.disabled=!1,this.input="",this.isFocussed=!1,this.lastSelected=!1}registerOnChange(t){this.onChangeFn=t}registerOnTouched(t){this.onTouchFn=t}setDisabledState(t){this.disabled=t,this.changeDetector.markForCheck()}writeValue(t){this.options=t||[]}focus(){this.textArea.nativeElement.focus()}removeOption(t){t.locked||(this.options=this.options.filter(e=>e.name!==t.name),this.onChangeFn(this.options))}handleKey(t){switch(t.key){case",":case"Enter":this.addOptionValue(),t.preventDefault();break;case"Backspace":this.lastSelected?(this.removeLastOption(),this.lastSelected=!1):""===this.input&&(this.lastSelected=!0);break;default:this.lastSelected=!1}}handleBlur(){this.isFocussed=!1,this.addOptionValue()}addOptionValue(){this.options=Object(X.unique)([...this.options,...this.parseInputIntoOptions(this.input)]),this.input="",this.onChangeFn(this.options)}parseInputIntoOptions(t){return t.split(/[,\n]/).map(t=>t.trim()).filter(t=>""!==t).map(t=>({name:t,locked:!1}))}removeLastOption(){this.options[this.options.length-1].locked||(this.options=this.options.slice(0,this.options.length-1))}};ma.\u0275fac=function(t){return new(t||ma)(a.gc(a.k))},ma.\u0275cmp=a.ac({type:ma,selectors:[["vdr-option-value-input"]],viewQuery:function(t,e){var c;(1&t&&a.Wc(kc,!0),2&t)&&(a.Nc(c=a.vc())&&(e.textArea=c.first))},inputs:{groupName:"groupName"},features:[a.Tb([pa])],decls:4,vars:5,consts:[[1,"input-wrapper",3,"click"],["class","chips",4,"ngIf"],[3,"ngModel","disabled","keyup","focus","blur","ngModelChange"],["textArea",""],[1,"chips"],[3,"icon","selected","locked","colorFrom","iconClick",4,"ngFor","ngForOf"],[3,"icon","colorFrom","iconClick"]],template:function(t,e){if(1&t){const t=a.nc();a.mc(0,"div",0),a.uc("click",(function(){return a.Rc(t),a.Oc(3).focus()})),a.Yc(1,Mc,2,1,"div",1),a.mc(2,"textarea",2,3),a.uc("keyup",(function(t){return e.handleKey(t)}))("focus",(function(){return e.isFocussed=!0}))("blur",(function(){return e.handleBlur()}))("ngModelChange",(function(t){return e.input=t})),a.lc(),a.lc()}2&t&&(a.Xb("focus",e.isFocussed),a.Ub(1),a.Dc("ngIf",0<e.options.length),a.Ub(1),a.Dc("ngModel",e.input)("disabled",e.disabled))},directives:[B.p,o.db,S.b,S.p,S.s,B.o,o.B],styles:[".input-wrapper[_ngcontent-%COMP%]{background-color:#fff;border-radius:3px!important;border:1px solid #bfc3cc!important;cursor:text}.input-wrapper.focus[_ngcontent-%COMP%]{border-color:#13b7f3!important;box-shadow:0 0 1px 1px #e3f6fc}.input-wrapper[_ngcontent-%COMP%]   .chips[_ngcontent-%COMP%]{padding:5px}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border:none;width:100%;height:24px;margin-top:3px;padding:0 6px}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:0}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:disabled{background-color:#fafafa}vdr-chip[_ngcontent-%COMP%]     .wrapper{margin:0 3px}vdr-chip.locked[_ngcontent-%COMP%]{opacity:.8}vdr-chip.selected[_ngcontent-%COMP%]     .wrapper{border-color:#ff9f07!important;box-shadow:0 0 1px 1px #ffb74d;opacity:.6}"]}),ma.ctorParameters=()=>[{type:a.k}],Object(n.c)([Object(a.D)(),Object(n.f)("design:type",Object)],ma.prototype,"groupName",void 0),Object(n.c)([Object(a.fb)("textArea",{static:!0}),Object(n.f)("design:type",a.s)],ma.prototype,"textArea",void 0),ma=Object(n.c)([Object(n.f)("design:paramtypes",[a.k])],ma);let ga=class{constructor(t,e,c){this.modalService=t,this.changeDetector=e,this.viewportRuler=c,this.assets=[],this.compact=!1,this.change=new a.u,this.dropListEnterPredicate=(t,e)=>{if(e===this.placeholder)return!0;if(e!==this.activeContainer)return!1;const c=this.placeholder.element.nativeElement,n=t.dropContainer.element.nativeElement,a=e.element.nativeElement,i=a.parentElement&&a.parentElement.children,o=ba(i,this.source?c:n),r=ba(i,a);return this.source||(this.sourceIndex=o,this.source=t.dropContainer,c.style.width=n.clientWidth+"px",c.style.height=n.clientHeight+"px",n.parentElement&&n.parentElement.removeChild(n)),this.targetIndex=r,this.target=e,c.style.display="",a.parentElement&&a.parentElement.insertBefore(c,r>o?a.nextSibling:a),this.placeholder.enter(t,t.element.nativeElement.offsetLeft,t.element.nativeElement.offsetTop),!1}}ngAfterViewInit(){const t=this.placeholder.element.nativeElement;t.style.display="none",t.parentElement&&t.parentElement.removeChild(t)}selectAssets(){this.modalService.fromComponent(o.n,{size:"xl"}).subscribe(t=>{t&&t.length&&(this.assets=Object(X.unique)(this.assets.concat(t),"id"),this.featuredAsset||(this.featuredAsset=t[0]),this.emitChangeEvent(this.assets,this.featuredAsset),this.changeDetector.markForCheck())})}setAsFeatured(t){this.featuredAsset=t,this.emitChangeEvent(this.assets,t)}isFeatured(t){return!!this.featuredAsset&&this.featuredAsset.id===t.id}previewAsset(t){this.modalService.fromComponent(o.p,{size:"xl",closable:!0,locals:{asset:t}}).subscribe()}removeAsset(t){this.assets=this.assets.filter(e=>e.id!==t.id),this.featuredAsset&&this.featuredAsset.id===t.id&&(this.featuredAsset=this.assets.length>0?this.assets[0]:void 0),this.emitChangeEvent(this.assets,this.featuredAsset)}emitChangeEvent(t,e){this.change.emit({assetIds:t.map(t=>t.id),featuredAssetId:e&&e.id})}dragMoved(t){const e=this.getPointerPositionOnPage(t.event);this.listGroup._items.forEach(t=>{(function(t,e,c){const{top:n,bottom:a,left:i,right:o}=t.element.nativeElement.getBoundingClientRect();return c>=n&&c<=a&&e>=i&&e<=o})(t,e.x,e.y)&&(this.activeContainer=t)})}dropListDropped(){if(!this.target||!this.source)return;const t=this.placeholder.element.nativeElement,e=t.parentElement;t.style.display="none",e.removeChild(t),e.appendChild(t),e.insertBefore(this.source.element.nativeElement,e.children[this.sourceIndex]),this.target=null,this.source=null,this.sourceIndex!==this.targetIndex&&(Object(Z.f)(this.assets,this.sourceIndex,this.targetIndex),this.emitChangeEvent(this.assets,this.featuredAsset))}getPointerPositionOnPage(t){const e=function(t){return t.type.startsWith("touch")}(t)?t.touches[0]||t.changedTouches[0]:t,c=this.viewportRuler.getViewportScrollPosition();return{x:e.pageX-c.left,y:e.pageY-c.top}}};function ba(t,e){return t?Array.prototype.indexOf.call(t,e):-1}ga.\u0275fac=function(t){return new(t||ga)(a.gc(o.xb),a.gc(a.k),a.gc(Q.d))},ga.\u0275cmp=a.ac({type:ga,selectors:[["vdr-product-assets"]],viewQuery:function(t,e){var c;(1&t&&(a.gd(Sc,!0,Z.d),a.gd(_c,!0,Z.c)),2&t)&&(a.Nc(c=a.vc())&&(e.listGroup=c.first),a.Nc(c=a.vc())&&(e.placeholder=c.first))},hostVars:2,hostBindings:function(t,e){2&t&&a.Xb("compact",e.compact)},inputs:{assets:"assets",compact:"compact",featuredAsset:"featuredAsset"},outputs:{change:"change"},decls:5,vars:2,consts:[["class","card",4,"ngIf","ngIfElse"],["compactView",""],["assetList",""],[1,"card"],[1,"card-img"],[1,"featured-asset"],[3,"src","click",4,"ngIf"],["class","placeholder",4,"ngIf"],[1,"card-block"],[4,"ngTemplateOutlet"],["class","card-footer",4,"vdrIfPermissions"],[3,"src","click"],[1,"placeholder"],["shape","image","size","128"],[1,"card-footer"],[1,"btn",3,"click"],["shape","attachment"],[1,"featured-asset","compact"],["class","compact-select btn btn-icon btn-sm btn-block",3,"title","click",4,"vdrIfPermissions"],["shape","image","size","150"],[1,"compact-select","btn","btn-icon","btn-sm","btn-block",3,"title","click"],["cdkDropListGroup","",1,"all-assets"],["dlg",""],["cdkDropList","",3,"cdkDropListDisabled","cdkDropListEnterPredicate","cdkDropListDropped"],["dl",""],["cdkDropList","",3,"cdkDropListDisabled","cdkDropListEnterPredicate","cdkDropListDropped",4,"ngFor","ngForOf"],["cdkDrag","",3,"cdkDragMoved"],["vdrDropdownTrigger","","tabindex","0",1,"asset-thumb",3,"title"],[3,"src"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",3,"click"],["type","button","vdrDropdownItem","",3,"disabled","click"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",1,"remove-asset",3,"disabled","click"]],template:function(t,e){if(1&t&&(a.Yc(0,Nc,8,4,"div",0),a.Yc(1,Kc,5,4,"ng-template",null,1,a.Zc),a.Yc(3,Bc,6,7,"ng-template",null,2,a.Zc)),2&t){const t=a.Oc(2);a.Dc("ngIf",!e.compact)("ngIfElse",t)}},directives:[B.p,B.u,o.ob,tt.o,Z.d,Z.c,B.o,o.S,Z.a,o.V,o.U,o.T],pipes:[o.q,W.d,o.gb],styles:["[_nghost-%COMP%]{width:340px;display:block}.compact[_nghost-%COMP%]{width:162px}.placeholder[_ngcontent-%COMP%]{text-align:center;color:#bfc3cc}.featured-asset[_ngcontent-%COMP%]{text-align:center;background:#f2f3f5;padding:6px;cursor:pointer}.featured-asset.compact[_ngcontent-%COMP%]{width:100%;min-height:40px;padding:6px;position:relative}.featured-asset[_ngcontent-%COMP%]   .compact-select[_ngcontent-%COMP%]{position:absolute;bottom:6px;right:6px;margin:0}.all-assets[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.all-assets[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{margin:3px;padding:0;border:2px solid #f2f3f5;cursor:pointer}.all-assets[_ngcontent-%COMP%]   .asset-thumb.featured[_ngcontent-%COMP%]{border-color:#13b7f3}.all-assets[_ngcontent-%COMP%]   .remove-asset[_ngcontent-%COMP%]{color:#ff9f07}.all-assets.compact[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{margin:1px;border-width:1px}.cdk-drag-preview[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:50px;background-color:#fafafa;opacity:.9;box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.8;width:60px;height:50px}.cdk-drag-placeholder[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{background-color:#bfc3cc;height:100%;width:54px}.cdk-drag-placeholder[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:none}.all-assets.compact[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%], .all-assets.compact[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{width:50px}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform 250ms cubic-bezier(0,0,.2,1)}.example-box[_ngcontent-%COMP%]:last-child{border:none}.all-assets.cdk-drop-list-dragging[_ngcontent-%COMP%]   vdr-dropdown[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform 250ms cubic-bezier(0,0,.2,1)}"],changeDetection:0}),ga.ctorParameters=()=>[{type:o.xb},{type:a.k},{type:Q.d}],Object(n.c)([Object(a.D)(),Object(n.f)("design:type",Array)],ga.prototype,"assets",void 0),Object(n.c)([Object(a.D)(),Object(n.f)("design:type",Object)],ga.prototype,"featuredAsset",void 0),Object(n.c)([Object(a.w)("class.compact"),Object(a.D)(),Object(n.f)("design:type",Object)],ga.prototype,"compact",void 0),Object(n.c)([Object(a.O)(),Object(n.f)("design:type",Object)],ga.prototype,"change",void 0),Object(n.c)([Object(a.fb)("dlg",{static:!1,read:Z.d}),Object(n.f)("design:type",Z.d)],ga.prototype,"listGroup",void 0),Object(n.c)([Object(a.fb)("dl",{static:!1,read:Z.c}),Object(n.f)("design:type",Z.c)],ga.prototype,"placeholder",void 0),ga=Object(n.c)([Object(n.f)("design:paramtypes",[o.xb,a.k,Q.d])],ga);let ha=class{constructor(){this.codeInputTouched=!1}ngOnInit(){var t;const e=this.productOption.translations.find(t=>t.languageCode===this.activeLanguage);if(this.name=null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"",this.code=this.productOption.code,this.customFieldsForm=new S.i({}),this.customFields){const t=e&&e.customFields||{};for(const e of this.customFields){const c=e.name,n="localeString"===e.type?t[c]:this.productOption.customFields[c];this.customFieldsForm.addControl(e.name,new S.f(n))}}}update(){const t=Object(o.Rb)({translatable:this.productOption,languageCode:this.activeLanguage,updatedFields:{code:this.code,name:this.name,customFields:this.customFieldsForm.value},customFieldConfig:this.customFields,defaultTranslation:{languageCode:this.activeLanguage,name:""}});this.resolveWith(t)}cancel(){this.resolveWith()}updateCode(t){this.codeInputTouched||this.productOption.code||(this.code=Object(K.normalizeString)(t,"-"))}};ha.\u0275fac=function(t){return new(t||ha)},ha.\u0275cmp=a.ac({type:ha,selectors:[["vdr-update-product-option-dialog"]],decls:11,vars:9,consts:[["vdrDialogTitle",""],["for","name",3,"label"],["id","name","type","text","required","",3,"ngModel","ngModelChange","input"],["nameInput","ngModel"],["for","code",3,"label"],["id","code","type","text","required","","pattern","[a-z0-9_-]+",3,"ngModel","ngModelChange"],["codeInput","ngModel"],[4,"ngIf"],["vdrDialogButtons",""],[4,"ngFor","ngForOf"],["entityName","ProductOption",3,"customFieldsFormGroup","customField","readonly",4,"ngIf"],["entityName","ProductOption",3,"customFieldsFormGroup","customField","readonly"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(t,e){1&t&&(a.Yc(0,zc,2,3,"ng-template",0),a.mc(1,"vdr-form-field",1),a.xc(2,"translate"),a.mc(3,"input",2,3),a.uc("ngModelChange",(function(t){return e.name=t}))("input",(function(t){return e.updateCode(t.target.value)})),a.lc(),a.lc(),a.mc(5,"vdr-form-field",4),a.xc(6,"translate"),a.mc(7,"input",5,6),a.uc("ngModelChange",(function(t){return e.code=t})),a.lc(),a.lc(),a.Yc(9,Zc,5,4,"section",7),a.Yc(10,Qc,6,7,"ng-template",8)),2&t&&(a.Ub(1),a.Dc("label",a.yc(2,5,"catalog.option-name")),a.Ub(2),a.Dc("ngModel",e.name),a.Ub(2),a.Dc("label",a.yc(6,7,"common.code")),a.Ub(2),a.Dc("ngModel",e.code),a.Ub(2),a.Dc("ngIf",e.customFields.length))},directives:[o.Q,o.cb,o.db,S.b,S.z,S.p,S.s,S.w,B.p,o.P,tt.t,B.o,o.H],pipes:[W.d,o.gb],styles:[""],changeDetection:0});let fa=class{constructor(t,e){this.changeDetector=t,this.modalService=e,this.assetChange=new a.u,this.selectionChange=new a.u,this.selectFacetValueClick=new a.u,this.updateProductOption=new a.u,this.selectedVariantIds=[]}ngOnInit(){this.formSubscription=this.formArray.valueChanges.subscribe(()=>this.changeDetector.markForCheck())}ngOnChanges(t){"facets"in t&&t.facets.currentValue&&(this.facetValues=Object(o.Tb)(this.facets))}ngOnDestroy(){this.formSubscription&&this.formSubscription.unsubscribe()}getTaxCategoryName(t){const e=this.formArray.at(t).get(["taxCategoryId"]);if(e&&this.taxCategories){const t=this.taxCategories.find(t=>t.id===e.value);return t?t.name:""}return""}areAllSelected(){return!!this.variants&&this.selectedVariantIds.length===this.variants.length}onAssetChange(t,e){this.assetChange.emit(Object.assign({variantId:t},e));const c=this.variants.findIndex(e=>e.id===t);this.formArray.at(c).markAsDirty()}toggleSelectAll(){this.areAllSelected()?this.selectedVariantIds=[]:this.selectedVariantIds=this.variants.map(t=>t.id),this.selectionChange.emit(this.selectedVariantIds)}toggleSelectVariant(t){const e=this.selectedVariantIds.indexOf(t);-1<e?this.selectedVariantIds.splice(e,1):this.selectedVariantIds.push(t),this.selectionChange.emit(this.selectedVariantIds)}optionGroupName(t){var e;const c=this.optionGroups.find(e=>e.id===t);if(c){return(null!==(e=null==c?void 0:c.translations.find(t=>t.languageCode===this.activeLanguage))&&void 0!==e?e:c.translations[0]).name}}optionName(t){var e;return(null!==(e=t.translations.find(t=>t.languageCode===this.activeLanguage))&&void 0!==e?e:t.translations[0]).name}pendingFacetValues(t){if(this.facets){const e=this.getFacetValueIds(t),c=this.variants[t].facetValues.map(t=>t.id);return e.filter(t=>!c.includes(t)).map(t=>this.facetValues.find(e=>e.id===t)).filter(q.notNullOrUndefined)}return[]}existingFacetValues(t){const e=this.variants[t];return[...this.getFacetValueIds(t)].filter(t=>e.facetValues.map(t=>t.id).includes(t)).map(t=>e.facetValues.find(e=>e.id===t)).filter(q.notNullOrUndefined)}removeFacetValue(t,e){const c=this.formArray.at(t),n=c.value.facetValueIds.filter(t=>t!==e);c.patchValue({facetValueIds:n}),c.markAsDirty()}isVariantSelected(t){return-1<this.selectedVariantIds.indexOf(t)}customFieldIsSet(t,e){return!!this.formArray.at(t).get(["customFields",e])}editOption(t){this.modalService.fromComponent(ha,{size:"md",locals:{productOption:t,activeLanguage:this.activeLanguage,customFields:this.customOptionFields}}).subscribe(t=>{t&&this.updateProductOption.emit(t)})}getFacetValueIds(t){return this.formArray.at(t).value.facetValueIds}};fa.\u0275fac=function(t){return new(t||fa)(a.gc(a.k),a.gc(o.xb))},fa.\u0275cmp=a.ac({type:fa,selectors:[["vdr-product-variants-list"]],inputs:{formArray:["productVariantsFormArray","formArray"],variants:"variants",taxCategories:"taxCategories",facets:"facets",optionGroups:"optionGroups",customFields:"customFields",customOptionFields:"customOptionFields",activeLanguage:"activeLanguage"},outputs:{assetChange:"assetChange",selectionChange:"selectionChange",selectFacetValueClick:"selectFacetValueClick",updateProductOption:"updateProductOption"},features:[a.Sb],decls:2,vars:1,consts:[[1,"variants-list"],["class","variant-container card",3,"disabled",4,"ngFor","ngForOf"],[1,"variant-container","card"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"card-block","header-row"],[1,"details"],[1,"sku",3,"readonly"],["clrInput","","type","text","formControlName","sku",3,"readonly","placeholder"],[1,"name",3,"readonly"],["clrInput","","type","text","formControlName","name",3,"readonly","placeholder"],[1,"right-controls"],[4,"vdrIfPermissions"],[1,"card-block"],[1,"variant-body"],[1,"assets"],[3,"compact","assets","featuredAsset","change"],[1,"variant-form-inputs"],[1,"standard-fields"],[1,"variant-form-input-row"],[1,"tax-category"],[4,"vdrIfPermissions","vdrIfPermissionsElse"],["taxCategoryLabel",""],[1,"price"],["clrInput","","formControlName","price",3,"currencyCode","readonly"],[3,"price","currencyCode","priceIncludesTax","taxCategoryId"],["clrInput","","type","number","min","0","step","1","formControlName","stockOnHand",3,"readonly"],[1,"track-inventory-toggle"],["type","checkbox","clrCheckbox","","name","trackInventory","formControlName","trackInventory",3,"vdrDisabled"],[1,"custom-fields"],["formGroupName","customFields",4,"ngIf"],[1,"options-facets"],[3,"entity"],[4,"ngIf"],[1,"flex-spacer"],[1,"facets"],[3,"facetValue","removable","remove",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary",3,"click",4,"vdrIfPermissions"],["type","checkbox","clrToggle","","name","enabled","formControlName","enabled"],["clrSelect","","name","options","formControlName","taxCategoryId"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"clr-control-label"],[1,"tax-category-label"],["formGroupName","customFields"],[4,"ngFor","ngForOf"],["entityName","ProductVariant",3,"compact","customFieldsFormGroup","readonly","customField",4,"ngIf"],["entityName","ProductVariant",3,"compact","customFieldsFormGroup","readonly","customField"],[1,"options"],[3,"colorFrom","invert","icon","iconClick",4,"ngFor","ngForOf"],[3,"colorFrom","invert","icon","iconClick"],[1,"option-group-name"],[3,"facetValue","removable","remove"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","plus"]],template:function(t,e){1&t&&(a.mc(0,"div",0),a.Yc(1,bn,2,5,"div",1),a.lc()),2&t&&(a.Ub(1),a.Dc("ngForOf",e.variants))},directives:function(){return[B.o,B.p,S.q,S.j,o.Nb,tt.s,o.db,S.b,tt.r,S.p,S.h,o.ob,ga,tt.t,o.F,ya,S.v,tt.k,S.a,tt.i,o.R,o.Z,tt.A,S.A,tt.z,S.u,S.D,S.k,o.H,o.B,o.ab,tt.o]},pipes:function(){return[o.gb,W.d,o.Ib]},styles:[".with-selected[_ngcontent-%COMP%]{display:flex;min-height:52px;align-items:center;border:1px solid #f2f3f5;border-radius:3px;padding:6px 18px}.with-selected[_ngcontent-%COMP%]   vdr-select-toggle[_ngcontent-%COMP%], .with-selected[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{margin-right:12px}.variant-container[_ngcontent-%COMP%]{transition:background-color .2s}.variant-container.disabled[_ngcontent-%COMP%]{background-color:#f2f3f5}.variant-container[_ngcontent-%COMP%]   .header-row[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap}.variant-container[_ngcontent-%COMP%]   .variant-body[_ngcontent-%COMP%]{display:flex;flex-direction:column}@media screen and (min-width:768px){.variant-container[_ngcontent-%COMP%]   .variant-body[_ngcontent-%COMP%]{flex-direction:row}}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;margin-right:12px}@media screen and (min-width:768px){.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{flex-direction:row;height:36px}}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{flex:1}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]     .clr-control-container{width:100%}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]     .clr-control-container input.clr-input{min-width:100%}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .sku[_ngcontent-%COMP%]{width:160px;margin-right:20px;flex:0}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]     .name input{min-width:300px}.variant-container[_ngcontent-%COMP%]   .right-controls[_ngcontent-%COMP%]{display:flex}.variant-container[_ngcontent-%COMP%]   .tax-category-label[_ngcontent-%COMP%]{margin-top:3px}.variant-container[_ngcontent-%COMP%]   .variant-form-inputs[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}@media screen and (min-width:768px){.variant-container[_ngcontent-%COMP%]   .variant-form-inputs[_ngcontent-%COMP%]{flex-direction:row}.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%]{margin:0 6px 8px 24px}}.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-right:24px;margin-bottom:24px}.variant-container[_ngcontent-%COMP%]   .track-inventory-toggle[_ngcontent-%COMP%]{margin-top:22px}.variant-container[_ngcontent-%COMP%]   .clr-form-control[_ngcontent-%COMP%]{margin-top:0}.variant-container[_ngcontent-%COMP%]   .facets[_ngcontent-%COMP%]{display:flex;align-items:center}.variant-container[_ngcontent-%COMP%]   .pricing[_ngcontent-%COMP%]{display:flex}.variant-container[_ngcontent-%COMP%]   .pricing[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-right:12px}.variant-container[_ngcontent-%COMP%]   .option-group-name[_ngcontent-%COMP%]{color:#97979a;text-transform:uppercase;font-size:10px;margin-right:3px;height:11px}.variant-container[_ngcontent-%COMP%]   .options-facets[_ngcontent-%COMP%]{display:flex;color:#97979a}"],changeDetection:0}),fa.ctorParameters=()=>[{type:a.k},{type:o.xb}],Object(n.c)([Object(a.D)("productVariantsFormArray"),Object(n.f)("design:type",S.c)],fa.prototype,"formArray",void 0),Object(n.c)([Object(a.D)(),Object(n.f)("design:type",Array)],fa.prototype,"variants",void 0),Object(n.c)([Object(a.D)(),Object(n.f)("design:type",Array)],fa.prototype,"taxCategories",void 0),Object(n.c)([Object(a.D)(),Object(n.f)("design:type",Array)],fa.prototype,"facets",void 0),Object(n.c)([Object(a.D)(),Object(n.f)("design:type",Array)],fa.prototype,"optionGroups",void 0),Object(n.c)([Object(a.D)(),Object(n.f)("design:type",Array)],fa.prototype,"customFields",void 0),Object(n.c)([Object(a.D)(),Object(n.f)("design:type",Array)],fa.prototype,"customOptionFields",void 0),Object(n.c)([Object(a.D)(),Object(n.f)("design:type",String)],fa.prototype,"activeLanguage",void 0),Object(n.c)([Object(a.O)(),Object(n.f)("design:type",Object)],fa.prototype,"assetChange",void 0),Object(n.c)([Object(a.O)(),Object(n.f)("design:type",Object)],fa.prototype,"selectionChange",void 0),Object(n.c)([Object(a.O)(),Object(n.f)("design:type",Object)],fa.prototype,"selectFacetValueClick",void 0),Object(n.c)([Object(a.O)(),Object(n.f)("design:type",Object)],fa.prototype,"updateProductOption",void 0),fa=Object(n.c)([Object(n.f)("design:paramtypes",[a.k,o.xb])],fa);let va=class{optionGroupName(t){const e=this.optionGroups.find(e=>e.id===t);return e&&e.name}};va.\u0275fac=function(t){return new(t||va)},va.\u0275cmp=a.ac({type:va,selectors:[["vdr-product-variants-table"]],inputs:{formArray:["productVariantsFormArray","formArray"],variants:"variants",optionGroups:"optionGroups"},decls:20,vars:20,consts:[[3,"items"],[4,"ngFor","ngForOf"],[3,"formGroup"],[1,"left","align-middle"],[1,"card-img"],[1,"featured-asset"],[3,"src",4,"ngIf"],["class","placeholder",4,"ngIf"],["clrInput","","type","text","formControlName","name",3,"readonly","placeholder"],["clrInput","","type","text","formControlName","sku",3,"readonly","placeholder"],[1,"left","align-middle","price"],["clrInput","","formControlName","price",3,"currencyCode","readonly"],[1,"left","align-middle","stock"],["clrInput","","type","number","min","0","step","1","formControlName","stockOnHand",3,"readonly"],["type","checkbox","clrToggle","","name","enabled","formControlName","enabled",3,"vdrDisabled"],[3,"src"],[1,"placeholder"],["shape","image","size","48"]],template:function(t,e){1&t&&(a.mc(0,"vdr-data-table",0),a.hc(1,"vdr-dt-column"),a.mc(2,"vdr-dt-column"),a.ad(3),a.xc(4,"translate"),a.lc(),a.mc(5,"vdr-dt-column"),a.ad(6),a.xc(7,"translate"),a.lc(),a.Yc(8,hn,3,1,"ng-container",1),a.xc(9,"sort"),a.mc(10,"vdr-dt-column"),a.ad(11),a.xc(12,"translate"),a.lc(),a.mc(13,"vdr-dt-column"),a.ad(14),a.xc(15,"translate"),a.lc(),a.mc(16,"vdr-dt-column"),a.ad(17),a.xc(18,"translate"),a.lc(),a.Yc(19,On,30,53,"ng-template"),a.lc()),2&t&&(a.Dc("items",e.variants),a.Ub(3),a.bd(a.yc(4,7,"common.name")),a.Ub(3),a.bd(a.yc(7,9,"catalog.sku")),a.Ub(2),a.Dc("ngForOf",a.zc(9,11,e.optionGroups,"id")),a.Ub(3),a.bd(a.yc(12,14,"catalog.price")),a.Ub(3),a.bd(a.yc(15,16,"catalog.stock-on-hand")),a.Ub(3),a.bd(a.yc(18,18,"common.enabled")))},directives:[o.M,o.L,B.o,S.q,S.j,B.p,tt.s,o.db,S.b,tt.r,S.p,S.h,o.F,S.v,tt.k,S.a,tt.i,o.R,tt.o],pipes:[W.d,o.Ib,o.gb,o.q,o.Jb],styles:[".placeholder[_ngcontent-%COMP%]{color:#bfc3cc}input[_ngcontent-%COMP%]{width:100%}.price[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .stock[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:96px}td[_ngcontent-%COMP%]{transition:background-color .2s}td.disabled[_ngcontent-%COMP%]{background-color:#f2f3f5}"],changeDetection:0}),Object(n.c)([Object(a.D)("productVariantsFormArray"),Object(n.f)("design:type",S.c)],va.prototype,"formArray",void 0),Object(n.c)([Object(a.D)(),Object(n.f)("design:type",Array)],va.prototype,"variants",void 0),Object(n.c)([Object(a.D)(),Object(n.f)("design:type",Array)],va.prototype,"optionGroups",void 0);let ya=class{constructor(t){this.dataService=t,this.priceChange$=new T.a(0),this.taxCategoryIdChange$=new T.a("")}ngOnInit(){const t=this.dataService.settings.getTaxRates(99999,0,"cache-first").mapStream(t=>t.taxRates.items),e=this.dataService.settings.getActiveChannel("cache-first").mapStream(t=>t.activeChannel);this.taxRate$=Object(A.a)(e,t,this.taxCategoryIdChange$).pipe(Object(s.a)(([t,e,c])=>{const n=t.defaultTaxZone;if(!n)return 0;const a=e.find(t=>t.zone.id===n.id&&t.category.id===c);return a?a.value:0})),this.grossPrice$=Object(A.a)(this.taxRate$,this.priceChange$).pipe(Object(s.a)(([t,e])=>Math.round(e*((100+t)/100))/100))}ngOnChanges(t){"price"in t&&this.priceChange$.next(t.price.currentValue),"taxCategoryId"in t&&this.taxCategoryIdChange$.next(t.taxCategoryId.currentValue)}};ya.\u0275fac=function(t){return new(t||ya)(a.gc(o.K))},ya.\u0275cmp=a.ac({type:ya,selectors:[["vdr-variant-price-detail"]],inputs:{priceIncludesTax:"priceIncludesTax",price:"price",currencyCode:"currencyCode",taxCategoryId:"taxCategoryId"},features:[a.Sb],decls:5,vars:5,consts:[[1,"clr-control-label"],["class","value",4,"ngIf"],[1,"value"]],template:function(t,e){1&t&&(a.mc(0,"label",0),a.ad(1),a.xc(2,"translate"),a.lc(),a.Yc(3,xn,4,8,"div",1),a.Yc(4,Fn,6,14,"div",1)),2&t&&(a.Ub(1),a.bd(a.yc(2,3,"catalog.taxes")),a.Ub(2),a.Dc("ngIf",e.priceIncludesTax),a.Ub(1),a.Dc("ngIf",!e.priceIncludesTax))},directives:[tt.t,B.p],pipes:[W.d,B.b,B.d],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}.value[_ngcontent-%COMP%]{margin-top:3px}"],changeDetection:0}),ya.ctorParameters=()=>[{type:o.K}],Object(n.c)([Object(a.D)(),Object(n.f)("design:type",Boolean)],ya.prototype,"priceIncludesTax",void 0),Object(n.c)([Object(a.D)(),Object(n.f)("design:type",Number)],ya.prototype,"price",void 0),Object(n.c)([Object(a.D)(),Object(n.f)("design:type",String)],ya.prototype,"currencyCode",void 0),Object(n.c)([Object(a.D)(),Object(n.f)("design:type",String)],ya.prototype,"taxCategoryId",void 0),ya=Object(n.c)([Object(n.f)("design:paramtypes",[o.K])],ya);let Oa=class{};Oa.\u0275mod=a.ec({type:Oa}),Oa.\u0275inj=a.dc({factory:function(t){return new(t||Oa)},imports:[[o.Gb,i.i.forChild(ca)]]})},qzMg:function(t,e,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.unique=function(t,e){return t.filter((t,c,n)=>c===n.findIndex(c=>void 0===e?c===t:c[e]===t[e]))}}}]);
//# sourceMappingURL=6-es2015.90b070767feb16d5f92d.js.map