(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{O3L2:function(t,e,c){"use strict";c.r(e),c.d(e,"PhoneSubscriptionUIModule",(function(){return E})),c.d(e,"phoneDetailBreadcrumb",(function(){return B}));var n=c("sEIs"),i=c("ixhn"),r=c("nIj0"),s=c("OxKu"),o=c("78m0"),a=c("6Oco"),d=c("mWib"),u=c("kuMc"),h=c("TLy2"),l=c("dMHK"),b=c("H5qd"),p=c.n(b),m=c("j9kT");const f=p.a`
    query GetAllPhones($options: PhoneListOptions){
		SubscriptionPhones(options: $options){
			items{
			...SubscribedPhones
			}
			totalItems
       }
    }
	${m.b}
`,v=p.a`
   mutation DeletePhone($input:[ID!]!){
      deleteSubscriptionPhone(id:$input){
	     ...SubscribedPhones 
	  }
   }
   ${m.b}
`;var g=c("EM62"),y=c("DEd4"),P=c("Kej3"),S=c("s2Ay"),k=c("2kYt");function w(t,e){if(1&t){const t=g.jc();g.ic(0,"a",5),g.pc("click",(function(){g.Mc(t);return g.rc().downloadcsv()})),g.dc(1,"clr-icon",6),g.Xc(2),g.sc(3,"translate"),g.hc()}2&t&&(g.Rb(2),g.Zc(" ",g.tc(3,1,"vdr-subscription-plugin.download-csv")," "))}const O=function(){return["./create"]};function I(t,e){1&t&&(g.ic(0,"a",7),g.dc(1,"clr-icon",8),g.Xc(2),g.sc(3,"translate"),g.hc()),2&t&&(g.yc("routerLink",g.Cc(4,O)),g.Rb(2),g.Zc(" ",g.tc(3,2,"vdr-subscription-plugin.create-new-phone")," "))}const j=function(t){return["/extensions","subscribedphones",t]};function R(t,e){if(1&t&&(g.ic(0,"td",11),g.dc(1,"vdr-table-row-action",12),g.sc(2,"translate"),g.hc()),2&t){const t=g.rc().item;g.Rb(1),g.yc("label",g.tc(2,2,"common.edit"))("linkTo",g.Dc(4,j,t.id))}}function C(t,e){if(1&t){const t=g.jc();g.ic(0,"td",11),g.ic(1,"vdr-dropdown"),g.ic(2,"button",13),g.Xc(3),g.sc(4,"translate"),g.dc(5,"clr-icon",14),g.hc(),g.ic(6,"vdr-dropdown-menu",15),g.ic(7,"button",16),g.pc("click",(function(){g.Mc(t);const e=g.rc().item;return g.rc().deletePhone(e.id)})),g.dc(8,"clr-icon",17),g.Xc(9),g.sc(10,"translate"),g.hc(),g.hc(),g.hc(),g.hc()}2&t&&(g.Rb(3),g.Zc(" ",g.tc(4,2,"common.actions")," "),g.Rb(6),g.Zc(" ",g.tc(10,4,"common.delete")," "))}function $(t,e){if(1&t&&(g.ic(0,"td",9),g.Xc(1),g.hc(),g.ic(2,"td",9),g.Xc(3),g.sc(4,"date"),g.hc(),g.ic(5,"td",9),g.Xc(6),g.sc(7,"date"),g.hc(),g.Vc(8,R,3,6,"td",10),g.Vc(9,C,11,6,"td",10)),2&t){const t=e.item;g.Rb(1),g.Yc(t.phone),g.Rb(2),g.Yc(g.uc(4,5,t.createdAt,"longDate")),g.Rb(3),g.Yc(g.uc(7,8,t.updatedAt,"longDate")),g.Rb(2),g.yc("vdrIfPermissions","UpdateSettings"),g.Rb(1),g.yc("vdrIfPermissions","DeleteSettings")}}class D extends i.x{constructor(t,e,c,n,i,s){super(i,s),this.dataService=t,this.modalService=e,this.notificationService=c,this.apollo=n,this.searchTerm=new r.f(""),super.setQueryFn((...t)=>this.dataService.query(f,t),t=>t.SubscriptionPhones,(t,e)=>({options:{skip:t,take:e,filter:{phone:{contains:this.getfilter()}},sort:{updatedAt:o.a.Desc}}}))}getfilter(){return this.searchTerm.value?this.searchTerm.value.toString():""}ngOnInit(){super.ngOnInit(),this.searchTerm.valueChanges.pipe(Object(d.a)(250),Object(u.a)(this.destroy$)).subscribe(()=>{this.refresh()})}downloadcsv(){this.apollo.watchQuery({query:f,variables:[]}).valueChanges.subscribe(t=>{l.a.exportToCsv("danfe-subscribed-phones.csv",t.data.SubscriptionPhones.items)})}deletePhone(t){let e=[t];this.modalService.dialog({title:Object(s.a)("vdr-subscription-plugin.confirm-delete-phone"),buttons:[{type:"secondary",label:Object(s.a)("common.cancel")},{type:"danger",label:Object(s.a)("common.delete"),returnValue:!0}]}).pipe(Object(h.a)(t=>t?this.dataService.mutate(v,{input:e}):a.a)).subscribe(()=>{this.notificationService.success(Object(s.a)("common.notify-delete-success"),{entity:"Phone"}),this.refresh()},t=>{this.notificationService.error(Object(s.a)("common.notify-delete-error"),{entity:"Phone"})})}}D.\u0275fac=function(t){return new(t||D)(g.cc(i.M),g.cc(i.Cb),g.cc(i.Db),g.cc(y.b),g.cc(n.e),g.cc(n.a))},D.\u0275cmp=g.Wb({type:D,selectors:[["vdr-all-phones-list"]],features:[g.Ob],decls:25,vars:27,consts:[["type","number","name","searchTerm",1,"clr-input","search-input",3,"formControl","placeholder"],["locationId","phone-list"],["href","javascript:void(0)","class","btn btn-primary","id","downloadbtn",3,"click",4,"vdrIfPermissions"],["class","btn btn-primary","id","createbtn",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],["href","javascript:void(0)","id","downloadbtn",1,"btn","btn-primary",3,"click"],["shape","download-cloud"],["id","createbtn",1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"left","align-middle"],["class","right align-middle",4,"vdrIfPermissions"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"click"],["shape","trash",1,"is-danger"]],template:function(t,e){1&t&&(g.ic(0,"vdr-action-bar"),g.ic(1,"vdr-ab-left"),g.dc(2,"input",0),g.sc(3,"translate"),g.hc(),g.ic(4,"vdr-ab-right"),g.dc(5,"vdr-action-bar-items",1),g.Vc(6,w,4,3,"a",2),g.Vc(7,I,4,5,"a",3),g.hc(),g.hc(),g.ic(8,"vdr-data-table",4),g.pc("pageChange",(function(t){return e.setPageNumber(t)}))("itemsPerPageChange",(function(t){return e.setItemsPerPage(t)})),g.sc(9,"async"),g.sc(10,"async"),g.sc(11,"async"),g.sc(12,"async"),g.ic(13,"vdr-dt-column"),g.Xc(14),g.sc(15,"translate"),g.hc(),g.ic(16,"vdr-dt-column"),g.Xc(17),g.sc(18,"translate"),g.hc(),g.ic(19,"vdr-dt-column"),g.Xc(20),g.sc(21,"translate"),g.hc(),g.dc(22,"vdr-dt-column"),g.dc(23,"vdr-dt-column"),g.Vc(24,$,10,11,"ng-template"),g.hc()),2&t&&(g.Rb(2),g.yc("formControl",e.searchTerm)("placeholder",g.tc(3,11,"vdr-subscription-plugin.search-by-phone")),g.Rb(4),g.yc("vdrIfPermissions","CreateSettings"),g.Rb(1),g.yc("vdrIfPermissions","CreateSettings"),g.Rb(1),g.yc("items",g.tc(9,13,e.items$))("itemsPerPage",g.tc(10,15,e.itemsPerPage$))("totalItems",g.tc(11,17,e.totalItems$))("currentPage",g.tc(12,19,e.currentPage$)),g.Rb(6),g.Yc(g.tc(15,21,"vdr-subscription-plugin.phone")),g.Rb(3),g.Yc(g.tc(18,23,"vdr-subscription-plugin.created")),g.Rb(3),g.Yc(g.tc(21,25,"vdr-subscription-plugin.updated")))},directives:[i.c,i.e,i.gb,r.v,r.b,r.p,r.g,i.f,i.d,i.tb,i.O,i.N,P.o,n.h,i.Rb,i.U,i.X,i.W,i.V],pipes:[S.d,k.b,k.f],styles:[".search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}"],changeDetection:0});var F=c("ROBh"),x=c("xVbo"),M=c("7SLS");const X=p.a`
    mutation UpdatePhone($input: [PhoneUpdateInput!]!) {
        updateSubscriptionPhone(input: $input) {
            ...SubscribedPhones
        }
    }
    ${m.b}
`,T=p.a`
    mutation CreatePhone($input: [PhoneAddInput!]!) {
        addSubscriptionPhone(input: $input) {
            ...SubscribedPhones
        }
    }
    ${m.b}
`;function V(t,e){if(1&t){const t=g.jc();g.ic(0,"button",5),g.pc("click",(function(){g.Mc(t);return g.rc().create()})),g.Xc(1),g.sc(2,"translate"),g.hc()}if(2&t){const t=g.rc();g.yc("disabled",!(t.detailForm.valid&&t.detailForm.dirty)),g.Rb(1),g.Zc(" ",g.tc(2,2,"common.create")," ")}}function Y(t,e){if(1&t){const t=g.jc();g.ic(0,"button",6),g.pc("click",(function(){g.Mc(t);return g.rc().save()})),g.Xc(1),g.sc(2,"translate"),g.hc()}if(2&t){const t=g.rc();g.yc("disabled",!(t.detailForm.valid&&t.detailForm.dirty)),g.Rb(1),g.Zc(" ",g.tc(2,2,"common.update")," ")}}class A extends i.v{constructor(t,e,c,n,i,s,o){super(t,e,c,i),this.formBuilder=n,this.dataService=i,this.changeDetector=s,this.notificationService=o,this.which=!1,this.detailForm=this.formBuilder.group({phone:["",r.C.required]})}ngOnInit(){"/extensions/subscribedphones/create"!=this.router.url?(this.which=!1,this.init()):this.which=!0}ngOnDestroy(){this.destroy()}create(){this.addNew().pipe(Object(x.a)(t=>!!t)).subscribe(()=>{this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success("common.notify-create-success",{entity:"Phone"})},()=>{this.notificationService.error("common.notify-create-error",{entity:"Phone"})})}save(){this.saveChanges().pipe(Object(x.a)(t=>!!t)).subscribe(()=>{this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success("common.notify-update-success",{entity:"Phone"})},()=>{this.notificationService.error("common.notify-update-error",{entity:"Phone"})})}addNew(){if(this.detailForm.dirty){const t=[{phone:this.detailForm.value.phone.toString()}];return this.dataService.mutate(T,{input:t}).pipe(Object(M.a)(!0))}return Object(F.a)(!1)}saveChanges(){if(this.detailForm.dirty){const t=this.detailForm.value.phone.toString(),e=[{id:this.id,phone:t}];return this.dataService.mutate(X,{input:e}).pipe(Object(M.a)(!0))}return Object(F.a)(!1)}setFormValues(t){this.detailForm.patchValue({phone:parseInt(t.phone)})}}A.\u0275fac=function(t){return new(t||A)(g.cc(n.a),g.cc(n.e),g.cc(i.Lb),g.cc(r.e),g.cc(i.M),g.cc(g.k),g.cc(i.Db))},A.\u0275cmp=g.Wb({type:A,selectors:[["vdr-subscription-phone-detail"]],features:[g.Ob],decls:9,vars:7,consts:[["class","btn btn-primary","id","custbtn",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],[1,"form",3,"formGroup"],["for","phone",3,"label"],["id","phone","type","number","formControlName","phone",3,"readonly"],["id","custbtn",1,"btn","btn-primary",3,"disabled","click"],["id","editbtn",1,"btn","btn-primary",3,"disabled","click"]],template:function(t,e){if(1&t&&(g.ic(0,"vdr-action-bar"),g.ic(1,"vdr-ab-right"),g.Vc(2,V,3,4,"button",0),g.Vc(3,Y,3,4,"ng-template",null,1,g.Wc),g.hc(),g.hc(),g.ic(5,"form",2),g.ic(6,"vdr-form-field",3),g.sc(7,"translate"),g.dc(8,"input",4),g.hc(),g.hc()),2&t){const t=g.Jc(4);g.Rb(2),g.yc("ngIf",e.which)("ngIfElse",t),g.Rb(3),g.yc("formGroup",e.detailForm),g.Rb(1),g.yc("label",g.tc(7,5,"vdr-subscription-plugin.phone-label")),g.Rb(2),g.yc("readonly",!1)}},directives:[i.c,i.f,k.p,r.E,r.q,r.j,i.fb,i.gb,r.v,r.b,r.p,r.h],pipes:[S.d],styles:[".search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}"]});const q=p.a`
  query GetPhone($id: ID!) {
    SubscriptionPhone(id: $id) {
      ...SubscribedPhones
    }
  }
  ${m.b}
`;class L extends i.w{constructor(t,e){super(t,{__typename:"Phone",id:"",phone:"",createdAt:"",updatedAt:""},t=>e.query(q,{id:t}).mapStream(t=>t.SubscriptionPhone))}}L.\u0275fac=function(t){return new(t||L)(g.mc(n.e),g.mc(i.M))},L.\u0275prov=g.Yb({token:L,factory:L.\u0275fac});var Z=c("YtkY");class E{}function B(t){return t.entity.pipe(Object(Z.a)(t=>[{label:"Subscribed Phones",link:["/extensions","subscribedphones"]},{label:""+t.phone,link:[]}]))}E.\u0275mod=g.ac({type:E}),E.\u0275inj=g.Zb({factory:function(t){return new(t||E)},providers:[L],imports:[[i.Mb,n.i.forChild([{path:"",pathMatch:"full",component:D,data:{breadcrumb:"Subscribed Phones"}},{path:"create",component:A,data:{breadcrumb:[{label:"Subscribed Phones",link:["/extensions","subscribedphones"]},{label:"Create Phone",link:[]}]}},{path:":id",component:A,resolve:Object(i.Yb)(L),data:{breadcrumb:B}}])]]})}}]);
//# sourceMappingURL=7-es2015.34c4b3fb3620fc0e8c1d.js.map