(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"hr/e":function(e,t,c){"use strict";c.r(t);var n=c("sEIs"),i=c("ixhn"),r=c("nIj0"),o=c("OxKu"),s=c("FOa3"),a=c("6Oco"),d=c("mWib"),l=c("kuMc"),u=c("TLy2"),b=c("7RXT"),h=c("H5qd"),p=c.n(h),m=c("JReq");const f=p.a`
    query GetAllPhones($options: PhoneListOptions){
		SubscriptionPhones(options: $options){
			items{
			...SubscribedPhones
			}
			totalItems
       }
    }
	${m.b}
`,v=p.a`
   mutation DeletePhone($input:[ID!]!){
      deleteSubscriptionPhone(id:$input){
	     ...SubscribedPhones 
	  }
   }
   ${m.b}
`;var g=c("EM62"),y=c("DEd4"),P=c("Kej3"),S=c("s2Ay"),w=c("2kYt");function k(e,t){if(1&e){const e=g.nc();g.mc(0,"a",5),g.uc("click",(function(){return g.Rc(e),g.wc().downloadcsv()})),g.hc(1,"clr-icon",6),g.ad(2),g.xc(3,"translate"),g.lc()}2&e&&(g.Ub(2),g.cd(" ",g.yc(3,1,"vdr-subscription-plugin.download-csv")," "))}const x=function(){return["./create"]};function D(e,t){1&e&&(g.mc(0,"a",7),g.hc(1,"clr-icon",8),g.ad(2),g.xc(3,"translate"),g.lc()),2&e&&(g.Dc("routerLink",g.Hc(4,x)),g.Ub(2),g.cd(" ",g.yc(3,2,"vdr-subscription-plugin.create-new-phone")," "))}const I=function(e){return["/extensions","subscribedphones",e]};function O(e,t){if(1&e&&(g.mc(0,"td",11),g.hc(1,"vdr-table-row-action",12),g.xc(2,"translate"),g.lc()),2&e){const e=g.wc().item;g.Ub(1),g.Dc("label",g.yc(2,2,"common.edit"))("linkTo",g.Ic(4,I,e.id))}}function U(e,t){if(1&e){const e=g.nc();g.mc(0,"td",11),g.mc(1,"vdr-dropdown"),g.mc(2,"button",13),g.ad(3),g.xc(4,"translate"),g.hc(5,"clr-icon",14),g.lc(),g.mc(6,"vdr-dropdown-menu",15),g.mc(7,"button",16),g.uc("click",(function(){g.Rc(e);const t=g.wc().item;return g.wc().deletePhone(t.id)})),g.hc(8,"clr-icon",17),g.ad(9),g.xc(10,"translate"),g.lc(),g.lc(),g.lc(),g.lc()}2&e&&(g.Ub(3),g.cd(" ",g.yc(4,2,"common.actions")," "),g.Ub(6),g.cd(" ",g.yc(10,4,"common.delete")," "))}function j(e,t){if(1&e&&(g.mc(0,"td",9),g.ad(1),g.lc(),g.mc(2,"td",9),g.ad(3),g.xc(4,"date"),g.lc(),g.mc(5,"td",9),g.ad(6),g.xc(7,"date"),g.lc(),g.Yc(8,O,3,6,"td",10),g.Yc(9,U,11,6,"td",10)),2&e){const e=t.item;g.Ub(1),g.bd(e.phone),g.Ub(2),g.bd(g.zc(4,5,e.createdAt,"longDate")),g.Ub(3),g.bd(g.zc(7,8,e.updatedAt,"longDate")),g.Ub(2),g.Dc("vdrIfPermissions","UpdateSettings"),g.Ub(1),g.Dc("vdrIfPermissions","DeleteSettings")}}class C extends i.w{constructor(e,t,c,n,i,o){super(i,o),this.dataService=e,this.modalService=t,this.notificationService=c,this.apollo=n,this.searchTerm=new r.f(""),super.setQueryFn((...e)=>this.dataService.query(f,e),e=>e.SubscriptionPhones,(e,t)=>({options:{skip:e,take:t,filter:{phone:{contains:this.getfilter()}},sort:{updatedAt:s.a.Desc}}}))}getfilter(){return this.searchTerm.value?this.searchTerm.value.toString():""}ngOnInit(){super.ngOnInit(),this.searchTerm.valueChanges.pipe(Object(d.a)(250),Object(l.a)(this.destroy$)).subscribe(()=>{this.refresh()})}downloadcsv(){this.apollo.watchQuery({query:f,variables:[]}).valueChanges.subscribe(e=>{b.a.exportToCsv("danfe-subscribed-phones.csv",e.data.SubscriptionPhones.items)})}deletePhone(e){let t=[e];this.modalService.dialog({title:Object(o.a)("vdr-subscription-plugin.confirm-delete-phone"),buttons:[{type:"secondary",label:Object(o.a)("common.cancel")},{type:"danger",label:Object(o.a)("common.delete"),returnValue:!0}]}).pipe(Object(u.a)(e=>e?this.dataService.mutate(v,{input:t}):a.a)).subscribe(()=>{this.notificationService.success(Object(o.a)("common.notify-delete-success"),{entity:"Phone"}),this.refresh()},e=>{this.notificationService.error(Object(o.a)("common.notify-delete-error"),{entity:"Phone"})})}}C.\u0275fac=function(e){return new(e||C)(g.gc(i.K),g.gc(i.xb),g.gc(i.yb),g.gc(y.b),g.gc(n.e),g.gc(n.a))},C.\u0275cmp=g.ac({type:C,selectors:[["vdr-all-phones-list"]],features:[g.Rb],decls:25,vars:27,consts:[["type","number","name","searchTerm",1,"clr-input","search-input",3,"formControl","placeholder"],["locationId","phone-list"],["href","javascript:void(0)","class","btn btn-primary","id","downloadbtn",3,"click",4,"vdrIfPermissions"],["class","btn btn-primary","id","createbtn",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],["href","javascript:void(0)","id","downloadbtn",1,"btn","btn-primary",3,"click"],["shape","download-cloud"],["id","createbtn",1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"left","align-middle"],["class","right align-middle",4,"vdrIfPermissions"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"click"],["shape","trash",1,"is-danger"]],template:function(e,t){1&e&&(g.mc(0,"vdr-action-bar"),g.mc(1,"vdr-ab-left"),g.hc(2,"input",0),g.xc(3,"translate"),g.lc(),g.mc(4,"vdr-ab-right"),g.hc(5,"vdr-action-bar-items",1),g.Yc(6,k,4,3,"a",2),g.Yc(7,D,4,5,"a",3),g.lc(),g.lc(),g.mc(8,"vdr-data-table",4),g.uc("pageChange",(function(e){return t.setPageNumber(e)}))("itemsPerPageChange",(function(e){return t.setItemsPerPage(e)})),g.xc(9,"async"),g.xc(10,"async"),g.xc(11,"async"),g.xc(12,"async"),g.mc(13,"vdr-dt-column"),g.ad(14),g.xc(15,"translate"),g.lc(),g.mc(16,"vdr-dt-column"),g.ad(17),g.xc(18,"translate"),g.lc(),g.mc(19,"vdr-dt-column"),g.ad(20),g.xc(21,"translate"),g.lc(),g.hc(22,"vdr-dt-column"),g.hc(23,"vdr-dt-column"),g.Yc(24,j,10,11,"ng-template"),g.lc()),2&e&&(g.Ub(2),g.Dc("formControl",t.searchTerm)("placeholder",g.yc(3,11,"vdr-subscription-plugin.search-by-phone")),g.Ub(4),g.Dc("vdrIfPermissions","CreateSettings"),g.Ub(1),g.Dc("vdrIfPermissions","CreateSettings"),g.Ub(1),g.Dc("items",g.yc(9,13,t.items$))("itemsPerPage",g.yc(10,15,t.itemsPerPage$))("totalItems",g.yc(11,17,t.totalItems$))("currentPage",g.yc(12,19,t.currentPage$)),g.Ub(6),g.bd(g.yc(15,21,"vdr-subscription-plugin.phone")),g.Ub(3),g.bd(g.yc(18,23,"vdr-subscription-plugin.created")),g.Ub(3),g.bd(g.yc(21,25,"vdr-subscription-plugin.updated")))},directives:[i.c,i.e,i.db,r.v,r.b,r.p,r.g,i.f,i.d,i.ob,i.M,i.L,P.o,n.h,i.Kb,i.S,i.V,i.U,i.T],pipes:[S.d,w.b,w.f],styles:[".search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}"],changeDetection:0});var $=c("ROBh"),F=c("xVbo"),T=c("7SLS");const q=p.a`
    mutation UpdatePhone($input: [PhoneUpdateInput!]!) {
        updateSubscriptionPhone(input: $input) {
            ...SubscribedPhones
        }
    }
    ${m.b}
`,A=p.a`
    mutation CreatePhone($input: [PhoneAddInput!]!) {
        addSubscriptionPhone(input: $input) {
            ...SubscribedPhones
        }
    }
    ${m.b}
`;function Y(e,t){if(1&e){const e=g.nc();g.mc(0,"button",5),g.uc("click",(function(){return g.Rc(e),g.wc().create()})),g.ad(1),g.xc(2,"translate"),g.lc()}if(2&e){const e=g.wc();g.Dc("disabled",!(e.detailForm.valid&&e.detailForm.dirty)),g.Ub(1),g.cd(" ",g.yc(2,2,"common.create")," ")}}function R(e,t){if(1&e){const e=g.nc();g.mc(0,"button",6),g.uc("click",(function(){return g.Rc(e),g.wc().save()})),g.ad(1),g.xc(2,"translate"),g.lc()}if(2&e){const e=g.wc();g.Dc("disabled",!(e.detailForm.valid&&e.detailForm.dirty)),g.Ub(1),g.cd(" ",g.yc(2,2,"common.update")," ")}}class L extends i.u{constructor(e,t,c,n,i,o,s){super(e,t,c,i),this.formBuilder=n,this.dataService=i,this.changeDetector=o,this.notificationService=s,this.which=!1,this.detailForm=this.formBuilder.group({phone:["",r.C.required]})}ngOnInit(){"/extensions/subscribedphones/create"!=this.router.url?(this.which=!1,this.init()):this.which=!0}ngOnDestroy(){this.destroy()}create(){this.addNew().pipe(Object(F.a)(e=>!!e)).subscribe(()=>{this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success("common.notify-create-success",{entity:"Phone"})},()=>{this.notificationService.error("common.notify-create-error",{entity:"Phone"})})}save(){this.saveChanges().pipe(Object(F.a)(e=>!!e)).subscribe(()=>{this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success("common.notify-update-success",{entity:"Phone"})},()=>{this.notificationService.error("common.notify-update-error",{entity:"Phone"})})}addNew(){if(this.detailForm.dirty){const e=[{phone:this.detailForm.value.phone.toString()}];return this.dataService.mutate(A,{input:e}).pipe(Object(T.a)(!0))}return Object($.a)(!1)}saveChanges(){if(this.detailForm.dirty){const e=this.detailForm.value.phone.toString(),t=[{id:this.id,phone:e}];return this.dataService.mutate(q,{input:t}).pipe(Object(T.a)(!0))}return Object($.a)(!1)}setFormValues(e){this.detailForm.patchValue({phone:parseInt(e.phone)})}}L.\u0275fac=function(e){return new(e||L)(g.gc(n.a),g.gc(n.e),g.gc(i.Fb),g.gc(r.e),g.gc(i.K),g.gc(g.k),g.gc(i.yb))},L.\u0275cmp=g.ac({type:L,selectors:[["vdr-subscription-phone-detail"]],features:[g.Rb],decls:9,vars:7,consts:[["class","btn btn-primary","id","custbtn",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],[1,"form",3,"formGroup"],["for","phone",3,"label"],["id","phone","type","number","formControlName","phone",3,"readonly"],["id","custbtn",1,"btn","btn-primary",3,"disabled","click"],["id","editbtn",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){if(1&e&&(g.mc(0,"vdr-action-bar"),g.mc(1,"vdr-ab-right"),g.Yc(2,Y,3,4,"button",0),g.Yc(3,R,3,4,"ng-template",null,1,g.Zc),g.lc(),g.lc(),g.mc(5,"form",2),g.mc(6,"vdr-form-field",3),g.xc(7,"translate"),g.hc(8,"input",4),g.lc(),g.lc()),2&e){const e=g.Oc(4);g.Ub(2),g.Dc("ngIf",t.which)("ngIfElse",e),g.Ub(3),g.Dc("formGroup",t.detailForm),g.Ub(1),g.Dc("label",g.yc(7,5,"vdr-subscription-plugin.phone-label")),g.Ub(2),g.Dc("readonly",!1)}},directives:[i.c,i.f,w.p,r.E,r.q,r.j,i.cb,i.db,r.v,r.b,r.p,r.h],pipes:[S.d],styles:[".search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}"]});const M=p.a`
  query GetPhone($id: ID!) {
    SubscriptionPhone(id: $id) {
      ...SubscribedPhones
    }
  }
  ${m.b}
`;class E extends i.v{constructor(e,t){super(e,{__typename:"Phone",id:"",phone:"",createdAt:"",updatedAt:""},e=>t.query(M,{id:e}).mapStream(e=>e.SubscriptionPhone))}}E.\u0275fac=function(e){return new(e||E)(g.qc(n.e),g.qc(i.K))},E.\u0275prov=g.cc({token:E,factory:E.\u0275fac});var K=c("YtkY");c.d(t,"PhoneSubscriptionUIModule",(function(){return B})),c.d(t,"phoneDetailBreadcrumb",(function(){return G}));class B{}function G(e){return e.entity.pipe(Object(K.a)(e=>[{label:"Subscribed Phones",link:["/extensions","subscribedphones"]},{label:`${e.phone}`,link:[]}]))}B.\u0275mod=g.ec({type:B}),B.\u0275inj=g.dc({factory:function(e){return new(e||B)},providers:[E],imports:[[i.Gb,n.i.forChild([{path:"",pathMatch:"full",component:C,data:{breadcrumb:"Subscribed Phones"}},{path:"create",component:L,data:{breadcrumb:[{label:"Subscribed Phones",link:["/extensions","subscribedphones"]},{label:"Create Phone",link:[]}]}},{path:":id",component:L,resolve:Object(i.Qb)(E),data:{breadcrumb:G}}])]]})}}]);
//# sourceMappingURL=11-es2015.55d8c8022acd08ef27cf.js.map