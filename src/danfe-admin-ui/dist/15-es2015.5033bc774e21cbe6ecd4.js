(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{Spgw:function(t,o,e){"use strict";e.r(o),e.d(o,"MarketingModule",(function(){return Z})),e.d(o,"PromotionDetailComponent",(function(){return S})),e.d(o,"PromotionListComponent",(function(){return x})),e.d(o,"PromotionResolver",(function(){return U})),e.d(o,"marketingRoutes",(function(){return $})),e.d(o,"promotionBreadcrumb",(function(){return T})),e.d(o,"\u02750",(function(){return N})),e.d(o,"\u02751",(function(){return L}));var n=e("D57K"),i=e("EM62"),c=e("nIj0"),r=e("sEIs"),a=e("OxKu"),s=e("ixhn"),d=e("J+dc"),m=e("cJ9h"),l=e("TLy2"),b=e("6Oco"),u=e("2kYt"),p=e("Kej3"),f=e("s2Ay");const h=function(){return["enabled"]};function v(t,o){if(1&t&&(i.nc(0,"clr-toggle-wrapper"),i.ic(1,"input",23),i.nc(2,"label"),i.bd(3),i.yc(4,"translate"),i.mc(),i.mc()),2&t){const t=i.xc();i.Vb(1),i.Ec("formControl",t.detailForm.get(i.Ic(4,h))),i.Vb(2),i.cd(i.zc(4,2,"common.enabled"))}}function y(t,o){if(1&t){const t=i.oc();i.nc(0,"button",24),i.vc("click",(function(){return i.Sc(t),i.xc().create()})),i.bd(1),i.yc(2,"translate"),i.mc()}if(2&t){const t=i.xc();i.Ec("disabled",!t.saveButtonEnabled()),i.Vb(1),i.dd(" ",i.zc(2,2,"common.create")," ")}}function g(t,o){if(1&t){const t=i.oc();i.nc(0,"button",24),i.vc("click",(function(){return i.Sc(t),i.xc(2).save()})),i.bd(1),i.yc(2,"translate"),i.mc()}if(2&t){const t=i.xc(2);i.Ec("disabled",!t.saveButtonEnabled()),i.Vb(1),i.dd(" ",i.zc(2,2,"common.update")," ")}}function P(t,o){1&t&&i.Zc(0,g,3,4,"button",25),2&t&&i.Ec("vdrIfPermissions","UpdatePromotion")}function C(t,o){if(1&t){const t=i.oc();i.lc(0),i.nc(1,"vdr-configurable-input",26),i.vc("remove",(function(o){return i.Sc(t),i.xc().removeCondition(o)})),i.yc(2,"hasPermission"),i.mc(),i.kc()}if(2&t){const t=o.$implicit,e=o.index,n=i.xc();i.Vb(1),i.Ec("readonly",!i.zc(2,4,"UpdatePromotion"))("operation",t)("operationDefinition",n.getConditionDefinition(t))("formControlName",e)}}function A(t,o){if(1&t){const t=i.oc();i.nc(0,"button",31),i.vc("click",(function(){i.Sc(t);const e=o.$implicit;return i.xc(2).addCondition(e)})),i.bd(1),i.mc()}if(2&t){const t=o.$implicit;i.Vb(1),i.dd(" ",t.description," ")}}function O(t,o){if(1&t&&(i.nc(0,"vdr-dropdown"),i.nc(1,"button",27),i.ic(2,"clr-icon",28),i.bd(3),i.yc(4,"translate"),i.mc(),i.nc(5,"vdr-dropdown-menu",29),i.Zc(6,A,2,1,"button",30),i.mc(),i.mc()),2&t){const t=i.xc();i.Vb(3),i.dd(" ",i.zc(4,2,"marketing.add-condition")," "),i.Vb(3),i.Ec("ngForOf",t.getAvailableConditions())}}function k(t,o){if(1&t){const t=i.oc();i.nc(0,"vdr-configurable-input",32),i.vc("remove",(function(o){return i.Sc(t),i.xc().removeAction(o)})),i.yc(1,"hasPermission"),i.mc()}if(2&t){const t=o.$implicit,e=o.index,n=i.xc();i.Ec("operation",t)("readonly",!i.zc(1,4,"UpdatePromotion"))("operationDefinition",n.getActionDefinition(t))("formControlName",e)}}function V(t,o){if(1&t){const t=i.oc();i.nc(0,"button",31),i.vc("click",(function(){i.Sc(t);const e=o.$implicit;return i.xc(2).addAction(e)})),i.bd(1),i.mc()}if(2&t){const t=o.$implicit;i.Vb(1),i.dd(" ",t.description," ")}}function E(t,o){if(1&t&&(i.nc(0,"vdr-dropdown"),i.nc(1,"button",27),i.ic(2,"clr-icon",28),i.bd(3),i.yc(4,"translate"),i.mc(),i.nc(5,"vdr-dropdown-menu",29),i.Zc(6,V,2,1,"button",30),i.mc(),i.mc()),2&t){const t=i.xc();i.Vb(3),i.dd(" ",i.zc(4,2,"marketing.add-action")," "),i.Vb(3),i.Ec("ngForOf",t.getAvailableActions())}}const I=function(){return["./create"]};function z(t,o){1&t&&(i.nc(0,"a",3),i.ic(1,"clr-icon",4),i.bd(2),i.yc(3,"translate"),i.mc()),2&t&&(i.Ec("routerLink",i.Ic(4,I)),i.Vb(2),i.dd(" ",i.zc(3,2,"marketing.create-new-promotion")," "))}function j(t,o){if(1&t&&(i.nc(0,"vdr-chip"),i.bd(1),i.mc()),2&t){const t=i.xc().item;i.Vb(1),i.dd(" ",t.couponCode," ")}}function w(t,o){1&t&&(i.nc(0,"vdr-chip"),i.bd(1),i.yc(2,"translate"),i.mc()),2&t&&(i.Vb(1),i.cd(i.zc(2,1,"common.disabled")))}const D=function(t){return["./",t]};function F(t,o){if(1&t){const t=i.oc();i.nc(0,"td",5),i.bd(1),i.mc(),i.nc(2,"td",5),i.Zc(3,j,2,1,"vdr-chip",6),i.mc(),i.nc(4,"td",5),i.bd(5),i.yc(6,"date"),i.mc(),i.nc(7,"td",5),i.bd(8),i.yc(9,"date"),i.mc(),i.nc(10,"td",7),i.Zc(11,w,3,3,"vdr-chip",6),i.mc(),i.nc(12,"td",8),i.ic(13,"vdr-table-row-action",9),i.yc(14,"translate"),i.mc(),i.nc(15,"td",8),i.nc(16,"vdr-dropdown"),i.nc(17,"button",10),i.bd(18),i.yc(19,"translate"),i.ic(20,"clr-icon",11),i.mc(),i.nc(21,"vdr-dropdown-menu",12),i.nc(22,"button",13),i.vc("click",(function(){i.Sc(t);const e=o.item;return i.xc().deletePromotion(e.id)})),i.yc(23,"hasPermission"),i.ic(24,"clr-icon",14),i.bd(25),i.yc(26,"translate"),i.mc(),i.mc(),i.mc(),i.mc()}if(2&t){const t=o.item;i.Vb(1),i.cd(t.name),i.Vb(2),i.Ec("ngIf",t.couponCode),i.Vb(2),i.cd(i.Ac(6,10,t.startsAt,"longDate")),i.Vb(3),i.cd(i.Ac(9,13,t.endsAt,"longDate")),i.Vb(3),i.Ec("ngIf",!t.enabled),i.Vb(2),i.Ec("label",i.zc(14,16,"common.edit"))("linkTo",i.Jc(24,D,t.id)),i.Vb(5),i.dd(" ",i.zc(19,18,"common.actions")," "),i.Vb(4),i.Ec("disabled",!i.zc(23,20,"DeletePromotion")),i.Vb(3),i.dd(" ",i.zc(26,22,"common.delete")," ")}}let S=class extends s.u{constructor(t,o,e,n,i,r,a){super(o,t,e,i),this.changeDetector=n,this.dataService=i,this.formBuilder=r,this.notificationService=a,this.conditions=[],this.actions=[],this.allConditions=[],this.allActions=[],this.detailForm=this.formBuilder.group({name:["",c.C.required],enabled:!0,couponCode:null,perCustomerUsageLimit:null,startsAt:null,endsAt:null,conditions:this.formBuilder.array([]),actions:this.formBuilder.array([])})}ngOnInit(){this.init(),this.promotion$=this.entity$,this.dataService.promotion.getPromotionActionsAndConditions().single$.subscribe(t=>{this.allActions=t.promotionActions,this.allConditions=t.promotionConditions,this.changeDetector.markForCheck()})}ngOnDestroy(){this.destroy()}getAvailableConditions(){return this.allConditions.filter(t=>!this.conditions.find(o=>o.code===t.code))}getConditionDefinition(t){return this.allConditions.find(o=>o.code===t.code)}getAvailableActions(){return this.allActions.filter(t=>!this.actions.find(o=>o.code===t.code))}getActionDefinition(t){return this.allActions.find(o=>o.code===t.code)}saveButtonEnabled(){return this.detailForm.dirty&&this.detailForm.valid&&(0!==this.conditions.length||this.detailForm.value.couponCode)&&0!==this.actions.length}addCondition(t){this.addOperation("conditions",t),this.detailForm.markAsDirty()}addAction(t){this.addOperation("actions",t),this.detailForm.markAsDirty()}removeCondition(t){this.removeOperation("conditions",t),this.detailForm.markAsDirty()}removeAction(t){this.removeOperation("actions",t),this.detailForm.markAsDirty()}formArrayOf(t){return this.detailForm.get(t)}create(){if(!this.detailForm.dirty)return;const t=this.detailForm.value,o={name:t.name,enabled:!0,couponCode:t.couponCode,perCustomerUsageLimit:t.perCustomerUsageLimit,startsAt:t.startsAt,endsAt:t.endsAt,conditions:this.mapOperationsToInputs(this.conditions,t.conditions),actions:this.mapOperationsToInputs(this.actions,t.actions)};this.dataService.promotion.createPromotion(o).subscribe(t=>{this.notificationService.success(Object(a.a)("common.notify-create-success"),{entity:"Promotion"}),this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.router.navigate(["../",t.createPromotion.id],{relativeTo:this.route})},t=>{this.notificationService.error(Object(a.a)("common.notify-create-error"),{entity:"Promotion"})})}save(){if(!this.detailForm.dirty)return;const t=this.detailForm.value;this.promotion$.pipe(Object(d.a)(1),Object(m.a)(o=>{const e={id:o.id,name:t.name,enabled:t.enabled,couponCode:t.couponCode,perCustomerUsageLimit:t.perCustomerUsageLimit,startsAt:t.startsAt,endsAt:t.endsAt,conditions:this.mapOperationsToInputs(this.conditions,t.conditions),actions:this.mapOperationsToInputs(this.actions,t.actions)};return this.dataService.promotion.updatePromotion(e)})).subscribe(t=>{this.notificationService.success(Object(a.a)("common.notify-update-success"),{entity:"Promotion"}),this.detailForm.markAsPristine(),this.changeDetector.markForCheck()},t=>{this.notificationService.error(Object(a.a)("common.notify-update-error"),{entity:"Promotion"})})}setFormValues(t,o){this.detailForm.patchValue({name:t.name,enabled:t.enabled,couponCode:t.couponCode,perCustomerUsageLimit:t.perCustomerUsageLimit,startsAt:t.startsAt,endsAt:t.endsAt}),t.conditions.forEach(t=>{this.addOperation("conditions",t)}),t.actions.forEach(t=>this.addOperation("actions",t))}mapOperationsToInputs(t,o){return t.map((t,e)=>({code:t.code,arguments:Object.values(o[e].args).map((o,e)=>({name:t.args[e].name,value:Object(s.Wb)(o)}))}))}addOperation(t,o){const e=this.formArrayOf(t),n="conditions"===t?this.conditions:this.actions;if(-1===e.value.findIndex(t=>t.code===o.code)){const i=o.args.reduce((e,n)=>{var i;return Object.assign(Object.assign({},e),{[n.name]:null!==(i=Object(s.Yb)(n.value))&&void 0!==i?i:this.getDefaultArgValue(t,o,n.name)})},{});e.push(this.formBuilder.control({code:o.code,args:i})),n.push({code:o.code,args:o.args.map(t=>({name:t.name,value:Object(s.Yb)(t.value)}))})}}getDefaultArgValue(t,o,e){const n="conditions"===t?this.allConditions.find(t=>t.code===o.code):this.allActions.find(t=>t.code===o.code);if(n){const t=n.args.find(t=>t.name===e);if(t)return Object(s.Zb)(t)}throw new Error('Could not determine default value for "argName"')}removeOperation(t,o){const e=this.formArrayOf(t),n="conditions"===t?this.conditions:this.actions,i=e.value.findIndex(t=>t.code===o.code);-1!==i&&(e.removeAt(i),n.splice(i,1))}};S.\u0275fac=function(t){return new(t||S)(i.hc(r.e),i.hc(r.a),i.hc(s.Ib),i.hc(i.k),i.hc(s.K),i.hc(c.e),i.hc(s.zb))},S.\u0275cmp=i.bc({type:S,selectors:[["vdr-promotion-detail"]],features:[i.Sb],decls:46,vars:43,consts:[[1,"flex","clr-align-items-center"],[3,"entity"],[4,"vdrIfPermissions"],["locationId","promotion-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],[1,"form",3,"formGroup"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly"],["for","startsAt",3,"label"],["formControlName","startsAt"],["for","endsAt",3,"label"],["formControlName","endsAt"],["for","couponCode",3,"label"],["id","couponCode","type","text","formControlName","couponCode",3,"readonly"],["for","perCustomerUsageLimit",3,"label"],["id","perCustomerUsageLimit","type","number","min","1","max","999","formControlName","perCustomerUsageLimit",3,"readonly"],[1,"clr-row"],["formArrayName","conditions",1,"clr-col"],[1,"clr-control-label"],[4,"ngFor","ngForOf"],["formArrayName","actions",1,"clr-col"],[3,"operation","readonly","operationDefinition","formControlName","remove",4,"ngFor","ngForOf"],["type","checkbox","clrToggle","","name","enabled",3,"formControl"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[3,"readonly","operation","operationDefinition","formControlName","remove"],["vdrDropdownTrigger","",1,"btn","btn-outline"],["shape","plus"],["vdrPosition","bottom-left"],["type","button","vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["type","button","vdrDropdownItem","",3,"click"],[3,"operation","readonly","operationDefinition","formControlName","remove"]],template:function(t,o){if(1&t&&(i.nc(0,"vdr-action-bar"),i.nc(1,"vdr-ab-left"),i.nc(2,"div",0),i.ic(3,"vdr-entity-info",1),i.yc(4,"async"),i.Zc(5,v,5,5,"clr-toggle-wrapper",2),i.mc(),i.mc(),i.nc(6,"vdr-ab-right"),i.ic(7,"vdr-action-bar-items",3),i.Zc(8,y,3,4,"button",4),i.yc(9,"async"),i.Zc(10,P,1,1,"ng-template",null,5,i.ad),i.mc(),i.mc(),i.nc(12,"form",6),i.nc(13,"vdr-form-field",7),i.yc(14,"translate"),i.ic(15,"input",8),i.yc(16,"hasPermission"),i.mc(),i.nc(17,"vdr-form-field",9),i.yc(18,"translate"),i.ic(19,"vdr-datetime-picker",10),i.mc(),i.nc(20,"vdr-form-field",11),i.yc(21,"translate"),i.ic(22,"vdr-datetime-picker",12),i.mc(),i.nc(23,"vdr-form-field",13),i.yc(24,"translate"),i.ic(25,"input",14),i.yc(26,"hasPermission"),i.mc(),i.nc(27,"vdr-form-field",15),i.yc(28,"translate"),i.ic(29,"input",16),i.yc(30,"hasPermission"),i.mc(),i.nc(31,"div",17),i.nc(32,"div",18),i.nc(33,"label",19),i.bd(34),i.yc(35,"translate"),i.mc(),i.Zc(36,C,3,6,"ng-container",20),i.nc(37,"div"),i.Zc(38,O,7,4,"vdr-dropdown",2),i.mc(),i.mc(),i.nc(39,"div",21),i.nc(40,"label",19),i.bd(41),i.yc(42,"translate"),i.mc(),i.Zc(43,k,2,6,"vdr-configurable-input",22),i.nc(44,"div"),i.Zc(45,E,7,4,"vdr-dropdown",2),i.mc(),i.mc(),i.mc(),i.mc()),2&t){const t=i.Pc(11);i.Vb(3),i.Ec("entity",i.zc(4,19,o.entity$)),i.Vb(2),i.Ec("vdrIfPermissions","UpdatePromotion"),i.Vb(3),i.Ec("ngIf",i.zc(9,21,o.isNew$))("ngIfElse",t),i.Vb(4),i.Ec("formGroup",o.detailForm),i.Vb(1),i.Ec("label",i.zc(14,23,"common.name")),i.Vb(2),i.Ec("readonly",!i.zc(16,25,"UpdatePromotion")),i.Vb(2),i.Ec("label",i.zc(18,27,"marketing.starts-at")),i.Vb(3),i.Ec("label",i.zc(21,29,"marketing.ends-at")),i.Vb(3),i.Ec("label",i.zc(24,31,"marketing.coupon-code")),i.Vb(2),i.Ec("readonly",!i.zc(26,33,"UpdatePromotion")),i.Vb(2),i.Ec("label",i.zc(28,35,"marketing.per-customer-limit")),i.Vb(2),i.Ec("readonly",!i.zc(30,37,"UpdatePromotion")),i.Vb(5),i.cd(i.zc(35,39,"marketing.conditions")),i.Vb(2),i.Ec("ngForOf",o.conditions),i.Vb(2),i.Ec("vdrIfPermissions","UpdatePromotion"),i.Vb(3),i.cd(i.zc(42,41,"marketing.actions")),i.Vb(2),i.Ec("ngForOf",o.actions),i.Vb(2),i.Ec("vdrIfPermissions","UpdatePromotion")}},directives:[s.c,s.e,s.ab,s.pb,s.f,s.d,u.p,c.E,c.q,c.j,s.db,s.eb,c.b,c.p,c.h,s.N,c.v,c.d,p.t,u.o,p.k,c.a,p.i,c.g,s.C,s.S,s.V,p.o,s.U,s.T],pipes:[u.b,f.d,s.hb],styles:[""],changeDetection:0}),S.ctorParameters=()=>[{type:r.e},{type:r.a},{type:s.Ib},{type:i.k},{type:s.K},{type:c.e},{type:s.zb}],S=Object(n.c)([Object(n.f)("design:paramtypes",[r.e,r.a,s.Ib,i.k,s.K,c.e,s.zb])],S);let x=class extends s.w{constructor(t,o,e,n,i){super(o,e),this.dataService=t,this.notificationService=n,this.modalService=i,super.setQueryFn((...t)=>this.dataService.promotion.getPromotions(...t),t=>t.promotions)}deletePromotion(t){this.modalService.dialog({title:Object(a.a)("catalog.confirm-delete-promotion"),buttons:[{type:"secondary",label:Object(a.a)("common.cancel")},{type:"danger",label:Object(a.a)("common.delete"),returnValue:!0}]}).pipe(Object(l.a)(o=>o?this.dataService.promotion.deletePromotion(t):b.a)).subscribe(()=>{this.notificationService.success(Object(a.a)("common.notify-delete-success"),{entity:"Promotion"}),this.refresh()},t=>{this.notificationService.error(Object(a.a)("common.notify-delete-error"),{entity:"Promotion"})})}};x.\u0275fac=function(t){return new(t||x)(i.hc(s.K),i.hc(r.e),i.hc(r.a),i.hc(s.zb),i.hc(s.yb))},x.\u0275cmp=i.bc({type:x,selectors:[["vdr-promotion-list"]],features:[i.Sb],decls:25,vars:25,consts:[["locationId","promotion-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"left","align-middle"],[4,"ngIf"],[1,"align-middle"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"]],template:function(t,o){1&t&&(i.nc(0,"vdr-action-bar"),i.nc(1,"vdr-ab-right"),i.ic(2,"vdr-action-bar-items",0),i.Zc(3,z,4,5,"a",1),i.mc(),i.mc(),i.nc(4,"vdr-data-table",2),i.vc("pageChange",(function(t){return o.setPageNumber(t)}))("itemsPerPageChange",(function(t){return o.setItemsPerPage(t)})),i.yc(5,"async"),i.yc(6,"async"),i.yc(7,"async"),i.yc(8,"async"),i.nc(9,"vdr-dt-column"),i.bd(10),i.yc(11,"translate"),i.mc(),i.nc(12,"vdr-dt-column"),i.bd(13),i.yc(14,"translate"),i.mc(),i.nc(15,"vdr-dt-column"),i.bd(16),i.yc(17,"translate"),i.mc(),i.nc(18,"vdr-dt-column"),i.bd(19),i.yc(20,"translate"),i.mc(),i.ic(21,"vdr-dt-column"),i.ic(22,"vdr-dt-column"),i.ic(23,"vdr-dt-column"),i.Zc(24,F,27,26,"ng-template"),i.mc()),2&t&&(i.Vb(3),i.Ec("vdrIfPermissions","CreatePromotion"),i.Vb(1),i.Ec("items",i.zc(5,9,o.items$))("itemsPerPage",i.zc(6,11,o.itemsPerPage$))("totalItems",i.zc(7,13,o.totalItems$))("currentPage",i.zc(8,15,o.currentPage$)),i.Vb(6),i.cd(i.zc(11,17,"common.name")),i.Vb(3),i.cd(i.zc(14,19,"marketing.coupon-code")),i.Vb(3),i.cd(i.zc(17,21,"marketing.starts-at")),i.Vb(3),i.cd(i.zc(20,23,"marketing.ends-at")))},directives:[s.c,s.f,s.d,s.pb,s.M,s.L,r.h,p.o,u.p,s.Nb,s.S,s.V,s.U,s.T,s.B],pipes:[u.b,f.d,u.f,s.hb],styles:[""],changeDetection:0}),x.ctorParameters=()=>[{type:s.K},{type:r.e},{type:r.a},{type:s.zb},{type:s.yb}],x=Object(n.c)([Object(n.f)("design:paramtypes",[s.K,r.e,r.a,s.zb,s.yb])],x);let U=class extends s.v{constructor(t,o){super(t,{__typename:"Promotion",id:"",createdAt:"",updatedAt:"",name:"",enabled:!1,conditions:[],actions:[]},t=>o.promotion.getPromotion(t).mapStream(t=>t.promotion))}};U.\u0275fac=function(t){return new(t||U)(i.rc(r.e),i.rc(s.K))},U.ctorParameters=()=>[{type:r.e},{type:s.K}],U.\u0275prov=Object(i.dc)({factory:function(){return new U(Object(i.rc)(r.e),Object(i.rc)(s.K))},token:U,providedIn:"root"}),U=Object(n.c)([Object(n.f)("design:paramtypes",[r.e,s.K])],U);const N={breadcrumb:Object(a.a)("breadcrumb.promotions")},L={breadcrumb:T},$=[{path:"promotions",component:x,data:N},{path:"promotions/:id",component:S,resolve:Object(s.Tb)(U),canDeactivate:[s.x],data:L}];function T(t,o){return Object(s.Vb)({entity:t.entity,id:o.id,breadcrumbKey:"breadcrumb.promotions",getName:t=>t.name,route:"promotions"})}let Z=class{};Z.\u0275mod=i.fc({type:Z}),Z.\u0275inj=i.ec({factory:function(t){return new(t||Z)},imports:[[s.Jb,r.i.forChild($)]]})}}]);